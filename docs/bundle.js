(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
(function (Buffer){
const regl=require("regl")("#target",{pixelRatio:.75}),{setupWebcam:setupWebcam}=require("./src/setup-facemesh.js");let shaders=require("./src/pack.shader.js"),handleActivity=require("./src/fade.js"),buildReference=require("./src/reference.js"),loadingShader=Buffer("cHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7CnVuaWZvcm0gZmxvYXQgdGljazsKdW5pZm9ybSBmbG9hdCB0aW1lOwp1bmlmb3JtIGJvb2wgaGFzRmFjZTsKdW5pZm9ybSB2ZWMyIHJlc29sdXRpb247CnVuaWZvcm0gc2FtcGxlcjJEIHByZXZpb3VzVGV4Owp1bmlmb3JtIHNhbXBsZXIyRCBjYW1UZXg7CnVuaWZvcm0gdmVjMiB2aWRlb1Jlc29sdXRpb247CnVuaWZvcm0gdmVjMiBzY2FsZWRWaWRlb1Jlc29sdXRpb247CnZhcnlpbmcgdmVjMiB1djsKCnZlYzIgcGl4ZWwgPSAxLjAgLyByZXNvbHV0aW9uOwoKdm9pZCBtYWluKCkgewogIHZlYzIgdXZOID0gKHV2ICogMC41KSArIHZlYzIoMC41KTsKICB2ZWMyIHJlc1JhdGlvID0gc2NhbGVkVmlkZW9SZXNvbHV0aW9uIC8gcmVzb2x1dGlvbjsKICB2ZWMyIHdlYmNhbUNvb3JkID0gKHV2IC8gcmVzUmF0aW8pIC8gMi4wICsgdmVjMigwLjUpOwoKICB2ZWMyIGZsaXB3Y29yZCA9IHZlYzIoMS4pIC0gd2ViY2FtQ29vcmQ7CiAgdmVjMiBiYWNrQ29vcmQgPSB1diAqICgxLjAgKyAwLjAxKTsKICBiYWNrQ29vcmQgPSAoYmFja0Nvb3JkIC8gMi4wKSArIHZlYzIoMC41KTsKICB2ZWMzIHdlYmNhbUNvbG9yID0gdGV4dHVyZTJEKGNhbVRleCwgZmxpcHdjb3JkKS5yZ2I7CiAgdmVjMyBiYWNrQnVmZmVyQ29sb3IgPSB0ZXh0dXJlMkQocHJldmlvdXNUZXgsIGJhY2tDb29yZCkucmdiOwogIHZlYzMgY29sb3IgPSB3ZWJjYW1Db2xvcjsKCiAgaWYgKCFoYXNGYWNlKSB7CiAgICBmbG9hdCBzY2FuTGluZSA9IG1vZCh0aW1lICogMC41LCAxLjApOwogICAgaWYgKGFicyh1dk4ueCAtIHNjYW5MaW5lKSA8IHBpeGVsLnggKiAxLikgewogICAgICBjb2xvciArPSB2ZWMzKDAuLCAxLjAsIDAuKSAqCiAgICAgICAgICAgICAgICgwLjUgKyBtYXgoc2luKHV2Ti55ICogMjAwLiArIHRpbWUgKiAyLjApLCAwLjApICogMC41KTsKICAgIH0KICAgIGNvbG9yLmcgPSBjb2xvci5nICogMC41ICsgYmFja0J1ZmZlckNvbG9yLmcgKiAwLjU7CiAgfQogIGdsX0ZyYWdDb2xvciA9IHZlYzQoY29sb3IsIDEpOwp9Cg==","base64"),prefix=Buffer("cHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7Cgp2YXJ5aW5nIHZlYzIgdXY7CnVuaWZvcm0gZmxvYXQgdGltZTsKdW5pZm9ybSB2ZWMyIHJlc29sdXRpb247CnVuaWZvcm0gdmVjMiB2aWRlb1Jlc29sdXRpb247CnVuaWZvcm0gdmVjMiBzY2FsZWRWaWRlb1Jlc29sdXRpb247CnVuaWZvcm0gdmVjMiBmYWNlQ2VudGVyOwp1bmlmb3JtIHNhbXBsZXIyRCBjYW1UZXg7CnVuaWZvcm0gc2FtcGxlcjJEIG1hc2tUZXg7CnVuaWZvcm0gc2FtcGxlcjJEIHByZXZpb3VzVGV4OwovLyBTUEFDRVIKdmVjMiBwaXhlbCA9IDEuMCAvIHJlc29sdXRpb247CgojZGVmaW5lIFBJIDMuMTQxNTkyNjUzOAojZGVmaW5lIFRBVSA2LjI4MzE4NTMwNwoKLy8gU1BBQ0VSCgp2ZWMzIGdldENhbSh2ZWMyIHBvcykgewogIHZlYzIgcmVzUmF0aW8gPSBzY2FsZWRWaWRlb1Jlc29sdXRpb24gLyByZXNvbHV0aW9uOwogIHZlYzIgd2ViY2FtQ29vcmQgPSAocG9zIC8gcmVzUmF0aW8pIC8gMi4wICsgdmVjMigwLjUpOwogIHZlYzIgZmxpcHdjb3JkID0gdmVjMigxLikgLSB3ZWJjYW1Db29yZDsKICByZXR1cm4gdGV4dHVyZTJEKGNhbVRleCwgZmxpcHdjb3JkKS5yZ2I7Cn0KCnZlYzMgZ2V0UHJldmlvdXModmVjMiBwb3MpIHsKICB2ZWMyIGJhY2tDb29yZCA9IChwb3MgLyAyLjApICsgdmVjMigwLjUpOwogIHJldHVybiB0ZXh0dXJlMkQocHJldmlvdXNUZXgsIGJhY2tDb29yZCkucmdiOwp9Ci8vIFNQQUNFUgoKLy8gQWNjZXNzIEZhY2lhbCBGZWF0dXJlIE1hc2tzCgpmbG9hdCBnZXRGYWNlKHZlYzIgcG9zKSB7CiAgdmVjMiByZXNSYXRpbyA9IHNjYWxlZFZpZGVvUmVzb2x1dGlvbiAvIHJlc29sdXRpb247CiAgdmVjMiB3ZWJjYW1Db29yZCA9IChwb3MgLyByZXNSYXRpbykgLyAyLjAgKyB2ZWMyKDAuNSk7CiAgdmVjMiBmbGlwd2NvcmQgPSB2ZWMyKDEuKSAtIHdlYmNhbUNvb3JkOwogIHJldHVybiB0ZXh0dXJlMkQobWFza1RleCwgZmxpcHdjb3JkKS5iOwp9CmZsb2F0IGdldEV5ZSh2ZWMyIHBvcykgewogIHZlYzIgcmVzUmF0aW8gPSBzY2FsZWRWaWRlb1Jlc29sdXRpb24gLyByZXNvbHV0aW9uOwogIHZlYzIgd2ViY2FtQ29vcmQgPSAocG9zIC8gcmVzUmF0aW8pIC8gMi4wICsgdmVjMigwLjUpOwogIHZlYzIgZmxpcHdjb3JkID0gdmVjMigxLikgLSB3ZWJjYW1Db29yZDsKICByZXR1cm4gdGV4dHVyZTJEKG1hc2tUZXgsIGZsaXB3Y29yZCkuZzsKfQpmbG9hdCBnZXRNb3V0aCh2ZWMyIHBvcykgewogIHZlYzIgcmVzUmF0aW8gPSBzY2FsZWRWaWRlb1Jlc29sdXRpb24gLyByZXNvbHV0aW9uOwogIHZlYzIgd2ViY2FtQ29vcmQgPSAocG9zIC8gcmVzUmF0aW8pIC8gMi4wICsgdmVjMigwLjUpOwogIHZlYzIgZmxpcHdjb3JkID0gdmVjMigxLikgLSB3ZWJjYW1Db29yZDsKICByZXR1cm4gdGV4dHVyZTJEKG1hc2tUZXgsIGZsaXB3Y29yZCkucjsKfQoKLy8gU1BBQ0VSCnZlYzIgcm90YXRlKHZlYzIgdiwgZmxvYXQgYSkgewogIGZsb2F0IHMgPSBzaW4oYSk7CiAgZmxvYXQgYyA9IGNvcyhhKTsKICBtYXQyIG0gPSBtYXQyKGMsIC1zLCBzLCBjKTsKICByZXR1cm4gbSAqIHY7Cn0KLy8gU1BBQ0VSCgpmbG9hdCBtYXAoZmxvYXQgdmFsdWUsIGZsb2F0IG1pbjEsIGZsb2F0IG1heDEsIGZsb2F0IG1pbjIsIGZsb2F0IG1heDIpIHsKICByZXR1cm4gbWluMiArICh2YWx1ZSAtIG1pbjEpICogKG1heDIgLSBtaW4yKSAvIChtYXgxIC0gbWluMSk7Cn0KCi8vIFNQQUNFUgovLyBDb2xvciBTaG9ydGhhbmRzCgp2ZWMzIGJsYWNrID0gdmVjMygwLjApOwp2ZWMzIHdoaXRlID0gdmVjMygxLjApOwp2ZWMzIHJlZCA9IHZlYzMoMC44NiwgMC4yMiwgMC4yNyk7CnZlYzMgb3JhbmdlID0gdmVjMygwLjkyLCAwLjQ5LCAwLjA3KTsKdmVjMyB5ZWxsb3cgPSB2ZWMzKDAuOTEsIDAuODksIDAuMjYpOwp2ZWMzIGdyZWVuID0gdmVjMygwLjAsIDAuNzEsIDAuMzEpOwp2ZWMzIGJsdWUgPSB2ZWMzKDAuMDUsIDAuMzUsIDAuNjUpOwp2ZWMzIHB1cnBsZSA9IHZlYzMoMC4zOCwgMC4wOSwgMC42NCk7CnZlYzMgcGluayA9IHZlYzMoLjksIDAuNzU4LCAwLjc5OCk7CnZlYzMgbGltZSA9IHZlYzMoMC4zNjEsIDAuOTY5LCAwLjI4Mik7CnZlYzMgdGVhbCA9IHZlYzMoMC4zOTYsIDAuODc4LCAwLjg3OCk7CnZlYzMgbWFnZW50YSA9IHZlYzMoMS4wLCAwLjE4OSwgMC43NDUpOwp2ZWMzIGJyb3duID0gdmVjMygwLjk2LCAwLjQ3NCwgMC4yMjcpOwovLyBTUEFDRVIKZmxvYXQgcmFuZChmbG9hdCBuKSB7IHJldHVybiBmcmFjdChzaW4obikgKiA0Mzc1OC41NDUzMTIzKTsgfQoKLy8gMUQsIDJELCAzRCBTaW1wbGV4IE5vaXNlCmZsb2F0IG5vaXNlKGZsb2F0IHApIHsKICBmbG9hdCBmbCA9IGZsb29yKHApOwogIGZsb2F0IGZjID0gZnJhY3QocCk7CiAgcmV0dXJuIG1peChyYW5kKGZsKSwgcmFuZChmbCArIDEuMCksIGZjKTsKfQoKLy8gSU5URVJOQUwKdmVjMyBtb2QyODkodmVjMyB4KSB7IHJldHVybiB4IC0gZmxvb3IoeCAqICgxLjAgLyAyODkuMCkpICogMjg5LjA7IH0KLy8gSU5URVJOQUwKdmVjMiBtb2QyODkodmVjMiB4KSB7IHJldHVybiB4IC0gZmxvb3IoeCAqICgxLjAgLyAyODkuMCkpICogMjg5LjA7IH0KLy8gSU5URVJOQUwKdmVjMyBwZXJtdXRlKHZlYzMgeCkgeyByZXR1cm4gbW9kMjg5KCgoeCAqIDM0LjApICsgMS4wKSAqIHgpOyB9CgpmbG9hdCBub2lzZSh2ZWMyIHYpIHsKICBjb25zdCB2ZWM0IEMgPSB2ZWM0KDAuMjExMzI0ODY1NDA1MTg3LCAgLy8gKDMuMC1zcXJ0KDMuMCkpLzYuMAogICAgICAgICAgICAgICAgICAgICAgMC4zNjYwMjU0MDM3ODQ0MzksICAvLyAwLjUqKHNxcnQoMy4wKS0xLjApCiAgICAgICAgICAgICAgICAgICAgICAtMC41NzczNTAyNjkxODk2MjYsIC8vIC0xLjAgKyAyLjAgKiBDLngKICAgICAgICAgICAgICAgICAgICAgIDAuMDI0MzkwMjQzOTAyNDM5KTsgLy8gMS4wIC8gNDEuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGaXJzdCBjb3JuZXIKICB2ZWMyIGkgPSBmbG9vcih2ICsgZG90KHYsIEMueXkpKTsKICB2ZWMyIHgwID0gdiAtIGkgKyBkb3QoaSwgQy54eCk7CgogIC8vIE90aGVyIGNvcm5lcnMKICB2ZWMyIGkxOwogIC8vIGkxLnggPSBzdGVwKCB4MC55LCB4MC54ICk7IC8vIHgwLnggPiB4MC55ID8gMS4wIDogMC4wCiAgLy8gaTEueSA9IDEuMCAtIGkxLng7CiAgaTEgPSAoeDAueCA+IHgwLnkpID8gdmVjMigxLjAsIDAuMCkgOiB2ZWMyKDAuMCwgMS4wKTsKICAvLyB4MCA9IHgwIC0gMC4wICsgMC4wICogQy54eCA7CiAgLy8geDEgPSB4MCAtIGkxICsgMS4wICogQy54eCA7CiAgLy8geDIgPSB4MCAtIDEuMCArIDIuMCAqIEMueHggOwogIHZlYzQgeDEyID0geDAueHl4eSArIEMueHh6ejsKICB4MTIueHkgLT0gaTE7CgogIC8vIFBlcm11dGF0aW9ucwogIGkgPSBtb2QyODkoaSk7IC8vIEF2b2lkIHRydW5jYXRpb24gZWZmZWN0cyBpbiBwZXJtdXRhdGlvbgogIHZlYzMgcCA9CiAgICAgIHBlcm11dGUocGVybXV0ZShpLnkgKyB2ZWMzKDAuMCwgaTEueSwgMS4wKSkgKyBpLnggKyB2ZWMzKDAuMCwgaTEueCwgMS4wKSk7CgogIHZlYzMgbSA9IG1heCgKICAgICAgMC41IC0gdmVjMyhkb3QoeDAsIHgwKSwgZG90KHgxMi54eSwgeDEyLnh5KSwgZG90KHgxMi56dywgeDEyLnp3KSksIDAuMCk7CiAgbSA9IG0gKiBtOwogIG0gPSBtICogbTsKCiAgLy8gR3JhZGllbnRzOiA0MSBwb2ludHMgdW5pZm9ybWx5IG92ZXIgYSBsaW5lLCBtYXBwZWQgb250byBhIGRpYW1vbmQuCiAgLy8gVGhlIHJpbmcgc2l6ZSAxNyoxNyA9IDI4OSBpcyBjbG9zZSB0byBhIG11bHRpcGxlIG9mIDQxICg0MSo3ID0gMjg3KQoKICB2ZWMzIHggPSAyLjAgKiBmcmFjdChwICogQy53d3cpIC0gMS4wOwogIHZlYzMgaCA9IGFicyh4KSAtIDAuNTsKICB2ZWMzIG94ID0gZmxvb3IoeCArIDAuNSk7CiAgdmVjMyBhMCA9IHggLSBveDsKCiAgLy8gTm9ybWFsaXNlIGdyYWRpZW50cyBpbXBsaWNpdGx5IGJ5IHNjYWxpbmcgbQogIC8vIEFwcHJveGltYXRpb24gb2Y6IG0gKj0gaW52ZXJzZXNxcnQoIGEwKmEwICsgaCpoICk7CiAgbSAqPSAxLjc5Mjg0MjkxNDAwMTU5IC0gMC44NTM3MzQ3MjA5NTMxNCAqIChhMCAqIGEwICsgaCAqIGgpOwoKICAvLyBDb21wdXRlIGZpbmFsIG5vaXNlIHZhbHVlIGF0IFAKICB2ZWMzIGc7CiAgZy54ID0gYTAueCAqIHgwLnggKyBoLnggKiB4MC55OwogIGcueXogPSBhMC55eiAqIHgxMi54eiArIGgueXogKiB4MTIueXc7CiAgcmV0dXJuIDEzMC4wICogZG90KG0sIGcpOwp9CgovLyBJTlRFUk5BTAp2ZWMzIG1vZDI4OV8zKHZlYzMgeCkgeyByZXR1cm4geCAtIGZsb29yKHggKiAoMS4wIC8gMjg5LjApKSAqIDI4OS4wOyB9Ci8vIElOVEVSTkFMCnZlYzQgbW9kMjg5XzQodmVjNCB4KSB7IHJldHVybiB4IC0gZmxvb3IoeCAqICgxLjAgLyAyODkuMCkpICogMjg5LjA7IH0KLy8gSU5URVJOQUwKdmVjNCBwZXJtdXRlKHZlYzQgeCkgeyByZXR1cm4gbW9kMjg5XzQoKCh4ICogMzQuMCkgKyAxLjApICogeCk7IH0KLy8gSU5URVJOQUwKdmVjNCB0YXlsb3JJbnZTcXJ0KHZlYzQgcikgeyByZXR1cm4gMS43OTI4NDI5MTQwMDE1OSAtIDAuODUzNzM0NzIwOTUzMTQgKiByOyB9CgpmbG9hdCBub2lzZSh2ZWMzIHYpIHsKICBjb25zdCB2ZWMyIEMgPSB2ZWMyKDEuMCAvIDYuMCwgMS4wIC8gMy4wKTsKICBjb25zdCB2ZWM0IEQgPSB2ZWM0KDAuMCwgMC41LCAxLjAsIDIuMCk7CgogIC8vIEZpcnN0IGNvcm5lcgogIHZlYzMgaSA9IGZsb29yKHYgKyBkb3QodiwgQy55eXkpKTsKICB2ZWMzIHgwID0gdiAtIGkgKyBkb3QoaSwgQy54eHgpOwoKICAvLyBPdGhlciBjb3JuZXJzCiAgdmVjMyBnID0gc3RlcCh4MC55engsIHgwLnh5eik7CiAgdmVjMyBsID0gMS4wIC0gZzsKICB2ZWMzIGkxID0gbWluKGcueHl6LCBsLnp4eSk7CiAgdmVjMyBpMiA9IG1heChnLnh5eiwgbC56eHkpOwoKICAvLyAgIHgwID0geDAgLSAwLjAgKyAwLjAgKiBDLnh4eDsKICAvLyAgIHgxID0geDAgLSBpMSAgKyAxLjAgKiBDLnh4eDsKICAvLyAgIHgyID0geDAgLSBpMiAgKyAyLjAgKiBDLnh4eDsKICAvLyAgIHgzID0geDAgLSAxLjAgKyAzLjAgKiBDLnh4eDsKICB2ZWMzIHgxID0geDAgLSBpMSArIEMueHh4OwogIHZlYzMgeDIgPSB4MCAtIGkyICsgQy55eXk7IC8vIDIuMCpDLnggPSAxLzMgPSBDLnkKICB2ZWMzIHgzID0geDAgLSBELnl5eTsgICAgICAvLyAtMS4wKzMuMCpDLnggPSAtMC41ID0gLUQueQoKICAvLyBQZXJtdXRhdGlvbnMKICBpID0gbW9kMjg5XzMoaSk7CiAgdmVjNCBwID0gcGVybXV0ZShwZXJtdXRlKHBlcm11dGUoaS56ICsgdmVjNCgwLjAsIGkxLnosIGkyLnosIDEuMCkpICsgaS55ICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVjNCgwLjAsIGkxLnksIGkyLnksIDEuMCkpICsKICAgICAgICAgICAgICAgICAgIGkueCArIHZlYzQoMC4wLCBpMS54LCBpMi54LCAxLjApKTsKCiAgLy8gR3JhZGllbnRzOiA3eDcgcG9pbnRzIG92ZXIgYSBzcXVhcmUsIG1hcHBlZCBvbnRvIGFuIG9jdGFoZWRyb24uCiAgLy8gVGhlIHJpbmcgc2l6ZSAxNyoxNyA9IDI4OSBpcyBjbG9zZSB0byBhIG11bHRpcGxlIG9mIDQ5ICg0OSo2ID0gMjk0KQogIGZsb2F0IG5fID0gMC4xNDI4NTcxNDI4NTc7IC8vIDEuMC83LjAKICB2ZWMzIG5zID0gbl8gKiBELnd5eiAtIEQueHp4OwoKICB2ZWM0IGogPSBwIC0gNDkuMCAqIGZsb29yKHAgKiBucy56ICogbnMueik7IC8vICBtb2QocCw3KjcpCgogIHZlYzQgeF8gPSBmbG9vcihqICogbnMueik7CiAgdmVjNCB5XyA9IGZsb29yKGogLSA3LjAgKiB4Xyk7IC8vIG1vZChqLE4pCgogIHZlYzQgeCA9IHhfICogbnMueCArIG5zLnl5eXk7CiAgdmVjNCB5ID0geV8gKiBucy54ICsgbnMueXl5eTsKICB2ZWM0IGggPSAxLjAgLSBhYnMoeCkgLSBhYnMoeSk7CgogIHZlYzQgYjAgPSB2ZWM0KHgueHksIHkueHkpOwogIHZlYzQgYjEgPSB2ZWM0KHguencsIHkuencpOwoKICAvLyB2ZWM0IHMwID0gdmVjNChsZXNzVGhhbihiMCwwLjApKSoyLjAgLSAxLjA7CiAgLy8gdmVjNCBzMSA9IHZlYzQobGVzc1RoYW4oYjEsMC4wKSkqMi4wIC0gMS4wOwogIHZlYzQgczAgPSBmbG9vcihiMCkgKiAyLjAgKyAxLjA7CiAgdmVjNCBzMSA9IGZsb29yKGIxKSAqIDIuMCArIDEuMDsKICB2ZWM0IHNoID0gLXN0ZXAoaCwgdmVjNCgwLjApKTsKCiAgdmVjNCBhMCA9IGIwLnh6eXcgKyBzMC54enl3ICogc2gueHh5eTsKICB2ZWM0IGExID0gYjEueHp5dyArIHMxLnh6eXcgKiBzaC56end3OwoKICB2ZWMzIHAwID0gdmVjMyhhMC54eSwgaC54KTsKICB2ZWMzIHAxID0gdmVjMyhhMC56dywgaC55KTsKICB2ZWMzIHAyID0gdmVjMyhhMS54eSwgaC56KTsKICB2ZWMzIHAzID0gdmVjMyhhMS56dywgaC53KTsKCiAgLy8gTm9ybWFsaXNlIGdyYWRpZW50cwogIHZlYzQgbm9ybSA9CiAgICAgIHRheWxvckludlNxcnQodmVjNChkb3QocDAsIHAwKSwgZG90KHAxLCBwMSksIGRvdChwMiwgcDIpLCBkb3QocDMsIHAzKSkpOwogIHAwICo9IG5vcm0ueDsKICBwMSAqPSBub3JtLnk7CiAgcDIgKj0gbm9ybS56OwogIHAzICo9IG5vcm0udzsKCiAgLy8gTWl4IGZpbmFsIG5vaXNlIHZhbHVlCiAgdmVjNCBtID0KICAgICAgbWF4KDAuNiAtIHZlYzQoZG90KHgwLCB4MCksIGRvdCh4MSwgeDEpLCBkb3QoeDIsIHgyKSwgZG90KHgzLCB4MykpLCAwLjApOwogIG0gPSBtICogbTsKICByZXR1cm4gNDIuMCAqCiAgICAgICAgIGRvdChtICogbSwgdmVjNChkb3QocDAsIHgwKSwgZG90KHAxLCB4MSksIGRvdChwMiwgeDIpLCBkb3QocDMsIHgzKSkpOwp9CgovLyBGcmFjdGFsIEJyb3duaWFuIE5vaXNlCmZsb2F0IGZibihmbG9hdCB4LCBjb25zdCBpbiBpbnQgaXRlcmF0aW9ucykgewogIGZsb2F0IHYgPSAwLjA7CiAgZmxvYXQgYSA9IDAuNTsKICBmbG9hdCBzaGlmdCA9IGZsb2F0KDEwMCk7CiAgZm9yIChpbnQgaSA9IDA7IGkgPCAzMjsgKytpKSB7CiAgICBpZiAoaSA8IGl0ZXJhdGlvbnMpIHsKICAgICAgdiArPSBhICogbm9pc2UoeCk7CiAgICAgIHggPSB4ICogMi4wICsgc2hpZnQ7CiAgICAgIGEgKj0gMC41OwogICAgfQogIH0KICByZXR1cm4gdjsKfQoKZmxvYXQgZmJuKHZlYzIgeCwgY29uc3QgaW4gaW50IGl0ZXJhdGlvbnMpIHsKICBmbG9hdCB2ID0gMC4wOwogIGZsb2F0IGEgPSAwLjU7CiAgdmVjMiBzaGlmdCA9IHZlYzIoMTAwKTsKICAvLyBSb3RhdGUgdG8gcmVkdWNlIGF4aWFsIGJpYXMKICBtYXQyIHJvdCA9IG1hdDIoY29zKDAuNSksIHNpbigwLjUpLCAtc2luKDAuNSksIGNvcygwLjUwKSk7CiAgZm9yIChpbnQgaSA9IDA7IGkgPCAzMjsgKytpKSB7CiAgICBpZiAoaSA8IGl0ZXJhdGlvbnMpIHsKICAgICAgdiArPSBhICogbm9pc2UoeCk7CiAgICAgIHggPSByb3QgKiB4ICogMi4wICsgc2hpZnQ7CiAgICAgIGEgKj0gMC41OwogICAgfQogIH0KICByZXR1cm4gdjsKfQoKZmxvYXQgZmJuKHZlYzMgeCwgY29uc3QgaW4gaW50IGl0ZXJhdGlvbnMpIHsKICBmbG9hdCB2ID0gMC4wOwogIGZsb2F0IGEgPSAwLjU7CiAgdmVjMyBzaGlmdCA9IHZlYzMoMTAwKTsKICBmb3IgKGludCBpID0gMDsgaSA8IDMyOyArK2kpIHsKICAgIGlmIChpIDwgaXRlcmF0aW9ucykgewogICAgICB2ICs9IGEgKiBub2lzZSh4KTsKICAgICAgeCA9IHggKiAyLjAgKyBzaGlmdDsKICAgICAgYSAqPSAwLjU7CiAgICB9CiAgfQogIHJldHVybiB2Owp9Ci8vIFNQQUNFUgovLyBJTlRFUk5BTApmbG9hdCBodWUycmdiKGZsb2F0IGYxLCBmbG9hdCBmMiwgZmxvYXQgaHVlKSB7CiAgLy8gaHR0cDovL3d3dy5jaGlsbGlhbnQuY29tL3JnYjJoc3YuaHRtbAoKICBpZiAoaHVlIDwgMC4wKQogICAgaHVlICs9IDEuMDsKICBlbHNlIGlmIChodWUgPiAxLjApCiAgICBodWUgLT0gMS4wOwogIGZsb2F0IHJlczsKICBpZiAoKDYuMCAqIGh1ZSkgPCAxLjApCiAgICByZXMgPSBmMSArIChmMiAtIGYxKSAqIDYuMCAqIGh1ZTsKICBlbHNlIGlmICgoMi4wICogaHVlKSA8IDEuMCkKICAgIHJlcyA9IGYyOwogIGVsc2UgaWYgKCgzLjAgKiBodWUpIDwgMi4wKQogICAgcmVzID0gZjEgKyAoZjIgLSBmMSkgKiAoKDIuMCAvIDMuMCkgLSBodWUpICogNi4wOwogIGVsc2UKICAgIHJlcyA9IGYxOwogIHJldHVybiByZXM7Cn0KCi8vIENvbG9yIFNwYWNlIENvbnZlcnNpb24KCnZlYzMgaHNsMnJnYih2ZWMzIGhzbCkgewogIHZlYzMgcmdiOwoKICBpZiAoaHNsLnkgPT0gMC4wKSB7CiAgICByZ2IgPSB2ZWMzKGhzbC56KTsgLy8gTHVtaW5hbmNlCiAgfSBlbHNlIHsKICAgIGZsb2F0IGYyOwoKICAgIGlmIChoc2wueiA8IDAuNSkKICAgICAgZjIgPSBoc2wueiAqICgxLjAgKyBoc2wueSk7CiAgICBlbHNlCiAgICAgIGYyID0gaHNsLnogKyBoc2wueSAtIGhzbC55ICogaHNsLno7CgogICAgZmxvYXQgZjEgPSAyLjAgKiBoc2wueiAtIGYyOwoKICAgIHJnYi5yID0gaHVlMnJnYihmMSwgZjIsIGhzbC54ICsgKDEuMCAvIDMuMCkpOwogICAgcmdiLmcgPSBodWUycmdiKGYxLCBmMiwgaHNsLngpOwogICAgcmdiLmIgPSBodWUycmdiKGYxLCBmMiwgaHNsLnggLSAoMS4wIC8gMy4wKSk7CiAgfQogIHJldHVybiByZ2I7Cn0KCnZlYzMgaHNsMnJnYihmbG9hdCBoLCBmbG9hdCBzLCBmbG9hdCBsKSB7IHJldHVybiBoc2wycmdiKHZlYzMoaCwgcywgbCkpOyB9CgovLyBJTlRFUk5BTAp2ZWMzIFJHQnRvSENWKHZlYzMgcmdiKSB7CiAgLy8gQmFzZWQgb24gd29yayBieSBTYW0gSG9jZXZhciBhbmQgRW1pbCBQZXJzc29uCiAgdmVjNCBwID0gKHJnYi5nIDwgcmdiLmIpID8gdmVjNChyZ2IuYmcsIC0xLjAsIDIuMCAvIDMuMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB2ZWM0KHJnYi5nYiwgMC4wLCAtMS4wIC8gMy4wKTsKICB2ZWM0IHEgPSAocmdiLnIgPCBwLngpID8gdmVjNChwLnh5dywgcmdiLnIpIDogdmVjNChyZ2IuciwgcC55engpOwogIGZsb2F0IGMgPSBxLnggLSBtaW4ocS53LCBxLnkpOwogIGZsb2F0IGggPSBhYnMoKHEudyAtIHEueSkgLyAoNi4wICogYyArIDFlLTEwKSArIHEueik7CiAgcmV0dXJuIHZlYzMoaCwgYywgcS54KTsKfQoKdmVjMyByZ2IyaHNsKHZlYzMgcmdiKSB7CiAgdmVjMyBoY3YgPSBSR0J0b0hDVihyZ2IpOwogIGZsb2F0IGwgPSBoY3YueiAtIGhjdi55ICogMC41OwogIGZsb2F0IHMgPSBoY3YueSAvICgxLjAgLSBhYnMobCAqIDIuMCAtIDEuMCkgKyAxZS0xMCk7CiAgcmV0dXJuIHZlYzMoaGN2LngsIHMsIGwpOwp9Cgp2ZWMzIHJnYjJoc2woZmxvYXQgciwgZmxvYXQgZywgZmxvYXQgYikgeyByZXR1cm4gcmdiMmhzbCh2ZWMzKHIsIGcsIGIpKTsgfQoKZmxvYXQgbHVtYSh2ZWMzIGNvbG9yKSB7IHJldHVybiBkb3QoY29sb3IsIHZlYzMoMC4yOTksIDAuNTg3LCAwLjExNCkpOyB9Cg==","base64").toString(),demos=["babies.glsl","censor.glsl","godrays.glsl","ice.glsl","potion-seller.glsl","six-eyes.glsl","starter.glsl","triple.glsl"],previousDemo=document.getElementById("prev"),nextDemo=document.getElementById("next"),demoIndex=demos.indexOf("starter.glsl"),{paintFace:paintFace}=require("./src/paint");const Editor=require("./src/editor.js");var editor=new Editor;function replaceShader(){let g=demos[demoIndex];fetch("./demos/"+g).then(g=>g.text()).then(g=>{editor.setValue(g)})}previousDemo.addEventListener("click",()=>{demoIndex=(demoIndex+demos.length-1)%demos.length,replaceShader()}),nextDemo.addEventListener("click",()=>{demoIndex=(demoIndex+1)%demos.length,replaceShader()}),shaders.fragment=shaders.fragment.replace("#define GLSLIFY 1\n","");let knownGoodShader=shaders.fragment,prefixLength=prefix.split(/\r\n|\r|\n/).length-1,widgets=[],markers=[];function clearHints(g){editor.cm.operation(function(){for(var g=0;g<widgets.length;++g)editor.cm.removeLineWidget(widgets[g]);widgets.length=0;for(g=0;g<markers.length;++g)markers[g].clear();markers.length=0})}function displayError(g,I,C,A){g-=prefixLength;var e=document.createElement("div");if(widgets.some(I=>I._line_number==g))return;e.appendChild(document.createTextNode(("^"+C).padStart(I+C.length+1,"Â "))),e.className="lint-error fade";let M=editor.cm.addLineWidget(g-1,e,{coverGutter:!1,noHScroll:!0});M._line_number=g,widgets.push(M),markers.push(editor.cm.markText({line:g-1,ch:I},{line:g-1,ch:I+A.length},{className:"cm-custom-error",attributes:{alt:C}}))}window.shader_error_hook=displayError,editor.setValue(shaders.fragment),editor.cm.on("change",g=>{let I=editor.getValue();shaders.fragment=I,clearHints()});const lastFrame=regl.texture();let faceDetectionTexture,paintElement=document.getElementById("paint"),hasFace=!1,faceCenter=[.5,.5];setupWebcam({regl:regl,done:(g,{videoWidth:I,videoHeight:C,getKeyPoints:A})=>{faceDetectionTexture=regl.texture(paintElement);let e=regl({uniforms:{camTex:g,previousTex:lastFrame,maskTex:faceDetectionTexture,videoResolution:[I,C],time:({time:g})=>g,hasFace:()=>hasFace,resolution:({viewportWidth:g,viewportHeight:I})=>[g,I],scaledVideoResolution:({viewportWidth:g,viewportHeight:A})=>{return g/A>I/C?[I*(A/C),A]:[g,C*(g/I)]},faceCenter:()=>[2*(1-faceCenter[0]/I)-1,2*(1-faceCenter[1]/C)-1]},frag:()=>hasFace?prefix+shaders.fragment:loadingShader,vert:()=>shaders.vertex,attributes:{position:[[-1,4],[-1,-1],[4,-1]]},count:3});regl.frame(function(g){let I=A();I&&(hasFace=!0,faceCenter=I.noseTip[0],ctx=paintFace(I),faceDetectionTexture.subimage(ctx));try{e()}catch(g){return console.log(g),void(shaders.fragment=knownGoodShader)}knownGoodShader=shaders.fragment,lastFrame({copy:!0})})}});

}).call(this,require("buffer").Buffer)
},{"./src/editor.js":337,"./src/fade.js":338,"./src/pack.shader.js":339,"./src/paint":340,"./src/reference.js":341,"./src/setup-facemesh.js":342,"buffer":300,"regl":322}],2:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tf=require("@tensorflow/tfjs-core");exports.disposeBox=(t=>{t.startEndTensor.dispose(),t.startPoint.dispose(),t.endPoint.dispose()}),exports.createBox=(t=>({startEndTensor:t,startPoint:tf.slice(t,[0,0],[-1,2]),endPoint:tf.slice(t,[0,2],[-1,2])})),exports.scaleBox=((t,e)=>{const s=tf.mul(t.startPoint,e),o=tf.mul(t.endPoint,e),r=tf.concat2d([s,o],1);return exports.createBox(r)});

},{"@tensorflow/tfjs-core":175}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tf=require("@tensorflow/tfjs-core"),box_1=require("./box"),ANCHORS_CONFIG={strides:[8,16],anchors:[2,6]},NUM_LANDMARKS=6;function generateAnchors(t,e,s){const o=[];for(let i=0;i<s.strides.length;i++){const n=s.strides[i],a=Math.floor((e+n-1)/n),r=Math.floor((t+n-1)/n),c=s.anchors[i];for(let t=0;t<a;t++){const e=n*(t+.5);for(let t=0;t<r;t++){const s=n*(t+.5);for(let t=0;t<c;t++)o.push([s,e])}}}return o}function decodeBounds(t,e,s){const o=tf.slice(t,[0,1],[-1,2]),i=tf.add(o,e),n=tf.slice(t,[0,3],[-1,2]),a=tf.div(n,s),r=tf.div(i,s),c=tf.div(a,2),l=tf.sub(r,c),f=tf.add(r,c),d=tf.mul(l,s),h=tf.mul(f,s);return tf.concat2d([d,h],1)}function getInputTensorDimensions(t){return t instanceof tf.Tensor?[t.shape[0],t.shape[1]]:[t.height,t.width]}function flipFaceHorizontal(t,e){let s,o,i;if(t.topLeft instanceof tf.Tensor&&t.bottomRight instanceof tf.Tensor){const[n,a]=tf.tidy(()=>[tf.concat([tf.sub(e-1,t.topLeft.slice(0,1)),t.topLeft.slice(1,1)]),tf.concat([tf.sub(e-1,t.bottomRight.slice(0,1)),t.bottomRight.slice(1,1)])]);s=n,o=a,null!=t.landmarks&&(i=tf.tidy(()=>{const s=tf.sub(tf.tensor1d([e-1,0]),t.landmarks),o=tf.tensor1d([1,-1]);return tf.mul(s,o)}))}else{const[n,a]=t.topLeft,[r,c]=t.bottomRight;s=[e-1-n,a],o=[e-1-r,c],null!=t.landmarks&&(i=t.landmarks.map(t=>[e-1-t[0],t[1]]))}const n={topLeft:s,bottomRight:o};return null!=i&&(n.landmarks=i),null!=t.probability&&(n.probability=t.probability instanceof tf.Tensor?t.probability.clone():t.probability),n}function scaleBoxFromPrediction(t,e){return tf.tidy(()=>{let s;return s=t.hasOwnProperty("box")?t.box:t,box_1.scaleBox(s,e).startEndTensor.squeeze()})}class BlazeFaceModel{constructor(t,e,s,o,i,n){this.blazeFaceModel=t,this.width=e,this.height=s,this.maxFaces=o,this.anchorsData=generateAnchors(e,s,ANCHORS_CONFIG),this.anchors=tf.tensor2d(this.anchorsData),this.inputSizeData=[e,s],this.inputSize=tf.tensor1d([e,s]),this.iouThreshold=i,this.scoreThreshold=n}async getBoundingBoxes(t,e,s=!0){const[o,i,n]=tf.tidy(()=>{const e=t.resizeBilinear([this.width,this.height]),s=tf.mul(tf.sub(e.div(255),.5),2),o=this.blazeFaceModel.predict(s).squeeze(),i=decodeBounds(o,this.anchors,this.inputSize),n=tf.slice(o,[0,0],[-1,1]);return[o,i,tf.sigmoid(n).squeeze()]}),a=console.warn;console.warn=(()=>{});const r=tf.image.nonMaxSuppression(i,n,this.maxFaces,this.iouThreshold,this.scoreThreshold);console.warn=a;const c=await r.array();r.dispose();let l=c.map(t=>tf.slice(i,[t,0],[1,-1]));e||(l=await Promise.all(l.map(async t=>{const e=await t.array();return t.dispose(),e})));const f=t.shape[1],d=t.shape[2];let h;h=e?tf.div([d,f],this.inputSize):[d/this.inputSizeData[0],f/this.inputSizeData[1]];const p=[];for(let t=0;t<l.length;t++){const i=l[t],a=tf.tidy(()=>{const a=i instanceof tf.Tensor?box_1.createBox(i):box_1.createBox(tf.tensor2d(i));if(!s)return a;const r=c[t];let l;return l=e?this.anchors.slice([r,0],[1,2]):this.anchorsData[r],{box:a,landmarks:tf.slice(o,[r,NUM_LANDMARKS-1],[1,-1]).squeeze().reshape([NUM_LANDMARKS,-1]),probability:tf.slice(n,[r],[1]),anchor:l}});p.push(a)}return i.dispose(),n.dispose(),o.dispose(),{boxes:p,scaleFactor:h}}async estimateFaces(t,e=!1,s=!1,o=!0){const[,i]=getInputTensorDimensions(t),n=tf.tidy(()=>(t instanceof tf.Tensor||(t=tf.browser.fromPixels(t)),t.toFloat().expandDims(0))),{boxes:a,scaleFactor:r}=await this.getBoundingBoxes(n,e,o);return n.dispose(),e?a.map(t=>{const e=scaleBoxFromPrediction(t,r);let n={topLeft:e.slice([0],[2]),bottomRight:e.slice([2],[2])};if(o){const{landmarks:e,probability:s,anchor:o}=t,i=e.add(o).mul(r);n.landmarks=i,n.probability=s}return s&&(n=flipFaceHorizontal(n,i)),n}):Promise.all(a.map(async t=>{const e=scaleBoxFromPrediction(t,r);let n;if(o){const[s,o,i]=await Promise.all([t.landmarks,e,t.probability].map(async t=>t.array())),a=t.anchor,[c,l]=r,f=s.map(t=>[(t[0]+a[0])*c,(t[1]+a[1])*l]);n={topLeft:o.slice(0,2),bottomRight:o.slice(2),landmarks:f,probability:i},box_1.disposeBox(t.box),t.landmarks.dispose(),t.probability.dispose()}else{const t=await e.array();n={topLeft:t.slice(0,2),bottomRight:t.slice(2)}}return e.dispose(),s&&(n=flipFaceHorizontal(n,i)),n}))}}exports.BlazeFaceModel=BlazeFaceModel;

},{"./box":2,"@tensorflow/tfjs-core":175}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tfconv=require("@tensorflow/tfjs-converter"),face_1=require("./face"),BLAZEFACE_MODEL_URL="https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1";async function load({maxFaces:e=10,inputWidth:o=128,inputHeight:a=128,iouThreshold:t=.3,scoreThreshold:r=.75}={}){const c=await tfconv.loadGraphModel(BLAZEFACE_MODEL_URL,{fromTFHub:!0});return new face_1.BlazeFaceModel(c,o,a,e,t,r)}exports.load=load;var face_2=require("./face");exports.BlazeFaceModel=face_2.BlazeFaceModel;

},{"./face":3,"@tensorflow/tfjs-converter":15}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tf=require("@tensorflow/tfjs-core");function disposeBox(t){null!=t&&null!=t.startPoint&&(t.startEndTensor.dispose(),t.startPoint.dispose(),t.endPoint.dispose())}function createBox(t,e,o){return{startEndTensor:t,startPoint:null!=e?e:tf.slice(t,[0,0],[-1,2]),endPoint:null!=o?o:tf.slice(t,[0,2],[-1,2])}}function scaleBoxCoordinates(t,e){const o=tf.mul(t.startPoint,e),n=tf.mul(t.endPoint,e);return createBox(tf.concat2d([o,n],1))}function getBoxSize(t){return tf.tidy(()=>{const e=tf.sub(t.endPoint,t.startPoint);return tf.abs(e)})}function getBoxCenter(t){return tf.tidy(()=>{const e=tf.div(tf.sub(t.endPoint,t.startPoint),2);return tf.add(t.startPoint,e)})}function cutBoxFromImageAndResize(t,e,o){const n=e.shape[1],s=e.shape[2],r=t.startEndTensor;return tf.tidy(()=>{const t=tf.concat2d([r.slice([0,1],[-1,1]),r.slice([0,0],[-1,1]),r.slice([0,3],[-1,1]),r.slice([0,2],[-1,1])],0),i=tf.div(t.transpose(),[n,s,n,s]);return tf.image.cropAndResize(e,i,[0],o)})}function enlargeBox(t,e=1.5){return tf.tidy(()=>{const o=getBoxCenter(t),n=getBoxSize(t),s=tf.mul(tf.div(n,2),e),r=tf.sub(o,s),i=tf.add(o,s);return createBox(tf.concat2d([r,i],1),r,i)})}exports.disposeBox=disposeBox,exports.createBox=createBox,exports.scaleBoxCoordinates=scaleBoxCoordinates,exports.getBoxSize=getBoxSize,exports.getBoxCenter=getBoxCenter,exports.cutBoxFromImageAndResize=cutBoxFromImageAndResize,exports.enlargeBox=enlargeBox;

},{"@tensorflow/tfjs-core":175}],6:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const blazeface=require("@tensorflow-models/blazeface"),tfconv=require("@tensorflow/tfjs-converter"),tf=require("@tensorflow/tfjs-core"),keypoints_1=require("./keypoints"),pipeline_1=require("./pipeline"),FACEMESH_GRAPHMODEL_PATH="https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",MESH_MODEL_INPUT_WIDTH=192,MESH_MODEL_INPUT_HEIGHT=192;async function load({maxContinuousChecks:e=5,detectionConfidence:t=.9,maxFaces:o=10,iouThreshold:n=.3,scoreThreshold:s=.75}={}){const[i,c]=await Promise.all([loadDetectorModel(o,n,s),loadMeshModel()]);return new FaceMesh(i,c,e,t,o)}async function loadDetectorModel(e,t,o){return blazeface.load({maxFaces:e,iouThreshold:t,scoreThreshold:o})}async function loadMeshModel(){return tfconv.loadGraphModel(FACEMESH_GRAPHMODEL_PATH,{fromTFHub:!0})}function getInputTensorDimensions(e){return e instanceof tf.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}function flipFaceHorizontal(e,t){if(e.mesh instanceof tf.Tensor){const[o,n,s,i]=tf.tidy(()=>{const o=tf.tensor1d([t-1,0,0]),n=tf.tensor1d([1,-1,1]);return tf.tidy(()=>[tf.concat([tf.sub(t-1,e.boundingBox.topLeft.slice(0,1)),e.boundingBox.topLeft.slice(1,1)]),tf.concat([tf.sub(t-1,e.boundingBox.bottomRight.slice(0,1)),e.boundingBox.bottomRight.slice(1,1)]),tf.sub(o,e.mesh).mul(n),tf.sub(o,e.scaledMesh).mul(n)])});return Object.assign({},e,{boundingBox:{topLeft:o,bottomRight:n},mesh:s,scaledMesh:i})}return Object.assign({},e,{boundingBox:{topLeft:[t-1-e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]],bottomRight:[t-1-e.boundingBox.bottomRight[0],e.boundingBox.bottomRight[1]]},mesh:e.mesh.map(e=>{const o=e.slice(0);return o[0]=t-1-e[0],o}),scaledMesh:e.scaledMesh.map(e=>{const o=e.slice(0);return o[0]=t-1-e[0],o})})}exports.load=load;class FaceMesh{constructor(e,t,o,n,s){this.pipeline=new pipeline_1.Pipeline(e,t,MESH_MODEL_INPUT_WIDTH,MESH_MODEL_INPUT_HEIGHT,o,s),this.detectionConfidence=n}static getAnnotations(){return keypoints_1.MESH_ANNOTATIONS}async estimateFaces(e,t=!1,o=!1){const[,n]=getInputTensorDimensions(e),s=tf.tidy(()=>(e instanceof tf.Tensor||(e=tf.browser.fromPixels(e)),e.toFloat().expandDims(0))),i=tf.env().get("WEBGL_PACK_DEPTHWISECONV");tf.env().set("WEBGL_PACK_DEPTHWISECONV",!0);const c=await this.pipeline.predict(s);return tf.env().set("WEBGL_PACK_DEPTHWISECONV",i),s.dispose(),null!=c&&c.length>0?Promise.all(c.map(async(e,s)=>{const{coords:i,scaledCoords:c,box:a,flag:r}=e;let l=[r];t||(l=l.concat([i,c,a.startPoint,a.endPoint]));const d=await Promise.all(l.map(async e=>e.array())),f=d[0];if(r.dispose(),f<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(s),t){const e={faceInViewConfidence:f,mesh:i,scaledMesh:c,boundingBox:{topLeft:a.startPoint.squeeze(),bottomRight:a.endPoint.squeeze()}};return o?flipFaceHorizontal(e,n):e}const[u,h,p,m]=d.slice(1);c.dispose(),i.dispose();let b={faceInViewConfidence:f,boundingBox:{topLeft:p,bottomRight:m},mesh:u,scaledMesh:h};o&&(b=flipFaceHorizontal(b,n));const M={};for(const e in keypoints_1.MESH_ANNOTATIONS)M[e]=keypoints_1.MESH_ANNOTATIONS[e].map(e=>b.scaledMesh[e]);return b.annotations=M,b})):[]}}exports.FaceMesh=FaceMesh;

},{"./keypoints":7,"./pipeline":8,"@tensorflow-models/blazeface":4,"@tensorflow/tfjs-converter":15,"@tensorflow/tfjs-core":175}],7:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MESH_ANNOTATIONS={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};

},{}],8:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tf=require("@tensorflow/tfjs-core"),box_1=require("./box"),LANDMARKS_COUNT=468,UPDATE_REGION_OF_INTEREST_IOU_THRESHOLD=.25;class Pipeline{constructor(e,t,s,o,i,n){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=e,this.meshDetector=t,this.meshWidth=s,this.meshHeight=o,this.maxContinuousChecks=i,this.maxFaces=n}async predict(e){if(this.shouldUpdateRegionsOfInterest()){const t=!0,s=!1,{boxes:o,scaleFactor:i}=await this.boundingBoxDetector.getBoundingBoxes(e,t,s);if(0===o.length)return i.dispose(),this.clearAllRegionsOfInterest(),null;const n=o.map(e=>box_1.enlargeBox(box_1.scaleBoxCoordinates(e,i)));o.forEach(box_1.disposeBox),this.updateRegionsOfInterest(n),this.runsWithoutFaceDetector=0}else this.runsWithoutFaceDetector++;return tf.tidy(()=>this.regionsOfInterest.map((t,s)=>{const o=box_1.cutBoxFromImageAndResize(t,e,[this.meshHeight,this.meshWidth]).div(255),[,i,n]=this.meshDetector.predict(o),r=tf.reshape(n,[-1,3]),h=tf.div(box_1.getBoxSize(t),[this.meshWidth,this.meshHeight]),a=tf.mul(r,h.concat(tf.tensor2d([1],[1,1]),1)).add(t.startPoint.concat(tf.tensor2d([0],[1,1]),1)),c=this.calculateLandmarksBoundingBox(a),l=this.regionsOfInterest[s];return box_1.disposeBox(l),this.regionsOfInterest[s]=c,{coords:r,scaledCoords:a,box:c,flag:i.squeeze()}}))}updateRegionsOfInterest(e){for(let t=0;t<e.length;t++){const s=e[t],o=this.regionsOfInterest[t];let i=0;if(o&&o.startPoint){const[e,t,n,r]=s.startEndTensor.arraySync()[0],[h,a,c,l]=o.startEndTensor.arraySync()[0],g=Math.max(e,h),x=Math.max(t,a),f=(Math.min(n,c)-g)*(Math.min(r,l)-x);i=f/((n-e)*(r-t)+(c-h)*(l-t)-f)}i>UPDATE_REGION_OF_INTEREST_IOU_THRESHOLD?box_1.disposeBox(s):(this.regionsOfInterest[t]=s,box_1.disposeBox(o))}for(let t=e.length;t<this.regionsOfInterest.length;t++)box_1.disposeBox(this.regionsOfInterest[t]);this.regionsOfInterest=this.regionsOfInterest.slice(0,e.length)}clearRegionOfInterest(e){null!=this.regionsOfInterest[e]&&(box_1.disposeBox(this.regionsOfInterest[e]),this.regionsOfInterest=[...this.regionsOfInterest.slice(0,e),...this.regionsOfInterest.slice(e+1)])}clearAllRegionsOfInterest(){for(let e=0;e<this.regionsOfInterest.length;e++)box_1.disposeBox(this.regionsOfInterest[e]);this.regionsOfInterest=[]}shouldUpdateRegionsOfInterest(){const e=this.regionsOfInterest.length,t=0===e;return 1===this.maxFaces||t?t:e!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks}calculateLandmarksBoundingBox(e){const t=e.slice([0,0],[LANDMARKS_COUNT,1]),s=e.slice([0,1],[LANDMARKS_COUNT,1]),o=tf.stack([t.min(),s.min(),t.max(),s.max()]),i=box_1.createBox(o.expandDims(0));return box_1.enlargeBox(i)}}exports.Pipeline=Pipeline;

},{"./box":5,"@tensorflow/tfjs-core":175}],9:[function(require,module,exports){
"use strict";var DataType,SaverDef;Object.defineProperty(exports,"__esModule",{value:!0}),function(T){T[T.DT_INVALID=0]="DT_INVALID",T[T.DT_FLOAT=1]="DT_FLOAT",T[T.DT_DOUBLE=2]="DT_DOUBLE",T[T.DT_INT32=3]="DT_INT32",T[T.DT_UINT8=4]="DT_UINT8",T[T.DT_INT16=5]="DT_INT16",T[T.DT_INT8=6]="DT_INT8",T[T.DT_STRING=7]="DT_STRING",T[T.DT_COMPLEX64=8]="DT_COMPLEX64",T[T.DT_INT64=9]="DT_INT64",T[T.DT_BOOL=10]="DT_BOOL",T[T.DT_QINT8=11]="DT_QINT8",T[T.DT_QUINT8=12]="DT_QUINT8",T[T.DT_QINT32=13]="DT_QINT32",T[T.DT_BFLOAT16=14]="DT_BFLOAT16",T[T.DT_FLOAT_REF=101]="DT_FLOAT_REF",T[T.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",T[T.DT_INT32_REF=103]="DT_INT32_REF",T[T.DT_UINT8_REF=104]="DT_UINT8_REF",T[T.DT_INT16_REF=105]="DT_INT16_REF",T[T.DT_INT8_REF=106]="DT_INT8_REF",T[T.DT_STRING_REF=107]="DT_STRING_REF",T[T.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",T[T.DT_INT64_REF=109]="DT_INT64_REF",T[T.DT_BOOL_REF=110]="DT_BOOL_REF",T[T.DT_QINT8_REF=111]="DT_QINT8_REF",T[T.DT_QUINT8_REF=112]="DT_QUINT8_REF",T[T.DT_QINT32_REF=113]="DT_QINT32_REF",T[T.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(DataType=exports.DataType||(exports.DataType={})),function(T){!function(T){T[T.LEGACY=0]="LEGACY",T[T.V1=1]="V1",T[T.V2=2]="V2"}(T.CheckpointFormatVersion||(T.CheckpointFormatVersion={}))}(SaverDef=exports.SaverDef||(exports.SaverDef={}));

},{}],10:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ExecutionContext=function(){function t(t,e){this.weightMap=t,this.tensorArrayMap=e,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return t.prototype.newFrame=function(t,e){return{id:t,frameName:e,iterationId:0}},Object.defineProperty(t.prototype,"currentContext",{get:function(){return this.contexts},set:function(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),t.prototype.generateCurrentContextIds=function(){for(var t=[],e=0;e<this.contexts.length-1;e++){var n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t},t.prototype.contextIdforContexts=function(t){return t?t.map(function(t){return 0===t.id&&0===t.iterationId?"":t.frameName+"-"+t.iterationId}).join("/"):""},t.prototype.enterFrame=function(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},t.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},t.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},t.prototype.getWeight=function(t){return this.weightMap[t]},t.prototype.addTensorArray=function(t){this.tensorArrayMap[t.id]=t},t.prototype.getTensorArray=function(t){return this.tensorArrayMap[t]},t}();exports.ExecutionContext=ExecutionContext;

},{}],11:[function(require,module,exports){
"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),utils_1=require("../operations/executors/utils"),operation_executor_1=require("../operations/operation_executor"),execution_context_1=require("./execution_context"),model_analysis_1=require("./model_analysis"),GraphExecutor=function(){function e(e){this.graph=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=e.outputs,this._inputs=e.inputs,this._signature=e.signature}return Object.defineProperty(e.prototype,"weightMap",{get:function(){return this._weightMap},set:function(e){var t=Object.keys(e).map(function(t){return e[t].map(function(e){return e.id})});this.weightIds=[].concat.apply([],t),this._weightMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){return e.signatureKey||e.name})},enumerable:!0,configurable:!0}),e.prototype.getCompilationKey=function(e,t){var n=e.map(function(e){return e.name}).sort(),r=t.map(function(e){return e.name}).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)},e.prototype.compile=function(e,t){var n=model_analysis_1.getExecutionSubgraph(e,t,this.weightMap),r=n.missingInputs,o=n.dynamicNode,i=n.syncInputs;if(null!=o)throw new Error("This execution contains the node '"+o.name+"', which has the dynamic op '"+o.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+i+"]");if(r.length>0){var a=t.map(function(e){return e.name}),s=Object.keys(e);throw new Error("Cannot compute the outputs ["+a+"] from the provided inputs ["+s+"]. Missing the following inputs: ["+r+"]")}return model_analysis_1.getNodesInTopologicalOrder(this.graph,this.weightMap,n)},e.prototype.execute=function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var o=r.map(function(e){return n.graph.nodes[utils_1.parseNodeName(e)[0]]}),i=t.map(function(e){return n.graph.nodes[utils_1.parseNodeName(e)[0]]}),a=this.getCompilationKey(o,i),s=this.compiledMap.get(a);null==s&&(s=this.compile(e,i),this.compiledMap.set(a,s));var u={};return tfjs_core_1.tidy(function(){var r=new execution_context_1.ExecutionContext(n._weightMap,u),o=__assign({},n.weightMap);Object.keys(e).forEach(function(t){var n=utils_1.parseNodeName(t),r=n[0],i=[];i[n[1]]=e[t],o[r]=i});for(var i=n.getFrozenTensorIds(o),a={},c=0;c<s.length;c++){var p=s[c];if(!o[p.name]){var h=operation_executor_1.executeOp(p,o,r);if(h instanceof Promise)throw new Error("The execution of the op '"+p.op+"' returned a promise. Please use model.executeAsync() instead.");o[p.name]=h,n.checkTensorForDisposal(p.name,p,o,r,i,t,a)}}return t.map(function(e){return utils_1.getTensor(e,o,r)})})},e.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(t){return e[t]}).map(function(e){return e.map(function(e){return e.id})}));return new Set(t)},e.prototype.checkTensorForDisposal=function(e,t,n,r,o,i,a){"control"!==t.category&&-1===i.indexOf(e)&&(n[e].forEach(function(e){null!=e&&(a[e.id]=(a[e.id]||0)+t.children.length)}),t.inputs.forEach(function(e){if("control"!==e.category){var t=utils_1.getTensorsForCurrentContenxt(e.name,n,r);null!=t&&t.forEach(function(e){if(e&&!o.has(e.id)){var t=a[e.id];1===t?(e.dispose(),delete a[e.id]):null!=t&&a[e.id]--}})}}))},e.prototype.executeAsync=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o,i,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t),n={},r=new execution_context_1.ExecutionContext(this._weightMap,n),[4,this.executeWithControlFlow(e,r,t)];case 1:return o=c.sent(),i=t.map(function(e){return utils_1.getTensor(e,o,r)}),a=new Set(i.map(function(e){return e.id})),s=new Set(Object.keys(e).map(function(t){return e[t].id})),Object.keys(o).forEach(function(e){o[e].forEach(function(e){!e||e.isDisposed||a.has(e.id)||s.has(e.id)||-1!==u.weightIds.indexOf(e.id)||e.dispose()})}),[2,i]}})})},e.prototype.executeWithControlFlow=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,o,i,a,s,u,c,p,h,l,d,f,m,y,g,_,v=this;return __generator(this,function(w){switch(w.label){case 0:r=Object.keys(e),o=r.map(function(e){return v.graph.nodes[utils_1.parseNodeName(e)[0]]}),i=n.map(function(e){return v.graph.nodes[utils_1.parseNodeName(e)[0]]}),a=model_analysis_1.getExecutionSubgraph(e,i,this.weightMap),s=a.usedNodes,u=a.missingInputs,c=a.dynamicNode,p=a.syncInputs,h=o.concat(this.graph.weights).map(function(e){return{node:e,contexts:t.currentContext}}),l=__assign({},this.weightMap),Object.keys(e).forEach(function(t){var n=utils_1.parseNodeName(t),r=n[0],o=[];o[n[1]]=e[t],l[r]=o}),d={},f=this.getFrozenTensorIds(l),m={},w.label=1;case 1:return h.length>0?(y=this.processStack(o,h,t,l,m,f,n,d,s),[4,Promise.all(y)]):[3,3];case 2:return w.sent(),[3,1];case 3:if(null==c&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(g=i.filter(function(e){return!model_analysis_1.isControlFlow(e)&&!utils_1.getTensor(e.name,l,t)}).map(function(e){return e.name})).length>0)throw _="",null!=c&&(_="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+p+"]"),new Error("Cannot compute the outputs ["+g+"] from the provided inputs ["+r+"]. Consider providing the following inputs: ["+u+"]. "+_);return[2,l]}})})},e.prototype.processStack=function(e,t,n,r,o,i,a,s,u){for(var c=this,p=[],h=function(){var h=t.pop();n.currentContext=h.contexts;var d="";if("Enter"===h.node.op&&utils_1.getParamValue("isConstant",h.node,r,n)&&(d=utils_1.getNodeNameAndIndex(h.node.name,n)[0]),-1===e.indexOf(h.node)){var f=operation_executor_1.executeOp(h.node,r,n);d||(d=utils_1.getNodeNameAndIndex(h.node.name,n)[0]);var m=n.currentContext;f instanceof Promise?p.push(f.then(function(e){return r[d]=e,n.currentContext=m,c.checkTensorForDisposal(d,h.node,r,n,i,a,s),c.processChildNodes(h.node,t,n,r,o,u),e})):(r[d]=f,l.checkTensorForDisposal(d,h.node,r,n,i,a,s),l.processChildNodes(h.node,t,n,r,o,u))}else l.processChildNodes(h.node,t,n,r,o,u)},l=this;t.length>0;)h();return p},e.prototype.processChildNodes=function(e,t,n,r,o,i){e.children.forEach(function(e){var a=utils_1.getNodeNameAndIndex(e.name,n)[0];!o[a]&&i.has(e.name)&&("Merge"===e.op?e.inputNames.some(function(e){return!!utils_1.getTensor(e,r,n)})&&(o[a]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every(function(e){return!!utils_1.getTensor(e,r,n)})&&(o[a]=!0,t.push({contexts:n.currentContext,node:e})))})},e.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(e){return e.dispose()})})},e.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(n){var r=e[n],o=utils_1.parseNodeName(n)[0],i=t.graph.nodes[o];if(i.attrParams.shape&&i.attrParams.shape.value){var a=i.attrParams.shape.value,s=a.length===r.shape.length&&r.shape.every(function(e,t){return-1===a[t]||a[t]===e});tfjs_core_1.util.assert(s,function(){return"The shape of dict['"+i.name+"'] provided in model.execute(dict) must be ["+a+"], but was ["+r.shape+"]"})}i.attrParams.dtype&&i.attrParams.dtype.value&&tfjs_core_1.util.assert(r.dtype===i.attrParams.dtype.value,function(){return"The dtype of dict['"+i.name+"'] provided in model.execute(dict) must be "+i.attrParams.dtype.value+", but was "+r.dtype})})},e.prototype.mapInputs=function(e){var t={};for(var n in e){if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n])t[this._signature.inputs[n].name]=e[n];else t[n]=e[n]}return t},e.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter(function(e){var n=utils_1.parseNodeName(e)[0];return null==t.graph.nodes[n]});if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+n+"] that are not part of graph")},e.prototype.mapOutputs=function(e){var t=this;return e.map(function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e},{})},e.prototype.checkOutputs=function(e){var t=this;e.forEach(function(e){var n=utils_1.parseNodeName(e)[0];if(!t.graph.nodes[n])throw new Error("The output '"+e+"' is not found in the graph")})},e}();exports.GraphExecutor=GraphExecutor;

},{"../operations/executors/utils":34,"../operations/operation_executor":51,"./execution_context":10,"./model_analysis":13,"@tensorflow/tfjs-core":175}],12:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}u((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,o,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),operation_mapper_1=require("../operations/operation_mapper"),graph_executor_1=require("./graph_executor");exports.TFHUB_SEARCH_PARAM="?tfjs-format=file",exports.DEFAULT_MODEL_NAME="model.json";var GraphModel=function(){function e(e,t){void 0===t&&(t={}),this.modelUrl=e,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={})}return Object.defineProperty(e.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),e.prototype.findIOHandler=function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=tfjs_core_1.io.browserHTTPRequest(e,this.loadOptions);else{var t=tfjs_core_1.io.getLoadHandlers(e,this.loadOptions.onProgress);if(0===t.length)t.push(tfjs_core_1.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one ("+t.length+") load handlers for URL '"+[e]+"'");this.handler=t[0]}},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,o;return __generator(this,function(n){switch(n.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return e=this,[4,this.handler.load()];case 1:return e.artifacts=n.sent(),t=this.artifacts.modelTopology,r={},null!=this.artifacts.userDefinedMetadata&&(r=this.artifacts.userDefinedMetadata.signature),this.version=t.versions.producer+"."+t.versions.minConsumer,o=tfjs_core_1.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs),this.executor=new graph_executor_1.GraphExecutor(operation_mapper_1.OperationMapper.Instance.transformGraph(t,r)),this.executor.weightMap=this.convertTensorMapToTensorsMap(o),[2,!0]}})})},e.prototype.save=function(e,t){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){if("string"==typeof e){if(0===(t=tfjs_core_1.io.getSaveHandlers(e)).length)throw new Error("Cannot find any save handlers for URL '"+e+"'");if(t.length>1)throw new Error("Found more than one ("+t.length+") save handlers for URL '"+e+"'");e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},e.prototype.predict=function(e,t){return this.execute(e,this.outputNodes)},e.prototype.normalizeInputs=function(e){if(!(e instanceof tfjs_core_1.Tensor||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+e.length+" input tensors.");return this.inputNodes.reduce(function(t,r,o){return t[r]=e[o],t},{})},e.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},e.prototype.execute=function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var r=this.executor.execute(e,t);return r.length>1?r:r[0]},e.prototype.executeAsync=function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(o){switch(o.label){case 0:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 1:return[2,(r=o.sent()).length>1?r:r[0]]}})})},e.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,r){return t[r]=[e[r]],t},{})},e.prototype.dispose=function(){this.executor.dispose()},e}();function loadGraphModel(e,t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(o){switch(o.label){case 0:if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return null==t&&(t={}),t.fromTFHub&&null==e.load&&(e.endsWith("/")||(e+="/"),e=""+e+exports.DEFAULT_MODEL_NAME+exports.TFHUB_SEARCH_PARAM),[4,(r=new GraphModel(e,t)).load()];case 1:return o.sent(),[2,r]}})})}exports.GraphModel=GraphModel,exports.loadGraphModel=loadGraphModel;

},{"../operations/operation_mapper":52,"./graph_executor":11,"@tensorflow/tfjs-core":175}],13:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var utils_1=require("../operations/executors/utils");function getExecutionSubgraph(e,n,t){for(var o=new Set,r=[],s=null,a=null,u=new Set,i=Object.keys(e).map(function(e){return utils_1.parseNodeName(e)[0]}),p=n.slice();p.length>0;){var c=p.pop();(isControlFlow(c)||isDynamicShape(c))&&null==s&&(a=(s=c).children.map(function(e){return e.name}).filter(function(e){return o.has(e)})),o.add(c.name),null==t[c.name]&&(-1===i.indexOf(c.name)&&(0!==c.inputs.length?c.inputs.forEach(function(e){u.has(e.name)||(u.add(e.name),p.push(e))}):r.push(c.name)))}return{inputs:e,outputs:n,usedNodes:o,missingInputs:r,dynamicNode:s,syncInputs:a}}function getNodesInTopologicalOrder(e,n,t){var o=t.usedNodes,r=t.inputs,s=[];Object.keys(r).map(function(e){return utils_1.parseNodeName(e)[0]}).map(function(n){return e.nodes[n]}).forEach(function(e){o.has(e.name)&&s.push(e)}),e.weights.forEach(function(e){o.has(e.name)&&s.push(e)});for(var a=new Set,u=[];s.length>0;){var i=s.pop();a.add(i.name),n[i.name]||u.push(i),i.children.forEach(function(e){!a.has(e.name)&&o.has(e.name)&&e.inputs.every(function(e){return a.has(e.name)})&&s.push(e)})}return u}exports.getExecutionSubgraph=getExecutionSubgraph,exports.getNodesInTopologicalOrder=getNodesInTopologicalOrder;var CONTROL_FLOW_OPS=["Switch","Merge","Enter","Exit","NextIteration"],DYNAMIC_SHAPE_OPS=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function isControlFlow(e){return CONTROL_FLOW_OPS.indexOf(e.op)>=0}function isDynamicShape(e){return DYNAMIC_SHAPE_OPS.indexOf(e.op)>=0}exports.isControlFlow=isControlFlow,exports.isDynamicShape=isDynamicShape;

},{"../operations/executors/utils":34}],14:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),TensorArray=function(){function e(t,r,s,n,i,a,o){this.name=t,this.dtype=r,this.maxSize=s,this.elementShape=n,this.identicalElementShapes=i,this.dynamicSize=a,this.clearAfterRead=o,this.tensors=[],this.closed_=!1,this.id=e.nextId++}return Object.defineProperty(e.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),e.prototype.clearAndClose=function(){this.tensors.forEach(function(e){return e.tensor.dispose()}),this.tensors=[],this.closed_=!0},e.prototype.size=function(){return this.tensors.length},e.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||e>=this.tensors.length)throw new Error("Tried to read from index "+e+", but array size is: "+this.tensors.length);var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+e+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},e.prototype.readMany=function(e){var t=this;return e.map(function(e){return t.read(e)})},e.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index "+e+", but array is not resizeable and size is: "+this.maxSize);var r=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+",\n          because the value dtype is "+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+e+"."),r&&r.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been read.");if(r&&r.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been written.");r.tensor=t,r.written=!0,this.tensors[e]=r},e.prototype.writeMany=function(e,t){var r=this;if(e.length!==t.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+e.length+" is not the same as tensors size: "+t.length+".");e.forEach(function(e,s){return r.write(e,t[s])})},e.prototype.gather=function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(!e){e=[];for(var r=0;r<this.size();r++)e.push(r)}if(0===e.length)return tfjs_core_1.tensor([],[0].concat(this.elementShape));var s=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),tfjs_core_1.stack(s,0)},e.prototype.concat=function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+e);if(0===this.size())return tfjs_core_1.tensor([],[0].concat(this.elementShape));for(var t=[],r=0;r<this.size();r++)t.push(r);var s=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,s[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+s[0].shape+")"),tfjs_core_1.concat(s,0)},e.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+t.shape[0]);var r=Math.max.apply(Math,e);if(!this.dynamicSize&&r>=this.maxSize)throw new Error("Max index must be < array size ("+r+"  vs. "+this.maxSize+")");this.writeMany(e,tfjs_core_1.unstack(t,0))},e.prototype.split=function(e,t){var r=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);var s=0,n=e.map(function(e){return s+=e});if(s!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+s+", and tensor's shape is: "+t.shape);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+e.length+"), and the TensorArray is not marked as dynamically resizeable");var i=0===s?0:t.size/s,a=[];tfjs_core_1.tidy(function(){t=t.reshape([1,s,i]);for(var o=0;o<e.length;++o){var h=[0,0===o?0:n[o-1],0],d=[1,e[o],i];a[o]=tfjs_core_1.slice(t,h,d).reshape(r.elementShape)}return a});for(var o=[],h=0;h<e.length;h++)o[h]=h;this.writeMany(o,a)},e.prototype.assertShapesMatchAllowUndefinedSize=function(e,t,r){void 0===r&&(r=""),tfjs_core_1.util.assert(this.shapesEqualAllowUndefinedSize(e,t),function(){return r+" Shapes "+e+" and "+t+" must match"})},e.prototype.shapesEqualAllowUndefinedSize=function(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(-1!==e[r]&&-1!==t[r]&&e[r]!==t[r])return!1;return!0},e.nextId=0,e}();exports.TensorArray=TensorArray;

},{"@tensorflow/tfjs-core":175}],15:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var graph_model_1=require("./executor/graph_model");exports.GraphModel=graph_model_1.GraphModel,exports.loadGraphModel=graph_model_1.loadGraphModel;var register_1=require("./operations/custom_op/register");exports.deregisterOp=register_1.deregisterOp,exports.registerOp=register_1.registerOp;var version_1=require("./version");exports.version_converter=version_1.version;

},{"./executor/graph_model":12,"./operations/custom_op/register":17,"./version":53}],16:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var utils_1=require("../executors/utils"),operation_mapper_1=require("../operation_mapper"),NodeValueImpl=function(){function t(t,r,e){var n=this;this.node=t,this.tensorMap=r,this.context=e,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(function(t){return n.getInput(t)}),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(function(t,r){return t[r]=n.getAttr(r),t},{}))}return t.prototype.getInput=function(t){return utils_1.getTensor(t,this.tensorMap,this.context)},t.prototype.getAttr=function(t,r){var e=this.node.rawAttrs[t];if(null!=e.tensor)return utils_1.getTensor(t,this.tensorMap,this.context);if(null!=e.i||null!=e.f)return operation_mapper_1.getNumberParam(this.node.rawAttrs,t,r);if(null!=e.s)return operation_mapper_1.getStringParam(this.node.rawAttrs,t,r);if(null!=e.b)return operation_mapper_1.getBoolParam(this.node.rawAttrs,t,r);if(null!=e.shape)return operation_mapper_1.getTensorShapeParam(this.node.rawAttrs,t,r);if(null!=e.type)return operation_mapper_1.getDtypeParam(this.node.rawAttrs,t,r);if(null!=e.list){if(null!=e.list.i||null!=e.list.f)return operation_mapper_1.getNumericArrayParam(this.node.rawAttrs,t,r);if(null!=e.list.s)return operation_mapper_1.getStringArrayParam(this.node.rawAttrs,t,r);if(null!=e.list.shape)return operation_mapper_1.getTensorShapeArrayParam(this.node.rawAttrs,t,r);if(null!=e.list.b)return operation_mapper_1.getBoolArrayParam(this.node.rawAttrs,t,r);if(null!=e.list.type)return operation_mapper_1.getDtypeArrayParam(this.node.rawAttrs,t,r)}return r},t}();exports.NodeValueImpl=NodeValueImpl;

},{"../executors/utils":34,"../operation_mapper":52}],17:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CUSTOM_OPS={};function registerOp(e,t){var r={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};CUSTOM_OPS[e]=r}function getRegisteredOp(e){return CUSTOM_OPS[e]}function deregisterOp(e){delete CUSTOM_OPS[e]}exports.registerOp=registerOp,exports.getRegisteredOp=getRegisteredOp,exports.deregisterOp=deregisterOp;

},{}],18:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,a,t){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[tfc.add(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"AddN":return[tfc.addN(utils_1.getParamValue("tensors",e,a,t))];case"FloorMod":case"Mod":return[tfc.mod(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"Mul":return[tfc.mul(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"RealDiv":case"Div":return[tfc.div(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"DivNoNan":return[tfc.divNoNan(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"FloorDiv":return[tfc.floorDiv(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"Sub":return[tfc.sub(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"Minimum":return[tfc.minimum(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"Maximum":return[tfc.maximum(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"Pow":return[tfc.pow(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"SquaredDifference":return[tfc.squaredDifference(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="arithmetic";

},{"./utils":34,"@tensorflow/tfjs-core":175}],19:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,a,t){switch(e.op){case"Abs":case"ComplexAbs":return[tfc.abs(utils_1.getParamValue("x",e,a,t))];case"Acos":return[tfc.acos(utils_1.getParamValue("x",e,a,t))];case"Acosh":return[tfc.acosh(utils_1.getParamValue("x",e,a,t))];case"Asin":return[tfc.asin(utils_1.getParamValue("x",e,a,t))];case"Asinh":return[tfc.asinh(utils_1.getParamValue("x",e,a,t))];case"Atan":return[tfc.atan(utils_1.getParamValue("x",e,a,t))];case"Atan2":return[tfc.atan2(utils_1.getParamValue("x",e,a,t),utils_1.getParamValue("y",e,a,t))];case"Atanh":return[tfc.atanh(utils_1.getParamValue("x",e,a,t))];case"Ceil":return[tfc.ceil(utils_1.getParamValue("x",e,a,t))];case"Complex":return[tfc.complex(utils_1.getParamValue("real",e,a,t),utils_1.getParamValue("imag",e,a,t))];case"Cos":return[tfc.cos(utils_1.getParamValue("x",e,a,t))];case"Cosh":return[tfc.cosh(utils_1.getParamValue("x",e,a,t))];case"Elu":return[tfc.elu(utils_1.getParamValue("x",e,a,t))];case"Erf":return[tfc.erf(utils_1.getParamValue("x",e,a,t))];case"Exp":return[tfc.exp(utils_1.getParamValue("x",e,a,t))];case"Expm1":return[tfc.expm1(utils_1.getParamValue("x",e,a,t))];case"Floor":return[tfc.floor(utils_1.getParamValue("x",e,a,t))];case"Log":return[tfc.log(utils_1.getParamValue("x",e,a,t))];case"Log1p":return[tfc.log1p(utils_1.getParamValue("x",e,a,t))];case"Imag":return[tfc.imag(utils_1.getParamValue("x",e,a,t))];case"Neg":return[tfc.neg(utils_1.getParamValue("x",e,a,t))];case"Reciprocal":return[tfc.reciprocal(utils_1.getParamValue("x",e,a,t))];case"Real":return[tfc.real(utils_1.getParamValue("x",e,a,t))];case"Relu":return[tfc.relu(utils_1.getParamValue("x",e,a,t))];case"Round":return[tfc.round(utils_1.getParamValue("x",e,a,t))];case"Selu":return[tfc.selu(utils_1.getParamValue("x",e,a,t))];case"Sigmoid":return[tfc.sigmoid(utils_1.getParamValue("x",e,a,t))];case"Sin":return[tfc.sin(utils_1.getParamValue("x",e,a,t))];case"Sign":return[tfc.sign(utils_1.getParamValue("x",e,a,t))];case"Sinh":return[tfc.sinh(utils_1.getParamValue("x",e,a,t))];case"Softplus":return[tfc.softplus(utils_1.getParamValue("x",e,a,t))];case"Sqrt":return[tfc.sqrt(utils_1.getParamValue("x",e,a,t))];case"Square":return[tfc.square(utils_1.getParamValue("x",e,a,t))];case"Tanh":return[tfc.tanh(utils_1.getParamValue("x",e,a,t))];case"Tan":return[tfc.tan(utils_1.getParamValue("x",e,a,t))];case"Relu6":case"ClipByValue":return[tfc.clipByValue(utils_1.getParamValue("x",e,a,t),utils_1.getParamValue("clipValueMin",e,a,t),utils_1.getParamValue("clipValueMax",e,a,t))];case"Rsqrt":return[tfc.rsqrt(utils_1.getTensor(e.inputNames[0],a,t))];case"Prod":return[tfc.prod(utils_1.getParamValue("x",e,a,t),utils_1.getParamValue("axes",e,a,t))];case"LeakyRelu":return[tfc.leakyRelu(utils_1.getParamValue("x",e,a,t),utils_1.getParamValue("alpha",e,a,t))];case"Prelu":return[tfc.prelu(utils_1.getParamValue("x",e,a,t),utils_1.getParamValue("alpha",e,a,t))];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="basic_math";

},{"./utils":34,"@tensorflow/tfjs-core":175}],20:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,r,t,a){return new(t||(t=Promise))(function(n,s){function u(e){try{l(a.next(e))}catch(e){s(e)}}function o(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){e.done?n(e.value):new t(function(r){r(e.value)}).then(u,o)}l((a=a.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(e,r){var t,a,n,s,u={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,a&&(n=2&s[0]?a.return:s[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,s[1])).done)return n;switch(a=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return u.label++,{value:s[1],done:!1};case 5:u.label++,a=s[1],s=[0];continue;case 7:s=u.ops.pop(),u.trys.pop();continue;default:if(!(n=(n=u.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){u=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){u.label=s[1];break}if(6===s[0]&&u.label<n[1]){u.label=n[1],n=s;break}if(n&&u.label<n[2]){u.label=n[2],u.ops.push(s);break}n[2]&&u.ops.pop(),u.trys.pop();continue}s=r.call(e,u)}catch(e){s=[6,e],a=0}finally{t=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},_this=this;Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),tensor_array_1=require("../../executor/tensor_array"),utils_1=require("./utils");exports.executeOp=function(e,r,t){return __awaiter(_this,void 0,void 0,function(){var a,n,s,u,o,l,i,c,_,g,y,d,m,f,V,p,P,h,A,T,w,v,b,x,j,I,S,E,C,k,z,N,q,G,O;return __generator(this,function(R){switch(R.label){case 0:switch(e.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[utils_1.getParamValue("pred",e,r,t).clone()]];case 2:return a=utils_1.getParamValue("pred",e,r,t),n=utils_1.getParamValue("data",e,r,t),[4,a.data()];case 3:return[2,R.sent()[0]?[void 0,n.clone()]:[n.clone(),void 0]];case 4:return[2,(s=e.inputNames.find(function(e){return void 0!==utils_1.getTensor(e,r,t)}))?[utils_1.getTensor(s,r,t).clone()]:void 0];case 5:return u=utils_1.getParamValue("frameName",e,r,t),o=utils_1.getParamValue("tensor",e,r,t),t.enterFrame(u),[2,[o.clone()]];case 6:return l=utils_1.getParamValue("tensor",e,r,t),t.exitFrame(),[2,[l.clone()]];case 7:return i=utils_1.getParamValue("tensor",e,r,t),t.nextIteration(),[2,[i.clone()]];case 8:return c=utils_1.getParamValue("size",e,r,t),_=utils_1.getParamValue("dtype",e,r,t),g=utils_1.getParamValue("elementShape",e,r,t),y=utils_1.getParamValue("dynamicSize",e,r,t),d=utils_1.getParamValue("clearAfterRead",e,r,t),m=utils_1.getParamValue("identicalElementShapes",e,r,t),f=utils_1.getParamValue("name",e,r,t),V=new tensor_array_1.TensorArray(f,_,c,g,m,y,d),t.addTensorArray(V),[2,[tfjs_core_1.scalar(V.id),tfjs_core_1.scalar(1)]];case 9:return p=utils_1.getParamValue("tensorArrayId",e,r,t),P=utils_1.getParamValue("index",e,r,t),h=utils_1.getParamValue("tensor",e,r,t),t.getTensorArray(p).write(P,h),[2,[tfjs_core_1.scalar(1)]];case 10:return A=utils_1.getParamValue("tensorArrayId",e,r,t),T=utils_1.getParamValue("index",e,r,t),[2,[t.getTensorArray(A).read(T)]];case 11:return w=utils_1.getParamValue("tensorArrayId",e,r,t),v=utils_1.getParamValue("indices",e,r,t),b=utils_1.getParamValue("dtype",e,r,t),[2,[t.getTensorArray(w).gather(v,b)]];case 12:return x=utils_1.getParamValue("tensorArrayId",e,r,t),j=utils_1.getParamValue("indices",e,r,t),I=utils_1.getParamValue("tensor",e,r,t),t.getTensorArray(x).scatter(j,I),[2,[tfjs_core_1.scalar(1)]];case 13:return S=utils_1.getParamValue("tensorArrayId",e,r,t),E=t.getTensorArray(S),C=utils_1.getParamValue("dtype",e,r,t),[2,[E.concat(C)]];case 14:return k=utils_1.getParamValue("tensorArrayId",e,r,t),z=utils_1.getParamValue("tensor",e,r,t),N=utils_1.getParamValue("lengths",e,r,t),t.getTensorArray(k).split(N,z),[2,[tfjs_core_1.scalar(1)]];case 15:return q=utils_1.getParamValue("tensorArrayId",e,r,t),G=t.getTensorArray(q),[2,[tfjs_core_1.scalar(G.size(),"int32")]];case 16:return O=utils_1.getParamValue("tensorArrayId",e,r,t),t.getTensorArray(O).clearAndClose(),[2,[tfjs_core_1.scalar(0)]];case 17:throw TypeError("Node type "+e.op+" is not implemented")}})})},exports.CATEGORY="control";

},{"../../executor/tensor_array":14,"./utils":34,"@tensorflow/tfjs-core":175}],21:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(a,e,t){switch(a.op){case"Conv1D":var r=utils_1.getParamValue("stride",a,e,t),u=utils_1.getParamValue("pad",a,e,t),s=utils_1.getParamValue("dataFormat",a,e,t).toUpperCase(),l=utils_1.getParamValue("dilation",a,e,t);return[tfc.conv1d(utils_1.getParamValue("x",a,e,t),utils_1.getParamValue("filter",a,e,t),r,u,s,l)];case"Conv2D":r=utils_1.getParamValue("strides",a,e,t),u=utils_1.getParamValue("pad",a,e,t),s=utils_1.getParamValue("dataFormat",a,e,t).toUpperCase();var i=utils_1.getParamValue("dilations",a,e,t);return[tfc.conv2d(utils_1.getParamValue("x",a,e,t),utils_1.getParamValue("filter",a,e,t),[r[1],r[2]],u,s,[i[1],i[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var o=utils_1.getParamValue("fusedOps",a,e,t),d=o[0],m=o[1],n="biasadd"===d,P="prelu"===m,g="fusedbatchnorm"===d,_=utils_1.getParamValue("numArgs",a,e,t);if(n){if(P&&2!==_)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!P&&1!==_)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(g)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");r=utils_1.getParamValue("strides",a,e,t),u=utils_1.getParamValue("pad",a,e,t),s=utils_1.getParamValue("dataFormat",a,e,t).toUpperCase(),i=utils_1.getParamValue("dilations",a,e,t);var p=utils_1.getParamValue("args",a,e,t),V=p[0],c=p[1];return[("_FusedConv2D"===a.op?tfc.fused.conv2d:tfc.fused.depthwiseConv2d)({x:utils_1.getParamValue("x",a,e,t),filter:utils_1.getParamValue("filter",a,e,t),strides:[r[1],r[2]],pad:u,dataFormat:s,dilations:[i[1],i[2]],bias:V,activation:m,preluActivationWeights:c})];case"Conv2DBackpropInput":case"Conv2dTranspose":var v=utils_1.getParamValue("outputShape",a,e,t);r=utils_1.getParamValue("strides",a,e,t),u=utils_1.getParamValue("pad",a,e,t);return[tfc.conv2dTranspose(utils_1.getParamValue("x",a,e,t),utils_1.getParamValue("filter",a,e,t),v,[r[1],r[2]],u)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":r=utils_1.getParamValue("strides",a,e,t),u=utils_1.getParamValue("pad",a,e,t),i=utils_1.getParamValue("dilations",a,e,t),s=utils_1.getParamValue("dataFormat",a,e,t).toUpperCase();return[tfc.depthwiseConv2d(utils_1.getParamValue("input",a,e,t),utils_1.getParamValue("filter",a,e,t),[r[1],r[2]],u,s,[i[1],i[2]])];case"Conv3D":r=utils_1.getParamValue("strides",a,e,t),u=utils_1.getParamValue("pad",a,e,t),s=utils_1.getParamValue("dataFormat",a,e,t).toUpperCase(),i=utils_1.getParamValue("dilations",a,e,t);return[tfc.conv3d(utils_1.getParamValue("x",a,e,t),utils_1.getParamValue("filter",a,e,t),[r[1],r[2],r[3]],u,s,[i[1],i[2],i[3]])];case"AvgPool":r=utils_1.getParamValue("strides",a,e,t),u=utils_1.getParamValue("pad",a,e,t);var f=utils_1.getParamValue("kernelSize",a,e,t);return[tfc.avgPool(utils_1.getParamValue("x",a,e,t),[f[1],f[2]],[r[1],r[2]],u)];case"MaxPool":r=utils_1.getParamValue("strides",a,e,t),u=utils_1.getParamValue("pad",a,e,t),f=utils_1.getParamValue("kernelSize",a,e,t);return[tfc.maxPool(utils_1.getParamValue("x",a,e,t),[f[1],f[2]],[r[1],r[2]],u)];case"AvgPool3D":r=utils_1.getParamValue("strides",a,e,t),u=utils_1.getParamValue("pad",a,e,t),f=utils_1.getParamValue("kernelSize",a,e,t);return[tfc.avgPool3d(utils_1.getParamValue("x",a,e,t),[f[1],f[2],f[3]],[r[1],r[2],r[3]],u)];case"MaxPool3D":r=utils_1.getParamValue("strides",a,e,t),u=utils_1.getParamValue("pad",a,e,t),f=utils_1.getParamValue("kernelSize",a,e,t);return[tfc.maxPool3d(utils_1.getParamValue("x",a,e,t),[f[1],f[2],f[3]],[r[1],r[2],r[3]],u)];default:throw TypeError("Node type "+a.op+" is not implemented")}},exports.CATEGORY="convolution";

},{"./utils":34,"@tensorflow/tfjs-core":175}],22:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,a,t){switch(e.op){case"Fill":var u=utils_1.getParamValue("shape",e,a,t),r=utils_1.getParamValue("dtype",e,a,t),l=utils_1.getParamValue("value",e,a,t);return[tfc.fill(u,l,r)];case"LinSpace":var s=utils_1.getParamValue("start",e,a,t),i=utils_1.getParamValue("stop",e,a,t),m=utils_1.getParamValue("num",e,a,t);return[tfc.linspace(s,i,m)];case"Multinomial":var n=utils_1.getParamValue("logits",e,a,t),o=utils_1.getParamValue("numSamples",e,a,t),c=utils_1.getParamValue("seed",e,a,t);return[tfc.multinomial(n,o,c)];case"OneHot":var g=utils_1.getParamValue("indices",e,a,t),_=utils_1.getParamValue("depth",e,a,t),V=utils_1.getParamValue("onValue",e,a,t),P=utils_1.getParamValue("offValue",e,a,t);return[tfc.oneHot(g,_,V,P)];case"Ones":return[tfc.ones(utils_1.getParamValue("shape",e,a,t),utils_1.getParamValue("dtype",e,a,t))];case"OnesLike":return[tfc.onesLike(utils_1.getParamValue("x",e,a,t))];case"RandomUniform":return[tfc.randomUniform(utils_1.getParamValue("shape",e,a,t),utils_1.getParamValue("minval",e,a,t),utils_1.getParamValue("maxval",e,a,t),utils_1.getParamValue("dtype",e,a,t))];case"Range":s=utils_1.getParamValue("start",e,a,t);var p=utils_1.getParamValue("stop",e,a,t),f=utils_1.getParamValue("step",e,a,t);return[tfc.range(s,p,f,utils_1.getParamValue("dtype",e,a,t))];case"TruncatedNormal":u=utils_1.getParamValue("shape",e,a,t);var d=utils_1.getParamValue("mean",e,a,t),v=utils_1.getParamValue("stdDev",e,a,t);c=utils_1.getParamValue("seed",e,a,t);return[tfc.truncatedNormal(u,d,v,utils_1.getParamValue("dtype",e,a,t),c)];case"Zeros":return[tfc.zeros(utils_1.getParamValue("shape",e,a,t),utils_1.getParamValue("dtype",e,a,t))];case"ZerosLike":return[tfc.zerosLike(utils_1.getParamValue("x",e,a,t))];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="creation";

},{"./utils":34,"@tensorflow/tfjs-core":175}],23:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,s){function o(e){try{u(n.next(e))}catch(e){s(e)}}function i(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(o,i)}u((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},_this=this;Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,t,r){return __awaiter(_this,void 0,void 0,function(){var n,a,s,o,i,u,c,l;return __generator(this,function(p){switch(p.label){case 0:switch(e.op){case"NonMaxSuppressionV5":case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,5];case"ListDiff":return[3,7]}return[3,8];case 1:return n=utils_1.getParamValue("boxes",e,t,r),a=utils_1.getParamValue("scores",e,t,r),s=utils_1.getParamValue("maxOutputSize",e,t,r),o=utils_1.getParamValue("iouThreshold",e,t,r),i=utils_1.getParamValue("scoreThreshold",e,t,r),"NonMaxSuppressionV5"!==e.op?[3,3]:(u=utils_1.getParamValue("softNmsSigma",e,t,r),[4,tfc.image.nonMaxSuppressionWithScoreAsync(n,a,s,o,i,u)]);case 2:return[2,[(l=p.sent()).selectedIndices,l.selectedScores]];case 3:return[4,tfc.image.nonMaxSuppressionAsync(n,a,s,o,i)];case 4:return[2,[p.sent()]];case 5:return c=utils_1.getParamValue("condition",e,t,r).asType("bool"),[4,tfc.whereAsync(c)];case 6:return l=[p.sent()],c.dispose(),[2,l];case 7:return[2,tfc.setdiff1dAsync(utils_1.getParamValue("x",e,t,r),utils_1.getParamValue("y",e,t,r))];case 8:throw TypeError("Node type "+e.op+" is not implemented")}})})},exports.CATEGORY="dynamic";

},{"./utils":34,"@tensorflow/tfjs-core":175}],24:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,t,r){switch(e.op){case"TopKV2":var o=utils_1.getParamValue("x",e,t,r),s=utils_1.getParamValue("k",e,t,r),u=utils_1.getParamValue("sorted",e,t,r),a=tfc.topk(o,s,u);return[a.values,a.indices];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="evaluation";

},{"./utils":34,"@tensorflow/tfjs-core":175}],25:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,a,t){switch(e.op){case"Const":return a[e.name];case"PlaceholderWithDefault":var r=utils_1.getParamValue("default",e,a,t);return[utils_1.getTensor(e.name,a,t)||r];case"Placeholder":return[utils_1.getTensor(e.name,a,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[utils_1.getParamValue("x",e,a,t).clone()];case"IdentityN":return utils_1.getParamValue("x",e,a,t).map(function(e){return e.clone()});case"Snapshot":return[utils_1.getParamValue("x",e,a,t).clone()];case"Shape":return[tfc.tensor1d(utils_1.getParamValue("x",e,a,t).shape,"int32")];case"ShapeN":return utils_1.getParamValue("x",e,a,t).map(function(e){return tfc.tensor1d(e.shape)});case"Size":return[tfc.scalar(utils_1.getParamValue("x",e,a,t).size,"int32")];case"Rank":return[tfc.scalar(utils_1.getParamValue("x",e,a,t).rank,"int32")];case"NoOp":return[tfc.scalar(1)];case"Print":var s=utils_1.getParamValue("x",e,a,t),u=utils_1.getParamValue("data",e,a,t),l=utils_1.getParamValue("message",e,a,t),n=utils_1.getParamValue("summarize",e,a,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(var o=0;o<u.length;o++)console.log(Array.prototype.slice.call(u[o].dataSync()).slice(0,n));return[s];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="graph";

},{"./utils":34,"@tensorflow/tfjs-core":175}],26:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,a,t){switch(e.op){case"ResizeBilinear":var r=utils_1.getParamValue("images",e,a,t),i=utils_1.getParamValue("size",e,a,t),s=utils_1.getParamValue("alignCorners",e,a,t);return[tfc.image.resizeBilinear(r,[i[0],i[1]],s)];case"ResizeNearestNeighbor":r=utils_1.getParamValue("images",e,a,t),i=utils_1.getParamValue("size",e,a,t),s=utils_1.getParamValue("alignCorners",e,a,t);return[tfc.image.resizeNearestNeighbor(r,[i[0],i[1]],s)];case"CropAndResize":var u=utils_1.getParamValue("image",e,a,t),l=utils_1.getParamValue("boxes",e,a,t),o=utils_1.getParamValue("boxInd",e,a,t),g=utils_1.getParamValue("cropSize",e,a,t),m=utils_1.getParamValue("method",e,a,t),n=utils_1.getParamValue("extrapolationValue",e,a,t);return[tfc.image.cropAndResize(u,l,o,g,m,n)];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="image";

},{"./utils":34,"@tensorflow/tfjs-core":175}],27:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,a,t){switch(e.op){case"Equal":return[tfc.equal(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"NotEqual":return[tfc.notEqual(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"Greater":return[tfc.greater(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"GreaterEqual":return[tfc.greaterEqual(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"Less":return[tfc.less(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"LessEqual":return[tfc.lessEqual(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"LogicalAnd":return[tfc.logicalAnd(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"LogicalNot":return[tfc.logicalNot(utils_1.getParamValue("a",e,a,t))];case"LogicalOr":return[tfc.logicalOr(utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];case"Select":return[tfc.where(utils_1.getParamValue("condition",e,a,t),utils_1.getParamValue("a",e,a,t),utils_1.getParamValue("b",e,a,t))];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="logical";

},{"./utils":34,"@tensorflow/tfjs-core":175}],28:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(a,e,t){switch(a.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[tfc.matMul(utils_1.getParamValue("a",a,e,t),utils_1.getParamValue("b",a,e,t),utils_1.getParamValue("transposeA",a,e,t),utils_1.getParamValue("transposeB",a,e,t))];case"Transpose":return[tfc.transpose(utils_1.getParamValue("x",a,e,t),utils_1.getParamValue("perm",a,e,t))];case"_FusedMatMul":var r=utils_1.getParamValue("fusedOps",a,e,t),s=r[0],u=r[1],l="biasadd"===s,i="prelu"===u,o=utils_1.getParamValue("numArgs",a,e,t);if(l){if(i&&2!==o)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&1!==o)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var n=utils_1.getParamValue("args",a,e,t),m=n[0],p=n[1];return[tfc.fused.matMul({a:utils_1.getParamValue("a",a,e,t),b:utils_1.getParamValue("b",a,e,t),transposeA:utils_1.getParamValue("transposeA",a,e,t),transposeB:utils_1.getParamValue("transposeB",a,e,t),bias:m,activation:u,preluActivationWeights:p})];default:throw TypeError("Node type "+a.op+" is not implemented")}},exports.CATEGORY="matrices";

},{"./utils":34,"@tensorflow/tfjs-core":175}],29:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,a,t){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[tfc.batchNorm(utils_1.getParamValue("x",e,a,t),utils_1.getParamValue("mean",e,a,t),utils_1.getParamValue("variance",e,a,t),utils_1.getParamValue("offset",e,a,t),utils_1.getParamValue("scale",e,a,t),utils_1.getParamValue("epsilon",e,a,t))];case"LRN":return[tfc.localResponseNormalization(utils_1.getParamValue("x",e,a,t),utils_1.getParamValue("radius",e,a,t),utils_1.getParamValue("bias",e,a,t),utils_1.getParamValue("alpha",e,a,t),utils_1.getParamValue("beta",e,a,t))];case"Softmax":return[tfc.softmax(utils_1.getParamValue("x",e,a,t))];case"LogSoftmax":return[tfc.logSoftmax(utils_1.getParamValue("x",e,a,t))];case"SparseToDense":return[tfc.sparseToDense(utils_1.getParamValue("sparseIndices",e,a,t),utils_1.getParamValue("outputShape",e,a,t),utils_1.getParamValue("sparseValues",e,a,t),utils_1.getParamValue("defaultValue",e,a,t))];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="normalization";

},{"./utils":34,"@tensorflow/tfjs-core":175}],30:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,a,t){switch(e.op){case"Max":var u=utils_1.getParamValue("axis",e,a,t),r=utils_1.getParamValue("keepDims",e,a,t);return[tfc.max(utils_1.getParamValue("x",e,a,t),u,r)];case"Mean":u=utils_1.getParamValue("axis",e,a,t),r=utils_1.getParamValue("keepDims",e,a,t);return[tfc.mean(utils_1.getParamValue("x",e,a,t),u,r)];case"Min":u=utils_1.getParamValue("axis",e,a,t),r=utils_1.getParamValue("keepDims",e,a,t);return[tfc.min(utils_1.getParamValue("x",e,a,t),u,r)];case"Sum":u=utils_1.getParamValue("axis",e,a,t),r=utils_1.getParamValue("keepDims",e,a,t);return[tfc.sum(utils_1.getParamValue("x",e,a,t),u,r)];case"All":u=utils_1.getParamValue("axis",e,a,t),r=utils_1.getParamValue("keepDims",e,a,t);return[tfc.all(utils_1.getParamValue("x",e,a,t),u,r)];case"Any":u=utils_1.getParamValue("axis",e,a,t),r=utils_1.getParamValue("keepDims",e,a,t);return[tfc.any(utils_1.getParamValue("x",e,a,t),u,r)];case"ArgMax":u=utils_1.getParamValue("axis",e,a,t);return[tfc.argMax(utils_1.getParamValue("x",e,a,t),u)];case"ArgMin":u=utils_1.getParamValue("axis",e,a,t);return[tfc.argMin(utils_1.getParamValue("x",e,a,t),u)];case"Prod":u=utils_1.getParamValue("axis",e,a,t),r=utils_1.getParamValue("keepDims",e,a,t);return[tfc.prod(utils_1.getParamValue("x",e,a,t),u,r)];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="reduction";

},{"./utils":34,"@tensorflow/tfjs-core":175}],31:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,a,t){switch(e.op){case"ConcatV2":case"Concat":var s=utils_1.getParamValue("n",e,a,t),r=utils_1.getParamValue("axis",e,a,t),u=utils_1.getParamValue("tensors",e,a,t);return u=u.slice(0,s),[tfc.concat(u,r)];case"GatherV2":case"Gather":r=utils_1.getParamValue("axis",e,a,t);var l=utils_1.getParamValue("x",e,a,t),i=utils_1.getParamValue("indices",e,a,t);return[tfc.gather(l,i.asType("int32"),r)];case"ReverseV2":case"Reverse":r=utils_1.getParamValue("axis",e,a,t),l=utils_1.getParamValue("x",e,a,t);return[tfc.reverse(l,r)];case"Slice":var c=utils_1.getParamValue("begin",e,a,t),n=utils_1.getParamValue("size",e,a,t);return[tfc.slice(utils_1.getParamValue("x",e,a,t),c,n)];case"StridedSlice":c=utils_1.getParamValue("begin",e,a,t);var g=utils_1.getParamValue("end",e,a,t),V=utils_1.getParamValue("strides",e,a,t),m=utils_1.getParamValue("beginMask",e,a,t),p=utils_1.getParamValue("endMask",e,a,t),_=utils_1.getParamValue("ellipsisMask",e,a,t),P=utils_1.getParamValue("newAxisMask",e,a,t),o=utils_1.getParamValue("shrinkAxisMask",e,a,t),f=utils_1.getParamValue("x",e,a,t);if(1===c.length&&f.shape.length>1)for(var h=1;h<f.shape.length;h++)c.push(0),g.push(f.shape[h]),V.push(V[0]);return[tfc.stridedSlice(f,c,g,V,m,p,_,P,o)];case"Pack":return tfc.tidy(function(){var s=utils_1.getParamValue("axis",e,a,t),r=utils_1.getParamValue("tensors",e,a,t),u=r[0].shape,l=r[0].squeeze().shape,i=r.map(function(e){var a=tfc.util.arraysEqual(e.shape,u);if(!a&&!tfc.util.arraysEqual(e.squeeze().shape,l))throw new Error("the input tensors shape does not match");return a?e:e.reshape(u)});return[tfc.stack(i,s)]});case"Unpack":return tfc.tidy(function(){var s=utils_1.getParamValue("axis",e,a,t),r=utils_1.getParamValue("tensor",e,a,t);return tfc.unstack(r,s)});case"Tile":var d=utils_1.getParamValue("reps",e,a,t);return[tfc.tile(utils_1.getParamValue("x",e,a,t),d)];case"Split":case"SplitV":r=utils_1.getParamValue("axis",e,a,t);var v=utils_1.getParamValue("numOrSizeSplits",e,a,t);return tfc.split(utils_1.getParamValue("x",e,a,t),v,r);case"ScatterNd":i=utils_1.getParamValue("indices",e,a,t);var x=utils_1.getParamValue("values",e,a,t),y=utils_1.getParamValue("shape",e,a,t);return[tfc.scatterND(i,x,y)];case"GatherNd":var S=utils_1.getParamValue("x",e,a,t);i=utils_1.getParamValue("indices",e,a,t);return[tfc.gatherND(S,i)];case"SparseToDense":i=utils_1.getParamValue("sparseIndices",e,a,t),y=utils_1.getParamValue("outputShape",e,a,t);var k=utils_1.getParamValue("sparseValues",e,a,t),T=utils_1.getParamValue("defaultValue",e,a,t);return[tfc.sparseToDense(i,k,y,k.dtype===T.dtype?T:T.asType(k.dtype))];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="slice_join";

},{"./utils":34,"@tensorflow/tfjs-core":175}],32:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,t,r){switch(e.op){case"FFT":return[tfc.fft(utils_1.getParamValue("x",e,t,r))];case"IFFT":return[tfc.ifft(utils_1.getParamValue("x",e,t,r))];case"RFFT":return[tfc.rfft(utils_1.getParamValue("x",e,t,r))];case"IRFFT":return[tfc.irfft(utils_1.getParamValue("x",e,t,r))];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="spectral";

},{"./utils":34,"@tensorflow/tfjs-core":175}],33:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(e,a,t){switch(e.op){case"Cast":return[tfc.cast(utils_1.getParamValue("x",e,a,t),utils_1.getParamValue("dtype",e,a,t))];case"ExpandDims":var u=utils_1.getParamValue("axis",e,a,t);return[tfc.expandDims(utils_1.getParamValue("x",e,a,t),u)];case"Squeeze":u=utils_1.getParamValue("axis",e,a,t);return[tfc.squeeze(utils_1.getParamValue("x",e,a,t),u)];case"Reshape":return[tfc.reshape(utils_1.getParamValue("x",e,a,t),utils_1.getParamValue("shape",e,a,t))];case"PadV2":case"Pad":return[tfc.pad(utils_1.getParamValue("x",e,a,t),utils_1.split(utils_1.getParamValue("padding",e,a,t),2),utils_1.getParamValue("constantValue",e,a,t))];case"SpaceToBatchND":var r=utils_1.getParamValue("blockShape",e,a,t),s=utils_1.split(utils_1.getParamValue("paddings",e,a,t),2);return[tfc.spaceToBatchND(utils_1.getParamValue("x",e,a,t),r,s)];case"BatchToSpaceND":r=utils_1.getParamValue("blockShape",e,a,t);var l=utils_1.split(utils_1.getParamValue("crops",e,a,t),2);return[tfc.batchToSpaceND(utils_1.getParamValue("x",e,a,t),r,l)];case"DepthToSpace":var i=utils_1.getParamValue("blockSize",e,a,t),c=utils_1.getParamValue("dataFormat",e,a,t).toUpperCase();return[tfc.depthToSpace(utils_1.getParamValue("x",e,a,t),i,c)];default:throw TypeError("Node type "+e.op+" is not implemented")}},exports.CATEGORY="transformation";

},{"./utils":34,"@tensorflow/tfjs-core":175}],34:[function(require,module,exports){
"use strict";function getParamValue(e,t,n,r){var o=t.inputParams[e];if(o&&void 0!==o.inputIndexStart){var a=o.inputIndexStart,s=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?a+1:o.inputIndexEnd;if("tensor"===o.type)return getTensor(t.inputNames[o.inputIndexStart],n,r);if("tensors"===o.type)return t.inputNames.slice(a,s).map(function(e){return getTensor(e,n,r)});var u=Array.prototype.slice.call(getTensor(t.inputNames.slice(a)[0],n,r).dataSync());return"number"===o.type?u[0]:u}var d=t.attrParams[e];return d&&d.value}function getTensor(e,t,n){var r=parseNodeName(e),o=r[0],a=r[1],s=n.currentContextIds.find(function(e){return!!t[getNodeNameWithContextId(o,e)]});return void 0!==s?t[getNodeNameWithContextId(o,s)][a]:void 0}function getTensorsForCurrentContenxt(e,t,n){return t[getNodeNameWithContextId(e,n.currentContextId)]}function getNodeNameAndIndex(e,t){var n=parseNodeName(e),r=n[0],o=n[1];return[getNodeNameWithContextId(r,t&&t.currentContextId),o]}function getNodeNameWithContextId(e,t){return t?e+"-"+t:e}function parseNodeName(e){var t=e.lastIndexOf(":");return-1===t?[e,0]:[e.substring(0,t),Number(e.substring(t+1))]}function split(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getParamValue=getParamValue,exports.getTensor=getTensor,exports.getTensorsForCurrentContenxt=getTensorsForCurrentContenxt,exports.getNodeNameAndIndex=getNodeNameAndIndex,exports.parseNodeName=parseNodeName,exports.split=split;

},{}],35:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];

},{}],36:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];

},{}],37:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}];

},{}],38:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}];

},{}],39:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}];

},{}],40:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];

},{}],41:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}];

},{}],42:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}];

},{}],43:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}];

},{}],44:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];

},{}],45:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];

},{}],46:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}];

},{}],47:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}];

},{}],48:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}];

},{}],49:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}];

},{}],50:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}];

},{}],51:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),node_value_impl_1=require("./custom_op/node_value_impl"),register_1=require("./custom_op/register"),arithmetic=require("./executors/arithmetic_executor"),basicMath=require("./executors/basic_math_executor"),control=require("./executors/control_executor"),convolution=require("./executors/convolution_executor"),creation=require("./executors/creation_executor"),dynamic=require("./executors/dynamic_executor"),evaluation=require("./executors/evaluation_executor"),graph=require("./executors/graph_executor"),image=require("./executors/image_executor"),logical=require("./executors/logical_executor"),matrices=require("./executors/matrices_executor"),normalization=require("./executors/normalization_executor"),reduction=require("./executors/reduction_executor"),sliceJoin=require("./executors/slice_join_executor"),spectral=require("./executors/spectral_executor"),transformation=require("./executors/transformation_executor");function executeOp(e,t,r){var c=function(e,t,r){switch(e.category){case"arithmetic":return tfc.tidy(function(){return arithmetic.executeOp(e,t,r)});case"basic_math":return tfc.tidy(function(){return basicMath.executeOp(e,t,r)});case"control":return control.executeOp(e,t,r);case"convolution":return tfc.tidy(function(){return convolution.executeOp(e,t,r)});case"creation":return tfc.tidy(function(){return creation.executeOp(e,t,r)});case"dynamic":return dynamic.executeOp(e,t,r);case"evaluation":return tfc.tidy(function(){return evaluation.executeOp(e,t,r)});case"image":return tfc.tidy(function(){return image.executeOp(e,t,r)});case"graph":return tfc.tidy(function(){return graph.executeOp(e,t,r)});case"logical":return tfc.tidy(function(){return logical.executeOp(e,t,r)});case"matrices":return tfc.tidy(function(){return matrices.executeOp(e,t,r)});case"normalization":return tfc.tidy(function(){return normalization.executeOp(e,t,r)});case"reduction":return tfc.tidy(function(){return reduction.executeOp(e,t,r)});case"slice_join":return tfc.tidy(function(){return sliceJoin.executeOp(e,t,r)});case"spectral":return tfc.tidy(function(){return spectral.executeOp(e,t,r)});case"transformation":return tfc.tidy(function(){return transformation.executeOp(e,t,r)});case"custom":var c=register_1.getRegisteredOp(e.op);if(c&&c.customExecutor)return c.customExecutor(new node_value_impl_1.NodeValueImpl(e,t,r));throw TypeError("Custom op "+e.op+" is not registered.");default:throw TypeError("Unknown op '"+e.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(e,t,r);return c instanceof Promise?c.then(function(e){return[].concat(e)}):[].concat(c)}exports.executeOp=executeOp;

},{"./custom_op/node_value_impl":16,"./custom_op/register":17,"./executors/arithmetic_executor":18,"./executors/basic_math_executor":19,"./executors/control_executor":20,"./executors/convolution_executor":21,"./executors/creation_executor":22,"./executors/dynamic_executor":23,"./executors/evaluation_executor":24,"./executors/graph_executor":25,"./executors/image_executor":26,"./executors/logical_executor":27,"./executors/matrices_executor":28,"./executors/normalization_executor":29,"./executors/reduction_executor":30,"./executors/slice_join_executor":31,"./executors/spectral_executor":32,"./executors/transformation_executor":33,"@tensorflow/tfjs-core":175}],52:[function(require,module,exports){
(function (Buffer){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),tensorflow=require("../data/compiled_api"),register_1=require("./custom_op/register"),utils_1=require("./executors/utils"),arithmetic=require("./op_list/arithmetic"),basicMath=require("./op_list/basic_math"),control=require("./op_list/control"),convolution=require("./op_list/convolution"),creation=require("./op_list/creation"),dynamic=require("./op_list/dynamic"),evaluation=require("./op_list/evaluation"),graph=require("./op_list/graph"),image=require("./op_list/image"),logical=require("./op_list/logical"),matrices=require("./op_list/matrices"),normalization=require("./op_list/normalization"),reduction=require("./op_list/reduction"),sliceJoin=require("./op_list/slice_join"),spectral=require("./op_list/spectral"),transformation=require("./op_list/transformation"),OperationMapper=function(){function e(){var e=[arithmetic,basicMath,control,convolution,creation,dynamic,evaluation,logical,image,graph,matrices,normalization,reduction,sliceJoin,spectral,transformation],t=[].concat.apply([],e.map(function(e){return e.json}));this.opMappers=t.reduce(function(e,t){return e[t.tfOpName]=t,e},{})}return Object.defineProperty(e,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),e.prototype.transformGraph=function(e,t){var r=this;void 0===t&&(t={});var a=[],n=[],o=e.node.reduce(function(e,t){return e[t.name]=r.mapNode(t),t.op.startsWith("Placeholder")&&a.push(e[t.name]),"Const"===t.op&&n.push(e[t.name]),e},{}),i=[],s=[],u={},p={};null!=t&&(u=this.mapSignatureEntries(t.inputs),p=this.mapSignatureEntries(t.outputs));var l=Object.keys(o);return l.forEach(function(e){var t=o[e];t.inputNames.forEach(function(e){var r=utils_1.getNodeNameAndIndex(e)[0];t.inputs.push(o[r]),o[r].children.push(t)})}),0===Object.keys(p).length?l.forEach(function(e){var t=o[e];0===t.children.length&&s.push(t)}):Object.keys(p).forEach(function(e){var t=utils_1.getNodeNameAndIndex(e)[0],r=o[t];null!=r&&(r.signatureKey=p[e],s.push(r))}),Object.keys(u).length>0?Object.keys(u).forEach(function(e){var t=utils_1.getNodeNameAndIndex(e)[0],r=o[t];r&&(r.signatureKey=u[e],i.push(r))}):i=a,{nodes:o,inputs:i,outputs:s,weights:n,placeholders:a,signature:t}},e.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,r){return t[e[r].name]=r,t},{})},e.prototype.mapNode=function(e){var t=register_1.getRegisteredOp(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var r={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(e){return e.startsWith("^")?e.substr(1):e}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(r.inputParams=t.inputs.reduce(function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e},{})),null!=t.attrs&&(r.attrParams=t.attrs.reduce(function(t,r){var a=r.type,n=void 0;switch(r.type){case"string":void 0===(n=getStringParam(e.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(n=getStringParam(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"string[]":void 0===(n=getStringArrayParam(e.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(n=getStringArrayParam(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"number":void 0===(n=getNumberParam(e.attr,r.tfName,r.defaultValue||0))&&r.tfDeprecatedName&&(n=getNumberParam(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"number[]":void 0===(n=getNumericArrayParam(e.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(n=getNumericArrayParam(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"bool":void 0===(n=getBoolParam(e.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(n=getBoolParam(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"bool[]":void 0===(n=getBoolArrayParam(e.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(n=getBoolArrayParam(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"shape":void 0===(n=getTensorShapeParam(e.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(n=getTensorShapeParam(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"shape[]":void 0===(n=getTensorShapeArrayParam(e.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(n=getTensorShapeArrayParam(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"dtype":void 0===(n=getDtypeParam(e.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(n=getDtypeParam(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"dtype[]":void 0===(n=getDtypeArrayParam(e.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(n=getDtypeArrayParam(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+r.type+" for op: "+e.op)}return t[r.name]={value:n,type:a},t},{})),r},e}();function decodeBase64(e){var t=tfjs_core_1.env().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function parseStringParam(e,t){var r=Array.isArray(e)?String.fromCharCode.apply(null,e):decodeBase64(e);return t?r:r.toLowerCase()}function getStringParam(e,t,r,a){void 0===a&&(a=!1);var n=e[t];return null!=n?parseStringParam(n.s,a):r}function getBoolParam(e,t,r){var a=e[t];return a?a.b:r}function getNumberParam(e,t,r){var a=e[t]||{},n=null!=a.i?a.i:null!=a.f?a.f:r;return"number"==typeof n?n:parseInt(n,10)}function parseDtypeParam(e){switch("string"==typeof e&&(e=tensorflow.DataType[e]),e){case tensorflow.DataType.DT_FLOAT:return"float32";case tensorflow.DataType.DT_INT32:case tensorflow.DataType.DT_INT64:return"int32";case tensorflow.DataType.DT_BOOL:return"bool";case tensorflow.DataType.DT_DOUBLE:return"float32";case tensorflow.DataType.DT_STRING:return"string";default:return null}}function getDtypeParam(e,t,r){var a=e[t];return a&&a.type?parseDtypeParam(a.type):r}function getDtypeArrayParam(e,t,r){var a=e[t];return a&&a.list&&a.list.type?a.list.type.map(function(e){return parseDtypeParam(e)}):r}function parseTensorShapeParam(e){if(!e.unknownRank)return null!=e.dim?e.dim.map(function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)}):[]}function getTensorShapeParam(e,t,r){var a=e[t];return a&&a.shape?parseTensorShapeParam(a.shape):r}function getNumericArrayParam(e,t,r){var a=e[t];return a?((a.list.f&&a.list.f.length?a.list.f:a.list.i)||[]).map(function(e){return"number"==typeof e?e:parseInt(e,10)}):r}function getStringArrayParam(e,t,r,a){void 0===a&&(a=!1);var n=e[t];return n&&n.list&&n.list.s?n.list.s.map(function(e){return parseStringParam(e,a)}):r}function getTensorShapeArrayParam(e,t,r){var a=e[t];return a&&a.list&&a.list.shape?a.list.shape.map(function(e){return parseTensorShapeParam(e)}):r}function getBoolArrayParam(e,t,r){var a=e[t];return a&&a.list&&a.list.b?a.list.b:r}exports.OperationMapper=OperationMapper,exports.decodeBase64=decodeBase64,exports.parseStringParam=parseStringParam,exports.getStringParam=getStringParam,exports.getBoolParam=getBoolParam,exports.getNumberParam=getNumberParam,exports.parseDtypeParam=parseDtypeParam,exports.getDtypeParam=getDtypeParam,exports.getDtypeArrayParam=getDtypeArrayParam,exports.parseTensorShapeParam=parseTensorShapeParam,exports.getTensorShapeParam=getTensorShapeParam,exports.getNumericArrayParam=getNumericArrayParam,exports.getStringArrayParam=getStringArrayParam,exports.getTensorShapeArrayParam=getTensorShapeArrayParam,exports.getBoolArrayParam=getBoolArrayParam;

}).call(this,require("buffer").Buffer)
},{"../data/compiled_api":9,"./custom_op/register":17,"./executors/utils":34,"./op_list/arithmetic":35,"./op_list/basic_math":36,"./op_list/control":37,"./op_list/convolution":38,"./op_list/creation":39,"./op_list/dynamic":40,"./op_list/evaluation":41,"./op_list/graph":42,"./op_list/image":43,"./op_list/logical":44,"./op_list/matrices":45,"./op_list/normalization":46,"./op_list/reduction":47,"./op_list/slice_join":48,"./op_list/spectral":49,"./op_list/transformation":50,"@tensorflow/tfjs-core":175,"buffer":300}],53:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var version="1.7.0";exports.version=version;

},{}],54:[function(require,module,exports){
"use strict";function binaryInsert(r,e,a){var n=binarySearch(r,e,a),t=n<0?-(n+1):n;r.splice(t,0,e)}function binarySearch(r,e,a){return binarySearch_(r,e,a||defaultComparator)}function defaultComparator(r,e){return r>e?1:r<e?-1:0}function binarySearch_(r,e,a){for(var n=0,t=r.length,i=0,o=!1;n<t;){var c=a(e,r[i=n+(t-n>>>1)]);c>0?n=i+1:(t=i,o=!c)}return o?n:-n-1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.binaryInsert=binaryInsert,exports.binarySearch=binarySearch;

},{}],55:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EPSILON_FLOAT32=1e-7,exports.EPSILON_FLOAT16=1e-4;var DataStorage=function(){function t(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},t.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}();exports.DataStorage=DataStorage;var KernelBackend=function(){function t(){}return t.prototype.time=function(t){return notYetImplemented("time")},t.prototype.read=function(t){return notYetImplemented("read")},t.prototype.readSync=function(t){return notYetImplemented("readSync")},t.prototype.numDataIds=function(){return notYetImplemented("numDataIds")},t.prototype.disposeData=function(t){return notYetImplemented("disposeData")},t.prototype.write=function(t,e,n){return notYetImplemented("write")},t.prototype.move=function(t,e,n,o){return notYetImplemented("move")},t.prototype.memory=function(){return notYetImplemented("memory")},t.prototype.floatPrecision=function(){return notYetImplemented("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?exports.EPSILON_FLOAT32:exports.EPSILON_FLOAT16},t.prototype.batchMatMul=function(t,e,n,o){return notYetImplemented("batchMatMul")},t.prototype.fusedBatchMatMul=function(t){t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights;return notYetImplemented("fusedBatchMatMul")},t.prototype.slice=function(t,e,n){return notYetImplemented("slice")},t.prototype.stridedSlice=function(t,e,n,o){return notYetImplemented("stridedSlice")},t.prototype.unstack=function(t,e){return notYetImplemented("unstack")},t.prototype.reverse=function(t,e){return notYetImplemented("reverse")},t.prototype.concat=function(t,e){return notYetImplemented("concat")},t.prototype.neg=function(t){return notYetImplemented("neg")},t.prototype.add=function(t,e){return notYetImplemented("add")},t.prototype.addN=function(t){return notYetImplemented("addN")},t.prototype.subtract=function(t,e){return notYetImplemented("subtract")},t.prototype.multiply=function(t,e){return notYetImplemented("multiply")},t.prototype.realDivide=function(t,e){return notYetImplemented("realDivide")},t.prototype.floorDiv=function(t,e){return notYetImplemented("floorDiv")},t.prototype.sum=function(t,e){return notYetImplemented("sum")},t.prototype.prod=function(t,e){return notYetImplemented("prod")},t.prototype.unsortedSegmentSum=function(t,e,n){return notYetImplemented("unsortedSegmentSum")},t.prototype.argMin=function(t,e){return notYetImplemented("argMin")},t.prototype.argMax=function(t,e){return notYetImplemented("argMax")},t.prototype.equal=function(t,e){return notYetImplemented("equal")},t.prototype.notEqual=function(t,e){return notYetImplemented("notEqual")},t.prototype.less=function(t,e){return notYetImplemented("less")},t.prototype.lessEqual=function(t,e){return notYetImplemented("lessEqual")},t.prototype.greater=function(t,e){return notYetImplemented("greater")},t.prototype.greaterEqual=function(t,e){return notYetImplemented("greaterEqual")},t.prototype.logicalNot=function(t){return notYetImplemented("logicalNot")},t.prototype.logicalAnd=function(t,e){return notYetImplemented("logicalAnd")},t.prototype.logicalOr=function(t,e){return notYetImplemented("logicalOr")},t.prototype.where=function(t){return notYetImplemented("where")},t.prototype.select=function(t,e,n){return notYetImplemented("select")},t.prototype.topk=function(t,e,n){return notYetImplemented("topk")},t.prototype.min=function(t,e){return notYetImplemented("min")},t.prototype.minimum=function(t,e){return notYetImplemented("minimum")},t.prototype.mod=function(t,e){return notYetImplemented("mod")},t.prototype.max=function(t,e){return notYetImplemented("max")},t.prototype.maximum=function(t,e){return notYetImplemented("maximum")},t.prototype.all=function(t,e){return notYetImplemented("all")},t.prototype.any=function(t,e){return notYetImplemented("any")},t.prototype.squaredDifference=function(t,e){return notYetImplemented("squaredDifference")},t.prototype.ceil=function(t){return notYetImplemented("ceil")},t.prototype.floor=function(t){return notYetImplemented("floor")},t.prototype.round=function(t){return notYetImplemented("round")},t.prototype.sign=function(t){return notYetImplemented("sign")},t.prototype.isNaN=function(t){return notYetImplemented("isNaN")},t.prototype.isInf=function(t){return notYetImplemented("isInf")},t.prototype.isFinite=function(t){return notYetImplemented("isFinite")},t.prototype.pow=function(t,e){return notYetImplemented("pow")},t.prototype.exp=function(t){return notYetImplemented("exp")},t.prototype.expm1=function(t){return notYetImplemented("expm1")},t.prototype.softmax=function(t,e){return notYetImplemented("softmax")},t.prototype.log=function(t){return notYetImplemented("log")},t.prototype.log1p=function(t){return notYetImplemented("log1p")},t.prototype.sqrt=function(t){return notYetImplemented("sqrt")},t.prototype.rsqrt=function(t){return notYetImplemented("rsqrt")},t.prototype.square=function(t){return notYetImplemented("square")},t.prototype.reciprocal=function(t){return notYetImplemented("reciprocal")},t.prototype.relu=function(t){return notYetImplemented("relu")},t.prototype.relu6=function(t){return notYetImplemented("relu6")},t.prototype.prelu=function(t,e){return notYetImplemented("prelu")},t.prototype.elu=function(t){return notYetImplemented("elu")},t.prototype.eluDer=function(t,e){return notYetImplemented("eluDer")},t.prototype.selu=function(t){return notYetImplemented("selu")},t.prototype.int=function(t){return notYetImplemented("int")},t.prototype.clip=function(t,e,n){return notYetImplemented("clip")},t.prototype.abs=function(t){return notYetImplemented("abs")},t.prototype.complexAbs=function(t){return notYetImplemented("complexAbs")},t.prototype.sigmoid=function(t){return notYetImplemented("sigmoid")},t.prototype.softplus=function(t){return notYetImplemented("softplus")},t.prototype.sin=function(t){return notYetImplemented("sin")},t.prototype.cos=function(t){return notYetImplemented("cos")},t.prototype.tan=function(t){return notYetImplemented("tan")},t.prototype.asin=function(t){return notYetImplemented("asin")},t.prototype.acos=function(t){return notYetImplemented("acos")},t.prototype.atan=function(t){return notYetImplemented("atan")},t.prototype.atan2=function(t,e){return notYetImplemented("atan2")},t.prototype.sinh=function(t){return notYetImplemented("sinh")},t.prototype.cosh=function(t){return notYetImplemented("cosh")},t.prototype.tanh=function(t){return notYetImplemented("tanh")},t.prototype.asinh=function(t){return notYetImplemented("asinh")},t.prototype.acosh=function(t){return notYetImplemented("acosh")},t.prototype.atanh=function(t){return notYetImplemented("atanh")},t.prototype.erf=function(t){return notYetImplemented("erf")},t.prototype.step=function(t,e){return notYetImplemented("step")},t.prototype.fusedConv2d=function(t){t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights;return notYetImplemented("fusedConv2d")},t.prototype.conv2d=function(t,e,n){return notYetImplemented("conv2d")},t.prototype.conv2dDerInput=function(t,e,n){return notYetImplemented("conv2dDerInput")},t.prototype.conv2dDerFilter=function(t,e,n){return notYetImplemented("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(t){t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights;return notYetImplemented("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(t,e,n){return notYetImplemented("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){return notYetImplemented("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){return notYetImplemented("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(t,e,n){return notYetImplemented("conv3d")},t.prototype.conv3dDerInput=function(t,e,n){return notYetImplemented("conv3dDerInput")},t.prototype.conv3dDerFilter=function(t,e,n){return notYetImplemented("conv3dDerFilter")},t.prototype.maxPool=function(t,e){return notYetImplemented("maxPool")},t.prototype.maxPoolBackprop=function(t,e,n,o){return notYetImplemented("maxPoolBackprop")},t.prototype.avgPool=function(t,e){return notYetImplemented("avgPool")},t.prototype.avgPoolBackprop=function(t,e,n){return notYetImplemented("avgPoolBackprop")},t.prototype.avgPool3d=function(t,e){return notYetImplemented("avgPool3d")},t.prototype.avgPool3dBackprop=function(t,e,n){return notYetImplemented("avgPool3dBackprop")},t.prototype.maxPool3d=function(t,e){return notYetImplemented("maxPool3d")},t.prototype.maxPool3dBackprop=function(t,e,n,o){return notYetImplemented("maxPool3dBackprop")},t.prototype.reshape=function(t,e){return notYetImplemented("reshape")},t.prototype.cast=function(t,e){return notYetImplemented("cast")},t.prototype.tile=function(t,e){return notYetImplemented("tile")},t.prototype.pad=function(t,e,n){return notYetImplemented("pad")},t.prototype.transpose=function(t,e){return notYetImplemented("transpose")},t.prototype.gather=function(t,e,n){return notYetImplemented("gather")},t.prototype.gatherND=function(t,e){return notYetImplemented("gatherND")},t.prototype.scatterND=function(t,e,n){return notYetImplemented("scatterND")},t.prototype.batchToSpaceND=function(t,e,n){return notYetImplemented("batchToSpaceND")},t.prototype.spaceToBatchND=function(t,e,n){return notYetImplemented("spaceToBatchND")},t.prototype.resizeBilinear=function(t,e,n,o){return notYetImplemented("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(t,e,n){return notYetImplemented("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(t,e,n,o){return notYetImplemented("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){return notYetImplemented("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(t,e,n,o,r,p){return notYetImplemented("batchNormalization")},t.prototype.localResponseNormalization4D=function(t,e,n,o,r){return notYetImplemented("localResponseNormalization4D")},t.prototype.LRNGrad=function(t,e,n,o,r,p,u){return notYetImplemented("LRNGrad")},t.prototype.multinomial=function(t,e,n,o){return notYetImplemented("multinomial")},t.prototype.oneHot=function(t,e,n,o){return notYetImplemented("oneHot")},t.prototype.cumsum=function(t,e,n,o){return notYetImplemented("cumsum")},t.prototype.nonMaxSuppression=function(t,e,n,o,r){return notYetImplemented("nonMaxSuppression")},t.prototype.fft=function(t){return notYetImplemented("fft")},t.prototype.ifft=function(t){return notYetImplemented("ifft")},t.prototype.complex=function(t,e){return notYetImplemented("complex")},t.prototype.real=function(t){return notYetImplemented("real")},t.prototype.imag=function(t){return notYetImplemented("imag")},t.prototype.cropAndResize=function(t,e,n,o,r,p){return notYetImplemented("cropAndResize")},t.prototype.depthToSpace=function(t,e,n){return notYetImplemented("depthToSpace")},t.prototype.split=function(t,e,n){return notYetImplemented("split")},t.prototype.sparseToDense=function(t,e,n,o){return notYetImplemented("sparseToDense")},t.prototype.diag=function(t){return notYetImplemented("diag")},t.prototype.fill=function(t,e,n){return notYetImplemented("fill")},t.prototype.onesLike=function(t){return notYetImplemented("onesLike")},t.prototype.zerosLike=function(t){return notYetImplemented("zerosLike")},t.prototype.linspace=function(t,e,n){return notYetImplemented("linspace")},t.prototype.dispose=function(){return notYetImplemented("dispose")},t}();function notYetImplemented(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}exports.KernelBackend=KernelBackend;

},{}],56:[function(require,module,exports){
"use strict";function __export(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_ops_1=require("../ops/tensor_ops"),util_1=require("../util");__export(require("../ops/axis_util")),__export(require("../ops/broadcast_util")),__export(require("../ops/concat_util")),__export(require("../ops/conv_util")),__export(require("../ops/reduce_util"));var types_1=require("../types");function castTensor(e,r,t){if("complex64"===r){if("complex64"===e.dtype)return e.clone();var o=tensor_ops_1.zeros(e.shape),s=e.toFloat(),p=t.complex(s,o);return o.dispose(),s.dispose(),p}if(!util_1.hasEncodingLoss(e.dtype,r))return engine_1.ENGINE.makeTensorFromDataId(e.dataId,e.shape,r);if("complex64"===e.dtype){var n=t.real(e);p=n.cast(r);return n.dispose(),p}if("int32"===r)return t.int(e);if("bool"===r){var a=tensor_ops_1.scalar(0,e.dtype);p=t.notEqual(e,a);return a.dispose(),p}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+r)}function reshapeTensor(e,r){return engine_1.ENGINE.makeTensorFromDataId(e.dataId,r,e.dtype)}function linspaceImpl(e,r,t){var o=(r-e)/(t-1),s=util_1.makeZerosTypedArray(t,"float32");s[0]=e;for(var p=1;p<s.length;p++)s[p]=s[p-1]+o;return tensor_ops_1.tensor1d(s,"float32")}exports.upcastType=types_1.upcastType,exports.castTensor=castTensor,exports.reshapeTensor=reshapeTensor,exports.linspaceImpl=linspaceImpl;

},{"../engine":163,"../ops/axis_util":194,"../ops/broadcast_util":199,"../ops/concat_util":205,"../ops/conv_util":208,"../ops/reduce_util":240,"../ops/tensor_ops":259,"../types":293,"../util":294}],57:[function(require,module,exports){
"use strict";function mergeRealAndImagArrays(e,r){if(e.length!==r.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+r.length+".");for(var t=new Float32Array(2*e.length),n=0;n<t.length;n+=2)t[n]=e[n/2],t[n+1]=r[n/2];return t}function splitRealAndImagArrays(e){for(var r=new Float32Array(e.length/2),t=new Float32Array(e.length/2),n=0;n<e.length;n+=2)r[n/2]=e[n],t[n/2]=e[n+1];return{real:r,imag:t}}function complexWithEvenIndex(e){for(var r=Math.ceil(e.length/4),t=new Float32Array(r),n=new Float32Array(r),a=0;a<e.length;a+=4)t[Math.floor(a/4)]=e[a],n[Math.floor(a/4)]=e[a+1];return{real:t,imag:n}}function complexWithOddIndex(e){for(var r=Math.floor(e.length/4),t=new Float32Array(r),n=new Float32Array(r),a=2;a<e.length;a+=4)t[Math.floor(a/4)]=e[a],n[Math.floor(a/4)]=e[a+1];return{real:t,imag:n}}function getComplexWithIndex(e,r){return{real:e[2*r],imag:e[2*r+1]}}function assignToTypedArray(e,r,t,n){e[2*n]=r,e[2*n+1]=t}function exponents(e,r){for(var t=new Float32Array(e/2),n=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var o=(r?2:-2)*Math.PI*(a/e);t[a]=Math.cos(o),n[a]=Math.sin(o)}return{real:t,imag:n}}function exponent(e,r,t){var n=(t?2:-2)*Math.PI*(e/r);return{real:Math.cos(n),imag:Math.sin(n)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeRealAndImagArrays=mergeRealAndImagArrays,exports.splitRealAndImagArrays=splitRealAndImagArrays,exports.complexWithEvenIndex=complexWithEvenIndex,exports.complexWithOddIndex=complexWithOddIndex,exports.getComplexWithIndex=getComplexWithIndex,exports.assignToTypedArray=assignToTypedArray,exports.exponents=exponents,exports.exponent=exponent;

},{}],58:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function a(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),__awaiter=this&&this.__awaiter||function(t,e,r,a){return new(r||(r=Promise))(function(o,i){function n(t){try{p(a.next(t))}catch(t){i(t)}}function s(t){try{p(a.throw(t))}catch(t){i(t)}}function p(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(n,s)}p((a=a.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,a,o,i,n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,a&&(o=2&i[0]?a.return:i[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,i[1])).done)return o;switch(a=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,a=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(o=(o=n.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){n=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){n.label=i[1];break}if(6===i[0]&&n.label<o[1]){n.label=o[1],o=i;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(i);break}o[2]&&n.ops.pop(),n.trys.pop();continue}i=e.call(t,n)}catch(t){i=[6,t],a=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),engine_1=require("../../engine"),environment_1=require("../../environment"),log_1=require("../../log"),array_ops_util=require("../../ops/array_ops_util"),axis_util=require("../../ops/axis_util"),broadcast_util=require("../../ops/broadcast_util"),complex_ops_1=require("../../ops/complex_ops"),concat_util=require("../../ops/concat_util"),div_1=require("../../ops/div"),erf_util=require("../../ops/erf_util"),gather_nd_util=require("../../ops/gather_nd_util"),ops=require("../../ops/ops"),ops_1=require("../../ops/ops"),scatter_nd_util=require("../../ops/scatter_nd_util"),selu_util=require("../../ops/selu_util"),slice_util_1=require("../../ops/slice_util"),tensor_1=require("../../tensor"),types_1=require("../../types"),util=require("../../util"),util_1=require("../../util"),backend_1=require("../backend"),backend_util=require("../backend_util"),complex_util=require("../complex_util"),non_max_suppression_impl_1=require("../non_max_suppression_impl"),split_shared_1=require("../split_shared"),tile_impl_1=require("../tile_impl"),topk_impl_1=require("../topk_impl"),where_impl_1=require("../where_impl"),cpu_util_1=require("./cpu_util");function mapActivation(t,e,r,a){if("linear"===r)return t.linear(e);if("relu"===r)return t.relu(e);if("elu"===r)return t.elu(e);if("relu6"===r)return t.relu6(e);if("prelu"===r)return t.prelu(e,a);throw new Error("Activation "+r+" has not been implemented for the CPU backend.")}var MathBackendCPU=function(t){function e(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new backend_1.DataStorage(e,engine_1.ENGINE),e}return __extends(e,t),e.prototype.write=function(t,e,r){this.firstUse&&(this.firstUse=!1,environment_1.env().get("IS_NODE")&&log_1.warn("\n============================\nHi there ð. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var a={};return this.data.set(a,{values:t,dtype:r}),a},e.prototype.move=function(t,e,r,a){this.data.set(t,{values:e,dtype:a})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var e=this.data.get(t),r=e.dtype,a=e.complexTensors;if("complex64"===r){var o=this.readSync(a.real.dataId),i=this.readSync(a.imag.dataId);return complex_util.mergeRealAndImagArrays(o,i)}return this.data.get(t).values},e.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),r=e;if("string"===t.dtype)try{r=e.map(function(t){return util.decodeString(t)})}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return ops_1.buffer(t.shape,t.dtype,r)},e.prototype.makeOutput=function(t,e,r){var a=this.write(t,e,r);return engine_1.ENGINE.makeTensorFromDataId(a,e,r,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){return e=util_1.now(),t(),[2,{kernelMs:util_1.now()-e}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,e){var r=this.makeOutput(null,t.shape,"complex64");return this.data.get(r.dataId).complexTensors={real:engine_1.ENGINE.keep(t.clone()),imag:engine_1.ENGINE.keep(e.clone())},r},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,r){if(cpu_util_1.assertNotComplex(t,"slice"),slice_util_1.isSliceContinous(t.shape,e,r)){var a=slice_util_1.computeFlatOffset(e,t.strides),o=util.sizeFromShape(r),i=this.readSync(t.dataId);return ops_1.tensor(i.subarray(a,a+o),r,t.dtype)}for(var n=ops.buffer(r,t.dtype),s=this.bufferSync(t),p=0;p<n.size;++p){var u=n.indexToLoc(p).map(function(t,r){return t+e[r]});n.values[p]=s.get.apply(s,u)}return n.toTensor()},e.prototype.stridedSlice=function(t,e,r,a){cpu_util_1.assertNotComplex(t,"stridedSlice");var o=slice_util_1.computeOutShape(e,r,a);if(o.some(function(t){return 0===t}))return ops.tensor([],o);for(var i=ops.buffer(o,t.dtype),n=this.bufferSync(t),s=0;s<i.size;s++){for(var p=i.indexToLoc(s),u=new Array(p.length),l=0;l<u.length;l++)u[l]=p[l]*a[l]+e[l];i.set.apply(i,[n.get.apply(n,u)].concat(p))}return i.toTensor()},e.prototype.diag=function(t){for(var e=this.readSync(t.dataId),r=ops.buffer([t.size,t.size],t.dtype),a=r.values,o=0;o<e.length;o++)a[o*t.size+o]=e[o];return r.toTensor()},e.prototype.unstack=function(t,e){for(var r=t.shape[e],a=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(a[o++]=t.shape[i]);var n=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var p=new Array(r);for(i=0;i<p.length;i++)n[e]=i,p[i]=this.slice(t,n,s).reshape(a);return p},e.prototype.reverse=function(t,e){cpu_util_1.assertNotComplex(t,"reverse");for(var r=ops.buffer(t.shape,t.dtype),a=this.bufferSync(t),o=function(o){var i=r.indexToLoc(o),n=i.slice();e.forEach(function(e){return n[e]=t.shape[e]-1-n[e]}),r.set.apply(r,[a.get.apply(a,n)].concat(i))},i=0;i<r.size;i++)o(i);return r.toTensor()},e.prototype.concat=function(t,e){var r=this;if("complex64"===t[0].dtype){var a=t.map(function(t){return complex_ops_1.real(t)}),o=t.map(function(t){return complex_ops_1.imag(t)});return complex_ops_1.complex(this.concat(a,e),this.concat(o,e))}var i=t.map(function(t){var r=util.sizeFromShape(t.shape.slice(e));return t.as2D(-1,r)}),n=concat_util.computeOutShape(i.map(function(t){return t.shape}),1),s=ops.buffer(n,t[0].dtype).values;if(1===i[0].shape[0]){var p=0;i.forEach(function(t){s.set(r.readSync(t.dataId),p),p+=t.size})}else{var u=0;i.forEach(function(t){for(var e=r.readSync(t.dataId),a=0,o=0;o<t.shape[0];++o)for(var i=o*n[1]+u,p=0;p<t.shape[1];++p)s[i+p]=e[a++];u+=t.shape[1]})}var l=concat_util.computeOutShape(t.map(function(t){return t.shape}),e);return ops_1.tensor(s,l,t[0].dtype)},e.prototype.neg=function(t){return cpu_util_1.assertNotComplex(t,"neg"),this.multiply(ops.scalar(-1),t)},e.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,r,a){return{real:t+r,imag:e+a}}):this.broadcastedBinaryOp(t,e,types_1.upcastType(t.dtype,e.dtype),function(t,e){return t+e})},e.prototype.addN=function(t){var e=this;cpu_util_1.assertNotComplex(t,"addN");for(var r=t.map(function(t){return e.readSync(t.dataId)}),a=ops.buffer(t[0].shape,t[0].dtype),o=a.values,i=0;i<t.length;i++)for(var n=r[i],s=0;s<o.length;s++)o[s]+=n[s];return a.toTensor()},e.prototype.softmax=function(t,e){var r=util.parseAxisParam([e],t.shape),a=this.max(t,r),o=axis_util.expandShapeToKeepDim(a.shape,r),i=this.subtract(t,a.reshape(o)),n=this.exp(i),s=this.sum(n,r).reshape(o);return div_1.div(n,s)},e.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,r,a){return{real:t-r,imag:e-a}}):this.broadcastedBinaryOp(t,e,types_1.upcastType(t.dtype,e.dtype),function(t,e){return t-e})},e.prototype.pow=function(t,e){return cpu_util_1.assertNotComplex([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},e.prototype.batchMatMul=function(t,e,r,a){cpu_util_1.assertNotComplex([t,e],"matMul");for(var o=r?t.shape[1]:t.shape[2],i=r?t.shape[2]:t.shape[1],n=a?e.shape[1]:e.shape[2],s=t.shape[0],p=this.readSync(t.dataId),u=this.readSync(e.dataId),l=r?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],h=l[0],d=l[1],f=l[2],c=a?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],y=c[0],v=c[1],m=c[2],_=i*n,g=ops_1.buffer([s,i,n],t.dtype),x=g.values,S=this.blockSize,I=0;I<s;I++)for(var b=0;b<i;b+=S)for(var M=0;M<n;M+=S)for(var N=0;N<o;N+=S)for(var C=Math.min(b+S,i),k=Math.min(M+S,n),w=Math.min(N+S,o),A=b;A<C;A++)for(var F=M;F<k;F++){for(var z=0,D=N;D<w;D++)z+=p[I*h+A*d+D*f]*u[D*y+F*v+I*m];x[I*_+(A*n+F)]+=z}return g.toTensor()},e.prototype.fusedBatchMatMul=function(t){var e=t.a,r=t.b,a=t.transposeA,o=t.transposeB,i=t.bias,n=t.activation,s=t.preluActivationWeights,p=this.batchMatMul(e,r,a,o);return i&&(p=this.add(p,i)),n&&(p=mapActivation(this,p,n,s)),p},e.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,r,a){return{real:t*r-e*a,imag:t*a+e*r}}):this.broadcastedBinaryOp(t,e,types_1.upcastType(t.dtype,e.dtype),function(t,e){return t*e})},e.prototype.floorDiv=function(t,e){cpu_util_1.assertNotComplex([t,e],"floorDiv");return this.broadcastedBinaryOp(t,e,"int32",function(t,e){return Math.floor(t/e)})},e.prototype.sum=function(t,e){cpu_util_1.assertNotComplex(t,"sum"),axis_util.assertAxesAreInnerMostDims("sum",e,t.rank);for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],i=types_1.upcastType(t.dtype,"int32"),n=ops.zeros(a,i),s=util.sizeFromShape(o),p=this.readSync(n.dataId),u=this.readSync(t.dataId),l=0;l<p.length;++l){for(var h=l*s,d=0,f=0;f<s;++f)d+=u[h+f];p[l]=d}return n},e.prototype.prod=function(t,e){cpu_util_1.assertNotComplex(t,"sum");for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],i=types_1.upcastType(t.dtype,"int32"),n=ops.zeros(a,i),s=util.sizeFromShape(o),p=this.readSync(n.dataId),u=this.readSync(t.dataId),l=0;l<p.length;++l){for(var h=l*s,d=1,f=0;f<s;++f)d*=u[h+f];p[l]=d}return n},e.prototype.unsortedSegmentSum=function(t,e,r){cpu_util_1.assertNotComplex(t,"unsortedSegmentSum");for(var a=[],o=t.rank-e.rank,i=0;i<o;++i)e=e.expandDims(i+1);for(i=0;i<r;++i){var n=ops.scalar(i,"int32"),s=ops.equal(n,e).asType("float32").mul(t).sum(0);a.push(s)}return ops.stack(a)},e.prototype.argMin=function(t,e){cpu_util_1.assertNotComplex(t,"argMin");var r=[e];axis_util.assertAxesAreInnerMostDims("argMin",r,t.rank);for(var a=axis_util.computeOutAndReduceShapes(t.shape,r),o=a[0],i=a[1],n=ops.zeros(o,"int32"),s=util.sizeFromShape(i),p=this.readSync(n.dataId),u=this.readSync(t.dataId),l=0;l<p.length;++l){for(var h=l*s,d=u[h],f=0,c=0;c<s;++c){var y=u[h+c];y<d&&(d=y,f=c)}p[l]=f}return n},e.prototype.argMax=function(t,e){cpu_util_1.assertNotComplex(t,"argMax");var r=[e];axis_util.assertAxesAreInnerMostDims("argMax",r,t.rank);for(var a=axis_util.computeOutAndReduceShapes(t.shape,r),o=a[0],i=a[1],n=ops.zeros(o,"int32"),s=util.sizeFromShape(i),p=this.readSync(n.dataId),u=this.readSync(t.dataId),l=0;l<p.length;++l){for(var h=l*s,d=u[h],f=0,c=0;c<s;++c){var y=u[h+c];y>d&&(d=y,f=c)}p[l]=f}return n},e.prototype.cumsum=function(t,e,r,a){if(cpu_util_1.assertNotComplex(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var o=types_1.upcastType(t.dtype,"int32"),i=ops.zeros(t.shape,o),n=this.readSync(i.dataId),s=this.readSync(t.dataId),p=t.shape[t.rank-1],u=a?function(t,e){return t+p-e-1}:function(t,e){return t+e},l=0;l<s.length;l+=p)for(var h=0;h<p;h++){var d=u(l,h);if(0===h)n[d]=r?0:s[d];else{var f=u(l,h-1);n[d]=r?s[f]+n[f]:s[d]+n[f]}}return i},e.prototype.equal=function(t,e){return cpu_util_1.assertNotComplex([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},e.prototype.notEqual=function(t,e){return cpu_util_1.assertNotComplex([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},e.prototype.less=function(t,e){return cpu_util_1.assertNotComplex([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},e.prototype.lessEqual=function(t,e){return cpu_util_1.assertNotComplex([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},e.prototype.greater=function(t,e){return cpu_util_1.assertNotComplex([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},e.prototype.greaterEqual=function(t,e){return cpu_util_1.assertNotComplex([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},e.prototype.logicalNot=function(t){cpu_util_1.assertNotComplex(t,"logicalNot");for(var e=this.readSync(t.dataId),r=new Uint8Array(e.length),a=0;a<e.length;++a)r[a]=e[a]?0:1;return this.makeOutput(r,t.shape,"bool")},e.prototype.logicalAnd=function(t,e){return cpu_util_1.assertNotComplex([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},e.prototype.logicalOr=function(t,e){return cpu_util_1.assertNotComplex([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},e.prototype.select=function(t,e,r){cpu_util_1.assertNotComplex([t,e,r],"select");for(var a=this.readSync(t.dataId),o=this.readSync(e.dataId),i=this.readSync(r.dataId),n=ops.zeros(e.shape,types_1.upcastType(e.dtype,r.dtype)),s=this.readSync(n.dataId),p=0,u=0===t.rank||t.rank>1||1===e.rank?1:util.sizeFromShape(e.shape.slice(1)),l=0;l<a.length;l++)for(var h=0;h<u;h++)1===a[l]?s[p++]=o[l]:s[p++]=i[l];return n},e.prototype.where=function(t){cpu_util_1.assertNotComplex([t],"where");var e=this.readSync(t.dataId);return where_impl_1.whereImpl(t.shape,e)},e.prototype.topk=function(t,e,r){cpu_util_1.assertNotComplex(t,"topk");var a=this.readSync(t.dataId);return topk_impl_1.topkImpl(a,t.shape,t.dtype,e,r)},e.prototype.min=function(t,e){cpu_util_1.assertNotComplex(t,"min"),axis_util.assertAxesAreInnerMostDims("min",e,t.rank);for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],i=ops.zeros(a,t.dtype),n=util.sizeFromShape(o),s=this.readSync(i.dataId),p=this.readSync(t.dataId),u=0;u<s.length;++u){for(var l=u*n,h=p[l],d=0;d<n;++d){var f=p[l+d];f<h&&(h=f)}s[u]=h}return i},e.prototype.minimum=function(t,e){return cpu_util_1.assertNotComplex([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},e.prototype.mod=function(t,e){return cpu_util_1.assertNotComplex([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var r=t%e;return t<0&&e<0||t>=0&&e>=0?r:(r+e)%e})},e.prototype.max=function(t,e){cpu_util_1.assertNotComplex(t,"max"),axis_util.assertAxesAreInnerMostDims("max",e,t.rank);for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],i=ops.zeros(a,t.dtype),n=util.sizeFromShape(o),s=this.readSync(i.dataId),p=this.readSync(t.dataId),u=0;u<s.length;++u){for(var l=u*n,h=p[l],d=0;d<n;++d){var f=p[l+d];f>h&&(h=f)}s[u]=h}return i},e.prototype.maximum=function(t,e){return cpu_util_1.assertNotComplex([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},e.prototype.all=function(t,e){cpu_util_1.assertNotComplex(t,"all"),axis_util.assertAxesAreInnerMostDims("all",e,t.rank);for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],i=ops.zeros(a,t.dtype),n=util.sizeFromShape(o),s=this.readSync(i.dataId),p=this.readSync(t.dataId),u=0;u<s.length;++u){for(var l=u*n,h=p[l],d=0;d<n;++d){var f=p[l+d];h=h&&f}s[u]=h}return i},e.prototype.any=function(t,e){cpu_util_1.assertNotComplex(t,"any"),axis_util.assertAxesAreInnerMostDims("any",e,t.rank);for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],i=ops.zeros(a,t.dtype),n=util.sizeFromShape(o),s=this.readSync(i.dataId),p=this.readSync(t.dataId),u=0;u<s.length;++u){for(var l=u*n,h=p[l],d=0;d<n;++d){var f=p[l+d];h=h||f}s[u]=h}return i},e.prototype.squaredDifference=function(t,e){return cpu_util_1.assertNotComplex([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var r=t-e;return r*r})},e.prototype.ceil=function(t){cpu_util_1.assertNotComplex(t,"ceil");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=Math.ceil(e[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.floor=function(t){cpu_util_1.assertNotComplex(t,"floor");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=Math.floor(e[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.sign=function(t){cpu_util_1.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a)e[a]<0?r[a]=-1:e[a]>0?r[a]=1:r[a]=0;return this.makeOutput(r,t.shape,"float32")},e.prototype.isNaN=function(t){cpu_util_1.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),r=new Uint8Array(e.length),a=0;a<e.length;++a)Number.isNaN(e[a])&&(r[a]=1);return this.makeOutput(r,t.shape,"bool")},e.prototype.isInf=function(t){cpu_util_1.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),r=new Uint8Array(e.length),a=0;a<e.length;++a)Math.abs(e[a])===1/0&&(r[a]=1);return this.makeOutput(r,t.shape,"bool")},e.prototype.isFinite=function(t){cpu_util_1.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),r=new Uint8Array(e.length),a=0;a<e.length;++a)Number.isFinite(e[a])&&(r[a]=1);return this.makeOutput(r,t.shape,"bool")},e.prototype.round=function(t){cpu_util_1.assertNotComplex(t,"round");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a){var o=Math.floor(e[a]);e[a]-o<.5?r[a]=Math.floor(e[a]):e[a]-o>.5?r[a]=Math.ceil(e[a]):r[a]=o%2==0?o:o+1}return this.makeOutput(r,t.shape,"float32")},e.prototype.exp=function(t){cpu_util_1.assertNotComplex(t,"exp");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=Math.exp(e[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.expm1=function(t){cpu_util_1.assertNotComplex(t,"expm1");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=Math.expm1(e[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.log=function(t){cpu_util_1.assertNotComplex(t,"log");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a){var o=e[a];r[a]=Math.log(o)}return this.makeOutput(r,t.shape,"float32")},e.prototype.log1p=function(t){cpu_util_1.assertNotComplex(t,"log1p");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a){var o=e[a];r[a]=Math.log1p(o)}return this.makeOutput(r,t.shape,"float32")},e.prototype.sqrt=function(t){cpu_util_1.assertNotComplex(t,"sqrt");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a){var o=e[a];r[a]=Math.sqrt(o)}return this.makeOutput(r,t.shape,"float32")},e.prototype.rsqrt=function(t){cpu_util_1.assertNotComplex(t,"rsqrt");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a){var o=e[a];r[a]=1/Math.sqrt(o)}return this.makeOutput(r,t.shape,"float32")},e.prototype.reciprocal=function(t){cpu_util_1.assertNotComplex(t,"reciprocal");for(var e=this.readSync(t.dataId),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=1/e[a];return this.makeOutput(r,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){cpu_util_1.assertNotComplex(t,"relu");for(var e=ops.zeros(t.shape,t.dtype),r=this.readSync(e.dataId),a=this.readSync(t.dataId),o=0;o<a.length;++o)r[o]=Math.max(0,a[o]);return e},e.prototype.relu6=function(t){cpu_util_1.assertNotComplex(t,"relu");for(var e=ops.zeros(t.shape,t.dtype),r=this.readSync(e.dataId),a=this.readSync(t.dataId),o=0;o<a.length;++o)r[o]=Math.min(Math.max(0,a[o]),6);return e},e.prototype.prelu=function(t,e){return cpu_util_1.assertNotComplex([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return t<0?e*t:t})},e.prototype.elu=function(t){cpu_util_1.assertNotComplex(t,"elu");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a){var o=r[a];e[a]=o>=0?o:Math.exp(o)-1}return this.makeOutput(e,t.shape,"float32")},e.prototype.eluDer=function(t,e){cpu_util_1.assertNotComplex([t,e],"eluDer");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=this.readSync(t.dataId),i=0;i<a.length;++i){var n=a[i];r[i]=n>=1?o[i]:o[i]*(n+1)}return this.makeOutput(r,e.shape,"float32")},e.prototype.selu=function(t){cpu_util_1.assertNotComplex(t,"selu");for(var e=selu_util.SELU_SCALEALPHA,r=selu_util.SELU_SCALE,a=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var n=o[i];a[i]=n>=0?r*n:e*(Math.exp(n)-1)}return this.makeOutput(a,t.shape,"float32")},e.prototype.clip=function(t,e,r){cpu_util_1.assertNotComplex(t,"clip");for(var a=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var n=o[i];a[i]=n>r?r:n<e?e:n}return this.makeOutput(a,t.shape,"float32")},e.prototype.abs=function(t){for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.abs(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<t.size;++a){var o=r[2*a],i=r[2*a+1];e[a]=Math.hypot(o,i)}return this.makeOutput(e,t.shape,"float32")},e.prototype.int=function(t){cpu_util_1.assertNotComplex(t,"int");for(var e=new Int32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=r[a];return this.makeOutput(e,t.shape,"int32")},e.prototype.sigmoid=function(t){cpu_util_1.assertNotComplex(t,"sigmoid");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=1/(1+Math.exp(-r[a]));return this.makeOutput(e,t.shape,"float32")},e.prototype.softplus=function(t){cpu_util_1.assertNotComplex(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,r=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var i=a[o]>-e,n=a[o]<e,s=Math.exp(a[o]),p=void 0;p=n?s:i?a[o]:Math.log(1+s),r[o]=p}return this.makeOutput(r,t.shape,"float32")},e.prototype.sin=function(t){cpu_util_1.assertNotComplex(t,"sin");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.sin(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cos=function(t){cpu_util_1.assertNotComplex(t,"cos");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.cos(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tan=function(t){cpu_util_1.assertNotComplex(t,"tan");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.tan(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asin=function(t){cpu_util_1.assertNotComplex(t,"asin");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.asin(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acos=function(t){cpu_util_1.assertNotComplex(t,"acos");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.acos(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan=function(t){cpu_util_1.assertNotComplex(t,"atan");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.atan(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan2=function(t,e){return cpu_util_1.assertNotComplex([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},e.prototype.sinh=function(t){cpu_util_1.assertNotComplex(t,"sinh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.sinh(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cosh=function(t){cpu_util_1.assertNotComplex(t,"cosh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.cosh(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tanh=function(t){cpu_util_1.assertNotComplex(t,"tanh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=util.tanh(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asinh=function(t){cpu_util_1.assertNotComplex(t,"asinh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.asinh(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acosh=function(t){cpu_util_1.assertNotComplex(t,"acosh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.acosh(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atanh=function(t){cpu_util_1.assertNotComplex(t,"atanh");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=0;a<r.length;++a)e[a]=Math.atanh(r[a]);return this.makeOutput(e,t.shape,"float32")},e.prototype.erf=function(t){cpu_util_1.assertNotComplex(t,"erf");for(var e=new Float32Array(t.size),r=this.readSync(t.dataId),a=erf_util.ERF_P,o=erf_util.ERF_A1,i=erf_util.ERF_A2,n=erf_util.ERF_A3,s=erf_util.ERF_A4,p=erf_util.ERF_A5,u=0;u<r.length;++u){var l=Math.sign(r[u]),h=Math.abs(r[u]),d=1/(1+a*h);e[u]=l*(1-((((p*d+s)*d+n)*d+i)*d+o)*d*Math.exp(-h*h))}return this.makeOutput(e,t.shape,"float32")},e.prototype.step=function(t,e){void 0===e&&(e=0),cpu_util_1.assertNotComplex(t,"step");for(var r=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var i=a[o];isNaN(i)?r[o]=NaN:r[o]=i>0?1:e}return this.makeOutput(r,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var e=t.input,r=t.filter,a=t.convInfo,o=t.bias,i=t.activation,n=t.preluActivationWeights,s=this.conv2d(e,r,a);return o&&(s=this.add(s,o)),i&&(s=mapActivation(this,s,i,n)),s},e.prototype.conv2d=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"conv2d");for(var a=r.filterHeight,o=r.filterWidth,i=r.dilationHeight,n=r.dilationWidth,s=r.padInfo.left,p=r.padInfo.top,u="channelsLast"===r.dataFormat,l=ops.buffer(r.outShape,t.dtype),h=t.strides[0],d=u?t.strides[1]:t.strides[2],f=u?t.strides[2]:1,c=u?1:t.strides[1],y=l.strides[0],v=u?l.strides[1]:l.strides[2],m=u?l.strides[2]:1,_=u?1:l.strides[1],g=this.readSync(t.dataId),x=this.readSync(e.dataId),S=l.values,I=0;I<r.batchSize;++I)for(var b=I*h,M=I*y,N=0;N<r.outHeight;++N)for(var C=M+N*v,k=N*r.strideHeight-p,w=0;w<a;w++){var A=k+w*i;if(!(A<0||A>=r.inHeight))for(var F=w*e.strides[0],z=b+A*d,D=0;D<r.outWidth;++D)for(var T=C+D*m,O=D*r.strideWidth-s,W=0;W<o;W++){var H=O+W*n;if(!(H<0||H>=r.inWidth))for(var B=z+H*f,E=F+W*e.strides[1],q=0;q<r.inChannels;++q){for(var P=g[B+q*c],R=0;R<r.outChannels;++R)S[T+R*_]+=P*x[E+R];E+=r.outChannels}}}return l.toTensor()},e.prototype.conv3d=function(t,e,r){for(var a=r.filterDepth,o=r.filterHeight,i=r.filterWidth,n=r.dilationDepth,s=r.dilationHeight,p=r.dilationWidth,u=r.padInfo.front,l=r.padInfo.left,h=r.padInfo.top,d=ops.buffer(r.outShape,t.dtype),f=this.readSync(t.dataId),c=this.readSync(e.dataId),y=d.values,v=0;v<r.batchSize;++v)for(var m=v*t.strides[0],_=v*d.strides[0],g=0;g<r.outDepth;++g)for(var x=_+g*d.strides[1],S=g*r.strideDepth-u,I=0;I<a;I++){var b=S+I*n;if(!(b<0||b>=r.inDepth))for(var M=I*e.strides[0],N=m+b*t.strides[1],C=0;C<r.outHeight;++C)for(var k=x+C*d.strides[2],w=C*r.strideHeight-h,A=0;A<o;A++){var F=w+A*s;if(!(F<0||F>=r.inHeight))for(var z=M+A*e.strides[1],D=N+F*t.strides[2],T=0;T<r.outWidth;++T)for(var O=k+T*r.outChannels,W=T*r.strideWidth-l,H=0;H<i;H++){var B=W+H*p;if(!(B<0||B>=r.inWidth))for(var E=z+H*e.strides[2],q=D+B*r.inChannels,P=E,R=0;R<r.inChannels;++R){for(var L=f[q+R],U=0;U<r.outChannels;++U)y[O+U]+=L*c[P+U];P+=r.outChannels}}}}return d.toTensor()},e.prototype.conv2dDerInput=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"conv2dDerInput");for(var a=ops.buffer(r.inShape,"float32"),o=a.values,i=this.readSync(t.dataId),n=this.readSync(e.dataId),s=e.strides,p=s[0],u=s[1],l=s[2],h=r.batchSize,d=r.filterHeight,f=r.filterWidth,c=r.inChannels,y=r.inHeight,v=r.inWidth,m=r.outChannels,_=r.outHeight,g=r.outWidth,x=r.strideHeight,S=r.strideWidth,I=r.dataFormat,b=d-1-r.padInfo.top,M=f-1-r.padInfo.left,N="channelsLast"===I,C=a.strides[0],k=N?a.strides[1]:a.strides[2],w=N?a.strides[2]:1,A=N?1:a.strides[1],F=t.strides[0],z=N?t.strides[1]:t.strides[2],D=N?t.strides[2]:1,T=N?1:t.strides[1],O=0;O<h;++O)for(var W=0;W<c;++W)for(var H=0;H<y;++H)for(var B=H-b,E=Math.max(0,Math.ceil(B/x)),q=Math.min(_,(d+B)/x),P=0;P<v;++P){for(var R=P-M,L=Math.max(0,Math.ceil(R/S)),U=Math.min(g,(f+R)/S),G=0,j=E;j<q;++j)for(var V=j*x-B,Y=L;Y<U;++Y)for(var K=F*O+z*j+D*Y,J=p*(d-1-V)+u*(f-1-(Y*S-R))+l*W,Q=0;Q<m;++Q){G+=i[K+T*Q]*n[J+Q]}o[C*O+k*H+w*P+A*W]=G}return a.toTensor()},e.prototype.conv3dDerInput=function(t,e,r){for(var a=ops.buffer(r.inShape,"float32"),o=a.values,i=a.strides,n=i[0],s=i[1],p=i[2],u=i[3],l=this.readSync(t.dataId),h=t.strides,d=h[0],f=h[1],c=h[2],y=h[3],v=this.readSync(e.dataId),m=e.strides,_=m[0],g=m[1],x=m[2],S=m[3],I=r.batchSize,b=r.filterDepth,M=r.filterHeight,N=r.filterWidth,C=r.inChannels,k=r.inDepth,w=r.inHeight,A=r.inWidth,F=r.outChannels,z=r.outDepth,D=r.outHeight,T=r.outWidth,O=r.strideDepth,W=r.strideHeight,H=r.strideWidth,B=b-1-r.padInfo.front,E=M-1-r.padInfo.top,q=N-1-r.padInfo.left,P=0;P<I;++P)for(var R=0;R<C;++R)for(var L=0;L<k;++L)for(var U=L-B,G=Math.max(0,Math.ceil(U/O)),j=Math.min(z,(b+U)/O),V=0;V<w;++V)for(var Y=V-E,K=Math.max(0,Math.ceil(Y/W)),J=Math.min(D,(M+Y)/W),Q=0;Q<A;++Q){for(var X=Q-q,Z=Math.max(0,Math.ceil(X/H)),$=Math.min(T,(N+X)/H),tt=0,et=G;et<j;++et)for(var rt=et*O-U,at=K;at<J;++at)for(var ot=at*W-Y,it=Z;it<$;++it)for(var nt=d*P+f*et+c*at+y*it,st=_*(b-1-rt)+g*(M-1-ot)+x*(N-1-(it*H-X))+S*R,pt=0;pt<F;++pt){tt+=l[nt+pt]*v[st+pt]}o[n*P+s*L+p*V+u*Q+R]=tt}return a.toTensor()},e.prototype.conv2dDerFilter=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"conv2dDerFilter");for(var a=r.strideHeight,o=r.strideWidth,i=r.filterHeight,n=r.filterWidth,s="channelsLast"===r.dataFormat,p=ops.buffer(r.filterShape,"float32"),u=r.padInfo.left,l=r.padInfo.top,h=this.bufferSync(t),d=this.bufferSync(e),f=0;f<i;++f)for(var c=Math.max(0,Math.ceil((l-f)/a)),y=Math.min(r.outHeight,(r.inHeight+l-f)/a),v=0;v<n;++v)for(var m=Math.max(0,Math.ceil((u-v)/o)),_=Math.min(r.outWidth,(r.inWidth+u-v)/o),g=0;g<r.inChannels;++g)for(var x=0;x<r.outChannels;++x){for(var S=0,I=0;I<r.batchSize;++I)for(var b=c;b<y;++b)for(var M=f+b*a-l,N=m;N<_;++N){var C=v+N*o-u;S+=s?h.get(I,M,C,g)*d.get(I,b,N,x):h.get(I,g,M,C)*d.get(I,x,b,N)}p.set(S,f,v,g,x)}return p.toTensor()},e.prototype.conv3dDerFilter=function(t,e,r){for(var a=r.strideDepth,o=r.strideHeight,i=r.strideWidth,n=r.filterDepth,s=r.filterHeight,p=r.filterWidth,u=ops.buffer(r.filterShape,"float32"),l=u.values,h=u.strides,d=h[0],f=h[1],c=h[2],y=h[3],v=this.readSync(e.dataId),m=e.strides,_=m[0],g=m[1],x=m[2],S=m[3],I=this.readSync(t.dataId),b=t.strides,M=b[0],N=b[1],C=b[2],k=b[3],w=r.padInfo.front,A=r.padInfo.left,F=r.padInfo.top,z=0;z<n;++z)for(var D=Math.max(0,Math.ceil((w-z)/a)),T=Math.min(r.outDepth,(r.inDepth+w-z)/a),O=z*d,W=0;W<s;++W)for(var H=Math.max(0,Math.ceil((F-W)/o)),B=Math.min(r.outHeight,(r.inHeight+F-W)/o),E=W*f+O,q=0;q<p;++q)for(var P=Math.max(0,Math.ceil((A-q)/i)),R=Math.min(r.outWidth,(r.inWidth+A-q)/i),L=q*c+E,U=0;U<r.inChannels;++U)for(var G=U*y+L,j=0;j<r.outChannels;++j){for(var V=0,Y=0;Y<r.batchSize;++Y)for(var K=Y*M,J=Y*_,Q=D;Q<T;++Q)for(var X=(z+Q*a-w)*N+K,Z=Q*g+J,$=H;$<B;++$)for(var tt=(W+$*o-F)*C+X,et=$*x+Z,rt=P;rt<R;++rt){var at=rt*S+et;V+=I[(q+rt*i-A)*k+tt+U]*v[at+j]}l[G+j]=V}return u.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var e=t.input,r=t.filter,a=t.convInfo,o=t.bias,i=t.activation,n=t.preluActivationWeights,s=this.depthwiseConv2D(e,r,a);return o&&(s=this.add(s,o)),i&&(s=mapActivation(this,s,i,n)),s},e.prototype.depthwiseConv2D=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"depthwiseConv2D");for(var a=r.filterHeight,o=r.filterWidth,i=r.dilationHeight,n=r.dilationWidth,s=r.padInfo.left,p=r.padInfo.top,u=r.outChannels/r.inChannels,l=ops.buffer(r.outShape,t.dtype),h=this.readSync(t.dataId),d=this.readSync(e.dataId),f=l.values,c=0;c<r.batchSize;++c)for(var y=c*t.strides[0],v=c*l.strides[0],m=0;m<r.outHeight;++m)for(var _=v+m*l.strides[1],g=m*r.strideHeight-s,x=0;x<a;++x){var S=g+x*i;if(!(S<0||S>=r.inHeight))for(var I=x*e.strides[0],b=y+S*t.strides[1],M=0;M<r.outWidth;++M)for(var N=_+M*l.strides[2],C=M*r.strideWidth-p,k=0;k<o;++k){var w=C+k*n;if(!(w<0||w>=r.inWidth))for(var A=I+k*e.strides[1],F=b+w*r.inChannels,z=N,D=A,T=0;T<r.inChannels;++T){for(var O=h[F+T],W=0;W<u;++W)f[z+W]+=O*d[D+W];z+=u,D+=u}}}return l.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"depthwiseConv2DDerInput");for(var a=ops.buffer(r.inShape,"float32"),o=a.values,i=a.strides,n=i[0],s=i[1],p=i[2],u=this.readSync(t.dataId),l=t.strides,h=l[0],d=l[1],f=l[2],c=this.readSync(e.dataId),y=e.strides,v=y[0],m=y[1],_=y[2],g=r.batchSize,x=r.filterHeight,S=r.filterWidth,I=r.inChannels,b=r.inHeight,M=r.inWidth,N=r.outChannels,C=r.outHeight,k=r.outWidth,w=r.strideHeight,A=r.strideWidth,F=x-1-r.padInfo.top,z=S-1-r.padInfo.left,D=N/I,T=0;T<g;++T)for(var O=0;O<I;++O)for(var W=0;W<b;++W)for(var H=W-F,B=Math.max(0,Math.ceil(H/w)),E=Math.min(C,(x+H)/w),q=0;q<M;++q){for(var P=q-z,R=Math.max(0,Math.ceil(P/A)),L=Math.min(k,(S+P)/A),U=0,G=B;G<E;++G)for(var j=G*w-H,V=R;V<L;++V)for(var Y=h*T+d*G+f*V,K=v*(x-1-j)+m*(S-1-(V*A-P))+_*O,J=0;J<D;++J){U+=u[Y+(O*D+J)]*c[K+J]}o[n*T+s*W+p*q+O]=U}return a.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"depthwiseConv2DDerFilter");for(var a=r.strideHeight,o=r.strideWidth,i=r.filterHeight,n=r.filterWidth,s=ops.buffer(r.filterShape,"float32"),p=r.padInfo.left,u=r.padInfo.top,l=r.outChannels/r.inChannels,h=this.bufferSync(t),d=this.bufferSync(e),f=0;f<i;++f)for(var c=Math.max(0,Math.ceil((u-f)/a)),y=Math.min(r.outHeight,(r.inHeight+u-f)/a),v=0;v<n;++v)for(var m=Math.max(0,Math.ceil((p-v)/o)),_=Math.min(r.outWidth,(r.inWidth+p-v)/o),g=0;g<r.outChannels;++g){for(var x=Math.trunc(g/l),S=g%l,I=0,b=0;b<r.batchSize;++b)for(var M=c;M<y;++M)for(var N=f+M*a-u,C=m;C<_;++C){var k=v+C*o-p;I+=h.get(b,N,k,x)*d.get(b,M,C,g)}s.set(I,f,v,x,S)}return s.toTensor()},e.prototype.tile=function(t,e){return cpu_util_1.assertNotComplex(t,"tile"),tile_impl_1.tile(this.bufferSync(t),e)},e.prototype.pad=function(t,e,r){cpu_util_1.assertNotComplex(t,"pad");var a=e.map(function(e,r){return e[0]+t.shape[r]+e[1]}),o=e.map(function(t){return t[0]}),i=this.bufferSync(t),n=ops.buffer(a,t.dtype);0!==r&&n.values.fill(r);for(var s=0;s<t.size;s++){var p=i.indexToLoc(s),u=p.map(function(t,e){return t+o[e]});n.set.apply(n,[i.get.apply(i,p)].concat(u))}return n.toTensor()},e.prototype.transpose=function(t,e){cpu_util_1.assertNotComplex(t,"transpose");for(var r=new Array(t.rank),a=0;a<r.length;a++)r[a]=t.shape[e[a]];var o=this.readSync(t.dataId),i=ops_1.buffer(r,t.dtype),n=this.bufferSync(t);for(a=0;a<t.size;++a){for(var s=n.indexToLoc(a),p=new Array(s.length),u=0;u<p.length;u++)p[u]=s[e[u]];var l=i.locToIndex(p);i.values[l]=o[a]}return i.toTensor()},e.prototype.gather=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"gather");var a=t.shape.slice(),o=this.readSync(e.dataId);a[r]=o.length;for(var i=ops_1.buffer(a,t.dtype),n=this.bufferSync(t),s=0;s<i.size;++s){var p=i.indexToLoc(s),u=p.slice();u[r]=o[p[r]];var l=n.locToIndex(u);i.values[s]=n.values[l]}return i.toTensor()},e.prototype.batchToSpaceND=function(t,e,r){cpu_util_1.assertNotComplex([t],"batchToSpaceND");var a=e.reduce(function(t,e){return t*e}),o=array_ops_util.getReshaped(t.shape,e,a),i=array_ops_util.getPermuted(o.length,e.length),n=array_ops_util.getReshapedPermuted(t.shape,e,a),s=array_ops_util.getSliceBeginCoords(r,e.length),p=array_ops_util.getSliceSize(n,r,e.length);return t.reshape(o).transpose(i).reshape(n).slice(s,p)},e.prototype.spaceToBatchND=function(t,e,r){cpu_util_1.assertNotComplex([t],"spaceToBatchND");var a=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,r);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var n=t.pad(o),s=array_ops_util.getReshaped(n.shape,e,a,!1),p=array_ops_util.getPermuted(s.length,e.length,!1),u=array_ops_util.getReshapedPermuted(n.shape,e,a,!1);return n.reshape(s).transpose(p).reshape(u)},e.prototype.pool=function(t,e,r){cpu_util_1.assertNotComplex(t,"pool");for(var a=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,n=e.dilationWidth,s=e.effectiveFilterHeight,p=e.effectiveFilterWidth,u=e.padInfo.top,l=e.padInfo.left,h="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(t.dataId),f=ops.buffer(e.outShape,t.dtype),c=f.values,y=e.outShape[1]*e.outShape[2]*e.outShape[3],v=e.outShape[2]*e.outShape[3],m=e.outShape[3],_=0;_<e.batchSize;++_)for(var g=_*y,x=_*t.strides[0],S=0;S<e.inChannels;++S)for(var I=0;I<e.outHeight;++I)for(var b=I*a-u,M=Math.max(0,b),N=Math.min(e.inHeight,s+b),C=g+I*v,k=0;k<e.outWidth;++k){for(var w=k*o-l,A=Math.max(0,w),F=Math.min(e.inWidth,p+w),z=h,D=0,T=0,O=M;O<N;O+=i){for(var W=x+O*t.strides[1],H=A;H<F;H+=n){var B=d[W+H*t.strides[2]+S];"max"===r&&B>z?z=B:"avg"===r&&(D+=B,T++)}if(isNaN(z))break}c[C+k*m+S]="avg"===r?D/T:z}return f.toTensor()},e.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},e.prototype.maxPoolPositions=function(t,e){for(var r=ops.buffer(e.outShape,"int32"),a=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,n=e.dilationWidth,s=e.effectiveFilterHeight,p=e.effectiveFilterWidth,u=e.padInfo.top,l=e.padInfo.left,h=this.bufferSync(t),d=0;d<e.batchSize;++d)for(var f=0;f<e.inChannels;++f)for(var c=0;c<e.outHeight;++c){for(var y=c*a-u,v=y;v<0;)v+=i;for(var m=Math.min(e.inHeight,s+y),_=0;_<e.outWidth;++_){for(var g=_*o-l,x=g;x<0;)x+=n;for(var S=Math.min(e.inWidth,p+g),I=Number.NEGATIVE_INFINITY,b=-1,M=v;M<m;M+=i)for(var N=M-y,C=x;C<S;C+=n){var k=C-g,w=h.get(d,M,C,f);w>I&&(I=w,b=N*p+k)}r.set(b,d,c,_,f)}}return r.toTensor()},e.prototype.maxPoolBackprop=function(t,e,r,a){cpu_util_1.assertNotComplex([e,r],"maxPoolBackprop");for(var o=this.maxPoolPositions(e,a),i=a.strideHeight,n=a.strideWidth,s=a.dilationHeight,p=a.dilationWidth,u=a.effectiveFilterHeight,l=a.effectiveFilterWidth,h=l-1-a.padInfo.left,d=u-1-a.padInfo.top,f=ops.buffer(e.shape,"float32"),c=this.bufferSync(o),y=this.bufferSync(t),v=0;v<a.batchSize;++v)for(var m=0;m<a.inChannels;++m)for(var _=0;_<a.inHeight;++_)for(var g=0;g<a.inWidth;++g){for(var x=_-d,S=g-h,I=0,b=0;b<u;b+=s){var M=(x+b)/i;if(!(M<0||M>=a.outHeight||Math.floor(M)!==M))for(var N=0;N<l;N+=p){var C=(S+N)/n;if(!(C<0||C>=a.outWidth||Math.floor(C)!==C)){var k=u*l-1-c.get(v,M,C,m)===b*l+N?1:0;if(0!==k)I+=y.get(v,M,C,m)*k}}}f.set(I,v,_,g,m)}return f.toTensor()},e.prototype.avgPoolBackprop=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"avgPoolBackprop");for(var a=r.strideHeight,o=r.strideWidth,i=r.filterHeight,n=r.filterWidth,s=r.dilationHeight,p=r.dilationWidth,u=r.effectiveFilterHeight,l=r.effectiveFilterWidth,h=l-1-r.padInfo.left,d=u-1-r.padInfo.top,f=ops.buffer(e.shape,"float32"),c=1/(i*n),y=this.bufferSync(t),v=0;v<r.batchSize;++v)for(var m=0;m<r.inChannels;++m)for(var _=0;_<r.inHeight;++_)for(var g=0;g<r.inWidth;++g){for(var x=_-d,S=g-h,I=0,b=0;b<u;b+=s){var M=(x+b)/a;if(!(M<0||M>=r.outHeight||Math.floor(M)!==M))for(var N=0;N<l;N+=p){var C=(S+N)/o;if(!(C<0||C>=r.outWidth||Math.floor(C)!==C))I+=y.get(v,M,C,m)}}f.set(I*c,v,_,g,m)}return f.toTensor()},e.prototype.pool3d=function(t,e,r){cpu_util_1.assertNotComplex(t,"pool3d");for(var a=e.strideDepth,o=e.strideHeight,i=e.strideWidth,n=e.dilationDepth,s=e.dilationHeight,p=e.dilationWidth,u=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,c=e.padInfo.left,y="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(t.dataId),m=ops.buffer(e.outShape,t.dtype),_=m.values,g=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],x=e.outShape[2]*e.outShape[3]*e.outShape[4],S=e.outShape[3]*e.outShape[4],I=e.outShape[4],b=0;b<e.batchSize;++b)for(var M=b*g,N=b*t.strides[0],C=0;C<e.inChannels;++C)for(var k=0;k<e.outDepth;++k){for(var w=k*a-d,A=w;A<0;)A+=n;for(var F=Math.min(e.inDepth,u+w),z=M+k*x,D=0;D<e.outHeight;++D){for(var T=D*o-f,O=T;O<0;)O+=s;for(var W=Math.min(e.inHeight,l+T),H=z+D*S,B=0;B<e.outWidth;++B){for(var E=B*i-c,q=E;q<0;)q+=p;for(var P=Math.min(e.inWidth,h+E),R=H+B*I,L=y,U=0,G=0,j=A;j<F;j+=n){for(var V=N+j*t.strides[1],Y=O;Y<W;Y+=s){for(var K=V+Y*t.strides[2],J=q;J<P;J+=p){var Q=v[K+J*t.strides[3]+C];if("max"===r&&Q>L?L=Q:"avg"===r&&(U+=Q,G++),isNaN(L))break}if(isNaN(L))break}if(isNaN(L))break}_[R+C]="avg"===r?U/G:L}}}return m.toTensor()},e.prototype.avgPool3d=function(t,e){return cpu_util_1.assertNotComplex(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"avgPool3dBackprop");for(var a=r.strideDepth,o=r.strideHeight,i=r.strideWidth,n=r.filterDepth,s=r.filterHeight,p=r.filterWidth,u=r.dilationDepth,l=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,c=r.effectiveFilterWidth,y=d-1-r.padInfo.front,v=c-1-r.padInfo.left,m=f-1-r.padInfo.top,_=ops.buffer(e.shape,"float32"),g=1/(n*s*p),x=this.bufferSync(t),S=0;S<r.batchSize;++S)for(var I=0;I<r.inChannels;++I)for(var b=0;b<r.inDepth;++b)for(var M=0;M<r.inHeight;++M)for(var N=0;N<r.inWidth;++N){for(var C=b-y,k=M-m,w=N-v,A=0,F=0;F<d;F+=u){var z=(C+F)/a;if(!(z<0||z>=r.outDepth||Math.floor(z)!==z))for(var D=0;D<f;D+=l){var T=(k+D)/o;if(!(T<0||T>=r.outHeight||Math.floor(T)!==T))for(var O=0;O<c;O+=h){var W=(w+O)/i;if(!(W<0||W>=r.outWidth||Math.floor(W)!==W))A+=x.get(S,z,T,W,I)}}}_.set(A*g,S,b,M,N,I)}return _.toTensor()},e.prototype.maxPool3d=function(t,e){return cpu_util_1.assertNotComplex(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,e){for(var r=ops.buffer(e.outShape,"int32"),a=e.strideDepth,o=e.strideHeight,i=e.strideWidth,n=e.dilationDepth,s=e.dilationHeight,p=e.dilationWidth,u=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,c=e.padInfo.left,y=this.bufferSync(t),v=0;v<e.batchSize;++v)for(var m=0;m<e.inChannels;++m)for(var _=0;_<e.outDepth;++_){for(var g=_*a-d,x=g;x<0;)x+=n;for(var S=Math.min(e.inDepth,u+g),I=0;I<e.outHeight;++I){for(var b=I*o-f,M=b;M<0;)M+=s;for(var N=Math.min(e.inHeight,l+b),C=0;C<e.outWidth;++C){for(var k=C*i-c,w=k;w<0;)w+=p;for(var A=Math.min(e.inWidth,h+k),F=Number.NEGATIVE_INFINITY,z=-1,D=x;D<S;D+=n)for(var T=D-g,O=M;O<N;O+=s)for(var W=O-b,H=w;H<A;H+=p){var B=H-k,E=y.get(v,D,O,H,m);E>=F&&(F=E,z=T*l*h+W*l+B)}r.set(z,v,_,I,C,m)}}}return r.toTensor()},e.prototype.maxPool3dBackprop=function(t,e,r,a){cpu_util_1.assertNotComplex([e,r],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(e,a),i=a.strideDepth,n=a.strideHeight,s=a.strideWidth,p=a.dilationDepth,u=a.dilationHeight,l=a.dilationWidth,h=a.effectiveFilterDepth,d=a.effectiveFilterHeight,f=a.effectiveFilterWidth,c=h-1-a.padInfo.front,y=f-1-a.padInfo.left,v=d-1-a.padInfo.top,m=ops.buffer(e.shape,"float32"),_=this.bufferSync(o),g=this.bufferSync(t),x=0;x<a.batchSize;++x)for(var S=0;S<a.inChannels;++S)for(var I=0;I<a.inDepth;++I)for(var b=0;b<a.inHeight;++b)for(var M=0;M<a.inWidth;++M){for(var N=I-c,C=b-v,k=M-y,w=0,A=0;A<h;A+=p){var F=(N+A)/i;if(!(F<0||F>=a.outDepth||Math.floor(F)!==F))for(var z=0;z<d;z+=u){var D=(C+z)/n;if(!(D<0||D>=a.outHeight||Math.floor(D)!==D))for(var T=0;T<f;T+=l){var O=(k+T)/s;if(!(O<0||O>=a.outWidth||Math.floor(O)!==O)){var W=h*d*f-1-_.get(x,F,D,O,S)===A*d*f+z*f+T?1:0;if(0!==W)w+=g.get(x,F,D,O,S)*W}}}}m.set(w,x,I,b,M,S)}return m.toTensor()},e.prototype.cast=function(t,e){return backend_util.castTensor(t,e,this)},e.prototype.reshape=function(t,e){return backend_util.reshapeTensor(t,e)},e.prototype.avgPool=function(t,e){return cpu_util_1.assertNotComplex(t,"avgPool"),this.pool(t,e,"avg").toFloat()},e.prototype.resizeBilinear=function(t,e,r,a){cpu_util_1.assertNotComplex(t,"resizeBilinear");for(var o=t.shape,i=o[0],n=o[1],s=o[2],p=o[3],u=this.readSync(t.dataId),l=new Float32Array(util.sizeFromShape([i,e,r,p])),h=[a&&e>1?n-1:n,a&&r>1?s-1:s],d=[a&&e>1?e-1:e,a&&r>1?r-1:r],f=0,c=h[0]/d[0],y=h[1]/d[1],v=0;v<i;v++)for(var m=0;m<e;m++)for(var _=c*m,g=Math.floor(_),x=_-g,S=Math.min(n-1,Math.ceil(_)),I=v*t.strides[0]+g*t.strides[1],b=v*t.strides[0]+S*t.strides[1],M=0;M<r;M++)for(var N=y*M,C=Math.floor(N),k=N-C,w=Math.min(s-1,Math.ceil(N)),A=I+C*t.strides[2],F=b+C*t.strides[2],z=I+w*t.strides[2],D=b+w*t.strides[2],T=0;T<p;T++){var O=u[A+T],W=u[F+T],H=O+(u[z+T]-O)*k,B=H+(W+(u[D+T]-W)*k-H)*x;l[f++]=B}return ops.tensor(l,[i,e,r,p])},e.prototype.resizeBilinearBackprop=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"resizeBilinearBackprop");for(var a=e.shape,o=a[0],i=a[1],n=a[2],s=a[3],p=t.shape,u=p[1],l=p[2],h=new Float32Array(o*i*n*s),d=[r&&u>1?i-1:i,r&&l>1?n-1:n],f=[r&&u>1?u-1:u,r&&l>1?l-1:l],c=d[0]/f[0],y=d[1]/f[1],v=this.readSync(t.dataId),m=0,_=0;_<o;_++)for(var g=_*e.strides[0],x=0;x<u;x++)for(var S=x*c,I=Math.floor(S),b=Math.min(Math.ceil(S),i-1),M=g+I*e.strides[1],N=g+b*e.strides[1],C=S-I,k=1-C,w=0;w<l;w++)for(var A=w*y,F=Math.floor(A),z=Math.min(Math.ceil(A),n-1),D=A-F,T=1-D,O=M+F*e.strides[2],W=M+z*e.strides[2],H=N+F*e.strides[2],B=N+z*e.strides[2],E=k*T,q=k*D,P=C*T,R=C*D,L=0;L<s;L++){var U=v[m++];h[O+L]+=U*E,h[W+L]+=U*q,h[H+L]+=U*P,h[B+L]+=U*R}return ops.tensor4d(h,[o,n,i,s],e.dtype)},e.prototype.resizeNearestNeighbor=function(t,e,r,a){cpu_util_1.assertNotComplex(t,"resizeNearestNeighbor");for(var o=t.shape,i=o[0],n=o[1],s=o[2],p=o[3],u=this.readSync(t.dataId),l=new Float32Array(i*e*r*p),h=[a&&e>1?n-1:n,a&&r>1?s-1:s],d=[a&&e>1?e-1:e,a&&r>1?r-1:r],f=h[0]/d[0],c=h[1]/d[1],y=0,v=0;v<i;v++)for(var m=v*t.strides[0],_=0;_<e;_++)for(var g=f*_,x=m+Math.min(n-1,a?Math.round(g):Math.floor(g))*t.strides[1],S=0;S<r;S++)for(var I=c*S,b=x+Math.min(s-1,a?Math.round(I):Math.floor(I))*t.strides[2],M=0;M<p;M++){var N=u[b+M];l[y++]=N}return ops.tensor(l,[i,e,r,p],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,e,r){cpu_util_1.assertNotComplex([t,e],"resizeNearestNeighborBackprop");for(var a=e.shape,o=a[0],i=a[1],n=a[2],s=a[3],p=t.shape,u=p[1],l=p[2],h=new Float32Array(o*i*n*s),d=this.readSync(t.dataId),f=[r&&u>1?i-1:i,r&&l>1?n-1:n],c=[r&&u>1?u-1:u,r&&l>1?l-1:l],y=f[0]/c[0],v=f[1]/c[1],m=1/y,_=1/v,g=2*Math.ceil(m)+2,x=2*Math.ceil(_)+2,S=0;S<o;S++)for(var I=S*e.strides[0],b=0;b<i;b++)for(var M=I+b*e.strides[1],N=Math.floor(b*m),C=Math.floor(N-g/2),k=0;k<n;k++)for(var w=M+k*e.strides[2],A=Math.floor(k*_),F=Math.floor(A-x/2),z=0;z<s;z++){for(var D=0,T=0;T<g;T++){var O=T+C;if(!(O<0||O>=u)){var W=I+O*t.strides[1],H=O*y;if(b===Math.min(i-1,r?Math.round(H):Math.floor(H)))for(var B=0;B<x;B++){var E=B+F;if(!(E<0||E>=l)){var q=W+E*t.strides[2],P=E*v;k===Math.min(n-1,r?Math.round(P):Math.floor(P))&&(D+=d[q+z])}}}}h[w+z]=D}return ops.tensor4d(h,e.shape,e.dtype)},e.prototype.batchNormalization=function(t,e,r,a,o,i){cpu_util_1.assertNotComplex([t,e,r,o,i],"batchNorm");for(var n=this.readSync(t.dataId),s=this.readSync(e.dataId),p=this.readSync(r.dataId),u=o?this.readSync(o.dataId):new Float32Array([1]),l=i?this.readSync(i.dataId):new Float32Array([0]),h=new Float32Array(n.length),d=l.length,f=u.length,c=p.length,y=s.length,v=0,m=0,_=0,g=0,x=0;x<n.length;++x)h[x]=l[v++]+(n[x]-s[m++])*u[_++]/Math.sqrt(p[g++]+a),v>=d&&(v=0),m>=y&&(m=0),_>=f&&(_=0),g>=c&&(g=0);return ops_1.tensor4d(h,t.shape)},e.prototype.localResponseNormalization4D=function(t,e,r,a,o){cpu_util_1.assertNotComplex(t,"localResponseNormalization4D");var i=t.shape[3],n=i-1,s=this.readSync(t.dataId),p=t.size,u=new Float32Array(p);function l(t){for(var r=t%i,a=t-r+Math.max(0,r-e),o=t-r+Math.min(r+e,n),p=0;a<=o;a++){var u=s[a];p+=u*u}return p}for(var h=0;h<p;h++){var d=l(h),f=s[h]*Math.pow(r+a*d,-o);u[h]=f}return ops.tensor4d(u,t.shape)},e.prototype.LRNGrad=function(t,e,r,a,o,i,n){cpu_util_1.assertNotComplex(t,"LRNGrad");for(var s=t.shape[3],p=this.readSync(t.dataId),u=this.readSync(e.dataId),l=this.readSync(r.dataId),h=new Float32Array(t.size),d=t.size,f=0;f<d;f++){for(var c=f%s,y=f-c+Math.max(0,c-a),v=f-c+Math.min(s,c+a+1),m=0,_=y;_<v;_++)m+=Math.pow(u[_],2);m=i*m+o;for(_=y;_<v;_++){var g=-2*i*n*u[_]*l[f]/m;f===_&&(g+=Math.pow(m,-n)),g*=p[f],h[_]+=g}}return ops.tensor4d(h,t.shape)},e.prototype.multinomial=function(t,e,r,a){cpu_util_1.assertNotComplex(t,"multinomial");for(var o=e?t:ops.softmax(t),i=o.shape[0],n=o.shape[1],s=ops.zeros([i,r],"int32"),p=this.readSync(s.dataId),u=this.readSync(o.dataId),l=0;l<i;++l){var h=l*n,d=new Float32Array(n-1);d[0]=u[h];for(var f=1;f<d.length;++f)d[f]=d[f-1]+u[h+f];for(var c=seedrandom.alea(a.toString()),y=l*r,v=0;v<r;++v){var m=c();p[y+v]=d.length;for(var _=0;_<d.length;_++)if(m<d[_]){p[y+v]=_;break}}}return s},e.prototype.oneHot=function(t,e,r,a){cpu_util_1.assertNotComplex(t,"oneHot");var o=new Float32Array(t.size*e);o.fill(a);for(var i=this.readSync(t.dataId),n=0;n<t.size;++n)i[n]>=0&&i[n]<e&&(o[n*e+i[n]]=r);return ops.tensor2d(o,[t.size,e],"int32")},e.prototype.nonMaxSuppression=function(t,e,r,a,o){cpu_util_1.assertNotComplex(t,"nonMaxSuppression");var i=this.readSync(t.dataId),n=this.readSync(e.dataId);return non_max_suppression_impl_1.nonMaxSuppressionV3(i,n,r,a,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,e){for(var r=t.shape[0],a=t.shape[1],o=ops.buffer(t.shape,"float32"),i=ops.buffer(t.shape,"float32"),n=ops.real(t).as2D(r,a),s=ops.imag(t).as2D(r,a),p=0;p<r;p++)for(var u=n.slice([p,0],[1,a]),l=s.slice([p,0],[1,a]),h=ops.complex(u,l),d=this.readSync(this.fftImpl(h,e).dataId),f=0;f<a;f++){var c=complex_util.getComplexWithIndex(d,f);o.values[p*a+f]=c.real,i.values[p*a+f]=c.imag}return ops.complex(o.toTensor(),i.toTensor()).as2D(r,a)},e.prototype.fftImpl=function(t,e){var r=t.as1D(),a=r.size;if(this.isExponentOf2(a)){var o=this.fftRadix2(r,a,e).as2D(t.shape[0],t.shape[1]);return e&&(o=ops.complex(ops.real(o).div(ops_1.scalar(a)),ops.imag(o).div(ops_1.scalar(a)))),o}var i=this.readSync(t.dataId),n=this.fourierTransformByMatmul(i,a,e),s=complex_util.splitRealAndImagArrays(n);return ops.complex(s.real,s.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return 0==(t&t-1)},e.prototype.fftRadix2=function(t,e,r){if(1===e)return t;var a=this.readSync(t.dataId),o=e/2,i=complex_util.complexWithEvenIndex(a),n=ops.complex(i.real,i.imag).as1D(),s=complex_util.complexWithOddIndex(a),p=ops.complex(s.real,s.imag).as1D();n=this.fftRadix2(n,o,r),p=this.fftRadix2(p,o,r);var u=complex_util.exponents(e,r),l=ops.complex(u.real,u.imag).mul(p),h=n.add(l),d=n.sub(l),f=ops.real(h).concat(ops.real(d)),c=ops.imag(h).concat(ops.imag(d));return ops.complex(f,c).as1D()},e.prototype.fourierTransformByMatmul=function(t,e,r){for(var a=new Float32Array(2*e),o=0;o<e;o++){for(var i=0,n=0,s=0;s<e;s++){var p=complex_util.exponent(o*s,e,r),u=complex_util.getComplexWithIndex(t,s);i+=u.real*p.real-u.imag*p.imag,n+=u.real*p.imag+u.imag*p.real}r&&(i/=e,n/=e),complex_util.assignToTypedArray(a,i,n,o)}return a},e.prototype.depthToSpace=function(t,e,r){util.assert("NHWC"===r,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+r}),util.assert(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var a=t.shape[0],o=t.shape[1],i=t.shape[2],n=t.shape[3],s=o*e,p=i*e,u=n/(e*e),l=this.readSync(t.dataId),h=new Float32Array(a*s*p*u),d=0,f=0;f<a;++f)for(var c=0;c<s;++c)for(var y=Math.floor(c/e),v=c%e,m=0;m<p;++m)for(var _=Math.floor(m/e),g=(v*e+m%e)*u,x=0;x<u;++x){var S=x+g+n*(_+i*(y+o*f));h[d++]=l[S]}return ops.tensor4d(h,[a,s,p,u])},e.prototype.broadcastedBinaryOp=function(t,e,r,a){var o=broadcast_util.assertAndGetBroadcastShape(t.shape,e.shape),i=ops.buffer(o,r),n=this.readSync(t.dataId),s=this.readSync(e.dataId),p=broadcast_util.getBroadcastDims(t.shape,o),u=broadcast_util.getBroadcastDims(e.shape,o),l=i.values;if(p.length+u.length===0)for(var h=0;h<l.length;++h)l[h]=a(n[h%n.length],s[h%s.length]);else{var d=this.bufferSync(t),f=this.bufferSync(e),c=function(r){var o=i.indexToLoc(r),h=o.slice(-t.rank);p.forEach(function(t){return h[t]=0});var c=d.locToIndex(h),y=o.slice(-e.rank);u.forEach(function(t){return y[t]=0});var v=f.locToIndex(y);l[r]=a(n[c],s[v])};for(h=0;h<l.length;++h)c(h)}return i.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,e,r){var a=broadcast_util.assertAndGetBroadcastShape(t.shape,e.shape),o=ops.buffer(a,"float32"),i=ops.buffer(a,"float32"),n=this.readSync(t.dataId),s=this.readSync(e.dataId),p=broadcast_util.getBroadcastDims(t.shape,a),u=broadcast_util.getBroadcastDims(e.shape,a),l=o.values,h=i.values;if(p.length+u.length===0)for(var d=0;d<l.length;d++){var f=d%n.length,c=d%s.length,y=r(n[2*f],n[2*f+1],s[2*c],s[2*c+1]);l[d]=y.real,h[d]=y.imag}else{var v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),m=this.bufferSync(this.data.get(e.dataId).complexTensors.real),_=function(a){var i=o.indexToLoc(a),d=i.slice(-t.rank);p.forEach(function(t){return d[t]=0});var f=v.locToIndex(d),c=i.slice(-e.rank);u.forEach(function(t){return c[t]=0});var y=m.locToIndex(c),_=r(n[2*f],n[2*f+1],s[2*y],s[2*y+1]);l[a]=_.real,h[a]=_.imag};for(d=0;d<l.length;d++)_(d)}return this.complex(o.toTensor(),i.toTensor())},e.prototype.split=function(t,e,r){return split_shared_1.split(t,e,r)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return backend_1.EPSILON_FLOAT32},e.prototype.cropAndResize=function(t,e,r,a,o,i){for(var n=t.shape,s=n[0],p=n[1],u=n[2],l=n[3],h=e.shape[0],d=a[0],f=a[1],c=ops.buffer([h,d,f,l],"float32"),y=this.readSync(e.dataId),v=this.readSync(r.dataId),m=this.readSync(t.dataId),_=t.strides,g=c.strides,x=0;x<h;x++){var S=4*x,I=y[S],b=y[S+1],M=y[S+2],N=y[S+3],C=v[x];if(!(C>=s))for(var k=d>1?(M-I)*(p-1)/(d-1):0,w=f>1?(N-b)*(u-1)/(f-1):0,A=0;A<d;A++){var F=d>1?I*(p-1)+A*k:.5*(I+M)*(p-1);if(F<0||F>p-1)for(var z=0;z<f;z++)for(var D=0;D<l;D++){var T=D+z*g[2]+A*g[1]+x*g[0];c.values[T]=i}else if("bilinear"===o){var O=Math.floor(F),W=Math.ceil(F),H=F-O;for(z=0;z<f;z++){if((j=f>1?b*(u-1)+z*w:.5*(b+N)*(u-1))<0||j>u-1)for(D=0;D<l;D++){T=D+z*g[2]+A*g[1]+x*g[0];c.values[T]=i}else{var B=Math.floor(j),E=Math.ceil(j),q=j-B;for(D=0;D<l;D++){var P=m[T=D+B*_[2]+O*_[1]+C*_[0]],R=m[T=D+E*_[2]+O*_[1]+C*_[0]],L=m[T=D+B*_[2]+W*_[1]+C*_[0]],U=P+(R-P)*q,G=L+(m[T=D+E*_[2]+W*_[1]+C*_[0]]-L)*q;T=D+z*g[2]+A*g[1]+x*g[0],c.values[T]=U+(G-U)*H}}}}else for(z=0;z<f;++z){var j;if((j=f>1?b*(u-1)+z*w:.5*(b+N)*(u-1))<0||j>u-1)for(D=0;D<l;D++){T=D+z*g[2]+A*g[1]+x*g[0];c.values[T]=i}else{var V=Math.round(j),Y=Math.round(F);for(D=0;D<l;D++){var K=D+V*_[2]+Y*_[1]+C*_[0],J=D+z*g[2]+A*g[1]+x*g[0];c.values[J]=m[K]}}}}}return c.toTensor()},e.prototype.sparseToDense=function(t,e,r,a){var o=scatter_nd_util.calculateShapes(e,t,r),i=o.sliceRank,n=o.numUpdates,s=o.sliceSize,p=o.strides,u=o.outputSize;return this.scatter(t,e,r,u,s,n,i,p,a,!1)},e.prototype.gatherND=function(t,e){var r=e.shape,a=r[r.length-1],o=gather_nd_util.prepareAndValidate(t,e),i=o[0],n=o[1],s=o[2],p=o[3];if(0===n)return ops_1.tensor([],i,t.dtype);for(var u=new tensor_1.TensorBuffer([n,s],t.dtype),l=this.readSync(e.dataId),h=this.readSync(t.dataId),d=0;d<n;d++){for(var f=[],c=0,y=0;y<a;y++){var v=l[d*a+y];c+=v*p[y],f.push(v)}if(c<0||c>=t.size/s)throw new Error("Invalid indices: "+f+" does not index into "+t.shape);for(var m=0;m<s;m++)u.values[d*s+m]=h[c*s+m]}return u.toTensor().reshape(i)},e.prototype.scatterND=function(t,e,r){var a=scatter_nd_util.calculateShapes(e,t,r),o=a.sliceRank,i=a.numUpdates,n=a.sliceSize,s=a.strides,p=a.outputSize,u=ops_1.scalar(0);return this.scatter(t,e,r,p,n,i,o,s,u,!0)},e.prototype.fill=function(t,e,r){r=r||util_1.inferDtype(e);var a=util_1.getArrayFromDType(r,util_1.sizeFromShape(t));return a.fill(e),engine_1.ENGINE.makeTensor(a,t,r,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var e=util_1.getArrayFromDType(t.dtype,util_1.sizeFromShape(t.shape));return this.makeOutput(e,t.shape,t.dtype)},e.prototype.linspace=function(t,e,r){return backend_util.linspaceImpl(t,e,r)},e.prototype.scatter=function(t,e,r,a,o,i,n,s,p,u){var l=[a/o,o],h=this.readSync(t.dataId),d=this.readSync(e.dataId);if(0===a)return ops_1.tensor([],r,e.dtype);var f=new tensor_1.TensorBuffer(l,e.dtype);f.values.fill(this.readSync(p.dataId)[0]);for(var c=0;c<i;c++){for(var y=[],v=0,m=0;m<n;m++){var _=h[c*n+m];y.push(_),v+=_*s[m]}if(v<0||v>=a/o)throw new Error("Invalid indices: "+y+" does not index into "+r);for(var g=0;g<o;g++)u?f.values[v*o+g]+=d[c*o+g]:f.values[v*o+g]=0===e.rank?d[0]:d[c*o+g]}return f.toTensor().reshape(r)},e}(backend_1.KernelBackend);exports.MathBackendCPU=MathBackendCPU,engine_1.ENGINE.registerBackend("cpu",function(){return new MathBackendCPU},1);

},{"../../engine":163,"../../environment":164,"../../log":190,"../../ops/array_ops_util":193,"../../ops/axis_util":194,"../../ops/broadcast_util":199,"../../ops/complex_ops":203,"../../ops/concat_util":205,"../../ops/div":210,"../../ops/erf_util":214,"../../ops/gather_nd_util":219,"../../ops/ops":233,"../../ops/scatter_nd_util":245,"../../ops/selu_util":248,"../../ops/slice_util":251,"../../tensor":287,"../../types":293,"../../util":294,"../backend":55,"../backend_util":56,"../complex_util":57,"../non_max_suppression_impl":67,"../split_shared":69,"../tile_impl":70,"../topk_impl":71,"../where_impl":160,"./cpu_util":59,"seedrandom":323}],59:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../../util");function assertNotComplex(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&util_1.assert("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})}exports.assertNotComplex=assertNotComplex;

},{"../../util":294}],60:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../../../kernel_names"),kernel_utils_1=require("../utils/kernel_utils"),Div_impl_1=require("./Div_impl");exports.divConfig=kernel_utils_1.createBinaryKernelConfig(kernel_names_1.Div,Div_impl_1.divImpl);

},{"../../../kernel_names":188,"../utils/kernel_utils":66,"./Div_impl":61}],61:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_utils_1=require("../utils/kernel_utils");exports.divImpl=kernel_utils_1.createBinaryKernelImpl(function(e,r){return e/r});

},{"../utils/kernel_utils":66}],62:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../../../kernel_names"),non_max_suppression_impl_1=require("../../non_max_suppression_impl"),cpu_util_1=require("../cpu_util");exports.nonMaxSuppressionV5Config={kernelName:kernel_names_1.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:function(e){var s=e.inputs,n=e.backend,r=e.attrs,a=s,o=a.boxes,u=a.scores,t=r,p=t.maxOutputSize,i=t.iouThreshold,_=t.scoreThreshold,l=t.softNmsSigma,c=n;cpu_util_1.assertNotComplex(o,"NonMaxSuppressionWithScore");var d=c.data.get(o.dataId).values,m=c.data.get(u.dataId).values,x=p,S=i,k=_,v=l,N=non_max_suppression_impl_1.nonMaxSuppressionV5(d,m,x,S,k,v);return[N.selectedIndices,N.selectedScores]}};

},{"../../../kernel_names":188,"../../non_max_suppression_impl":67,"../cpu_util":59}],63:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../../../kernel_names"),cpu_util_1=require("../cpu_util");exports.squareConfig={kernelName:kernel_names_1.Square,backendName:"cpu",kernelFunc:function(e){var a=e.inputs,r=e.backend,t=a.x,n=r;cpu_util_1.assertNotComplex(t,"square");for(var u=n.data.get(t.dataId).values,s=new Float32Array(u.length),l=0;l<u.length;++l){var p=u[l];s[l]=p*p}return{dataId:n.write(s,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};

},{"../../../kernel_names":188,"../cpu_util":59}],64:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../../../kernel_names"),kernel_utils_1=require("../utils/kernel_utils"),kernel_utils_2=require("../utils/kernel_utils"),squaredDifferenceImpl=kernel_utils_1.createBinaryKernelImpl(function(e,r){var n=e-r;return n*n});exports.squaredDifferenceConfig=kernel_utils_2.createBinaryKernelConfig(kernel_names_1.SquaredDifference,squaredDifferenceImpl);

},{"../../../kernel_names":188,"../utils/kernel_utils":66}],65:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});for(var kernel_registry_1=require("../../kernel_registry"),Div_1=require("./kernels/Div"),NonMaxSuppressionV5_1=require("./kernels/NonMaxSuppressionV5"),Square_1=require("./kernels/Square"),SquaredDifference_1=require("./kernels/SquaredDifference"),kernelConfigs=[NonMaxSuppressionV5_1.nonMaxSuppressionV5Config,Square_1.squareConfig,SquaredDifference_1.squaredDifferenceConfig,Div_1.divConfig],_i=0,kernelConfigs_1=kernelConfigs;_i<kernelConfigs_1.length;_i++){var kernelConfig=kernelConfigs_1[_i];kernel_registry_1.registerKernel(kernelConfig)}

},{"../../kernel_registry":189,"./kernels/Div":60,"./kernels/NonMaxSuppressionV5":62,"./kernels/Square":63,"./kernels/SquaredDifference":64}],66:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var backend_util=require("../../../backends/backend_util"),util=require("../../../util"),cpu_util_1=require("../cpu_util");function createBinaryKernelConfig(e,t){return{kernelName:e,backendName:"cpu",kernelFunc:function(r){var a=r.inputs,n=r.backend,i=a,l=i.a,u=i.b,c=n;cpu_util_1.assertNotComplex([l,u],e);var o=c.data.get(l.dataId).values,d=c.data.get(u.dataId).values,s=t(l.shape,u.shape,o,d,l.dtype),p=s[0],g=s[1];return{dataId:c.write(p,g,l.dtype),shape:g,dtype:l.dtype}}}}function createBinaryKernelImpl(e){return function(t,r,a,n,i){var l=backend_util.assertAndGetBroadcastShape(t,r),u=l.length,c=util.computeStrides(l),o=util.sizeFromShape(l),d=util.getTypedArrayFromDType(i,o),s=t.length,p=r.length,g=util.computeStrides(t),f=util.computeStrides(r),h=backend_util.getBroadcastDims(t,l),y=backend_util.getBroadcastDims(r,l);if(h.length+y.length===0)for(var m=0;m<d.length;++m)d[m]=e(a[m%a.length],n[m%n.length]);else{var v=function(t){var r=util.indexToLoc(t,u,c),i=r.slice(-s);h.forEach(function(e){return i[e]=0});var l=util.locToIndex(i,s,g),o=r.slice(-p);y.forEach(function(e){return o[e]=0});var m=util.locToIndex(o,p,f);d[t]=e(a[l],n[m])};for(m=0;m<d.length;++m)v(m)}return[d,l]}}exports.createBinaryKernelConfig=createBinaryKernelConfig,exports.createBinaryKernelImpl=createBinaryKernelImpl;

},{"../../../backends/backend_util":56,"../../../util":294,"../cpu_util":59}],67:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops"),array_util_1=require("./array_util");function nonMaxSuppressionV3(e,r,n,s,o){return nonMaxSuppressionImpl_(e,r,n,s,o,0).selectedIndices}function nonMaxSuppressionV5(e,r,n,s,o,t){var a=nonMaxSuppressionImpl_(e,r,n,s,o,t,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function nonMaxSuppressionImpl_(e,r,n,s,o,t,a,i){void 0===a&&(a=!1),void 0===i&&(i=!1);for(var p=Array.from(r).map(function(e,r){return{score:e,boxIndex:r,suppressBeginIndex:0}}).filter(function(e){return e.score>o}).sort(ascendingComparator),u=t>0?-.5/t:0,c=[],x=[];c.length<n&&p.length>0;){var d=p.pop(),l=d.score,M=d.boxIndex,h=d.suppressBeginIndex;if(l<o)break;for(var m=!1,f=c.length-1;f>=h;--f){var _=intersectionOverUnion(e,M,c[f]);if(_>=s){m=!0;break}if(d.score=d.score*suppressWeight(s,u,_),d.score<=o)break}d.suppressBeginIndex=c.length,m||(d.score===l?(c.push(M),x.push(d.score)):d.score>o&&array_util_1.binaryInsert(p,d,ascendingComparator))}var v=c.length;return i&&(c.fill(0,v),x.fill(0,v)),{selectedIndices:tensor_ops_1.tensor1d(c,"int32"),selectedScores:tensor_ops_1.tensor1d(x,"float32"),numValidOutputs:tensor_ops_1.scalar(v,"int32")}}function intersectionOverUnion(e,r,n){var s=e.subarray(4*r,4*r+4),o=e.subarray(4*n,4*n+4),t=Math.min(s[0],s[2]),a=Math.min(s[1],s[3]),i=Math.max(s[0],s[2]),p=Math.max(s[1],s[3]),u=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),x=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),l=(i-t)*(p-a),M=(x-u)*(d-c);if(l<=0||M<=0)return 0;var h=Math.max(t,u),m=Math.max(a,c),f=Math.min(i,x),_=Math.min(p,d),v=Math.max(f-h,0)*Math.max(_-m,0);return v/(l+M-v)}function suppressWeight(e,r,n){var s=Math.exp(r*n*n);return n<=e?s:0}function ascendingComparator(e,r){return e.score-r.score||e.score===r.score&&r.boxIndex-e.boxIndex}exports.nonMaxSuppressionV3=nonMaxSuppressionV3,exports.nonMaxSuppressionV5=nonMaxSuppressionV5;

},{"../ops/tensor_ops":259,"./array_util":54}],68:[function(require,module,exports){
"use strict";function getVecChannels(e,n){return["x","y","z","w","u","v"].slice(0,n).map(function(n){return e+"."+n})}function getChannels(e,n){return 1===n?[e]:getVecChannels(e,n)}function getSourceCoords(e,n){if(1===e)return"rc";for(var t="",r=0;r<e;r++)t+=n[r],r<e-1&&(t+=",");return t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getVecChannels=getVecChannels,exports.getChannels=getChannels,exports.getSourceCoords=getSourceCoords;

},{}],69:[function(require,module,exports){
"use strict";function split(e,r,t){var s=new Array(e.rank).fill(0),i=e.shape.slice();return r.map(function(r){i[t]=r;var l=e.slice(s,i);return s[t]+=r,l})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.split=split;

},{}],70:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var array_ops_1=require("../ops/array_ops");function tile(e,r){for(var a=new Array(e.rank),o=0;o<a.length;o++)a[o]=e.shape[o]*r[o];var t=array_ops_1.buffer(a,e.dtype);for(o=0;o<t.values.length;++o){for(var s=t.indexToLoc(o),n=new Array(e.rank),l=0;l<n.length;l++)n[l]=s[l]%e.shape[l];var p=e.locToIndex(n);t.values[o]=e.values[p]}return t.toTensor()}exports.tile=tile;

},{"../ops/array_ops":192}],71:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops"),util_1=require("../util");function topkImpl(r,e,t,o,s){for(var n=e[e.length-1],u=[r.length/n,n],p=u[0],a=u[1],l=util_1.getTypedArrayFromDType(t,p*o),i=util_1.getTypedArrayFromDType("int32",p*o),_=0;_<p;_++){for(var v=_*a,y=r.subarray(v,v+a),d=[],f=0;f<y.length;f++)d.push({value:y[f],index:f});d.sort(function(r,e){return e.value-r.value});var g=_*o,c=l.subarray(g,g+o),h=i.subarray(g,g+o);for(f=0;f<o;f++)c[f]=d[f].value,h[f]=d[f].index}var m=e.slice();return m[m.length-1]=o,[tensor_ops_1.tensor(l,m,t),tensor_ops_1.tensor(i,m,"int32")]}exports.topkImpl=topkImpl;

},{"../ops/tensor_ops":259,"../util":294}],72:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AddNProgram=function(){return function(t,r){this.outputShape=[],this.outputShape=t,this.variableNames=r.map(function(t,r){return"T"+r});var e=[];this.variableNames.forEach(function(t){e.push("float v"+t+" = get"+t+"AtOutCoords();")});var n=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        float result = "+n+";\n        setOutput(result);\n      }\n    "}}();exports.AddNProgram=AddNProgram;

},{}],73:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AddNPackedProgram=function(){return function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var r=[];this.variableNames.forEach(function(t){r.push("vec4 v"+t+" = get"+t+"AtOutCoords();")});var a=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+r.join("\n        ")+"\n\n        vec4 result = "+a+";\n        setOutput(result);\n      }\n    "}}();exports.AddNPackedProgram=AddNPackedProgram;

},{}],74:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ArgMinMaxProgram=function(){return function(t,n,e){this.variableNames=["A"];var i=t.windowSize,a=t.batchSize,s=t.inSize,o=Math.ceil(s/i);e||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var r="max"===n?">":"<",d=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+i+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+i+"; i++) {\n          int inIdx = "+d+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+r+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}}();exports.ArgMinMaxProgram=ArgMinMaxProgram;

},{}],75:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../../util"),packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),ArgMinMaxPackedProgram=function(){return function(e,n,t,c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,util_1.assert(e.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var a=e[e.length-1],o=Math.ceil(a/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),c||this.variableNames.push("bestIndicesA");var i,s,r=this.outputShape,u=r.length,l=shader_compiler_1.getCoordsDataType(u),d=packing_util_1.getChannels("coords",u);if(1===o){s=u+1;var h=shader_compiler_1.getCoordsDataType(s);i="\n        "+h+" sourceLocR = "+h+"("+d.join()+", 0);\n        ++"+d[u-1]+";\n        "+h+" sourceLocG = "+h+"("+d.join()+", 0);\n        ++"+d[u-2]+";\n        "+h+" sourceLocA = "+h+"("+d.join()+", 0);\n        --"+d[u-1]+";\n        "+h+" sourceLocB = "+h+"("+d.join()+", 0);\n        --"+d[u-2]+";"}else s=u,i="\n        "+l+" sourceLocR = coords;\n        ++"+d[u-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+d[u-2]+";\n        "+l+" sourceLocA = coords;\n        --"+d[u-1]+";\n        "+l+" sourceLocB = coords;\n        --"+d[u-2]+";";var p=["x","y","z","w","u","v"].slice(0,s),g="."+p[s-1],x=p.map(function(e){return"int "+e}),v=packing_util_1.getChannels("sourceLocR",s-1).concat("inIdx.r"),C=packing_util_1.getChannels("sourceLocG",s-1).concat("inIdx.g"),I=packing_util_1.getChannels("sourceLocB",s-1).concat("inIdx.b"),_=packing_util_1.getChannels("sourceLocA",s-1).concat("inIdx.a"),b="max"===t?"greaterThan":"lessThan",A=c?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+C.join()+"),\n                             getBestIndicesAChannel("+I.join()+"),\n                             getBestIndicesAChannel("+_.join()+")));",j="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+C.join()+") : 0.,\n            hasNextRow ? getAChannel("+I.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+_.join()+") : 0.)",L=c?"":"\n      float getBestIndicesAChannel("+x.join()+") {\n        return getChannel(getBestIndicesA("+p.join()+"),\n                                          vec2("+p.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+x.join()+") {\n        return getChannel(getA("+p.join()+"),\n                               vec2("+p.slice(-2).join()+"));\n      }\n      "+L+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+d[u-1]+" < "+(r[u-1]-1)+";\n        bool hasNextRow = "+d[u-2]+" < "+(r[u-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+g+", sourceLocG"+g+",\n          sourceLocB"+g+", sourceLocA"+g+") * "+n+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+j+";\n\n        for (int i = 0; i < "+n+"; i++) {\n          inIdx = srcIdx;\n          "+A+"\n          vec4 candidate = "+j+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "}}();exports.ArgMinMaxPackedProgram=ArgMinMaxPackedProgram;

},{"../../util":294,"../packing_util":68,"./shader_compiler":146}],76:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AvgPool2DBackpropProgram=function(){return function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterHeight,o=n.filterWidth,i=n.strideHeight,d=n.strideWidth,e=n.dilationHeight,r=n.dilationWidth,a=n.effectiveFilterHeight,y=n.effectiveFilterWidth,l=a-1-n.padInfo.top,f=y-1-n.padInfo.left,c=1/(t*o);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+f+");\n      const float avgMultiplier = float("+c+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+";\n            wR += "+e+") {\n          float dyR = float(dyRCorner + wR) / "+i+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+y+";\n            wC+= "+r+") {\n            float dyC = float(dyCCorner + wC) / "+d+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.AvgPool2DBackpropProgram=AvgPool2DBackpropProgram;var AvgPool3DBackpropProgram=function(){return function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterDepth,o=n.filterHeight,i=n.filterWidth,d=n.strideDepth,e=n.strideHeight,r=n.strideWidth,a=n.dilationDepth,y=n.dilationHeight,l=n.dilationWidth,f=n.effectiveFilterDepth,c=n.effectiveFilterHeight,s=n.effectiveFilterWidth,C=f-1-n.padInfo.front,p=c-1-n.padInfo.top,h=s-1-n.padInfo.left,u=1/(t*o*i);this.userCode="\n      const ivec3 pads = ivec3("+C+", "+p+", "+h+");\n      const float avgMultiplier = float("+u+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+f+";\n            wD += "+a+") {\n          float dyD = float(dyDCorner + wD) / "+d+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+y+") {\n            float dyR = float(dyRCorner + wR) / "+e+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+s+";\n                wC += "+l+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.AvgPool3DBackpropProgram=AvgPool3DBackpropProgram;

},{}],77:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,p){function o(e){try{u(n.next(e))}catch(e){p(e)}}function i(e){try{u(n.throw(e))}catch(e){p(e)}}function u(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(o,i)}u((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,a,p,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return p={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(p[Symbol.iterator]=function(){return this}),p;function i(p){return function(i){return function(p){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&p[0]?n.return:p[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,p[1])).done)return a;switch(n=0,a&&(p=[2&p[0],a.value]),p[0]){case 0:case 1:a=p;break;case 4:return o.label++,{value:p[1],done:!1};case 5:o.label++,n=p[1],p=[0];continue;case 7:p=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===p[0]||2===p[0])){o=0;continue}if(3===p[0]&&(!a||p[1]>a[0]&&p[1]<a[3])){o.label=p[1];break}if(6===p[0]&&o.label<a[1]){o.label=a[1],a=p;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(p);break}a[2]&&o.ops.pop(),o.trys.pop();continue}p=t.call(e,o)}catch(e){p=[6,e],n=0}finally{r=a=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([p,i])}}};Object.defineProperty(exports,"__esModule",{value:!0}),require("./flags_webgl");var device_util=require("../../device_util"),engine_1=require("../../engine"),environment_1=require("../../environment"),globals_1=require("../../globals"),log_1=require("../../log"),array_ops_1=require("../../ops/array_ops"),array_ops_util=require("../../ops/array_ops_util"),axis_util=require("../../ops/axis_util"),complex_ops_1=require("../../ops/complex_ops"),concat_util_1=require("../../ops/concat_util"),div_1=require("../../ops/div"),gather_nd_util=require("../../ops/gather_nd_util"),reduce_util=require("../../ops/reduce_util"),scatter_nd_util=require("../../ops/scatter_nd_util"),segment_util=require("../../ops/segment_util"),slice_util=require("../../ops/slice_util"),softmax_1=require("../../ops/softmax"),tensor_ops_1=require("../../ops/tensor_ops"),types_1=require("../../types"),util=require("../../util"),util_1=require("../../util"),backend_1=require("../backend"),backend_util=require("../backend_util"),complex_util_1=require("../complex_util"),non_max_suppression_impl_1=require("../non_max_suppression_impl"),split_shared_1=require("../split_shared"),tile_impl_1=require("../tile_impl"),topk_impl_1=require("../topk_impl"),where_impl_1=require("../where_impl"),addn_gpu_1=require("./addn_gpu"),addn_packed_gpu_1=require("./addn_packed_gpu"),argminmax_gpu_1=require("./argminmax_gpu"),argminmax_packed_gpu_1=require("./argminmax_packed_gpu"),avg_pool_backprop_gpu_1=require("./avg_pool_backprop_gpu"),batchnorm_gpu_1=require("./batchnorm_gpu"),batchnorm_packed_gpu_1=require("./batchnorm_packed_gpu"),binaryop_complex_gpu=require("./binaryop_complex_gpu"),binaryop_complex_gpu_1=require("./binaryop_complex_gpu"),binaryop_gpu=require("./binaryop_gpu"),binaryop_gpu_1=require("./binaryop_gpu"),binaryop_packed_gpu=require("./binaryop_packed_gpu"),binaryop_packed_gpu_1=require("./binaryop_packed_gpu"),canvas_util_1=require("./canvas_util"),clip_gpu_1=require("./clip_gpu"),clip_packed_gpu_1=require("./clip_packed_gpu"),complex_abs_gpu_1=require("./complex_abs_gpu"),concat_gpu_1=require("./concat_gpu"),concat_packed_gpu_1=require("./concat_packed_gpu"),conv_backprop_gpu_1=require("./conv_backprop_gpu"),conv_backprop_gpu_depthwise_1=require("./conv_backprop_gpu_depthwise"),conv_gpu_1=require("./conv_gpu"),conv_gpu_depthwise_1=require("./conv_gpu_depthwise"),conv_packed_gpu_depthwise_1=require("./conv_packed_gpu_depthwise"),crop_and_resize_gpu_1=require("./crop_and_resize_gpu"),cumsum_gpu_1=require("./cumsum_gpu"),decode_matrix_gpu_1=require("./decode_matrix_gpu"),decode_matrix_packed_gpu_1=require("./decode_matrix_packed_gpu"),depth_to_space_gpu_1=require("./depth_to_space_gpu"),diag_gpu_1=require("./diag_gpu"),encode_float_gpu_1=require("./encode_float_gpu"),encode_float_packed_gpu_1=require("./encode_float_packed_gpu"),encode_matrix_gpu_1=require("./encode_matrix_gpu"),encode_matrix_packed_gpu_1=require("./encode_matrix_packed_gpu"),fft_gpu=require("./fft_gpu"),fft_gpu_1=require("./fft_gpu"),fill_gpu_1=require("./fill_gpu"),gather_gpu_1=require("./gather_gpu"),gather_nd_gpu_1=require("./gather_nd_gpu"),gpgpu_context_1=require("./gpgpu_context"),gpgpu_math=require("./gpgpu_math"),im2col_packed_gpu_1=require("./im2col_packed_gpu"),lrn_gpu_1=require("./lrn_gpu"),lrn_grad_gpu_1=require("./lrn_grad_gpu"),lrn_packed_gpu_1=require("./lrn_packed_gpu"),max_pool_backprop_gpu_1=require("./max_pool_backprop_gpu"),mulmat_packed_gpu_1=require("./mulmat_packed_gpu"),multinomial_gpu_1=require("./multinomial_gpu"),onehot_gpu_1=require("./onehot_gpu"),pack_gpu_1=require("./pack_gpu"),pad_gpu_1=require("./pad_gpu"),pad_packed_gpu_1=require("./pad_packed_gpu"),pool_gpu_1=require("./pool_gpu"),reduce_gpu_1=require("./reduce_gpu"),reshape_packed_gpu_1=require("./reshape_packed_gpu"),resize_bilinear_backprop_gpu_1=require("./resize_bilinear_backprop_gpu"),resize_bilinear_gpu_1=require("./resize_bilinear_gpu"),resize_bilinear_packed_gpu_1=require("./resize_bilinear_packed_gpu"),resize_nearest_neighbor_backprop_gpu_1=require("./resize_nearest_neighbor_backprop_gpu"),resize_nearest_neighbor_gpu_1=require("./resize_nearest_neighbor_gpu"),reverse_gpu_1=require("./reverse_gpu"),reverse_packed_gpu_1=require("./reverse_packed_gpu"),scatter_gpu_1=require("./scatter_gpu"),segment_gpu_1=require("./segment_gpu"),select_gpu_1=require("./select_gpu"),slice_gpu_1=require("./slice_gpu"),slice_packed_gpu_1=require("./slice_packed_gpu"),strided_slice_gpu_1=require("./strided_slice_gpu"),tex_util=require("./tex_util"),tex_util_1=require("./tex_util"),texture_manager_1=require("./texture_manager"),tile_gpu_1=require("./tile_gpu"),transpose_gpu_1=require("./transpose_gpu"),transpose_packed_gpu_1=require("./transpose_packed_gpu"),unary_op=require("./unaryop_gpu"),unaryop_gpu_1=require("./unaryop_gpu"),unary_packed_op=require("./unaryop_packed_gpu"),unaryop_packed_gpu_1=require("./unaryop_packed_gpu"),unpack_gpu_1=require("./unpack_gpu"),webgl_util=require("./webgl_util"),binaryCaches={};function getBinaryCache(e){return e in binaryCaches?binaryCaches[e]:(binaryCaches[e]={},binaryCaches[e])}function mapActivationToShaderProgram(e,t){if(void 0===t&&(t=!1),"linear"===e)return t?unary_packed_op.LINEAR:unary_op.LINEAR;if("relu"===e)return t?unary_packed_op.RELU:unary_op.RELU;if("elu"===e)return t?unary_packed_op.ELU:unary_op.ELU;if("relu6"===e)return t?unary_packed_op.RELU6:unary_op.RELU6;if("prelu"===e)return t?binaryop_packed_gpu.PRELU:binaryop_gpu.PRELU;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}exports.getBinaryCache=getBinaryCache;var CPU_HANDOFF_SIZE_THRESHOLD=128,BEFORE_PAGING_CONSTANT=600;function numMBBeforeWarning(){return null==environment_1.env().global.screen?1024:environment_1.env().global.screen.height*environment_1.env().global.screen.width*window.devicePixelRatio*BEFORE_PAGING_CONSTANT/1024/1024}exports.MATMUL_SHARED_DIM_THRESHOLD=1e3;var MathBackendWebGL=function(e){function t(t){var r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!environment_1.env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var n=canvas_util_1.getWebGLContext(environment_1.env().getNumber("WEBGL_VERSION"));r.binaryCache=getBinaryCache(environment_1.env().getNumber("WEBGL_VERSION")),r.gpgpu=new gpgpu_context_1.GPGPUContext(n),r.canvas=n.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new texture_manager_1.TextureManager(r.gpgpu),r.numMBBeforeWarning=numMBBeforeWarning(),r.texData=new backend_1.DataStorage(r,engine_1.ENGINE),r}return __extends(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,r){if(environment_1.env().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var n={};return this.texData.set(n,{shape:t,dtype:r,values:e,usage:tex_util_1.TextureUsage.UPLOAD}),n},t.prototype.move=function(e,t,r,n){if(environment_1.env().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===n)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:n,values:t,usage:tex_util_1.TextureUsage.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),r=t.values,n=t.dtype,a=t.complexTensors,p=t.slice,o=t.shape,i=t.isPacked;if(null!=p){var u=void 0;u=i?new unaryop_packed_gpu_1.UnaryOpPackedProgram(o,unary_op.CLONE):new unaryop_gpu_1.UnaryOpProgram(o,unary_op.CLONE);var s=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:n}],n),_=this.readSync(s.dataId);return this.disposeData(s.dataId),_}if(null!=r)return this.convertAndCacheOnCPU(e);if("string"===n)return r;var c,l,h=null!=this.activeTimers;if(h&&(c=util.now()),"complex64"===n){var d=a.real.dataSync(),g=a.imag.dataSync();l=complex_util_1.mergeRealAndImagArrays(d,g)}else l=this.getValuesFromTexture(e);return h&&(this.downloadWaitMs+=util.now()-c),this.convertAndCacheOnCPU(e,l)},t.prototype.read=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,a,p,o,i,u,s,_,c,l,h,d,g,m,y,v,f,P,A,k;return __generator(this,function(x){switch(x.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise(function(e){return t.push(e)})];if(r=this.texData.get(e),n=r.values,a=r.shape,p=r.slice,o=r.dtype,i=r.complexTensors,u=r.isPacked,null!=p)return s=void 0,s=u?new unaryop_packed_gpu_1.UnaryOpPackedProgram(a,unary_op.CLONE):new unaryop_gpu_1.UnaryOpProgram(a,unary_op.CLONE),_=this.runWebGLProgram(s,[{dataId:e,shape:a,dtype:o}],o),c=this.read(_.dataId),this.disposeData(_.dataId),[2,c];if(null!=n)return[2,this.convertAndCacheOnCPU(e)];if(!environment_1.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===environment_1.env().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return l=null,"complex64"!==o&&environment_1.env().get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(e),d=this.texData.get(h.dataId),l=(k=this.gpgpu).createBufferFromTexture.apply(k,[d.texture].concat(tex_util.getDenseTexShape(a)))),this.pendingRead.set(e,[]),"complex64"===o?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:x.sent(),x.label=2;case 2:return"complex64"!==o?[3,4]:[4,Promise.all([i.real.data(),i.imag.data()])];case 3:return m=x.sent(),y=m[0],v=m[1],g=complex_util_1.mergeRealAndImagArrays(y,v),[3,5];case 4:null==l?g=this.getValuesFromTexture(e):(f=util.sizeFromShape(a),g=this.gpgpu.downloadFloat32MatrixFromBuffer(l,f)),x.label=5;case 5:return null!=h&&this.disposeData(h.dataId),P=this.convertAndCacheOnCPU(e,g),A=this.pendingRead.get(e),this.pendingRead.delete(e),A.forEach(function(e){return e(P)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,P]}})})},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var r=e[t];if(!webgl_util.canBeRepresented(r)){if(environment_1.env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+r+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+r+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,r=this.texData.get(e),n=r.shape,a=r.dtype,p=r.isPacked,o=util.sizeFromShape(n);if(environment_1.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var i=this.decode(e),u=this.texData.get(i.dataId),s=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(tex_util.getDenseTexShape(n))).subarray(0,o);return this.disposeData(i.dataId),s}var _=environment_1.env().getBool("WEBGL_PACK")&&!0===p,c=_?webgl_util.getShapeAs3D(n):n,l=_?new encode_float_packed_gpu_1.EncodeFloatPackedProgram(c):new encode_float_gpu_1.EncodeFloatProgram(c),h=this.runWebGLProgram(l,[{shape:c,dtype:a,dataId:e}],"float32"),d=this.texData.get(h.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture,d.texShape[0],d.texShape[1]).subarray(0,o);return this.disposeData(h.dataId),g},t.prototype.time=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,a,p,o,i;return __generator(this,function(u){switch(u.label){case 0:return t=this.activeTimers,r=[],n=!1,null==this.programTimersStack?(this.programTimersStack=r,n=!0):this.activeTimers.push(r),this.activeTimers=r,e(),a=util.flatten(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),p=util.flatten(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,n&&(this.programTimersStack=null),o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return i=u.sent(),o.kernelMs=util.sum(i),o.getExtraProfileInfo=function(){return i.map(function(e,t){return{name:p[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},[3,3];case 2:o.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,o]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:util.now(),endMs:null}},t.prototype.endTimer=function(e){return environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=util.now(),e)},t.prototype.getQueryTime=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){return environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),r=t.texture,n=t.dtype,a=t.texShape,p=t.usage,o=t.isPacked,i=t.slice,u=i&&i.origDataId||e,s=this.dataRefCount.get(u);s>1?this.dataRefCount.set(u,s-1):(this.dataRefCount.delete(u),null!=r&&(this.numBytesInGPU-=this.computeBytes(a,n),this.textureManager.releaseTexture(r,a,p,o)));var _=this.texData.get(e);_.texture=null,_.texShape=null,_.isPacked=!1,_.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return environment_1.env().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=engine_1.ENGINE.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var r=this;return void 0===t&&(t=CPU_HANDOFF_SIZE_THRESHOLD),null!=this.getCPUBackend()&&e.every(function(e){return null==r.texData.get(e.dataId).texture&&e.size<t})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var r=this.makeOutput(e.shape,"complex64");return this.texData.get(r.dataId).complexTensors={real:engine_1.ENGINE.keep(e.clone()),imag:engine_1.ENGINE.keep(t.clone())},r},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,r);if(0===util.sizeFromShape(r))return tensor_ops_1.tensor([],r,e.dtype);var n=this.texData.get(e.dataId).isPacked,a=slice_util.isSliceContinous(e.shape,t,r);if(n||!a){var p=environment_1.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new slice_packed_gpu_1.SlicePackedProgram(r):new slice_gpu_1.SliceProgram(r),o=p.getCustomSetupFunc(t);return this.compileAndRun(p,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,r)},t.prototype.shallowSlice=function(e,t,r){var n=this.texData.get(e.dataId),a=this.makeOutput(r,e.dtype),p=this.texData.get(a.dataId);Object.assign(p,n),p.shape=r,p.dtype=e.dtype;var o=slice_util.computeFlatOffset(t,e.strides);n.slice&&(o+=n.slice.flatOffset),p.slice={flatOffset:o,origDataId:n.slice&&n.slice.origDataId||e.dataId};var i=this.dataRefCount.get(p.slice.origDataId)||1;return this.dataRefCount.set(p.slice.origDataId,i+1),a},t.prototype.stridedSlice=function(e,t,r,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,r,n);var a=slice_util.computeOutShape(t,r,n);if(a.some(function(e){return 0===e}))return tensor_ops_1.tensor([],a);var p=new strided_slice_gpu_1.StridedSliceProgram(t,n,a);return this.compileAndRun(p,[e])},t.prototype.reverse=function(e,t){var r=environment_1.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new reverse_packed_gpu_1.ReversePackedProgram(e.shape,t):new reverse_gpu_1.ReverseProgram(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var r=e.map(function(e){return complex_ops_1.real(e)}),n=e.map(function(e){return complex_ops_1.imag(e)});return complex_ops_1.complex(this.concat(r,t),this.concat(n,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>environment_1.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),p=this.concat(e.slice(0,a),t),o=this.concat(e.slice(a),t);return this.concat([p,o],t)}if(environment_1.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var i=new concat_packed_gpu_1.ConcatPackedProgram(e.map(function(e){return e.shape}),t);return this.compileAndRun(i,e)}var u=concat_util_1.computeOutShape(e.map(function(e){return e.shape}),t),s=e.map(function(e){return e.as2D(-1,util_1.sizeFromShape(e.shape.slice(t)))}),_=new concat_gpu_1.ConcatProgram(s.map(function(e){return e.shape}));return this.compileAndRun(_,s).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(environment_1.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,unary_op.NEG,e.dtype);var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.NEG);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,r,n){var a=r?e.shape[2]:e.shape[1],p=n?t.shape[1]:t.shape[2],o=r?e.shape[1]:e.shape[2],i=e.shape[0];if((1===a||1===p)&&o>exports.MATMUL_SHARED_DIM_THRESHOLD){r&&(e=e.transpose([0,2,1])),n&&(t=t.transpose([0,2,1]));var u=1===p?e:e.as3D(i,o,1),s=1===p?2:1,_=1===p?t.as3D(i,1,o):t;return this.multiply(u,_).sum(s,!0)}var c=types_1.upcastType(e.dtype,t.dtype),l=new mulmat_packed_gpu_1.MatMulPackedProgram(e.shape,[i,a,p],r,n);return this.compileAndRun(l,[e,t],c)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,r=e.b,n=e.transposeA,a=e.transposeB,p=e.bias,o=e.activation,i=e.preluActivationWeights,u=n?t.shape[2]:t.shape[1],s=a?r.shape[1]:r.shape[2],_=t.shape[0],c=types_1.upcastType(t.dtype,r.dtype),l=null!=p,h=null!=i,d=o?mapActivationToShaderProgram(o,!0):null,g=new mulmat_packed_gpu_1.MatMulPackedProgram(t.shape,[_,u,s],n,a,l,d,h),m=[t,r];return p&&m.push(p),i&&m.push(i),this.compileAndRun(g,m,c)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var r=this.texData.get(e.dataId),n=this.texData.get(t.dataId),a=new binaryop_complex_gpu_1.BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.REAL,e.shape,t.shape),p=new binaryop_complex_gpu_1.BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.IMAG,e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag),this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)],i=this.compileAndRun(a,o),u=this.compileAndRun(p,o),s=this.complex(i,u);return i.dispose(),u.dispose(),s}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_gpu.MUL,e.dtype);var _=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MUL,e.shape,t.shape);return this.compileAndRun(_,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,r,n,a,p){var o=[e,t,r],i=null;null!=p&&(i=p.shape,o.push(p));var u=null;if(null!=a&&(u=a.shape,o.push(a)),environment_1.env().getBool("WEBGL_PACK_NORMALIZATION")){var s=new batchnorm_packed_gpu_1.BatchNormPackedProgram(e.shape,t.shape,r.shape,i,u,n);return this.compileAndRun(s,o)}var _=new batchnorm_gpu_1.BatchNormProgram(e.shape,t.shape,r.shape,i,u,n);return this.compileAndRun(_,o)},t.prototype.localResponseNormalization4D=function(e,t,r,n,a){var p=environment_1.env().getBool("WEBGL_PACK_NORMALIZATION")?new lrn_packed_gpu_1.LRNPackedProgram(e.shape,t,r,n,a):new lrn_gpu_1.LRNProgram(e.shape,t,r,n,a);return this.compileAndRun(p,[e])},t.prototype.LRNGrad=function(e,t,r,n,a,p,o){var i=new lrn_grad_gpu_1.LRNGradProgram(t.shape,n,a,p,o);return this.compileAndRun(i,[t,r,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var r=this.readSync(e.dataId).map(function(e){return util.decodeString(e)}),n=array_ops_1.buffer(e.shape,e.dtype,r);return tile_impl_1.tile(n,t)}var a=new tile_gpu_1.TileProgram(e.shape,t);return this.compileAndRun(a,[e])},t.prototype.pad=function(e,t,r){var n=environment_1.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pad_packed_gpu_1.PadPackedProgram(e.shape,t,r):new pad_gpu_1.PadProgram(e.shape,t,r);return this.compileAndRun(n,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var r=environment_1.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new transpose_packed_gpu_1.TransposePackedProgram(e.shape,t):new transpose_gpu_1.TransposeProgram(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.gather=function(e,t,r){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,r);var n=new gather_gpu_1.GatherProgram(e.shape,t.size,r);return this.compileAndRun(n,[e,t])},t.prototype.batchToSpaceND=function(e,t,r){util.assert(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var n=t.reduce(function(e,t){return e*t}),a=array_ops_util.getReshaped(e.shape,t,n),p=array_ops_util.getPermuted(a.length,t.length),o=array_ops_util.getReshapedPermuted(e.shape,t,n),i=array_ops_util.getSliceBeginCoords(r,t.length),u=array_ops_util.getSliceSize(o,r,t.length);return e.reshape(a).transpose(p).reshape(o).slice(i,u)},t.prototype.spaceToBatchND=function(e,t,r){util.assert(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var n=t.reduce(function(e,t){return e*t}),a=[[0,0]];a.push.apply(a,r);for(var p=1+t.length;p<e.shape.length;++p)a.push([0,0]);var o=e.pad(a),i=array_ops_util.getReshaped(o.shape,t,n,!1),u=array_ops_util.getPermuted(i.length,t.length,!1),s=array_ops_util.getReshapedPermuted(o.shape,t,n,!1);return o.reshape(i).transpose(u).reshape(s)},t.prototype.reduce=function(e,t,r){var n=e.shape[0],a=e.shape[1],p={windowSize:reduce_util.computeOptimalWindowSize(a),inSize:a,batchSize:n},o=new reduce_gpu_1.ReduceProgram(p,t),i=this.compileAndRun(o,[e],r);return 1===i.shape[1]?i:this.reduce(i,t,r)},t.prototype.argReduce=function(e,t,r){void 0===r&&(r=null);var n=e.shape[0],a=e.shape[1];null!=r&&(n=r.shape[0],a=r.shape[1]);var p={windowSize:reduce_util.computeOptimalWindowSize(a),inSize:a,batchSize:n},o=new argminmax_gpu_1.ArgMinMaxProgram(p,t,null==r),i=[e];null!=r&&i.push(r);var u=this.compileAndRun(o,i,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,r){void 0===r&&(r=null);var n=null!=r?r.shape:e.shape,a=n[n.length-1],p=reduce_util.computeOptimalWindowSize(a),o=new argminmax_packed_gpu_1.ArgMinMaxPackedProgram(n,p,t,null==r),i=null==r?[e]:[e,r],u=this.compileAndRun(o,i,"int32");return u.rank===e.rank?this.argReducePacked(e,t,u):u},t.prototype.sum=function(e,t){axis_util.assertAxesAreInnerMostDims("sum",t,e.rank);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=util.sizeFromShape(a),o=e.as2D(-1,p),i=types_1.sumOutType(e.dtype);return this.reduce(o,"sum",i).reshape(n)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=util.sizeFromShape(a),o=e.as2D(-1,p),i=types_1.sumOutType(e.dtype);return this.reduce(o,"prod",i).reshape(n)},t.prototype.unsortedSegmentSum=function(e,t,r){var n=0,a=axis_util.getAxesPermutation([n],e.rank),p=e;null!=a&&(p=e.transpose(a),n=axis_util.getInnerMostAxes(1,e.rank)[0]);var o=segment_util.computeOutShape(p.shape,n,r),i=util.sizeFromShape([p.shape[n]]),u=p.as2D(-1,i),s=types_1.sumOutType(e.dtype),_=this.segOpCompute(u,"unsortedSegmentSum",t,s,r).reshape(o);return null!=a&&(_=_.transpose(axis_util.getUndoAxesPermutation(a))),_},t.prototype.segOpCompute=function(e,t,r,n,a){var p=e.shape[0],o=e.shape[1],i=segment_util.segOpComputeOptimalWindowSize(o,a),u={windowSize:i,inSize:o,batchSize:p,numSegments:a},s=new segment_gpu_1.SegmentOpProgram(u,t),_=this.compileAndRun(s,[e,r],n);return _.shape[1]===a?_:(r=tensor_ops_1.range(0,a).tile([o/i]),this.segOpCompute(_,t,r,n,a))},t.prototype.argMinMaxReduce=function(e,t,r){var n=[t];if(axis_util.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),n,e.rank),!environment_1.env().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=axis_util.computeOutAndReduceShapes(e.shape,n),p=a[0],o=a[1],i=util.sizeFromShape(o),u=e.as2D(-1,i);return this.argReduce(u,r).reshape(p)}return this.argReducePacked(e,r)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,r,n){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var a=new cumsum_gpu_1.CumSumProgram(e.shape,r,n);return this.compileAndRun(a,[e])},t.prototype.equal=function(e,t){if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_packed_gpu.EQUAL,"bool");var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.EQUAL,e.shape,t.shape);return this.compileAndRun(r,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_packed_gpu.NOT_EQUAL,"bool");var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.NOT_EQUAL,e.shape,t.shape);return this.compileAndRun(r,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_packed_gpu.LESS,"bool");var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LESS,e.shape,t.shape);return this.compileAndRun(r,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_packed_gpu.LESS_EQUAL,"bool");var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LESS_EQUAL,e.shape,t.shape);return this.compileAndRun(r,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_packed_gpu.GREATER,"bool");var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.GREATER,e.shape,t.shape);return this.compileAndRun(r,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_packed_gpu.GREATER_EQUAL,"bool");var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.GREATER_EQUAL,e.shape,t.shape);return this.compileAndRun(r,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.LOGICAL_NOT);return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_packed_gpu.LOGICAL_AND,"bool");var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_AND,e.shape,t.shape);return this.compileAndRun(r,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_packed_gpu.LOGICAL_OR,"bool");var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_OR,e.shape,t.shape);return this.compileAndRun(r,[e,t],"bool")},t.prototype.select=function(e,t,r){var n=new select_gpu_1.SelectProgram(e.rank,t.shape,t.rank);return this.compileAndRun(n,[e,t,r],types_1.upcastType(t.dtype,r.dtype))},t.prototype.where=function(e){log_1.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return where_impl_1.whereImpl(e.shape,t)},t.prototype.topk=function(e,t,r){var n=e.dataSync();return topk_impl_1.topkImpl(n,e.shape,e.dtype,t,r)},t.prototype.min=function(e,t){axis_util.assertAxesAreInnerMostDims("min",t,e.rank);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=util.sizeFromShape(a),o=e.as2D(-1,p);return this.reduce(o,"min",o.dtype).reshape(n)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var r=environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.MIN,e.shape,t.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MIN,e.shape,t.shape);return this.compileAndRun(r,[e,t])},t.prototype.mod=function(e,t){var r=environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.MOD,e.shape,t.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MOD,e.shape,t.shape);return this.compileAndRun(r,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);axis_util.assertAxesAreInnerMostDims("max",t,e.rank);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=util.sizeFromShape(a),o=e.as2D(-1,p);return this.reduce(o,"max",o.dtype).reshape(n)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var r=environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.MAX,e.shape,t.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MAX,e.shape,t.shape);return this.compileAndRun(r,[e,t])},t.prototype.all=function(e,t){axis_util.assertAxesAreInnerMostDims("all",t,e.rank);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=util.sizeFromShape(a),o=e.as2D(-1,p);return this.reduce(o,"all",o.dtype).reshape(n)},t.prototype.any=function(e,t){axis_util.assertAxesAreInnerMostDims("any",t,e.rank);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],p=util.sizeFromShape(a),o=e.as2D(-1,p);return this.reduce(o,"any",o.dtype).reshape(n)},t.prototype.floorDiv=function(e,t){var r=binaryop_gpu.INT_DIV;if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_packed_gpu.INT_DIV,"int32");var n=new binaryop_gpu_1.BinaryOpProgram(r,e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,binaryop_gpu.ADD);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var r=types_1.upcastType(e.dtype,t.dtype);if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_gpu.ADD,r);var n=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ADD,e.shape,t.shape);return this.compileAndRun(n,[e,t],r)},t.prototype.packedUnaryOp=function(e,t,r){var n=new unaryop_packed_gpu_1.UnaryOpPackedProgram(e.shape,t);return this.compileAndRun(n,[e],r)},t.prototype.packedBinaryOp=function(e,t,r,n,a){void 0===a&&(a=!1);var p=new binaryop_packed_gpu_1.BinaryOpPackedProgram(r,e.shape,t.shape,a);return this.compileAndRun(p,[e,t],n)},t.prototype.complexSeparableBinaryOp=function(e,t,r){var n=this,a=this.texData.get(e.dataId),p=this.texData.get(t.dataId),o=[[a.complexTensors.real,p.complexTensors.real],[a.complexTensors.imag,p.complexTensors.imag]].map(function(a){var p=a[0],o=a[1],i=n.makeComplexComponentTensorInfo(e,p),u=n.makeComplexComponentTensorInfo(t,o),s=new binaryop_gpu_1.BinaryOpProgram(r,e.shape,t.shape);return n.compileAndRun(s,[i,u],types_1.upcastType(p.dtype,o.dtype))}),i=o[0],u=o[1],s=this.complex(i,u);return i.dispose(),u.dispose(),s},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>environment_1.env().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),r=this.addN(e.slice(0,t)),n=this.addN(e.slice(t));return this.addN([r,n])}var a=e.map(function(e){return e.dtype}).reduce(function(e,t){return types_1.upcastType(e,t)}),p=e.map(function(e){return e.shape}),o=environment_1.env().getBool("WEBGL_PACK")?new addn_packed_gpu_1.AddNPackedProgram(e[0].shape,p):new addn_gpu_1.AddNProgram(e[0].shape,p);return this.compileAndRun(o,e,a)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,binaryop_gpu.SUB);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var r=types_1.upcastType(e.dtype,t.dtype);if(environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,binaryop_gpu.SUB,e.dtype);var n=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.SUB,e.shape,t.shape);return this.compileAndRun(n,[e,t],r)},t.prototype.pow=function(e,t){var r=environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.POW,e.shape,t.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.POW,e.shape,t.shape),n=types_1.upcastType(e.dtype,t.dtype);return this.compileAndRun(r,[e,t],n)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(environment_1.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,unary_op.CEIL,e.dtype);var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.CEIL);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(environment_1.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,unary_op.FLOOR,e.dtype);var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.FLOOR);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SIGN);return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.IS_NAN);return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.IS_INF);return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.IS_FINITE);return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ROUND);return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(environment_1.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,unary_op.EXP,e.dtype);var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.EXP);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(environment_1.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,unary_op.EXPM1,e.dtype);var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.EXPM1);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var r=util.parseAxisParam([t],e.shape),n=this.max(e,r),a=axis_util.expandShapeToKeepDim(n.shape,r),p=this.subtract(e,n.reshape(a)),o=this.exp(p),i=this.sum(o,r).reshape(a);return div_1.div(o,i)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(environment_1.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,unary_packed_op.LOG,e.dtype);var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.LOG);return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.LOG1P);return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SQRT);return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.RSQRT);return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.RECIPROCAL);return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=environment_1.env().getBool("WEBGL_PACK")?new unaryop_packed_gpu_1.UnaryOpPackedProgram(e.shape,unary_packed_op.RELU):new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.RELU),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=environment_1.env().getBool("WEBGL_PACK")?new unaryop_packed_gpu_1.UnaryOpPackedProgram(e.shape,unary_packed_op.RELU6):new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.RELU6),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var r=environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.PRELU,e.shape,t.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.PRELU,e.shape,t.shape);return this.compileAndRun(r,[e,t])},t.prototype.elu=function(e){if(environment_1.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,unary_packed_op.ELU,e.dtype);var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ELU);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var r=environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.ELU_DER,e.shape,t.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ELU_DER,e.shape,t.shape);return this.compileAndRun(r,[e,t])},t.prototype.selu=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SELU);return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.TO_INT);return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,r){var n,a=(n=environment_1.env().getBool("WEBGL_PACK_CLIP")?new clip_packed_gpu_1.ClipPackedProgram(e.shape):new clip_gpu_1.ClipProgram(e.shape)).getCustomSetupFunc(t,r);return this.compileAndRun(n,[e],null,a)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(environment_1.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,unary_op.ABS,e.dtype);var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ABS);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),r=new complex_abs_gpu_1.ComplexAbsProgram(e.shape),n=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(r,n)},t.prototype.sigmoid=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SIGMOID);return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SOFTPLUS);return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SIN);return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.COS);return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.TAN);return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ASIN);return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ACOS);return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ATAN);return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var r=environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.ATAN2,e.shape,t.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ATAN2,e.shape,t.shape);return this.compileAndRun(r,[e,t])},t.prototype.sinh=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SINH);return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.COSH);return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.TANH);return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ASINH);return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ACOSH);return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ATANH);return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ERF);return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var r=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.STEP(t));return this.compileAndRun(r,[e])},t.prototype.conv2dByMatMul=function(e,t,r,n,a,p){var o=e.shape,i=this.texData.get(e.dataId),u=r.inChannels,s=o[0]*o[1]*o[2],_=r.outChannels,c="channelsLast"===r.dataFormat,l=(1===s||1===_)&&u>exports.MATMUL_SHARED_DIM_THRESHOLD,h=o[2]%2!=0&&!!i.isPacked;if(l||!environment_1.env().getBool("WEBGL_LAZILY_UNPACK")||!environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!h){var d=c?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],g=this.reshape(e,[1,d,r.inChannels]),m=this.reshape(t,[1,r.inChannels,r.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:m,transposeA:!1,transposeB:!1,bias:n,activation:a,preluActivationWeights:p}),r.outShape)}var y=c?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),v={dataId:e.dataId,shape:[1,y,r.inChannels],dtype:e.dtype},f=i.shape;i.shape=i.shape.slice(),i.shape[i.shape.length-2]++,util.assert(webgl_util.isReshapeFree(i.shape,v.shape),function(){return"packed reshape "+i.shape+" to "+v.shape+" isn't free"});var P=this.reshape(t,[1,r.inChannels,r.outChannels]),A=this.fusedBatchMatMul({a:v,b:P,transposeA:!1,transposeB:!1,bias:n,activation:a,preluActivationWeights:p}),k=this.texData.get(A.dataId);return util.assert(k.isPacked,function(){return"batchMatMul result is expected to be packed"}),i.shape=f,k.shape=r.outShape,engine_1.ENGINE.makeTensorFromDataId(A.dataId,r.outShape,A.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,r,n,a,p){var o=r.filterWidth,i=r.filterHeight,u=r.inChannels,s=r.outWidth,_=r.outHeight,c="channelsLast"===r.dataFormat,l=o*i*u,h=_*s,d=[l,h],g=e.squeeze([0]),m=t.reshape([1,l,-1]),y=new im2col_packed_gpu_1.Im2ColPackedProgram(d,g.shape,r),v=this.compileAndRun(y,[g]).reshape([1,d[0],d[1]]),f=null!=n,P=null!=p,A=a?mapActivationToShaderProgram(a,!0):null,k=new mulmat_packed_gpu_1.MatMulPackedProgram(v.shape,[1,h,r.outChannels],!0,!1,f,A,P),x=[v,m];n&&x.push(n),P&&x.push(p);var R=this.compileAndRun(k,x);return c?R.reshape([1,_,s,r.outChannels]):R.reshape([1,r.outChannels,_,s])},t.prototype.fusedConv2d=function(e){var t=e.input,r=e.filter,n=e.convInfo,a=e.bias,p=e.activation,o=e.preluActivationWeights;if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,r,n,a,p,o);if(environment_1.env().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,r,n,a,p,o);var i=null!=a,u=null!=o,s=p?mapActivationToShaderProgram(p,!1):null,_=new conv_gpu_1.Conv2DProgram(n,i,s,u),c=[t,r];return a&&c.push(a),o&&c.push(o),this.compileAndRun(_,c)},t.prototype.conv2d=function(e,t,r){if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(e,t,r);if(environment_1.env().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,r);var n=new conv_gpu_1.Conv2DProgram(r);return this.compileAndRun(n,[e,t])},t.prototype.conv2dDerInput=function(e,t,r){var n=new conv_backprop_gpu_1.Conv2DDerInputProgram(r);return this.compileAndRun(n,[e,t])},t.prototype.conv2dDerFilter=function(e,t,r){var n=new conv_backprop_gpu_1.Conv2DDerFilterProgram(r);return this.compileAndRun(n,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,r=e.input,n=e.filter,a=e.convInfo,p=e.bias,o=e.activation,i=e.preluActivationWeights,u=environment_1.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,s=o?mapActivationToShaderProgram(o,u):null,_=[r,n],c=null!=p,l=null!=i;return c&&_.push(p),l&&_.push(i),u?(t=new conv_packed_gpu_depthwise_1.DepthwiseConvPacked2DProgram(a,c,s,l),this.compileAndRun(t,_)):(t=new conv_gpu_depthwise_1.DepthwiseConv2DProgram(a,c,s,l),this.compileAndRun(t,_))},t.prototype.depthwiseConv2D=function(e,t,r){var n;return environment_1.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&r.strideWidth<=2&&r.outChannels/r.inChannels==1?(n=new conv_packed_gpu_depthwise_1.DepthwiseConvPacked2DProgram(r),this.compileAndRun(n,[e,t])):(n=new conv_gpu_depthwise_1.DepthwiseConv2DProgram(r),this.compileAndRun(n,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,r){var n=new conv_backprop_gpu_depthwise_1.DepthwiseConv2DDerInputProgram(r);return this.compileAndRun(n,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,r){var n=new conv_backprop_gpu_depthwise_1.DepthwiseConv2DDerFilterProgram(r);return this.compileAndRun(n,[e,t])},t.prototype.conv3d=function(e,t,r){var n=new conv_gpu_1.Conv3DProgram(r);return this.compileAndRun(n,[e,t])},t.prototype.conv3dDerInput=function(e,t,r){var n=new conv_backprop_gpu_1.Conv3DDerInputProgram(r);return this.compileAndRun(n,[e,t])},t.prototype.conv3dDerFilter=function(e,t,r){var n=new conv_backprop_gpu_1.Conv3DDerFilterProgram(r);return this.compileAndRun(n,[e,t])},t.prototype.maxPool=function(e,t){var r=new pool_gpu_1.Pool2DProgram(t,"max",!1);return this.compileAndRun(r,[e])},t.prototype.avgPool=function(e,t){var r=new pool_gpu_1.Pool2DProgram(t,"avg",!1);return this.compileAndRun(r,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,r,n){var a=new pool_gpu_1.Pool2DProgram(n,"max",!0),p=this.compileAndRun(a,[t]),o=new max_pool_backprop_gpu_1.MaxPool2DBackpropProgram(n),i=this.compileAndRun(o,[e,p],t.dtype);return p.dispose(),i},t.prototype.avgPoolBackprop=function(e,t,r){var n=new avg_pool_backprop_gpu_1.AvgPool2DBackpropProgram(r);return this.compileAndRun(n,[e],t.dtype)},t.prototype.cast=function(e,t){return backend_util.castTensor(e,t,this)},t.prototype.unstack=function(e,t){for(var r=e.shape[t],n=new Array(e.rank-1),a=0,p=0;p<e.rank;p++)p!==t&&(n[a++]=e.shape[p]);var o=new Array(e.rank).fill(0),i=e.shape.slice();i[t]=1;var u=new Array(r);for(p=0;p<u.length;p++)o[t]=p,u[p]=this.slice(e,o,i).reshape(n);return u},t.prototype.avgPool3d=function(e,t){var r=new pool_gpu_1.Pool3DProgram(t,"avg",!1);return this.compileAndRun(r,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,r){var n=new avg_pool_backprop_gpu_1.AvgPool3DBackpropProgram(r);return this.compileAndRun(n,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var r=new pool_gpu_1.Pool3DProgram(t,"max",!1);return this.compileAndRun(r,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,r,n){var a=new pool_gpu_1.Pool3DProgram(n,"max",!0),p=this.compileAndRun(a,[t]),o=new max_pool_backprop_gpu_1.MaxPool3DBackpropProgram(n),i=this.compileAndRun(o,[e,p],t.dtype);return p.dispose(),i},t.prototype.reshape=function(e,t){var r=this.texData.get(e.dataId);if(r.isPacked&&!webgl_util.isReshapeFree(e.shape,t)&&(null===r.texture||!webgl_util.isReshapeFree(r.shape,t))){var n=this.packedReshape(e,t);return engine_1.ENGINE.makeTensorFromDataId(n.dataId,n.shape,n.dtype)}return backend_util.reshapeTensor(e,t)},t.prototype.resizeBilinear=function(e,t,r,n){var a=environment_1.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new resize_bilinear_packed_gpu_1.ResizeBilinearPackedProgram(e.shape,t,r,n):new resize_bilinear_gpu_1.ResizeBilinearProgram(e.shape,t,r,n);return this.compileAndRun(a,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,r){var n=new resize_bilinear_backprop_gpu_1.ResizeBilinearBackpropProgram(e,t,r);return this.compileAndRun(n,[e])},t.prototype.resizeNearestNeighbor=function(e,t,r,n){var a=new resize_nearest_neighbor_gpu_1.ResizeNearestNeighborProgram(e.shape,t,r,n);return this.compileAndRun(a,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,r){var n=new resize_nearest_neighbor_backprop_gpu_1.ResizeNearestNeigborBackpropProgram(e,t,r);return this.compileAndRun(n,[e])},t.prototype.multinomial=function(e,t,r,n){var a=t?e:softmax_1.softmax(e),p=a.shape[0],o=a.shape[1],i=new multinomial_gpu_1.MultinomialProgram(p,o,r),u=i.getCustomSetupFunc(n);return this.compileAndRun(i,[a],"int32",u)},t.prototype.oneHot=function(e,t,r,n){var a=new onehot_gpu_1.OneHotProgram(e.size,t,r,n);return this.compileAndRun(a,[e])},t.prototype.diag=function(e){var t=new diag_gpu_1.DiagProgram(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,r,n,a){log_1.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var p=e.dataSync(),o=t.dataSync();return non_max_suppression_impl_1.nonMaxSuppressionV3(p,o,r,n,a)},t.prototype.cropAndResize=function(e,t,r,n,a,p){var o=new crop_and_resize_gpu_1.CropAndResizeProgram(e.shape,t.shape,n,a,p);return this.compileAndRun(o,[e,t,r],"float32")},t.prototype.depthToSpace=function(e,t,r){util.assert(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var n=e.shape[0],a="NHWC"===r?e.shape[1]:e.shape[2],p="NHWC"===r?e.shape[2]:e.shape[3],o="NHWC"===r?e.shape[3]:e.shape[1],i=a*t,u=p*t,s=o/(t*t),_="NHWC"===r?[n,i,u,s]:[n,s,i,u],c=new depth_to_space_gpu_1.DepthToSpaceProgram(_,t,r);return this.compileAndRun(c,[e])},t.prototype.split=function(e,t,r){return split_shared_1.split(e,t,r)},t.prototype.scatterND=function(e,t,r){var n=scatter_nd_util.calculateShapes(t,e,r),a=n.sliceRank,p=n.numUpdates,o=n.sliceSize,i=n.strides,u=n.outputSize,s=[u/o,o],_=e.reshape([p,a]),c=t.reshape([p,o]);if(0===u)return backend_util.reshapeTensor(tensor_ops_1.tensor([]),r);var l=tensor_ops_1.scalar(0),h=new scatter_gpu_1.ScatterProgram(p,a,_.rank,c.rank,i,s);return this.compileAndRun(h,[c,_,l]).reshape(r)},t.prototype.sparseToDense=function(e,t,r,n){var a=scatter_nd_util.calculateShapes(t,e,r),p=a.sliceRank,o=a.numUpdates,i=a.strides,u=a.outputSize,s=new scatter_gpu_1.ScatterProgram(o,p,e.rank,t.rank,i,[u,1],!1);return this.compileAndRun(s,[t,e,n]).reshape(r)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var r=this.texData.get(e.dataId),n=new fft_gpu_1.FFTProgram(fft_gpu.COMPLEX_FFT.REAL,e.shape,t),a=new fft_gpu_1.FFTProgram(fft_gpu.COMPLEX_FFT.IMAG,e.shape,t),p=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)],o=this.compileAndRun(n,p),i=this.compileAndRun(a,p),u=this.complex(o,i).as2D(e.shape[0],e.shape[1]);return o.dispose(),i.dispose(),u},t.prototype.gatherND=function(e,t){var r=t.shape,n=r[r.length-1],a=gather_nd_util.prepareAndValidate(e,t),p=a[0],o=a[1],i=a[2],u=a[3],s=t.reshape([o,n]),_=e.reshape([e.size/i,i]),c=new gather_nd_gpu_1.GatherNDProgram(n,u,[o,i]);return this.compileAndRun(c,[_,s]).reshape(p)},t.prototype.fill=function(e,t,r){if("string"===(r=r||util_1.inferDtype(t))){var n=util_1.getArrayFromDType(r,util_1.sizeFromShape(e));return n.fill(t),engine_1.ENGINE.makeTensor(n,e,r,this)}var a=new fill_gpu_1.FillProgram(e,t),p=a.getCustomSetupFunc(t);return this.compileAndRun(a,[],r,p)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,r){return backend_util.linspaceImpl(e,t,r)},t.prototype.makeTensorInfo=function(e,t){var r=this.write(null,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var r=this.makeTensorInfo(e,t).dataId;return engine_1.ENGINE.makeTensorFromDataId(r,e,t,this)},t.prototype.unpackTensor=function(e){var t=new unpack_gpu_1.UnpackProgram(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new pack_gpu_1.PackProgram(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var r=[webgl_util.getBatchDim(e.shape)].concat(webgl_util.getRowsCols(e.shape)),n={dtype:e.dtype,shape:r,dataId:e.dataId},a=[webgl_util.getBatchDim(t)].concat(webgl_util.getRowsCols(t)),p=new reshape_packed_gpu_1.ReshapePackedProgram(a,r),o=this.runWebGLProgram(p,[n],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}},t.prototype.decode=function(e){var t,r=this.texData.get(e),n=r.isPacked,a=r.shape,p=r.dtype,o=webgl_util.getShapeAs3D(a);t=n?new decode_matrix_packed_gpu_1.DecodeMatrixPackedProgram(o):new decode_matrix_gpu_1.DecodeMatrixProgram(o);return{dtype:p,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:p,dataId:e}],p,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,r,n,a){var p=this;void 0===a&&(a=!1);var o=this.makeTensorInfo(e.outputShape,r),i=this.texData.get(o.dataId);if(e.packedOutput&&(i.isPacked=!0),e.outPackingScheme===tex_util.PackingScheme.DENSE){var u=tex_util.getDenseTexShape(e.outputShape);i.texShape=u.map(function(e){return 2*e})}if(null!=e.outTexUsage&&(i.usage=e.outTexUsage),0===util_1.sizeFromShape(o.shape))return i.values=util_1.getTypedArrayFromDType(o.dtype,0),o;var s=[],_=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var r=p.texData.get(t.dataId);if(null==r.texture){if(!e.packedInputs&&util.sizeFromShape(t.shape)<=environment_1.env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:r.values};e.packedInputs&&(r.isPacked=!0,r.shape=t.shape)}else if(!!r.isPacked!=!!e.packedInputs)t=r.isPacked?p.unpackTensor(t):p.packTensor(t),s.push(t),r=p.texData.get(t.dataId);else if(r.isPacked&&!webgl_util.isReshapeFree(r.shape,t.shape)){var n=t,a=t.shape;t.shape=r.shape,t=p.packedReshape(t,a),s.push(t),r=p.texData.get(t.dataId),n.shape=a}return p.uploadToGPU(t.dataId),{shape:t.shape,texData:r,isUniform:!1}});this.uploadToGPU(o.dataId);var c,l={shape:o.shape,texData:i,isUniform:!1},h=gpgpu_math.makeShaderKey(e,_,l),d=this.getAndSaveBinary(h,function(){return gpgpu_math.compileProgram(p.gpgpu,e,_,l)}),g=null!=this.activeTimers;if(g&&(c=this.startTimer()),gpgpu_math.runProgram(this.gpgpu,d,_,l,n),s.forEach(function(e){return p.disposeData(e.dataId)}),g&&(c=this.endTimer(c),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(c)})),!environment_1.env().getBool("WEBGL_LAZILY_UNPACK")&&i.isPacked&&!1===a){var m=this.unpackTensor(o);return this.disposeData(o.dataId),m}return o},t.prototype.compileAndRun=function(e,t,r,n,a){void 0===a&&(a=!1),r=r||t[0].dtype;var p=this.runWebGLProgram(e,t,r,n,a);return engine_1.ENGINE.makeTensorFromDataId(p.dataId,p.shape,p.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;if(!this.disposed){if(!environment_1.env().getBool("IS_TEST"))Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]});this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=globals_1.tidy(function(){if(!environment_1.env().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=environment_1.env().getBool("DEBUG");environment_1.env().set("DEBUG",!1);var r=e.abs(tensor_ops_1.scalar(1e-8)).dataSync()[0];if(environment_1.env().set("DEBUG",t),r>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?backend_1.EPSILON_FLOAT32:backend_1.EPSILON_FLOAT16},t.prototype.uploadToGPU=function(e){var t,r=this.texData.get(e),n=r.shape,a=r.dtype,p=r.values,o=r.texture,i=r.usage,u=r.isPacked;if(null==o){var s,_=null!=this.activeTimers;_&&(s=util.now());var c=r.texShape;if(null==c&&(c=webgl_util.getTextureShapeFromLogicalShape(n,u),r.texShape=c),null!=p){var l=webgl_util.getShapeAs3D(n),h=void 0,d=c[1],g=c[0],m=p instanceof Uint8Array;u?(d=(t=tex_util.getPackedMatrixTextureShapeWidthHeight(c[0],c[1]))[0],g=t[1],h=new encode_matrix_packed_gpu_1.EncodeMatrixPackedProgram(l,[g,d],m)):h=new encode_matrix_gpu_1.EncodeMatrixProgram(l,[g,d],m);var y=this.makeTensorInfo([g,d],a);this.texData.get(y.dataId).usage=m?tex_util_1.TextureUsage.PIXELS:tex_util_1.TextureUsage.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),d,g,p);var v=this.runWebGLProgram(h,[y],a,null,!0),f=this.texData.get(v.dataId);r.texture=f.texture,r.texShape=f.texShape,r.isPacked=f.isPacked,r.usage=f.usage,this.disposeData(y.dataId),this.texData.delete(v.dataId),r.values=null,_&&(this.uploadWaitMs+=util.now()-s)}else{var P=this.acquireTexture(c,i,a,u);r.texture=P}}},t.prototype.convertAndCacheOnCPU=function(e,t){var r=this.texData.get(e),n=r.dtype;return this.releaseGPUData(e),null!=t&&(r.values=float32ToTypedArray(t,n)),r.values},t.prototype.acquireTexture=function(e,t,r,n){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,n)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*util.bytesPerElement(t)},t}(backend_1.KernelBackend);function float32ToTypedArray(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var r="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),n=0;n<r.length;++n)r[n]=Math.round(e[n]);return r}throw new Error("Unknown dtype "+t)}exports.MathBackendWebGL=MathBackendWebGL,device_util.isBrowser()&&engine_1.ENGINE.registerBackend("webgl",function(){return new MathBackendWebGL},2);

},{"../../device_util":162,"../../engine":163,"../../environment":164,"../../globals":166,"../../log":190,"../../ops/array_ops":192,"../../ops/array_ops_util":193,"../../ops/axis_util":194,"../../ops/complex_ops":203,"../../ops/concat_util":205,"../../ops/div":210,"../../ops/gather_nd_util":219,"../../ops/reduce_util":240,"../../ops/scatter_nd_util":245,"../../ops/segment_util":247,"../../ops/slice_util":251,"../../ops/softmax":252,"../../ops/tensor_ops":259,"../../types":293,"../../util":294,"../backend":55,"../backend_util":56,"../complex_util":57,"../non_max_suppression_impl":67,"../split_shared":69,"../tile_impl":70,"../topk_impl":71,"../where_impl":160,"./addn_gpu":72,"./addn_packed_gpu":73,"./argminmax_gpu":74,"./argminmax_packed_gpu":75,"./avg_pool_backprop_gpu":76,"./batchnorm_gpu":78,"./batchnorm_packed_gpu":79,"./binaryop_complex_gpu":80,"./binaryop_gpu":81,"./binaryop_packed_gpu":82,"./canvas_util":83,"./clip_gpu":84,"./clip_packed_gpu":85,"./complex_abs_gpu":86,"./concat_gpu":87,"./concat_packed_gpu":88,"./conv_backprop_gpu":89,"./conv_backprop_gpu_depthwise":90,"./conv_gpu":91,"./conv_gpu_depthwise":92,"./conv_packed_gpu_depthwise":93,"./crop_and_resize_gpu":94,"./cumsum_gpu":95,"./decode_matrix_gpu":96,"./decode_matrix_packed_gpu":97,"./depth_to_space_gpu":98,"./diag_gpu":99,"./encode_float_gpu":100,"./encode_float_packed_gpu":101,"./encode_matrix_gpu":102,"./encode_matrix_packed_gpu":103,"./fft_gpu":104,"./fill_gpu":105,"./flags_webgl":106,"./gather_gpu":107,"./gather_nd_gpu":108,"./gpgpu_context":110,"./gpgpu_math":111,"./im2col_packed_gpu":113,"./lrn_gpu":122,"./lrn_grad_gpu":123,"./lrn_packed_gpu":124,"./max_pool_backprop_gpu":125,"./mulmat_packed_gpu":126,"./multinomial_gpu":127,"./onehot_gpu":128,"./pack_gpu":129,"./pad_gpu":130,"./pad_packed_gpu":131,"./pool_gpu":132,"./reduce_gpu":133,"./reshape_packed_gpu":135,"./resize_bilinear_backprop_gpu":136,"./resize_bilinear_gpu":137,"./resize_bilinear_packed_gpu":138,"./resize_nearest_neighbor_backprop_gpu":139,"./resize_nearest_neighbor_gpu":140,"./reverse_gpu":141,"./reverse_packed_gpu":142,"./scatter_gpu":143,"./segment_gpu":144,"./select_gpu":145,"./slice_gpu":148,"./slice_packed_gpu":149,"./strided_slice_gpu":150,"./tex_util":151,"./texture_manager":152,"./tile_gpu":153,"./transpose_gpu":154,"./transpose_packed_gpu":155,"./unaryop_gpu":156,"./unaryop_packed_gpu":157,"./unpack_gpu":158,"./webgl_util":159}],78:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),BatchNormProgram=function(){return function(t,a,e,s,r,o){this.outputShape=[],this.variableNames=["x","mean","variance"],broadcast_util.assertAndGetBroadcastShape(t,a),broadcast_util.assertAndGetBroadcastShape(t,e);var n="0.0";null!=s&&(broadcast_util.assertAndGetBroadcastShape(t,s),this.variableNames.push("offset"),n="getOffsetAtOutCoords()");var i="1.0";null!=r&&(broadcast_util.assertAndGetBroadcastShape(t,r),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+n+";\n        float scale = "+i+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "}}();exports.BatchNormProgram=BatchNormProgram;

},{"../../ops/broadcast_util":199}],79:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),BatchNormPackedProgram=function(){return function(e,t,a,s,r,c){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],broadcast_util.assertAndGetBroadcastShape(e,t),broadcast_util.assertAndGetBroadcastShape(e,a);var o="vec4(0.0)";null!=s&&(broadcast_util.assertAndGetBroadcastShape(e,s),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var n="vec4(1.0)";null!=r&&(broadcast_util.assertAndGetBroadcastShape(e,r),this.variableNames.push("scale"),n="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+n+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+c+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "}}();exports.BatchNormPackedProgram=BatchNormPackedProgram;

},{"../../ops/broadcast_util":199}],80:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util");exports.COMPLEX_MULTIPLY={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};var BinaryOpComplexProgram=function(){return function(a,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=broadcast_util.assertAndGetBroadcastShape(t,e),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+a+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "}}();exports.BinaryOpComplexProgram=BinaryOpComplexProgram;

},{"../../ops/broadcast_util":199}],81:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),CHECK_NAN_SNIPPET="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";exports.ADD="return a + b;",exports.SUB="return a - b;",exports.MUL="return a * b;",exports.DIV="\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",exports.INT_DIV="\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",exports.POW="\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",exports.SQUARED_DIFFERENCE="return (a - b) * (a - b);",exports.EQUAL="return float(a == b);",exports.NOT_EQUAL="return float(a != b);",exports.LESS="return float(a < b);",exports.LESS_EQUAL="return float(a <= b);",exports.GREATER="return float(a > b);",exports.GREATER_EQUAL="return float(a >= b);",exports.LOGICAL_AND="return float(a >= 1.0 && b >= 1.0);",exports.LOGICAL_OR="return float(a >= 1.0 || b >= 1.0);",exports.MAX=CHECK_NAN_SNIPPET+"\n  return max(a, b);\n",exports.MIN=CHECK_NAN_SNIPPET+"\n  return min(a, b);\n",exports.MOD="if (b == 0.0) return NAN;\n  return mod(a, b);",exports.ATAN2=CHECK_NAN_SNIPPET+"\n  return atan(a, b);\n",exports.ELU_DER="return (b >= 1.0) ? a : a * (b + 1.0);",exports.PRELU="return (a < 0.) ? b * a : a;";var BinaryOpProgram=function(){return function(r,n,t){this.variableNames=["A","B"],this.outputShape=broadcast_util.assertAndGetBroadcastShape(n,t),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+r+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}}();exports.BinaryOpProgram=BinaryOpProgram;

},{"../../ops/broadcast_util":199}],82:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),util_1=require("../../util"),packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),CHECK_NAN_SNIPPET="\n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n";exports.DIV="\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",exports.INT_DIV="\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",exports.POW="\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  "+CHECK_NAN_SNIPPET+"\n  return result;\n",exports.PRELU="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",exports.ELU_DER="\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",exports.ATAN2="\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+CHECK_NAN_SNIPPET+"\n  return result;\n",exports.EQUAL="\n  return vec4(equal(a, b));\n",exports.NOT_EQUAL="\n  return vec4(notEqual(a, b));\n",exports.LESS="\n  return vec4(lessThan(a, b));\n",exports.LESS_EQUAL="\n  return vec4(lessThanEqual(a, b));\n",exports.GREATER="\n  return vec4(greaterThan(a, b));\n",exports.GREATER_EQUAL="\n  return vec4(greaterThanEqual(a, b));\n",exports.LOGICAL_AND="\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",exports.LOGICAL_OR="\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",exports.MAX="\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+CHECK_NAN_SNIPPET+"\n  return result;\n",exports.MIN="\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+CHECK_NAN_SNIPPET+"\n  return result;\n",exports.MOD="\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  "+CHECK_NAN_SNIPPET+"\n  return result;\n";var BinaryOpPackedProgram=function(){return function(e,n,r,t){void 0===t&&(t=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=broadcast_util.assertAndGetBroadcastShape(n,r);var s=this.outputShape.length,a="";if(t)if(0===s||1===util_1.sizeFromShape(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+shader_compiler_1.getCoordsDataType(s)+" coords = getOutputCoords();\n        ",1===s)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var u=packing_util_1.getChannels("coords",s);a+="\n            bool nextRowOutOfBounds =\n              ("+u[s-2]+" + 1) >= "+this.outputShape[s-2]+";\n            bool nextColOutOfBounds =\n              ("+u[s-1]+" + 1) >= "+this.outputShape[s-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "}}();exports.BinaryOpPackedProgram=BinaryOpPackedProgram;

},{"../../ops/broadcast_util":199,"../../util":294,"../packing_util":68,"./shader_compiler":146}],83:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var contexts={},WEBGL_ATTRIBUTES={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function setWebGLContext(e,t){contexts[e]=t}function getWebGLContext(e){e in contexts||(contexts[e]=getWebGLRenderingContext(e));var t=contexts[e];return t.isContextLost()?(delete contexts[e],getWebGLContext(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),contexts[e])}function createCanvas(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function getWebGLRenderingContext(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=createCanvas(e);return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete contexts[e]},!1),1===e?t.getContext("webgl",WEBGL_ATTRIBUTES)||t.getContext("experimental-webgl",WEBGL_ATTRIBUTES):t.getContext("webgl2",WEBGL_ATTRIBUTES)}exports.setWebGLContext=setWebGLContext,exports.getWebGLContext=getWebGLContext;

},{}],84:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ClipProgram=function(){function n(n){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n,o){var t=this;return function(a,i){null==t.minLoc&&(t.minLoc=a.getUniformLocationNoThrow(i,"minVal"),t.maxLoc=a.getUniformLocationNoThrow(i,"maxVal")),a.gl.uniform1f(t.minLoc,n),a.gl.uniform1f(t.maxLoc,o)}},n}();exports.ClipProgram=ClipProgram;

},{}],85:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ClipPackedProgram=function(){function n(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n,t){var o=this;return function(a,e){null==o.minLoc&&(o.minLoc=a.getUniformLocationNoThrow(e,"minVal"),o.maxLoc=a.getUniformLocationNoThrow(e,"maxVal")),a.gl.uniform1f(o.minLoc,n),a.gl.uniform1f(o.maxLoc,t)}},n}();exports.ClipPackedProgram=ClipPackedProgram;

},{}],86:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ComplexAbsProgram=function(){return function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}();exports.ComplexAbsProgram=ComplexAbsProgram;

},{}],87:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var concat_util=require("../../ops/concat_util"),ConcatProgram=function(){return function(t){this.outputShape=[],this.outputShape=concat_util.computeOutShape(t,1),this.variableNames=t.map(function(t,e){return"T"+e});var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var o=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++){var r=e[n-1];o.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+r+"));")}var u=e.length,a=e[e.length-1];o.push("else setOutput(getT"+u+"(yR, yC-"+a+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+o.join("\n        ")+"\n      }\n    "}}();exports.ConcatProgram=ConcatProgram;

},{"../../ops/concat_util":205}],88:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var concat_util=require("../../ops/concat_util"),packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),ConcatPackedProgram=function(){return function(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=concat_util.computeOutShape(e,n);var t=this.outputShape,r=t.length,a=shader_compiler_1.getCoordsDataType(r),u=packing_util_1.getChannels("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,n){return"T"+n});var o=new Array(e.length-1);o[0]=e[0][n];for(var s=1;s<o.length;s++)o[s]=o[s-1]+e[s][n];var l=i[n],c=i.slice(-2),h=i.join(),p="if ("+l+" < "+o[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+c.join()+"));\n        }";for(s=1;s<o.length;s++){var g=o[s-1];p+="\n        if ("+l+" < "+o[s]+"  && "+l+" >= "+o[s-1]+") {\n          return getChannel(\n            getT"+s+"("+shiftedChannels(i,l,g)+"),\n            vec2("+shiftedChannels(c,l,g)+"));\n        }"}var d=o.length,f=o[o.length-1];p+="\n        return getChannel(\n          getT"+d+"("+shiftedChannels(i,l,f)+"),\n          vec2("+shiftedChannels(c,l,f)+"));",this.userCode="\n      float getValue("+i.map(function(e){return"int "+e})+") {\n        "+p+"\n      }\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+u+"), 0., 0., 0.);\n\n        "+u[r-1]+" = "+u[r-1]+" + 1;\n        if ("+u[r-1]+" < "+t[r-1]+") {\n          result.g = getValue("+u+");\n        }\n\n        "+u[r-2]+" = "+u[r-2]+" + 1;\n        if ("+u[r-2]+" < "+t[r-2]+") {\n          result.a = getValue("+u+");\n        }\n\n        "+u[r-1]+" = "+u[r-1]+" - 1;\n        if ("+u[r-2]+" < "+t[r-2]+" &&\n            "+u[r-1]+" < "+t[r-1]+") {\n          result.b = getValue("+u+");\n        }\n        setOutput(result);\n      }\n    "}}();function shiftedChannels(e,n,t){var r=e.indexOf(n);return e.map(function(e,n){return n===r?e+" - "+t:e}).join()}exports.ConcatPackedProgram=ConcatPackedProgram;

},{"../../ops/concat_util":205,"../packing_util":68,"./shader_compiler":146}],89:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Conv2DDerFilterProgram=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,o=n.strideWidth,e=n.padInfo.top,d=n.padInfo.left,r="channelsLast"===n.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+e+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+o+" - "+d+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              if ("+r+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv2DDerFilterProgram=Conv2DDerFilterProgram;var Conv2DDerInputProgram=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,o=n.filterWidth,e=n.strideHeight,d=n.strideWidth,r="channelsLast"===n.dataFormat,i=t-1-n.padInfo.top,a=o-1-n.padInfo.left,y=r?1:2,C=r?2:3,u=r?3:1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+u+"];\n\n        ivec2 dyCorner = ivec2(coords["+y+"], coords["+C+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+d+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+o+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n\n              if ("+r+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv2DDerInputProgram=Conv2DDerInputProgram;var Conv3DDerFilterProgram=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideDepth,o=n.strideHeight,e=n.strideWidth,d=n.padInfo.front,r=n.padInfo.top,i=n.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yF = 0; yF < "+n.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+d+";\n\n            if (xF < 0 || xF >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n              int xR = wR + yR * "+o+" - "+r+";\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n                int xC = wC + yC * "+e+" - "+i+";\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv3DDerFilterProgram=Conv3DDerFilterProgram;var Conv3DDerInputProgram=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterDepth,o=n.filterHeight,e=n.filterWidth,d=n.strideDepth,r=n.strideHeight,i=n.strideWidth,a=t-1-n.padInfo.front,y=o-1-n.padInfo.top,C=e-1-n.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+a+", "+y+", "+C+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+d+".0;\n\n          if (dyF < 0.0 || dyF >= "+n.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+o+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+r+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+o+" - 1 - wR;\n\n            for (int wC = 0; wC < "+e+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+e+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv3DDerInputProgram=Conv3DDerInputProgram;

},{}],90:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DepthwiseConv2DDerFilterProgram=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,e=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,r=n.outChannels/n.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+r+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+o+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+e+" - "+i+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.DepthwiseConv2DDerFilterProgram=DepthwiseConv2DDerFilterProgram;var DepthwiseConv2DDerInputProgram=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,o=n.strideHeight,i=n.strideWidth,r=t-1-n.padInfo.top,d=e-1-n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+r+", "+d+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+o+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+a+"; dm++) {\n              int d2 = d1 * "+a+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.DepthwiseConv2DDerInputProgram=DepthwiseConv2DDerInputProgram;

},{}],91:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Conv2DProgram=function(){return function(n,t,e,o){void 0===t&&(t=!1),void 0===e&&(e=null),void 0===o&&(o=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var d=n.padInfo.top,i=n.padInfo.left,a=n.strideHeight,r=n.strideWidth,x=n.dilationHeight,s=n.dilationWidth,C=n.filterHeight,c=n.filterWidth,w=4*Math.floor(n.inChannels/4),l=n.inChannels%4,h="channelsLast"===n.dataFormat,u=h?1:2,R=h?2:3,v=h?3:1,g="",f="";e&&(g=o?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",f="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+g+"\n\n      const ivec2 strides = ivec2("+a+", "+r+");\n      const ivec2 pads = ivec2("+d+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+u+"], coords["+R+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+C+"; wR++) {\n          int xR = xRCorner + wR * "+x+";\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+s+";\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+w+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+h+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===l)+") {\n\n              if ("+h+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+w+") *\n                    getW(wR, wC, "+w+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+w+", xR, xC) *\n                    getW(wR, wC, "+w+", d2);\n              }\n\n            } else if ("+(2===l)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+w+", d2),\n                getW(wR, wC, "+w+" + 1, d2)\n              );\n\n              if ("+h+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+w+"),\n                  getX(batch, xR, xC, "+w+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+w+", xR, xC),\n                  getX(batch, "+w+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===l)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+w+", d2),\n                getW(wR, wC, "+w+" + 1, d2),\n                getW(wR, wC, "+w+" + 2, d2)\n              );\n\n              if ("+h+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+w+"),\n                  getX(batch, xR, xC, "+w+" + 1),\n                  getX(batch, xR, xC, "+w+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+w+", xR, xC),\n                  getX(batch, "+w+" + 1, xR, xC),\n                  getX(batch, "+w+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+b+"\n        "+f+"\n        setOutput(result);\n      }\n    "}}();exports.Conv2DProgram=Conv2DProgram;var Conv3DProgram=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.padInfo.front,e=n.padInfo.top,o=n.padInfo.left,d=n.strideDepth,i=n.strideHeight,a=n.strideWidth,r=n.dilationDepth,x=n.dilationHeight,s=n.dilationWidth,C=n.filterDepth,c=n.filterHeight,w=n.filterWidth,l=4*Math.floor(n.inChannels/4),h=n.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+d+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+t+", "+e+", "+o+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+C+"; wF++) {\n          int xF = xFCorner + wF * "+r+";\n\n          if (xF < 0 || xF >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+c+"; wR++) {\n            int xR = xRCorner + wR * "+x+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC++) {\n              int xC = xCCorner + wC * "+s+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+l+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===h)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+l+") *\n                  getW(wF, wR, wC, "+l+", d2);\n              } else if ("+(2===h)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+l+"),\n                  getX(batch, xF, xR, xC, "+l+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+l+", d2),\n                  getW(wF, wR, wC, "+l+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===h)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+l+"),\n                  getX(batch, xF, xR, xC, "+l+" + 1),\n                  getX(batch, xF, xR, xC, "+l+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+l+", d2),\n                  getW(wF, wR, wC, "+l+" + 1, d2),\n                  getW(wF, wR, wC, "+l+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv3DProgram=Conv3DProgram;

},{}],92:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DepthwiseConv2DProgram=function(){return function(t,n,o,e){void 0===n&&(n=!1),void 0===o&&(o=null),void 0===e&&(e=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.inHeight,r=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,d=t.strideHeight,l=t.strideWidth,C=t.dilationHeight,h=t.dilationWidth,u=t.filterHeight,v=t.filterWidth,c=t.outChannels/t.inChannels,x="",f="";o&&(x=e?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+o+"\n        }":"\n          float activation(float x) {\n            "+o+"\n          }\n        ",f="result = activation(result);");var p=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),e&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+d+", "+l+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+c+";\n        int q = d2 - d1 * "+c+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+u+"; wR++) {\n          int xR = xRCorner + wR * "+C+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+r+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+p+"\n        "+f+"\n        setOutput(result);\n      }\n    "}}();exports.DepthwiseConv2DProgram=DepthwiseConv2DProgram;

},{}],93:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../../util"),DepthwiseConvPacked2DProgram=function(){return function(e,n,x,t){void 0===n&&(n=!1),void 0===x&&(x=null),void 0===t&&(t=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var C=e.inHeight,f=e.inWidth,s=e.padInfo.top,i=e.padInfo.left,r=e.strideHeight,c=e.strideWidth,R=e.dilationHeight,l=e.dilationWidth,a=e.filterHeight,o=e.filterWidth,v=o,d="int xR; int xC; int xCOffset;",u=0;u<a;u++)for(var O=0;O<o;O++)d+="\n          vec4 xTexelR"+u+"C"+2*O+" = vec4(0.);\n          vec4 wR"+u+"C"+O+" = vec4(0.);\n          vec4 xR"+u+"C"+O+" = vec4(0.);";for(u=0;u<a;u++)for(var h=0;h<v;h++){if(d+="\n          xR = xRCorner + "+u*R+";\n          xC = xCCorner + "+(O=2*h)*l+";\n        ",1===c){if(O<o&&(d+=i%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+C+" && xCOffset >= 0 && xCOffset < "+f+") {\n                  xTexelR"+u+"C"+O+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+f+") {\n                    xTexelR"+u+"C"+O+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+u+"C"+O+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+C+" && xCOffset >= 0 && xCOffset < "+f+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+f+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+u+"C"+O+" = vec4(previous.zw, xTexelR"+u+"C"+O+".xy);\n                } else {\n                  xR"+u+"C"+O+" = vec4(0, 0, xTexelR"+u+"C"+O+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+C+" && xC >= 0 && xC < "+f+") {\n                  xTexelR"+u+"C"+O+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+u+"C"+O+" = vec4(0.);\n                }\n\n                xR"+u+"C"+O+" = xTexelR"+u+"C"+O+";\n              ",O+1<o)){var T=i%2==0?util.nearestLargerEven(l):l;l%2==0&&i%2==1||l%2!=0&&i%2!=1?(d+="\n                  xCOffset = xC + "+i%2+" + "+T+";\n\n                  if(xR >= 0 && xR < "+C+" &&\n                    xCOffset >= 0 && xCOffset < "+f+") {\n                    xTexelR"+u+"C"+(O+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",l>1&&(d+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+C+" &&\n                      xCOffset >= 0 && xCOffset < "+f+") {\n                      xTexelR"+u+"C"+O+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+u+"C"+O+" = vec4(0.);\n                    }\n                  "),d+="\n                  xR"+u+"C"+(O+1)+" = vec4(\n                    xTexelR"+u+"C"+O+".zw, xTexelR"+u+"C"+(O+2)+".xy);\n                "):d+="\n                  xCOffset = xC + "+T+";\n\n                  if(xR >= 0 && xR < "+C+" &&\n                    xCOffset >= 0 && xCOffset < "+f+") {\n                    xTexelR"+u+"C"+(O+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+u+"C"+(O+1)+" = xTexelR"+u+"C"+(O+2)+";\n                "}}else O<o&&(d+="\n              if(xR >= 0 && xR < "+C+") {\n            ",i%2==1?(d+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+f+") {\n                  xTexelR"+u+"C"+O+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+u+"C"+O+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+f+") {\n                  xTexelR"+u+"C"+(O+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+u+"C"+(O+2)+" = vec4(0.);\n                }\n\n                xR"+u+"C"+O+" = vec4(\n                  xTexelR"+u+"C"+O+".zw, xTexelR"+u+"C"+(O+2)+".zw);\n              ",O+1<o&&(d+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+f+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+u+"C"+(O+1)+" = vec4(xTexelR"+u+"C"+(O+2)+".xy, final.xy);\n                ")):(d+="\n                if(xC >= 0 && xC < "+f+") {\n                  xTexelR"+u+"C"+O+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+u+"C"+O+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+f+") {\n                  xTexelR"+u+"C"+(O+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+u+"C"+(O+2)+" = vec4(0.);\n                }\n\n                xR"+u+"C"+O+" = vec4(\n                  xTexelR"+u+"C"+O+".xy, xTexelR"+u+"C"+(O+2)+".xy);\n              ",O+1<o&&(d+="\n                  xR"+u+"C"+(O+1)+" = vec4(\n                    xTexelR"+u+"C"+O+".zw, xTexelR"+u+"C"+(O+2)+".zw);\n                ")),d+="}");O<o&&(d+="\n            vec4 wTexelR"+u+"C"+O+" = getW("+u+", "+O+", d1, q);\n            wR"+u+"C"+O+" = vec4(wTexelR"+u+"C"+O+".xz, wTexelR"+u+"C"+O+".xz);\n          ",O+1<o&&(d+="\n              vec4 wTexelR"+u+"C"+(O+1)+" = getW("+u+", "+(O+1)+", d1, q);\n              wR"+u+"C"+(O+1)+" =\n                vec4(wTexelR"+u+"C"+(O+1)+".xz, wTexelR"+u+"C"+(O+1)+".xz);"))}for(u=0;u<a;u++)for(O=0;O<o;O++)d+="dotProd += xR"+u+"C"+O+" * wR"+u+"C"+O+";";var g="",p="";x&&(g=t?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+x+"\n        }":"vec4 activation(vec4 x) {\n          "+x+"\n        }",p="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),t&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+g+"\n\n      const ivec2 strides = ivec2("+r+", "+c+");\n      const ivec2 pads = ivec2("+s+", "+i+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+d+"\n\n        vec4 result = dotProd;\n        "+w+"\n        "+p+"\n        setOutput(result);\n      }\n    "}}();exports.DepthwiseConvPacked2DProgram=DepthwiseConvPacked2DProgram;

},{"../../util":294}],94:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CropAndResizeProgram=function(){return function(e,t,o,n,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],c=e[3],l=t[0],u=o[0],f=o[1];this.outputShape=[l,u,f,c];var d="bilinear"===n?1:0,x=[i-1+".0",s-1+".0"],C=x[0],g=x[1],R=u>1?[""+(i-1)/(u-1),"(y2-y1) * height_ratio","y1*"+C+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+C],b=R[0],h=R[1],p=R[2],m=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g],y=m[0],v=m[1],_=m[2];this.userCode="\n      const float height_ratio = float("+b+");\n      const float width_ratio = float("+y+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+h+";\n        float width_scale = "+v+";\n\n        float in_y = "+p+";\n        if( in_y < 0.0 || in_y > "+C+" ) {\n          setOutput(float("+r+"));\n          return;\n        }\n        float in_x = "+_+";\n        if( in_x < 0.0 || in_x > "+g+" ) {\n          setOutput(float("+r+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "}}();exports.CropAndResizeProgram=CropAndResizeProgram;

},{}],95:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),CumSumProgram=function(){return function(r,n,t){this.variableNames=["x"],this.outputShape=r;var e=r.length,o=r[r.length-1],i=t?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(t?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+shader_compiler_1.getCoordsDataType(e)+" coords = getOutputCoords();\n        int end = "+getFinalCoord(e,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+n+") {\n            continue;\n          }\n          "+getFinalCoord(e,"coords")+" = idx;\n          val += getX("+getCoords(e,"coords")+");\n        }\n        setOutput(val);\n      }\n    "}}();function getCoords(r,n){if(1===r)return""+n;if(2===r)return n+".x, "+n+".y";if(3===r)return n+".x, "+n+".y, "+n+".z";if(4===r)return n+".x, "+n+".y, "+n+".z, "+n+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}function getFinalCoord(r,n){if(1===r)return""+n;if(2===r)return n+".y";if(3===r)return n+".z";if(4===r)return n+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}exports.CumSumProgram=CumSumProgram;

},{"./shader_compiler":146}],96:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_util=require("./shader_compiler_util"),tex_util_1=require("./tex_util"),DecodeMatrixProgram=function(){return function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=tex_util_1.PackingScheme.DENSE;var t=tex_util_1.getDenseTexShape(e),r=glsl_version_1.getGlslDifferences();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+r.output+" = result;\n      }\n    "}}();exports.DecodeMatrixProgram=DecodeMatrixProgram;

},{"./glsl_version":109,"./shader_compiler_util":147,"./tex_util":151}],97:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_util=require("./shader_compiler_util"),tex_util_1=require("./tex_util"),DecodeMatrixPackedProgram=function(){return function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=tex_util_1.PackingScheme.DENSE;var t=tex_util_1.getDenseTexShape(e),r=glsl_version_1.getGlslDifferences();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+r.output+" = result;\n      }\n    "}}();exports.DecodeMatrixPackedProgram=DecodeMatrixPackedProgram;

},{"./glsl_version":109,"./shader_compiler_util":147,"./tex_util":151}],98:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DepthToSpaceProgram=function(){function t(t,o,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=o,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+o+";\n      int offset_h = imod(h, "+o+");\n      int in_w = w / "+o+";\n      int offset_w = imod(w, "+o+");\n      int offset_d = (offset_h * "+o+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}();exports.DepthToSpaceProgram=DepthToSpaceProgram;

},{}],99:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DiagProgram=function(){return function(o){this.variableNames=["X"],this.outputShape=[o,o],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}();exports.DiagProgram=DiagProgram;

},{}],100:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_compiler_util_1=require("./shader_compiler_util"),tex_util_1=require("./tex_util"),EncodeFloatProgram=function(){return function(e){this.variableNames=["A"],this.outTexUsage=tex_util_1.TextureUsage.DOWNLOAD;var t=glsl_version_1.getGlslDifferences();this.outputShape=e,this.userCode="\n      "+shader_compiler_util_1.ENCODE_FLOAT_SNIPPET+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "}}();exports.EncodeFloatProgram=EncodeFloatProgram;

},{"./glsl_version":109,"./shader_compiler_util":147,"./tex_util":151}],101:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_compiler_util_1=require("./shader_compiler_util"),tex_util_1=require("./tex_util"),EncodeFloatPackedProgram=function(){return function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=tex_util_1.TextureUsage.DOWNLOAD;var t=glsl_version_1.getGlslDifferences();this.outputShape=e,this.userCode="\n      "+shader_compiler_util_1.ENCODE_FLOAT_SNIPPET+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "}}();exports.EncodeFloatPackedProgram=EncodeFloatPackedProgram;

},{"./glsl_version":109,"./shader_compiler_util":147,"./tex_util":151}],102:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_util=require("./shader_compiler_util"),EncodeMatrixProgram=function(){return function(e,n,t){void 0===t&&(t=!1),this.variableNames=["A"];var r=glsl_version_1.getGlslDifferences(),s=n[0],l=n[1];this.outputShape=e;var o="result";t&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+shader_util.getFlatIndexFrom3D(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+l+";\n        int c = imod(flatIndex, "+l+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+l+".0, "+s+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "}}();exports.EncodeMatrixProgram=EncodeMatrixProgram;

},{"./glsl_version":109,"./shader_compiler_util":147}],103:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_util=require("./shader_compiler_util"),EncodeMatrixPackedProgram=function(){return function(e,n,r){void 0===r&&(r=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var o=glsl_version_1.getGlslDifferences(),t=n[0],l=n[1];this.outputShape=e;var s="",a="result";r&&(a="floor(result * 255. + 0.5)");for(var d=0;d<=1;d++)for(var i=0;i<=1;i++){var u=2*d+i;s+="\n          localCoords = coords;\n          if(localCoords[2] + "+i+" < "+e[2]+") {\n            localCoords[2] += "+i+";\n            if(localCoords[1] + "+d+" < "+e[1]+") {\n              localCoords[1] += "+d+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+l+";\n              c = imod(flatIndex, "+l+");\n              uv = (vec2(c, r) + halfCR) / vec2("+l+".0, "+t+".0);\n              values = "+o.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+u+"] = values[0];\n              } else if(offset == 1) {\n                result["+u+"] = values[1];\n              } else if(offset == 2) {\n                result["+u+"] = values[2];\n              } else {\n                result["+u+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+shader_util.getFlatIndexFrom3D(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+s+"\n\n        "+o.output+" = "+a+";\n      }\n    "}}();exports.EncodeMatrixPackedProgram=EncodeMatrixPackedProgram;

},{"./glsl_version":109,"./shader_compiler_util":147}],104:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.COMPLEX_FFT={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"};var FFTProgram=function(){return function(t,e,n){this.variableNames=["real","imag"];var a=e[1];this.outputShape=e;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?a+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+a+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+a+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+i+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "}}();exports.FFTProgram=FFTProgram;

},{}],105:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FillProgram=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(o,u){null==e.valueLoc&&(e.valueLoc=o.getUniformLocationNoThrow(u,"value")),o.gl.uniform1f(e.valueLoc,t)}},t}();exports.FillProgram=FillProgram;

},{}],106:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var device_util=require("../../device_util"),environment_1=require("../../environment"),webgl_util=require("./webgl_util"),ENV=environment_1.env();ENV.registerFlag("HAS_WEBGL",function(){return ENV.getNumber("WEBGL_VERSION")>0}),ENV.registerFlag("WEBGL_VERSION",function(){return webgl_util.isWebGLVersionEnabled(2)?2:webgl_util.isWebGLVersionEnabled(1)?1:0}),ENV.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===ENV.get("WEBGL_VERSION")}),ENV.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),ENV.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),ENV.registerFlag("WEBGL_PACK",function(){return ENV.getBool("HAS_WEBGL")}),ENV.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return ENV.getBool("WEBGL_PACK")}),ENV.registerFlag("WEBGL_PACK_CLIP",function(){return ENV.getBool("WEBGL_PACK")}),ENV.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),ENV.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return ENV.getBool("WEBGL_PACK")}),ENV.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return ENV.getBool("WEBGL_PACK")}),ENV.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return ENV.getBool("WEBGL_PACK")}),ENV.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return ENV.getBool("WEBGL_PACK")}),ENV.registerFlag("WEBGL_PACK_REDUCE",function(){return ENV.getBool("WEBGL_PACK")}),ENV.registerFlag("WEBGL_LAZILY_UNPACK",function(){return ENV.getBool("WEBGL_PACK")}),ENV.registerFlag("WEBGL_CONV_IM2COL",function(){return ENV.getBool("WEBGL_PACK")}),ENV.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return webgl_util.getWebGLMaxTextureSize(ENV.getNumber("WEBGL_VERSION"))}),ENV.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return webgl_util.getMaxTexturesInShader(ENV.getNumber("WEBGL_VERSION"))}),ENV.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=ENV.getNumber("WEBGL_VERSION");return 0===e?0:webgl_util.getWebGLDisjointQueryTimerVersion(e)}),ENV.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!device_util.isMobile()}),ENV.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return webgl_util.isCapableOfRenderingToFloatTexture(ENV.getNumber("WEBGL_VERSION"))}),ENV.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!ENV.getBool("WEBGL_FORCE_F16_TEXTURES")&&ENV.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),ENV.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return webgl_util.isDownloadFloatTextureEnabled(ENV.getNumber("WEBGL_VERSION"))}),ENV.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return webgl_util.isWebGLFenceEnabled(ENV.getNumber("WEBGL_VERSION"))}),ENV.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return ENV.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0});

},{"../../device_util":162,"../../environment":164,"./webgl_util":159}],107:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),GatherProgram=function(){return function(r,e,t){this.variableNames=["A","indices"];var s=r.slice();s[t]=e,this.outputShape=s,this.rank=s.length;var o=shader_compiler_1.getCoordsDataType(this.rank),n=getSourceCoords(r,t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+n+"));\n      }\n    "}}();function getSourceCoords(r,e){var t=r.length;if(t>4)throw Error("Gather for rank "+t+" is not yet supported");if(1===t)return"int(getIndices(resRC))";for(var s=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],n=0;n<r.length;n++)n===e?o.push("int(getIndices("+s[n]+"))"):o.push(""+s[n]);return o.join()}exports.GatherProgram=GatherProgram;

},{"./shader_compiler":146}],108:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),GatherNDProgram=function(){return function(e,t,r){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=r;var s=shader_compiler_1.getCoordsDataType(t.length),i=shader_compiler_1.getCoordsDataType(r.length),n=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+n+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "}}();exports.GatherNDProgram=GatherNDProgram;

},{"./shader_compiler":146}],109:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment");function getGlslDifferences(){var n,e,a,t,v,l,u,r,o,i;return 2===environment_1.env().getNumber("WEBGL_VERSION")?(n="#version 300 es",e="in",a="out",t="in",v="texture",l="outputColor",u="out vec4 outputColor;",r="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",o="",i="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(n="",e="attribute",a="varying",t="varying",v="texture2D",l="gl_FragColor",u="",r="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",o="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",i="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:n,attribute:e,varyingVs:a,varyingFs:t,texture2D:v,output:l,defineOutput:u,defineSpecialNaN:r,defineSpecialInf:o,defineRound:i}}exports.getGlslDifferences=getGlslDifferences;

},{"../../environment":164}],110:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(o,n){function u(t){try{l(i.next(t))}catch(t){n(t)}}function s(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(u,s)}l((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,i,o,n,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,i=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),canvas_util_1=require("./canvas_util"),gpgpu_util=require("./gpgpu_util"),tex_util=require("./tex_util"),webgl_util=require("./webgl_util"),GPGPUContext=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=environment_1.env().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,canvas_util_1.setWebGLContext(e,t)):this.gl=canvas_util_1.getWebGLContext(e);var r="WEBGL_color_buffer_float";if(1===environment_1.env().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=webgl_util.getExtensionOrThrow(this.gl,this.debug,"OES_texture_float"),webgl_util.hasExtension(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=webgl_util.getExtensionOrThrow(this.gl,this.debug,"OES_texture_half_float");else if(environment_1.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),webgl_util.hasExtension(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=webgl_util.getExtensionOrThrow(this.gl,this.debug,"EXT_color_buffer_half_float");else if(environment_1.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",webgl_util.hasExtension(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!webgl_util.hasExtension(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=gpgpu_util.createVertexBuffer(this.gl,this.debug),this.indexBuffer=gpgpu_util.createIndexBuffer(this.gl,this.debug),this.framebuffer=webgl_util.createFramebuffer(this.gl,this.debug),this.textureConfig=tex_util.getTextureConfig(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return environment_1.env().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;webgl_util.callAndCheck(e,this.debug,function(){return e.finish()}),webgl_util.callAndCheck(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),webgl_util.callAndCheck(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),webgl_util.callAndCheck(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),webgl_util.callAndCheck(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),webgl_util.callAndCheck(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),gpgpu_util.createFloat32MatrixTexture(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),gpgpu_util.createFloat16MatrixTexture(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),gpgpu_util.createUnsignedBytesMatrixTexture(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),gpgpu_util.uploadPixelDataToTexture(this.gl,this.debug,t,e)},t.prototype.uploadDenseMatrixToTexture=function(t,e,r,i){this.throwIfDisposed(),gpgpu_util.uploadDenseMatrixToTexture(this.gl,this.debug,t,e,r,i,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),gpgpu_util.createFloat16PackedMatrixTexture(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),gpgpu_util.createPackedMatrixTexture(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(webgl_util.unbindColorTextureFromFramebuffer(this.gl,this.debug,this.framebuffer),this.outputTexture=null),webgl_util.callAndCheck(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,r){var i=this;return this.downloadMatrixDriver(t,function(){return gpgpu_util.downloadByteEncodedFloatMatrixFromOutputTexture(i.gl,i.debug,e,r,i.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,r,i,o,n){return gpgpu_util.downloadPackedMatrixFromBuffer(this.gl,t,e,r,i,o,n,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return gpgpu_util.downloadFloat32MatrixFromBuffer(this.gl,t,e)},t.prototype.createBufferFromTexture=function(t,e,r){this.bindTextureToFrameBuffer(t);var i=gpgpu_util.createBufferFromOutputTexture(this.gl,this.debug,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,r,i=this;if(environment_1.env().getBool("WEBGL_FENCE_API_ENABLED")){var o=t,n=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var t=o.clientWaitSync(n,0,0);return t===o.ALREADY_SIGNALED||t===o.CONDITION_SATISFIED},e=n}else environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(e,environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,r){var i=this;return this.downloadMatrixDriver(t,function(){return gpgpu_util.downloadMatrixFromPackedOutputTexture(i.gl,i.debug,e,r)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=webgl_util.createFragmentShader(e,this.debug,t),i=gpgpu_util.createVertexShader(e,this.debug),o=webgl_util.createProgram(e,this.debug);return webgl_util.callAndCheck(e,this.debug,function(){return e.attachShader(o,i)}),webgl_util.callAndCheck(e,this.debug,function(){return e.attachShader(o,r)}),webgl_util.linkProgram(e,this.debug,o),this.debug&&webgl_util.validateProgram(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=gpgpu_util.bindVertexProgramAttributeStreams(e,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&webgl_util.callAndCheck(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&webgl_util.validateProgram(this.gl,this.debug,this.program),webgl_util.callAndCheck(this.gl,this.debug,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?webgl_util.getProgramUniformLocationOrThrow(this.gl,this.debug,t,e):webgl_util.getProgramUniformLocation(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),webgl_util.bindTextureToProgramUniformSampler(this.gl,this.debug,this.program,t,e,r)},t.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var i=tex_util.getPackedMatrixTextureShapeWidthHeight(e,r),o=i[0],n=i[1];this.setOutputMatrixTextureDriver(t,o,n)},t.prototype.setOutputMatrixWriteRegion=function(t,e,r,i){this.setOutputMatrixWriteRegionDriver(r,t,i,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&webgl_util.validateProgram(this.gl,this.debug,this.program),webgl_util.validateFramebuffer(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),webgl_util.callAndCheck(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,this.debug,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=webgl_util.getExtensionOrThrow(this.gl,this.debug,2===environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(r){switch(r.label){case 0:return[4,util.repeatedTry(function(){return e.disposed||e.isQueryAvailable(t,environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,environment_1.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(t,i.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},t.prototype.pollItems=function(){for(var t=linearSearchLastTrue(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e){(0,this.itemsToPoll[e].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||util.repeatedTry(function(){return r.pollItems(),0===r.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),webgl_util.bindColorTextureToFramebuffer(this.gl,this.debug,t,this.framebuffer),this.debug&&webgl_util.validateFramebuffer(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(webgl_util.bindColorTextureToFramebuffer(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&webgl_util.validateFramebuffer(this.gl)):webgl_util.unbindColorTextureFromFramebuffer(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var r=e();return this.unbindTextureToFrameBuffer(),r},t.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var i=this.gl;webgl_util.bindColorTextureToFramebuffer(i,this.debug,t,this.framebuffer),this.debug&&webgl_util.validateFramebuffer(i),this.outputTexture=t,webgl_util.callAndCheck(i,this.debug,function(){return i.viewport(0,0,e,r)}),webgl_util.callAndCheck(i,this.debug,function(){return i.scissor(0,0,e,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,i){var o=this;this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,this.debug,function(){return o.gl.scissor(t,e,r,i)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function linearSearchLastTrue(t){for(var e=0;e<t.length;++e){if(!t[e]())break}return e-1}exports.GPGPUContext=GPGPUContext,exports.linearSearchLastTrue=linearSearchLastTrue;

},{"../../environment":164,"../../util":294,"./canvas_util":83,"./gpgpu_util":112,"./tex_util":151,"./webgl_util":159}],111:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),shader_compiler=require("./shader_compiler");function compileProgram(e,a,r,t){var n=a.userCode,i=r.map(function(e,r){var t={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(t.flatOffset=e.texData.slice.flatOffset),{name:a.variableNames[r],shapeInfo:t}}),o=i.map(function(e){return e.shapeInfo}),f={logicalShape:t.shape,texShape:t.texData.texShape,isUniform:!1,isPacked:t.texData.isPacked,flatOffset:null},l=shader_compiler.makeShader(i,f,n,a.packedInputs),s=e.createProgram(l),u=null,m=e.getUniformLocation(s,"NAN",!1);1===environment_1.env().getNumber("WEBGL_VERSION")&&(u=e.getUniformLocation(s,"INFINITY",!1));for(var c={},h=0;h<a.variableNames.length;h++){var p=a.variableNames[h];c[p]=e.getUniformLocation(s,p,!1),c["offset"+p]=e.getUniformLocation(s,"offset"+p,!1)}return{program:a,source:l,webGLProgram:s,uniformLocations:c,inShapeInfos:o,outShapeInfo:f,infLoc:u,nanLoc:m}}function validateBinaryAndProgram(e,a){if(e.length!==a.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+a.length+" inputs");e.forEach(function(e,r){var t=e.logicalShape,n=a[r],i=n.shape;if(!util.arraysEqual(t,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+t+" and "+i+" must match");if(!e.isUniform||!n.isUniform){var o=e.texShape,f=n.isUniform?null:n.texData.texShape;if(!util.arraysEqual(o,f))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+f+" must match")}})}function runProgram(e,a,r,t,n){validateBinaryAndProgram(a.inShapeInfos,r),validateBinaryAndProgram([a.outShapeInfo],[t]);var i=t.texData.texture,o=t.texData.texShape;t.texData.isPacked?e.setOutputPackedMatrixTexture(i,o[0],o[1]):e.setOutputMatrixTexture(i,o[0],o[1]),e.setProgram(a.webGLProgram),1===environment_1.env().getNumber("WEBGL_VERSION")&&null!==a.infLoc&&e.gl.uniform1f(a.infLoc,1/0),null!==a.nanLoc&&e.gl.uniform1f(a.nanLoc,NaN),r.forEach(function(r,t){var n=a.program.variableNames[t],i=a.uniformLocations[n],o=a.uniformLocations["offset"+n];if(null!=i)if(r.isUniform)if(util.sizeFromShape(r.shape)<2)e.gl.uniform1f(i,r.uniformValues[0]);else{var f=r.uniformValues;f instanceof Float32Array||(f=new Float32Array(f)),e.gl.uniform1fv(i,f)}else null!=r.texData.slice&&null!=o&&e.gl.uniform1i(o,r.texData.slice.flatOffset),e.setInputMatrixTexture(r.texData.texture,i,t)}),null!=n&&n(e,a.webGLProgram),e.executeProgram()}function makeShaderKey(e,a,r){var t="";a.concat(r).forEach(function(e){var a=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,r=e.isUniform?"uniform":e.texData.texShape;t+=e.shape+"_"+r+"_"+a});var n=e.userCode,i=e.constructor.name;return i+="_"+t+"_"+n}exports.compileProgram=compileProgram,exports.runProgram=runProgram,exports.makeShaderKey=makeShaderKey;

},{"../../environment":164,"../../util":294,"./shader_compiler":146}],112:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),tex_util=require("./tex_util"),webgl_util=require("./webgl_util");function createVertexShader(e,t){var r=glsl_version_1.getGlslDifferences(),a=r.version+"\n    precision highp float;\n    "+r.attribute+" vec3 clipSpacePos;\n    "+r.attribute+" vec2 uv;\n    "+r.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }";return webgl_util.createVertexShader(e,t,a)}function createVertexBuffer(e,t){var r=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return webgl_util.createStaticVertexBuffer(e,t,r)}function createIndexBuffer(e,t){var r=new Uint16Array([0,1,2,2,1,3]);return webgl_util.createStaticIndexBuffer(e,t,r)}function createAndConfigureTexture(e,t,r,a,u,n,i){webgl_util.validateTextureSize(r,a);var l=webgl_util.createTexture(e,t),o=e.TEXTURE_2D;return webgl_util.callAndCheck(e,t,function(){return e.bindTexture(o,l)}),webgl_util.callAndCheck(e,t,function(){return e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),webgl_util.callAndCheck(e,t,function(){return e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),webgl_util.callAndCheck(e,t,function(){return e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST)}),webgl_util.callAndCheck(e,t,function(){return e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST)}),webgl_util.callAndCheck(e,t,function(){return e.texImage2D(o,0,u,r,a,0,n,i,null)}),webgl_util.callAndCheck(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),l}function createFloat32MatrixTexture(e,t,r,a,u){var n=tex_util.getUnpackedMatrixTextureShapeWidthHeight(r,a);return createAndConfigureTexture(e,t,n[0],n[1],u.internalFormatFloat,u.textureFormatFloat,e.FLOAT)}function createFloat16MatrixTexture(e,t,r,a,u){var n=tex_util.getUnpackedMatrixTextureShapeWidthHeight(r,a);return createAndConfigureTexture(e,t,n[0],n[1],u.internalFormatHalfFloat,u.textureFormatFloat,u.textureTypeHalfFloat)}function createUnsignedBytesMatrixTexture(e,t,r,a,u){var n=tex_util.getUnpackedMatrixTextureShapeWidthHeight(r,a);return createAndConfigureTexture(e,t,n[0],n[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function createPackedMatrixTexture(e,t,r,a,u){var n=tex_util.getPackedMatrixTextureShapeWidthHeight(r,a);return createAndConfigureTexture(e,t,n[0],n[1],u.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function createFloat16PackedMatrixTexture(e,t,r,a,u){var n=tex_util.getPackedMatrixTextureShapeWidthHeight(r,a);return createAndConfigureTexture(e,t,n[0],n[1],u.internalFormatPackedHalfFloat,e.RGBA,u.textureTypeHalfFloat)}function bindVertexProgramAttributeStreams(e,t,r,a){return webgl_util.callAndCheck(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,a)}),webgl_util.bindVertexBufferToProgramAttribute(e,t,r,"clipSpacePos",a,3,20,0)&&webgl_util.bindVertexBufferToProgramAttribute(e,t,r,"uv",a,2,20,12)}function uploadDenseMatrixToTexture(e,t,r,a,u,n,i){var l,o,c;webgl_util.callAndCheck(e,t,function(){return e.bindTexture(e.TEXTURE_2D,r)}),n instanceof Uint8Array?(l=new Uint8Array(a*u*4),o=e.UNSIGNED_BYTE,c=e.RGBA):(l=new Float32Array(a*u*4),o=e.FLOAT,c=i.internalFormatPackedFloat),l.set(n),webgl_util.callAndCheck(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,c,a,u,0,e.RGBA,o,l)}),webgl_util.callAndCheck(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function uploadPixelDataToTexture(e,t,r,a){webgl_util.callAndCheck(e,t,function(){return e.bindTexture(e.TEXTURE_2D,r)}),a.data instanceof Uint8Array?webgl_util.callAndCheck(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,a.width,a.height,0,e.RGBA,e.UNSIGNED_BYTE,a.data)}):webgl_util.callAndCheck(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a)}),webgl_util.callAndCheck(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function createBufferFromOutputTexture(e,t,r,a,u){var n=e.createBuffer();webgl_util.callAndCheck(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,n)});var i=16*r*a;return webgl_util.callAndCheck(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)}),webgl_util.callAndCheck(e,t,function(){return e.readPixels(0,0,a,r,e.RGBA,e.FLOAT,0)}),webgl_util.callAndCheck(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),n}function downloadFloat32MatrixFromBuffer(e,t,r){var a=e,u=new Float32Array(r);return a.bindBuffer(a.PIXEL_PACK_BUFFER,t),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,u),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),u}function downloadByteEncodedFloatMatrixFromOutputTexture(e,t,r,a,u){var n=tex_util.getUnpackedMatrixTextureShapeWidthHeight(r,a),i=n[0],l=n[1],o=new Uint8Array(tex_util.getUnpackedArraySizeFromMatrixSize(r*a,4));return webgl_util.callAndCheck(e,t,function(){return e.readPixels(0,0,i,l,u.downloadTextureFormat,e.UNSIGNED_BYTE,o)}),new Float32Array(o.buffer)}function downloadPackedMatrixFromBuffer(e,t,r,a,u,n,i,l){var o=e,c=new Float32Array(tex_util.getPackedRGBAArraySizeFromMatrixShape(n,i));return o.bindBuffer(o.PIXEL_PACK_BUFFER,t),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,c),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),c}function downloadMatrixFromPackedOutputTexture(e,t,r,a){var u=new Float32Array(r*a*4);return webgl_util.callAndCheck(e,t,function(){return e.readPixels(0,0,a,r,e.RGBA,e.FLOAT,u)}),u}exports.createVertexShader=createVertexShader,exports.createVertexBuffer=createVertexBuffer,exports.createIndexBuffer=createIndexBuffer,exports.createFloat32MatrixTexture=createFloat32MatrixTexture,exports.createFloat16MatrixTexture=createFloat16MatrixTexture,exports.createUnsignedBytesMatrixTexture=createUnsignedBytesMatrixTexture,exports.createPackedMatrixTexture=createPackedMatrixTexture,exports.createFloat16PackedMatrixTexture=createFloat16PackedMatrixTexture,exports.bindVertexProgramAttributeStreams=bindVertexProgramAttributeStreams,exports.uploadDenseMatrixToTexture=uploadDenseMatrixToTexture,exports.uploadPixelDataToTexture=uploadPixelDataToTexture,exports.createBufferFromOutputTexture=createBufferFromOutputTexture,exports.downloadFloat32MatrixFromBuffer=downloadFloat32MatrixFromBuffer,exports.downloadByteEncodedFloatMatrixFromOutputTexture=downloadByteEncodedFloatMatrixFromOutputTexture,exports.downloadPackedMatrixFromBuffer=downloadPackedMatrixFromBuffer,exports.downloadMatrixFromPackedOutputTexture=downloadMatrixFromPackedOutputTexture;

},{"./glsl_version":109,"./tex_util":151,"./webgl_util":159}],113:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),Im2ColPackedProgram=function(){return function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var i=t.filterWidth,s=t.inChannels,o=t.strideWidth,r=t.strideHeight,d=t.padInfo,l=t.outWidth,a=t.dilationWidth,c=t.dilationHeight,f=t.dataFormat,u=d.left,m=d.top,h=s*i,p=glsl_version_1.getGlslDifferences(),v="channelsLast"===f,g=v?0:1,k=v?1:2,x="",D=0;D<=1;D++)for(var I=0;I<=1;I++)x+="\n          blockIndex = rc.y + "+I+";\n          pos = rc.x + "+D+";\n\n          if(blockIndex < "+n[1]+" && pos < "+n[0]+") {\n            offsetY = int(blockIndex / ("+l+")) * "+r+" - "+m+";\n            d0 = offsetY + "+c+" * (pos / "+h+");\n\n            if(d0 < "+e[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+l+".) * "+o+". - "+u+".);\n              d1 = offsetX + "+a+" * (int(mod(float(pos), "+h+".) / "+s+".));\n\n              if(d1 < "+e[k]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+s+".));\n\n                if ("+v+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*D+I)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*D+I)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+x+"\n\n        "+p.output+" = result;\n      }\n    "}}();exports.Im2ColPackedProgram=Im2ColPackedProgram;

},{"./glsl_version":109}],114:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../../../kernel_names"),Div_impl_1=require("./Div_impl");exports.divConfig={kernelName:kernel_names_1.Div,backendName:"webgl",kernelFunc:function(e){var r=e.inputs,n=e.backend,i=r,l=i.a,_=i.b,a=n;return Div_impl_1.divImpl(l,_,a)}};

},{"../../../kernel_names":188,"./Div_impl":115}],115:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../../environment"),binaryop_gpu=require("../binaryop_gpu"),binaryop_gpu_1=require("../binaryop_gpu"),binaryop_packed_gpu=require("../binaryop_packed_gpu"),binaryop_packed_gpu_1=require("../binaryop_packed_gpu");function divImpl(e,r,p){var a=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.DIV,e.shape,r.shape);return environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(a=new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.DIV,e.shape,r.shape,!0)),p.runWebGLProgram(a,[e,r],"float32")}exports.divImpl=divImpl;

},{"../../../environment":164,"../binaryop_gpu":81,"../binaryop_packed_gpu":82}],116:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var fromPixels2DContext,environment_1=require("../../../environment"),kernel_names_1=require("../../../kernel_names"),tex_util_1=require("../tex_util"),from_pixels_gpu_1=require("./FromPixels_utils/from_pixels_gpu"),from_pixels_packed_gpu_1=require("./FromPixels_utils/from_pixels_packed_gpu");function fromPixels(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.pixels,o=r.numChannels,a="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,l="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,s=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],m=s[0],x=s[1],_=[x,m],u=[x,m,o];(l||a)&&(null==fromPixels2DContext&&(fromPixels2DContext=document.createElement("canvas").getContext("2d")),fromPixels2DContext.canvas.width=m,fromPixels2DContext.canvas.height=x,fromPixels2DContext.drawImage(i,0,0,m,x),i=fromPixels2DContext.canvas);var d=n.makeTensorInfo(_,"int32");n.texData.get(d.dataId).usage=tex_util_1.TextureUsage.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),i);var f=environment_1.env().getBool("WEBGL_PACK")?new from_pixels_packed_gpu_1.FromPixelsPackedProgram(u):new from_pixels_gpu_1.FromPixelsProgram(u),p=n.runWebGLProgram(f,[d],"int32");return n.disposeData(d.dataId),p}exports.fromPixelsConfig={kernelName:kernel_names_1.FromPixels,backendName:"webgl",kernelFunc:fromPixels};

},{"../../../environment":164,"../../../kernel_names":188,"../tex_util":151,"./FromPixels_utils/from_pixels_gpu":117,"./FromPixels_utils/from_pixels_packed_gpu":118}],117:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("../../glsl_version"),FromPixelsProgram=function(){return function(e){this.variableNames=["A"];var n=glsl_version_1.getGlslDifferences(),t=e[0],s=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+s+".0, "+t+".0);\n\n        vec4 values = "+n.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}}();exports.FromPixelsProgram=FromPixelsProgram;

},{"../../glsl_version":109}],118:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("../../glsl_version"),FromPixelsPackedProgram=function(){return function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=glsl_version_1.getGlslDifferences(),o=e[0],t=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+t+".0, "+o+".0);\n            vec4 values = "+n.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+n.output+" = result;\n      }\n    "}}();exports.FromPixelsPackedProgram=FromPixelsPackedProgram;

},{"../../glsl_version":109}],119:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../../../kernel_names"),log_1=require("../../../log"),non_max_suppression_impl_1=require("../../non_max_suppression_impl");exports.nonMaxSuppressionV5Config={kernelName:kernel_names_1.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:function(e){var n=e.inputs,s=e.backend,r=e.attrs;log_1.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=n,a=o.boxes,i=o.scores,p=r,t=p.maxOutputSize,l=p.iouThreshold,u=p.scoreThreshold,_=p.softNmsSigma,d=s,c=d.readSync(a.dataId),m=d.readSync(i.dataId),x=t,S=l,k=u,g=_,b=non_max_suppression_impl_1.nonMaxSuppressionV5(c,m,x,S,k,g);return[b.selectedIndices,b.selectedScores]}};

},{"../../../kernel_names":188,"../../../log":190,"../../non_max_suppression_impl":67}],120:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../../../kernel_names"),unaryop_gpu_1=require("../unaryop_gpu");exports.squareConfig={kernelName:kernel_names_1.Square,backendName:"webgl",kernelFunc:function(e){var r=e.inputs,n=e.backend,a=r.x,u=n,p=new unaryop_gpu_1.UnaryOpProgram(a.shape,unaryop_gpu_1.SQUARE);return u.runWebGLProgram(p,[a],a.dtype)}};

},{"../../../kernel_names":188,"../unaryop_gpu":156}],121:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../../environment"),kernel_names_1=require("../../../kernel_names"),binaryop_gpu_1=require("../binaryop_gpu"),binaryop_packed_gpu_1=require("../binaryop_packed_gpu");exports.squaredDifferenceConfig={kernelName:kernel_names_1.SquaredDifference,backendName:"webgl",kernelFunc:function(e){var r=e.inputs,n=e.backend,a=r,p=a.a,_=a.b,i=n,u=environment_1.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram("return (a - b) * (a - b);",p.shape,_.shape):new binaryop_gpu_1.BinaryOpProgram("return (a - b) * (a - b);",p.shape,_.shape);return i.compileAndRun(u,[p,_])}};

},{"../../../environment":164,"../../../kernel_names":188,"../binaryop_gpu":81,"../binaryop_packed_gpu":82}],122:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LRNProgram=function(){return function(t,o,n,r,e){this.variableNames=["x"],this.outputShape=[];var i,s=o,a=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";i=.5===e?"inversesqrt("+u+")":1===e?"1.0/("+u+")":"exp(log("+u+") * float(-"+e+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+s+"; j <= "+s+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+i+";\n        setOutput(val);\n      }\n    "}}();exports.LRNProgram=LRNProgram;

},{}],123:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LRNGradProgram=function(){return function(n,t,e,i,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=t,this.bias=e,this.alpha=i,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+i+") * norm + float("+e+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+i+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "}}();exports.LRNGradProgram=LRNGradProgram;

},{}],124:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LRNPackedProgram=function(){return function(e,n,t,o,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var r,c=n,s=e[3]-1;this.outputShape=e;var u="float("+t+") + float("+o+") * sum";r=.5===a?"inversesqrt("+u+")":1===a?"1.0/("+u+")":"exp(log("+u+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+c+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+c+"; j <= "+c+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+r+";\n        setOutput(result);\n      }\n    "}}();exports.LRNPackedProgram=LRNPackedProgram;

},{}],125:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MaxPool2DBackpropProgram=function(){return function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.strideHeight,o=n.strideWidth,e=n.dilationHeight,i=n.effectiveFilterHeight,d=n.effectiveFilterWidth,r=i-1-n.padInfo.top,a=d-1-n.padInfo.left,s=i*d-1;this.userCode="\n      const ivec2 pads = ivec2("+r+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+e+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+s+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+d+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.MaxPool2DBackpropProgram=MaxPool2DBackpropProgram;var MaxPool3DBackpropProgram=function(){return function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.strideDepth,o=n.strideHeight,e=n.strideWidth,i=n.dilationDepth,d=n.dilationHeight,r=n.dilationWidth,a=n.effectiveFilterDepth,s=n.effectiveFilterHeight,y=n.effectiveFilterWidth,c=a-1-n.padInfo.front,l=s-1-n.padInfo.top,f=y-1-n.padInfo.left,u=a*s*y-1;this.userCode="\n      const ivec3 pads = ivec3("+c+", "+l+", "+f+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+a+";\n           wD += "+i+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+s+";\n              wR += "+d+") {\n            float dyR = float(dyRCorner + wR) / "+o+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+y+";\n                wC += "+r+") {\n              float dyC = float(dyCCorner + wC) / "+e+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+u+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+s+" * "+y+" +\n                  wR * "+y+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.MaxPool3DBackpropProgram=MaxPool3DBackpropProgram;

},{}],126:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MatMulPackedProgram=function(){return function(t,e,i,n,r,a,s){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a=null),void 0===s&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var o=i?t[1]:t[2],c=Math.ceil(o/2),u=i?"i * 2, rc.y":"rc.y, i * 2",v=n?"rc.z, i * 2":"i * 2, rc.z",l=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],x="",h="";a&&(x=s?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",h="result = activation(result);");var p=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const float sharedDimension = "+c+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+c+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+v+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+l[0]+" * "+d[0]+");\n          result += ("+l[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+p+"\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "}}();exports.MatMulPackedProgram=MatMulPackedProgram;

},{}],127:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MultinomialProgram=function(){function n(n,t,e){this.variableNames=["probs"],this.outputShape=[n,e],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n){var t=this;return function(e,o){null==t.seedLoc&&(t.seedLoc=e.getUniformLocation(o,"seed")),e.gl.uniform1f(t.seedLoc,n)}},n}();exports.MultinomialProgram=MultinomialProgram;

},{}],128:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var OneHotProgram=function(){return function(t,e,o,n){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+n+"), float("+o+"),\n                      float(index == coords.y)));\n      }\n    "}}();exports.OneHotProgram=OneHotProgram;

},{}],129:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),PackProgram=function(){return function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var r=packing_util_1.getChannels("rc",t),n=shader_compiler_1.getCoordsDataType(t),u=getOutOfBoundsCondition(t,e,r),o=getSetup(t,e[e.length-1],e[e.length-2],r),i=getOutput(e,r);this.userCode="\n        void main() {\n          "+n+" rc = getOutputCoords();\n\n          if("+u+") {\n            setOutput(vec4(0));\n          } else {\n            "+o+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}}}();function getSourceCoordsArr(e,t){for(var r=[],n=0;n<=1;n++)for(var u=0;u<=1;u++){for(var o=(0===n?"r":"rp1")+", "+(0===u?"c":"cp1"),i=2;i<e;i++)o=t[t.length-1-i]+","+o;r.push(o)}return r}function getOutOfBoundsCondition(e,t,r){if(1===e)return"rc > "+t[0];for(var n="",u=e-2;u<e;u++)n+=r[u]+" >= "+t[u],u<e-1&&(n+="||");return n}function getSetup(e,t,r,n){if(1===e)return"";var u=n.slice(-2);return"\n    int r = "+u[0]+";\n    int c = "+u[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+r+";\n  "}function getOutput(e,t){var r=e.length,n=getSourceCoordsArr(r,t);return 1===r?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+n[0]+"),\n          cEdge ? 0. : getA("+n[1]+"),\n          rEdge ? 0. : getA("+n[2]+"),\n          rEdge || cEdge ? 0. : getA("+n[3]+")"}exports.PackProgram=PackProgram;

},{"../packing_util":68,"./shader_compiler":146}],130:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),PadProgram=function(){return function(t,n,e){this.variableNames=["x"],this.outputShape=n.map(function(n,e){return n[0]+t[e]+n[1]});var o=t.length,r=shader_compiler_1.getCoordsDataType(o),a=n.map(function(t){return t[0]}).join(","),u=n.map(function(n,e){return n[0]+t[e]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);this.userCode=1!==o?"\n      "+r+" start = "+r+"("+a+");\n      "+r+" end = "+r+"("+u+");\n\n      void main() {\n        "+r+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+e+"));\n        } else {\n          "+r+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+u+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+e+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "}}();exports.PadProgram=PadProgram;

},{"./shader_compiler":146}],131:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),PadPackedProgram=function(){return function(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});for(var r=t.length,a=shader_compiler_1.getCoordsDataType(r),u=e.map(function(t){return t[0]}).join(","),o=e.map(function(e,n){return e[0]+t[n]}).join(","),s=packing_util_1.getChannels("rc",r),c=packing_util_1.getChannels("source",r),i=s[r-1]+" < "+this.outputShape[r-1],p=1===r?"source":"vec2("+c.slice(-2).join()+")",l=[a+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+i+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+i+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",g=0,_=1===r?2:4;g<_;g++)h+="\n        "+l[g]+"\n        if ("+d+") {\n          result["+g+"] = float("+n+");\n        } else {\n          "+a+" source = rc - start;\n          result["+g+"] = getChannel(getX("+c.join()+"), "+p+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+a+" start = "+a+"("+u+");\n      const "+a+" end = "+a+"("+o+");\n\n      void main() {\n        "+a+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "}}();exports.PadPackedProgram=PadPackedProgram;

},{"../packing_util":68,"./shader_compiler":146}],132:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Pool2DProgram=function(){return function(n,e,i){if(this.variableNames=["x"],"avg"===e&&i)throw new Error("Cannot compute positions for average pool.");var t=n.filterWidth,a=n.strideHeight,o=n.strideWidth,r=n.dilationHeight,x=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=n.padInfo.top,s=n.padInfo.left;this.outputShape=n.outShape;var C="avg"===e,d="0.0";if(C||(d="-1.0 / 1e-20"),i)this.userCode="\n        const ivec2 strides = ivec2("+a+", "+o+");\n        const ivec2 pads = ivec2("+c+", "+s+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+r+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+x+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var v=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(v="avgValue / count");var h=4*Math.floor(t/4),f=t%4,V="\n      if ("+C+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+o+");\n      const ivec2 pads = ivec2("+c+", "+s+");\n      const float initializationValue = "+d+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+d+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+r+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC += 4) {\n            int xC = xCCorner + wC * "+x+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+x+", d),\n              getValue(batch, xR, xC + 2 * "+x+", d),\n              getValue(batch, xR, xC + 3 * "+x+", d)\n            );\n\n            "+V+"\n          }\n\n          int xC = xCCorner + "+h+";\n          if ("+(1===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+V+"\n          } else if ("+(2===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+x+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+V+"\n          } else if ("+(3===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+x+", d),\n              getValue(batch, xR, xC + 2 * "+x+", d),\n              initializationValue\n            );\n\n            "+V+"\n          }\n        }\n        setOutput("+v+");\n      }\n    "}}}();exports.Pool2DProgram=Pool2DProgram;var Pool3DProgram=function(){return function(n,e,i){if(this.variableNames=["x"],"avg"===e&&i)throw new Error("Cannot compute positions for average pool.");var t=n.filterWidth,a=n.strideDepth,o=n.strideHeight,r=n.strideWidth,x=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,s=n.effectiveFilterHeight,C=n.effectiveFilterWidth,d=n.padInfo.front,v=n.padInfo.top,h=n.padInfo.left;this.outputShape=n.outShape;var f="avg"===e,V="0.0";if(f||(V="-1.0 / 1e-20"),i)this.userCode="\n        const ivec3 strides =\n            ivec3("+a+", "+o+", "+r+");\n        const ivec3 pads = ivec3("+d+", "+v+", "+h+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+c+";\n              wD += "+x+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+s+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+C+";\n                  wC += "+l+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+s+" * "+C+" +\n                      wR * "+C+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var R=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(R="avgValue / count");var m=4*Math.floor(t/4),g=t%4,w="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+a+", "+o+", "+r+");\n      const ivec3 pads = ivec3("+d+", "+v+", "+h+");\n      const float initializationValue = "+V+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+V+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+x+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+s+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+m+"; wC += 4) {\n              int xC = xCCorner + wC * "+l+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+l+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+m+";\n            if ("+(1===g)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===g)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===g)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+R+");\n        }\n      }\n    "}}}();exports.Pool3DProgram=Pool3DProgram;

},{}],133:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ReduceProgram=function(){return function(n,e){this.variableNames=["x"];var a=n.windowSize,l=n.batchSize,i=n.inSize,t=Math.ceil(i/a);this.outputShape=[l,t];var u="0.0",o="";"prod"===e?u="1.0":"min"===e?(u="1.0 / 1e-20",o="min"):"max"===e&&(u="-1.0 / 1e-20",o="max");var d=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?d="sumValue":"prod"===e?d="prodValue":"all"===e?d="allValue":"any"===e&&(d="anyValue");var V=4*Math.floor(a/4),c=a%4,s="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+o+"(values, minMaxValue);\n      }\n    ",r="vec4";"all"===e?(u="1.0",s="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",r="bvec4"):"any"===e&&(u="0.0",s="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",r="bvec4");var f="";i%a>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+u+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+a+";\n\n        vec4 minMaxValue = vec4("+u+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+V+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+r+" values = "+r+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+s+"\n        }\n\n        int inIdx = inOffset + "+V+";\n        if ("+(1===c)+") {\n          "+r+" values = "+r+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+s+"\n        } else if ("+(2===c)+") {\n          "+r+" values = "+r+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+s+"\n        } else if ("+(3===c)+") {\n          "+r+" values = "+r+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+s+"\n        }\n        setOutput("+d+");\n      }\n    "}}();exports.ReduceProgram=ReduceProgram;

},{}],134:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});for(var kernel_registry_1=require("../../kernel_registry"),Div_1=require("./kernels/Div"),FromPixels_1=require("./kernels/FromPixels"),NonMaxSuppressionV5_1=require("./kernels/NonMaxSuppressionV5"),Square_1=require("./kernels/Square"),SquaredDifference_1=require("./kernels/SquaredDifference"),kernelConfigs=[FromPixels_1.fromPixelsConfig,Div_1.divConfig,NonMaxSuppressionV5_1.nonMaxSuppressionV5Config,Square_1.squareConfig,SquaredDifference_1.squaredDifferenceConfig],_i=0,kernelConfigs_1=kernelConfigs;_i<kernelConfigs_1.length;_i++){var kernelConfig=kernelConfigs_1[_i];kernel_registry_1.registerKernel(kernelConfig)}

},{"../../kernel_registry":189,"./kernels/Div":114,"./kernels/FromPixels":116,"./kernels/NonMaxSuppressionV5":119,"./kernels/Square":120,"./kernels/SquaredDifference":121}],135:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_util=require("./shader_compiler_util"),ReshapePackedProgram=function(){return function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      "+getReshapedInputCoords(t)+"\n      "+shader_util.getFlatIndexFrom3D(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "}}();function getReshapedInputCoords(e){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  "}exports.ReshapePackedProgram=ReshapePackedProgram;

},{"./shader_compiler_util":147}],136:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResizeBilinearBackpropProgram=function(){return function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var o=t.shape,i=o[1],d=o[2],r=n.shape,a=r[1],f=r[2],l=[e&&a>1?i-1:i,e&&f>1?d-1:d],s=[e&&a>1?a-1:a,e&&f>1?f-1:f],x=l[0]/s[0],c=l[1]/s[1],p=1/x,y=1/c,R=2*Math.ceil(p)+2,h=2*Math.ceil(y)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+x+");\n        const float widthScale = float("+c+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+y+");\n\n        const int winHeight = int("+R+");\n        const int winWidth = int("+h+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+a+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+f+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(d-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}}();exports.ResizeBilinearBackpropProgram=ResizeBilinearBackpropProgram;

},{}],137:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResizeBilinearProgram=function(){return function(e,o,t,n){this.variableNames=["A"],this.outputShape=[];var r=e[0],c=e[1],i=e[2],u=e[3];this.outputShape=[r,o,t,u];var a=[n&&o>1?c-1:c,n&&t>1?i-1:i],s=[n&&o>1?o-1:o,n&&t>1?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+c+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}}();exports.ResizeBilinearProgram=ResizeBilinearProgram;

},{}],138:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResizeBilinearPackedProgram=function(){return function(e,o,n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var c=e[0],r=e[1],u=e[2],l=e[3];this.outputShape=[c,o,n,l];var s=[t&&o>1?r-1:r,t&&n>1?u-1:u],a=[t&&o>1?o-1:o,t&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+s[0]/a[0]+",\n          "+s[1]/a[1]+",\n          "+s[1]/a[1]+");\n      const vec3 inputShapeRC = vec3("+r+".0, "+u+".0,\n                                     "+u+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(l-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "}}();exports.ResizeBilinearPackedProgram=ResizeBilinearPackedProgram;

},{}],139:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResizeNearestNeigborBackpropProgram=function(){return function(t,n,o){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var e=n.shape,a=e[1],r=e[2],i=t.shape,s=i[1],f=i[2],l=[o&&s>1?a-1:a,o&&f>1?r-1:r],c=[o&&s>1?s-1:s,o&&f>1?f-1:f],d=l[0]/c[0],u=l[1]/c[1],y=1/d,h=1/u,p=2*Math.ceil(y)+2,C=2*Math.ceil(h)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+u+");\n\n        const float invHeightScale = float("+y+");\n        const float invWidthScale = float("+h+");\n\n        const int winHeight = int("+p+");\n        const int winWidth = int("+C+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+f+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+a+") - 1),\n                "+o+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+r+") - 1),\n                "+o+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}}();exports.ResizeNearestNeigborBackpropProgram=ResizeNearestNeigborBackpropProgram;

},{}],140:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResizeNearestNeighborProgram=function(){return function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],s=e[1],i=e[2],a=e[3];this.outputShape=[o,t,n,a];var c=[r&&t>1?s-1:s,r&&n>1?i-1:i],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],v=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+s+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+v+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "}}();exports.ResizeNearestNeighborProgram=ResizeNearestNeighborProgram;

},{}],141:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),ReverseProgram=function(){return function(e,r){this.variableNames=["x"];var o=e.length;if(o>4)throw new Error("WebGL backend: Reverse of rank-"+o+" tensor is not yet supported");if(this.outputShape=e,1!==o){var t=e.map(function(o,t){return function(o){return-1!==r.indexOf(o)&&1!==e[o]?e[o]+" - coords["+o+"] - 1":"coords["+o+"]"}(t)}).join(","),n=shader_compiler_1.getCoordsDataType(o);this.userCode="\n      void main() {\n        "+n+" coords = getOutputCoords();\n        setOutput(getX("+t+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "}}();exports.ReverseProgram=ReverseProgram;

},{"./shader_compiler":146}],142:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),ReversePackedProgram=function(){return function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=packing_util_1.getChannels("rc",n),u=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],s=shader_compiler_1.getCoordsDataType(n);function c(n){var r=e.map(function(r,u){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(u,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+u+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+s+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return c(e)}(r.slice())+";\n          if("+u+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",c(e)}(r.slice())+";\n          }\n          if("+i+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",c(e)}(r.slice())+";\n            if("+u+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",c(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "}}();exports.ReversePackedProgram=ReversePackedProgram;

},{"../packing_util":68,"./shader_compiler":146}],143:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),ScatterProgram=function(){return function(e,t,n,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var d=shader_compiler_1.getCoordsDataType(o.length),s=shader_compiler_1.getCoordsDataType(i.length),u="";1===n?u="i":2===n&&(u="i, j");var l="getIndices("+u+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var c="getUpdates("+f+")",p=t>1?"strides[j]":"strides";this.userCode="\n        "+d+" strides = "+d+"("+o+");\n\n        void main() {\n          "+s+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+p+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+c+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "}}();exports.ScatterProgram=ScatterProgram;

},{"./shader_compiler":146}],144:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SegmentOpProgram=function(){return function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,i=n.batchSize,a=n.inSize,d=n.numSegments,g=d*Math.ceil(a/t);this.outputShape=[i,g];var u=4*Math.floor(t/4),r=t%4,I="\n        sumValue += dot(values, segFilter);\n    ",l="";a%t>0&&(l="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      ");var c="";a%t>0&&(c="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+c+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+d+")) * float("+t+"));\n        int currentSeg = int(mod(float(outIdx), float("+d+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+u+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+I+"\n        }\n\n        int inIdx = inOffset + "+u+";\n        if ("+(1===r)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+I+"\n        } else if ("+(2===r)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+I+"\n        } else if ("+(3===r)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+I+"\n        }\n        setOutput(sumValue);\n      }\n    "}}();exports.SegmentOpProgram=SegmentOpProgram;

},{}],145:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),SelectProgram=function(){return function(e,r,t){var s,o;if(this.variableNames=["c","a","b"],this.outputShape=r,t>4)throw Error("Where for rank "+t+" is not yet supported");if(1===t)o="resRC",s="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],i=[],u=0;u<r.length;u++)i.push(""+a[u]),u<e&&n.push(""+a[u]);s=n.join(),o=i.join()}var p=shader_compiler_1.getCoordsDataType(t);this.userCode="\n      void main() {\n        "+p+" resRC = getOutputCoords();\n        float cVal = getC("+s+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "}}();exports.SelectProgram=SelectProgram;

},{"./shader_compiler":146}],146:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util_1=require("../../ops/broadcast_util"),util=require("../../util"),glsl_version_1=require("./glsl_version"),shader_util=require("./shader_compiler_util");function makeShader(e,n,t,r){var o=[];e.forEach(function(e){var n=util.sizeFromShape(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float "+e.name+(n>1?"["+n+"]":"")+";"):(o.push("uniform sampler2D "+e.name+";"),o.push("uniform int offset"+e.name+";"))});var i,a,u=o.join("\n"),l=e.map(function(e){return getInputSamplingSnippet(e,n,r)}).join("\n"),c=n.texShape,p=glsl_version_1.getGlslDifferences(),s=getFloatTextureSampleSnippet(p),d=getShaderPrefix(p);return n.isPacked?(i=getPackedOutputSamplingSnippet(n.logicalShape,c),a=getFloatTextureSetRGBASnippet(p)):(i=getOutputSamplingSnippet(n.logicalShape,c),a=getFloatTextureSetRSnippet(p)),r&&(d+=SHADER_PACKED_PREFIX),[d,s,a,u,i,l,t].join("\n")}function getSamplerFromInInfo(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return getSamplerScalar(e);case 1:return getSampler1D(e);case 2:return getSampler2D(e);case 3:return getSampler3D(e);case 4:return getSampler4D(e);case 5:return getSampler5D(e);case 6:return getSampler6D(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function getPackedSamplerFromInInfo(e){switch(e.shapeInfo.logicalShape.length){case 0:return getPackedSamplerScalar(e);case 1:return getPackedSampler1D(e);case 2:return getPackedSampler2D(e);case 3:return getPackedSampler3D(e);default:return getPackedSamplerND(e)}}function getInputSamplingSnippet(e,n,t){void 0===t&&(t=!1);var r="";r+=t?getPackedSamplerFromInInfo(e):getSamplerFromInInfo(e);var o=e.shapeInfo.logicalShape,i=n.logicalShape;return o.length<=i.length&&(r+=t?getPackedSamplerAtOutputCoords(e,n):getSamplerAtOutputCoords(e,n)),r}function getPackedOutputSamplingSnippet(e,n){switch(e.length){case 0:return getOutputScalarCoords();case 1:return getOutputPacked1DCoords(e,n);case 2:return getOutputPacked2DCoords(e,n);case 3:return getOutputPacked3DCoords(e,n);default:return getOutputPackedNDCoords(e,n)}}function getOutputSamplingSnippet(e,n){switch(e.length){case 0:return getOutputScalarCoords();case 1:return getOutput1DCoords(e,n);case 2:return getOutput2DCoords(e,n);case 3:return getOutput3DCoords(e,n);case 4:return getOutput4DCoords(e,n);case 5:return getOutput5DCoords(e,n);case 6:return getOutput6DCoords(e,n);default:throw new Error(e.length+"-D output sampling is not yet supported")}}function getFloatTextureSampleSnippet(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}function getFloatTextureSetRSnippet(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}function getFloatTextureSetRGBASnippet(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}function getShaderPrefix(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+SAMPLE_1D_SNIPPET+"\n    "+SAMPLE_2D_SNIPPET+"\n    "+SAMPLE_3D_SNIPPET+"\n  "}exports.makeShader=makeShader;var SAMPLE_1D_SNIPPET="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SAMPLE_2D_SNIPPET="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SAMPLE_3D_SNIPPET="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SHADER_PACKED_PREFIX="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function getOutputScalarCoords(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function getOutputPacked1DCoords(e,n){var t=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];return 1===t[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return 2 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n    }\n  "}function getOutput1DCoords(e,n){return 1===n[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return resTexRC.x * "+n[1]+" + resTexRC.y;\n    }\n  "}function getOutputPacked3DCoords(e,n){var t=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(e[2]/2),o=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}function getOutput3DCoords(e,n){var t=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+t+"\n      return ivec3(r, c, d);\n    }\n  "}function getOutputPackedNDCoords(e,n){for(var t=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),i=o,a="",u="b, r, c",l=2;l<e.length-1;l++)a="\n      int b"+l+" = index / "+(i*=e[e.length-l-1])+";\n      index -= b"+l+" * "+i+";\n    "+a,u="b"+l+", "+u;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+u+");\n    }\n  "}function getOutput4DCoords(e,n){var t=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+t+"\n      return ivec4(r, c, d, d2);\n    }\n  "}function getOutput5DCoords(e,n){var t=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+n[0]+",\n                             "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+t+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}function getOutput6DCoords(e,n){var t=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+t+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}function getOutputPacked2DCoords(e,n){var t=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];if(util.arraysEqual(e,n))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}function getOutput2DCoords(e,n){return util.arraysEqual(e,n)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+n[0]+", "+n[1]+"));\n        int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+n[0]+", "+n[1]+"));\n        int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}function getFlatOffsetUniformName(e){return"offset"+e}function getPackedSamplerScalar(e){var n=e.name;return"\n    vec4 "+("get"+n.charAt(0).toUpperCase()+n.slice(1))+"() {\n      return "+glsl_version_1.getGlslDifferences().texture2D+"("+n+", halfCR);\n    }\n  "}function getSamplerScalar(e){var n=e.name,t="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float "+t+"() {return "+n+";}";var r=e.shapeInfo.texShape,o=r[0],i=r[1];if(1===o&&1===i)return"\n      float "+t+"() {\n        return sampleTexture("+n+", halfCR);\n      }\n    ";var a=e.shapeInfo.texShape;return"\n    float "+t+"() {\n      vec2 uv = uvFromFlat("+a[0]+", "+a[1]+", "+getFlatOffsetUniformName(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}function getPackedSampler1D(e){var n=e.name,t="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=glsl_version_1.getGlslDifferences();return"\n    vec4 "+t+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+i.texture2D+"("+n+", uv);\n    }\n  "}function getSampler1D(e){var n=e.name,t="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+t+"(int index) {\n        "+getUniformSampler(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,o=r[0],i=r[1];if(1===i&&1===o)return"\n      float "+t+"(int index) {\n        return sampleTexture("+n+", halfCR);\n      }\n    ";var a=getFlatOffsetUniformName(n);return 1===i?"\n      float "+t+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+o+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":1===o?"\n      float "+t+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+t+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+i+", index + "+a+");\n      return sampleTexture("+n+", uv);\n    }\n  "}function getPackedSampler2D(e){var n=e.shapeInfo.logicalShape,t=e.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=e.shapeInfo.texShape,i=o[0],a=o[1],u=glsl_version_1.getGlslDifferences();if(null!=o&&util.arraysEqual(n,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+i+".0);\n\n        return "+u.texture2D+"("+t+", uv);\n      }\n    ";var l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(n[1]/2)+", "+l[0]+", "+l[1]+", row, col);\n      return "+u.texture2D+"("+t+", uv);\n    }\n  "}function getSampler2D(e){var n=e.shapeInfo.logicalShape,t=e.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=e.shapeInfo.texShape;if(null!=o&&util.arraysEqual(n,o)){var i=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+i+".0);\n      return sampleTexture("+t+", uv);\n    }\n  "}var a=util.squeezeShape(n),u=a.newShape,l=a.keptDims,c=u;if(c.length<n.length){return"\n      "+getSamplerFromInInfo(squeezeInputInfo(e,c))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+getSqueezedParams(["row","col"],l)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+getUniformSampler(e)+"\n      }\n    ";var p=o[0],s=o[1],d=getFlatOffsetUniformName(t);return 1===s?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+p+".0);\n      return sampleTexture("+t+", uv);\n    }\n  ":1===p?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+s+".0, 0.5);\n      return sampleTexture("+t+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+p+", "+s+", index);\n    return sampleTexture("+t+", uv);\n  }\n"}function getPackedSampler3D(e){var n=e.shapeInfo.logicalShape,t=e.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=e.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===n[0]){return"\n        "+getPackedSamplerFromInInfo(squeezeInputInfo(e,n.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+getSqueezedParams(["b","row","col"],[1,2])+");\n        }\n      "}var a=i[0],u=i[1],l=Math.ceil(n[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+a+", "+u+", "+l*Math.ceil(n[1]/2)+", "+l+", b, row, col);\n      return "+glsl_version_1.getGlslDifferences().texture2D+"("+t+", uv);\n    }\n  "}function getSampler3D(e){var n=e.shapeInfo.logicalShape,t=e.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=n[1]*n[2],i=n[2],a=util.squeezeShape(n),u=a.newShape,l=a.keptDims,c=u;if(c.length<n.length){return"\n        "+getSamplerFromInInfo(squeezeInputInfo(e,c))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+getSqueezedParams(["row","col","depth"],l)+");\n        }\n      "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+i+", 1)));\n        "+getUniformSampler(e)+"\n      }\n    ";var p=e.shapeInfo.texShape,s=p[0],d=p[1],f=e.shapeInfo.flatOffset;return d===o&&null==f?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+i+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+s+".0);\n          return sampleTexture("+t+", uv);\n        }\n      ":d===i&&null==f?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+s+".0);\n      return sampleTexture("+t+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+i+" + depth + "+getFlatOffsetUniformName(t)+";\n        vec2 uv = uvFromFlat("+s+", "+d+", index);\n        return sampleTexture("+t+", uv);\n      }\n  "}function getPackedSamplerND(e){for(var n=e.shapeInfo.logicalShape,t=n.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=a[0],l=a[1],c=Math.ceil(n[t-1]/2),p=c*Math.ceil(n[t-2]/2),s="int b, int row, int col",d="b * "+p+" + (row / 2) * "+c+" + (col / 2)",f=2;f<t-1;f++)s="int b"+f+", "+s,d="b"+f+" * "+(p*=n[t-f-1])+" + "+d;return"\n    vec4 "+o+"("+s+") {\n      int index = "+d+";\n      int texR = index / "+l+";\n      int texC = index - texR * "+l+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+l+", "+u+");\n      return "+glsl_version_1.getGlslDifferences().texture2D+"("+r+", uv);\n    }\n  "}function getSampler4D(e){var n=e.shapeInfo.logicalShape,t=e.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=n[3],i=n[2]*o,a=n[1]*i,u=util.squeezeShape(n),l=u.newShape,c=u.keptDims;if(l.length<n.length){return"\n      "+getSamplerFromInInfo(squeezeInputInfo(e,l))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+getSqueezedParams(["row","col","depth","depth2"],c)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+a+", "+i+", "+o+", 1)));\n        "+getUniformSampler(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,s=e.shapeInfo.texShape,d=s[0],f=s[1];return f===a&&null==p?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+i+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+d+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":f===o&&null==p?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+d+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+a+" + col * "+i+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+f+", index + "+getFlatOffsetUniformName(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}function getSampler5D(e){var n=e.shapeInfo.logicalShape,t=e.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=n[4],i=n[3]*o,a=n[2]*i,u=n[1]*a,l=util.squeezeShape(n),c=l.newShape,p=l.keptDims;if(c.length<n.length){return"\n      "+getSamplerFromInInfo(squeezeInputInfo(e,c))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+getSqueezedParams(["row","col","depth","depth2","depth3"],p)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+a+", "+i+", "+o+")) +\n          depth3;\n        "+getUniformSampler(e)+"\n      }\n    ";var s=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,f=d[0],h=d[1];return h===u&&null==s?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+a+", "+i+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+f+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":h===o&&null==s?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+f+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+a+" + depth * "+i+" +\n          depth2 * "+o+" + depth3 + "+getFlatOffsetUniformName(t)+";\n      vec2 uv = uvFromFlat("+f+", "+h+", index);\n      return sampleTexture("+t+", uv);\n    }\n  "}function getSampler6D(e){var n=e.shapeInfo.logicalShape,t=e.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=util.squeezeShape(n),i=o.newShape,a=o.keptDims;if(i.length<n.length){return"\n      "+getSamplerFromInInfo(squeezeInputInfo(e,i))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+getSqueezedParams(["row","col","depth","depth2","depth3","depth4"],a)+");\n      }\n    "}var u=n[5],l=n[4]*u,c=n[3]*l,p=n[2]*c,s=n[1]*p;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+p+", "+c+", "+l+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+u+", 1)));\n        "+getUniformSampler(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],v=f[1];return v===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+p+", "+c+", "+l+", "+u+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+h+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":v===u&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+h+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+p+" + depth * "+c+" +\n          depth2 * "+l+" + depth3 * "+u+" + depth4 + "+getFlatOffsetUniformName(t)+";\n      vec2 uv = uvFromFlat("+h+", "+v+", index);\n      return sampleTexture("+t+", uv);\n    }\n  "}function getUniformSampler(e){var n=e.name,t=util.sizeFromShape(e.shapeInfo.logicalShape);return t<2?"return "+n+";":"\n    for (int i = 0; i < "+t+"; i++) {\n      if (i == index) {\n        return "+n+"[i];\n      }\n    }\n  "}function getPackedSamplerAtOutputCoords(e,n){var t,r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),i="get"+o+"AtOutCoords",a=e.shapeInfo.logicalShape.length,u=n.logicalShape.length,l=broadcast_util_1.getBroadcastDims(e.shapeInfo.logicalShape,n.logicalShape),c=getCoordsDataType(u),p=u-a,s=["x","y","z","w","u","v"];t=0===a?"":u<2&&l.length>=1?"coords = 0;":l.map(function(e){return"coords."+s[e+p]+" = 0;"}).join("\n");var d="";d=u<2&&a>0?"coords":e.shapeInfo.logicalShape.map(function(e,n){return"coords."+s[n+p]}).join(", ");var f="return outputValue;",h=1===util.sizeFromShape(e.shapeInfo.logicalShape),v=1===util.sizeFromShape(n.logicalShape);if(1!==a||h||v){if(h&&!v)f=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(l.length){var x=a-2,g=a-1;l.indexOf(x)>-1&&l.indexOf(g)>-1?f="return vec4(outputValue.x);":l.indexOf(x)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(g)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+i+"() {\n      "+c+" coords = getOutputCoords();\n      "+t+"\n      vec4 outputValue = get"+o+"("+d+");\n      "+f+"\n    }\n  "}function getSamplerAtOutputCoords(e,n){var t=e.name,r=t.charAt(0).toUpperCase()+t.slice(1),o="get"+r+"AtOutCoords",i=n.texShape,a=e.shapeInfo.texShape,u=e.shapeInfo.logicalShape.length,l=n.logicalShape.length;if(!e.shapeInfo.isUniform&&u===l&&null==e.shapeInfo.flatOffset&&util.arraysEqual(a,i))return"\n      float "+o+"() {\n        return sampleTexture("+t+", resultUV);\n      }\n    ";var c=getCoordsDataType(l),p=broadcast_util_1.getBroadcastDims(e.shapeInfo.logicalShape,n.logicalShape),s=l-u,d=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+(0===u?"":l<2&&p.length>=1?"coords = 0;":p.map(function(e){return"coords."+d[e+s]+" = 0;"}).join("\n"))+"\n      return get"+r+"("+(l<2&&u>0?"coords":e.shapeInfo.logicalShape.map(function(e,n){return"coords."+d[n+s]}).join(", "))+");\n    }\n  "}function getCoordsDataType(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function squeezeInputInfo(e,n){var t=JSON.parse(JSON.stringify(e));return t.shapeInfo.logicalShape=n,t}function getSqueezedParams(e,n){return n.map(function(n){return e[n]}).join(", ")}exports.getCoordsDataType=getCoordsDataType;

},{"../../ops/broadcast_util":199,"../../util":294,"./glsl_version":109,"./shader_compiler_util":147}],147:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../../util");function getLogicalCoordinatesFromFlatIndex(n,e,t){void 0===t&&(t="index");var o=util.computeStrides(e);return o.map(function(e,r){return"int "+n[r]+" = "+t+" / "+e+"; "+(r===o.length-1?"int "+n[r+1]+" = "+t+" - "+n[r]+" * "+e:"index -= "+n[r]+" * "+e)+";"}).join("")}function buildVec(n){return 1===n.length?""+n[0]:"vec"+n.length+"("+n.join(",")+")"}function dotify(n,e){if(n.length!==e.length)throw new Error("Vectors to be dotted must be of the same length -got "+n.length+" and "+e.length);for(var t=[],o=Math.floor(n.length/4),r=n.length%4,i=0;i<o;i++){var l=n.slice(4*i,4*i+4),c=e.slice(4*i,4*i+4);t.push(buildVec(l)+", "+buildVec(c))}if(0!==r){l=n.slice(4*o),c=e.slice(4*o);1===l.length&&(l=l.map(function(n){return"float("+n+")"}),c=c.map(function(n){return"float("+n+")"})),t.push(buildVec(l)+", "+buildVec(c))}return t.map(function(n,e){return"dot("+n+")"}).join("+")}function getFlatIndexFrom3D(n){var e=util.computeStrides(n).map(function(n){return n.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}exports.getLogicalCoordinatesFromFlatIndex=getLogicalCoordinatesFromFlatIndex,exports.dotify=dotify,exports.getFlatIndexFrom3D=getFlatIndexFrom3D,exports.ENCODE_FLOAT_SNIPPET="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";

},{"../../util":294}],148:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),SliceProgram=function(){function r(r){this.variableNames=["source"],this.outputShape=r,this.rank=r.length;var t,o=shader_compiler_1.getCoordsDataType(this.rank),e="uniform int start["+this.rank+"];",n=getCoords(this.rank);t="\n        "+o+" sourceLoc;\n        "+o+" coords = getOutputCoords();\n        "+r.map(function(r,t){return"sourceLoc."+coords[t]+" = start["+t+"] + coords."+coords[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+e+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+n+"));\n      }\n    "}return r.prototype.getCustomSetupFunc=function(r){var t=this;if(r.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+r.length+")");return function(o,e){null==t.startLoc&&(t.startLoc=o.getUniformLocationNoThrow(e,"start"),null==t.startLoc)||o.gl.uniform1iv(t.startLoc,r)}},r}();exports.SliceProgram=SliceProgram;var coords=["x","y","z","w","u","v"];function getCoords(r){if(1===r)return"sourceLoc";if(r<=6)return coords.slice(0,r).map(function(r){return"sourceLoc."+r}).join(",");throw Error("Slicing for rank "+r+" is not yet supported")}

},{"./shader_compiler":146}],149:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),SlicePackedProgram=function(){function t(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=shader_compiler_1.getCoordsDataType(this.rank),r=packing_util_1.getChannels("coords",this.rank),e=packing_util_1.getChannels("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+e.slice(-2).join()+")",s="getChannel(getSource("+e.join()+"), "+i+")",a="\n      result.x = "+s+";\n      if (++"+r[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+e[this.rank-1]+";\n        result.y = "+s+";\n        --"+e[this.rank-1]+";\n      }\n    ",o=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+e[this.rank-2]+";\n        result.z = "+s+";\n        if (++"+r[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+e[this.rank-1]+";\n          result.w = "+s+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+n+"("+t.map(function(t,n){return"start["+n+"]"}).join()+");":t.map(function(t,n){return e[n]+" = "+r[n]+" + start["+n+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+n+" coords = getOutputCoords();\n        "+n+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+o+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,e){null==n.startLoc&&(n.startLoc=r.getUniformLocationNoThrow(e,"start"),null==n.startLoc)||r.gl.uniform1iv(n.startLoc,t)}},t}();exports.SlicePackedProgram=SlicePackedProgram;

},{"../packing_util":68,"./shader_compiler":146}],150:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),StridedSliceProgram=function(){return function(e,r,t){this.variableNames=["x"],this.outputShape=t;var i=t.length,o=shader_compiler_1.getCoordsDataType(t.length),s=shader_compiler_1.getCoordsDataType(t.length),n="";if(1===i)n="coords * strides + begin";else{var d=0;n=t.map(function(e,r){return d++,1===t.length?"coords * strides["+r+"] + begin["+r+"]":"coords["+(d-1)+"] * strides["+r+"] + begin["+r+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+e+");\n      "+o+" strides = "+o+"("+r+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+n+"));\n      }\n    "}}();exports.StridedSliceProgram=StridedSliceProgram;

},{"./shader_compiler":146}],151:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var PackingScheme,TextureUsage,PhysicalTextureType,environment_1=require("../../environment"),util=require("../../util");function getUnpackedMatrixTextureShapeWidthHeight(e,t){return[t,e]}function getUnpackedArraySizeFromMatrixSize(e,t){return e*t}function getColorMatrixTextureShapeWidthHeight(e,t){return[4*t,e]}function getDenseTexShape(e){var t=util.sizeFromShape(e),r=Math.ceil(t/4);return util.sizeToSquarishShape(r)}function getMatrixSizeFromUnpackedArraySize(e,t){if(e%t!=0)throw new Error("unpackedSize ("+e+") must be a multiple of "+t);return e/t}function decodeMatrixFromUnpackedColorRGBAArray(e,t,r){var a=e.length*r/4;if(t.length<a)throw new Error("matrix length ("+t.length+") must be >= "+a);for(var i=0,n=0;n<e.length;n+=4)for(var o=0;o<r;o++)t[i++]=e[n+o]}function getPackedMatrixTextureShapeWidthHeight(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function getPackedRGBAArraySizeFromMatrixShape(e,t){var r=getPackedMatrixTextureShapeWidthHeight(e,t);return r[0]*r[1]*4}function getTextureConfig(e,t){var r,a,i,n,o,x,u,h,A,p=e;return 2===environment_1.env().getNumber("WEBGL_VERSION")?(r=p.R32F,a=p.R16F,i=p.RGBA16F,n=p.RGBA32F,o=p.RED,x=4,u=1,h=p.HALF_FLOAT,A=p.FLOAT):(r=e.RGBA,a=e.RGBA,i=e.RGBA,n=p.RGBA,o=e.RGBA,x=4,u=4,h=null!=t?t.HALF_FLOAT_OES:null,A=e.FLOAT),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:n,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:x,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:A}}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(PackingScheme=exports.PackingScheme||(exports.PackingScheme={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(TextureUsage=exports.TextureUsage||(exports.TextureUsage={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(PhysicalTextureType=exports.PhysicalTextureType||(exports.PhysicalTextureType={})),exports.getUnpackedMatrixTextureShapeWidthHeight=getUnpackedMatrixTextureShapeWidthHeight,exports.getUnpackedArraySizeFromMatrixSize=getUnpackedArraySizeFromMatrixSize,exports.getColorMatrixTextureShapeWidthHeight=getColorMatrixTextureShapeWidthHeight,exports.getDenseTexShape=getDenseTexShape,exports.getMatrixSizeFromUnpackedArraySize=getMatrixSizeFromUnpackedArraySize,exports.decodeMatrixFromUnpackedColorRGBAArray=decodeMatrixFromUnpackedColorRGBAArray,exports.getPackedMatrixTextureShapeWidthHeight=getPackedMatrixTextureShapeWidthHeight,exports.getPackedRGBAArraySizeFromMatrixShape=getPackedRGBAArraySizeFromMatrixShape,exports.getTextureConfig=getTextureConfig;

},{"../../environment":164,"../../util":294}],152:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),tex_util_1=require("./tex_util"),TextureManager=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,r){var u,s=getPhysicalFromLogicalTextureType(t,r),i=getKeyFromTextureShape(e,s,r);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var x=this.freeTextures[i].shift();return this.usedTextures[i].push(x),x}return this.numUsedTextures++,this.log(),s===tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===tex_util_1.PhysicalTextureType.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===tex_util_1.PhysicalTextureType.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===tex_util_1.PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),u},e.prototype.releaseTexture=function(e,t,r,u){if(null!=this.freeTextures){var s=getKeyFromTextureShape(t,getPhysicalFromLogicalTextureType(r,u),u);s in this.freeTextures||(this.freeTextures[s]=[]),this.freeTextures[s].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[s],x=i.indexOf(e);if(x<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(x,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function getPhysicalTextureForRendering(e){return environment_1.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT32:tex_util_1.PhysicalTextureType.UNPACKED_FLOAT32:e?tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT16:tex_util_1.PhysicalTextureType.UNPACKED_FLOAT16}function getPhysicalFromLogicalTextureType(e,t){if(e===tex_util_1.TextureUsage.UPLOAD)return tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT32;if(e===tex_util_1.TextureUsage.RENDER||null==e)return getPhysicalTextureForRendering(t);if(e===tex_util_1.TextureUsage.DOWNLOAD||e===tex_util_1.TextureUsage.PIXELS)return tex_util_1.PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function getKeyFromTextureShape(e,t,r){return e[0]+"_"+e[1]+"_"+t+"_"+r}exports.TextureManager=TextureManager;

},{"../../environment":164,"./tex_util":151}],153:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),TileProgram=function(){return function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),o=0;o<t.length;o++)t[o]=r[o]*e[o];this.outputShape=t,this.rank=t.length;var s=shader_compiler_1.getCoordsDataType(this.rank),i=getSourceCoords(r);this.userCode="\n      void main() {\n        "+s+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "}}();function getSourceCoords(r){var e=r.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+r[0]+")";for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],o=[],s=0;s<r.length;s++)o.push("imod("+t[s]+", "+r[s]+")");return o.join()}exports.TileProgram=TileProgram;

},{"./shader_compiler":146}],154:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),TransposeProgram=function(){return function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),s=0;s<t.length;s++)t[s]=r[e[s]];this.outputShape=t,this.rank=t.length;var o=shader_compiler_1.getCoordsDataType(this.rank),n=getSwitchedCoords(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+n+"));\n    }\n    "}}();function getSwitchedCoords(r){var e=r.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e),o=0;o<r.length;o++)s[r[o]]=t[o];return s.join()}exports.TransposeProgram=TransposeProgram;

},{"./shader_compiler":146}],155:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),TransposePackedProgram=function(){return function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var s=shader_compiler_1.getCoordsDataType(this.rank),a=packing_util_1.getVecChannels("rc",this.rank),i=new Array(this.rank);for(n=0;n<e.length;n++)i[e[n]]=a[n];var o="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+t[this.rank-1],h="getChannel(getA("+i.join()+"), "+o+")";this.userCode="\n    void main() {\n      "+s+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+h+";\n      if("+u+") {\n        result[1] = "+h+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+t[this.rank-2]+") {\n        result[2] = "+h+";\n        if("+u+") {\n          result[3] = "+h+";\n        }\n      }\n      setOutput(result);\n    }\n    "}}();exports.TransposePackedProgram=TransposePackedProgram;

},{"../packing_util":68,"./shader_compiler":146}],156:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var erf_util=require("../../ops/erf_util"),selu_util=require("../../ops/selu_util"),UnaryOpProgram=function(){return function(n,r){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      float unaryOperation(float x) {\n        "+r+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}}();exports.UnaryOpProgram=UnaryOpProgram;var CHECK_NAN_SNIPPET="if (isnan(x)) return x;";function STEP(n){return void 0===n&&(n=0),CHECK_NAN_SNIPPET+"\n    return x > 0.0 ? 1.0 : float("+n+");\n  "}exports.LINEAR="return x;",exports.ABS="return abs(x);",exports.RELU=CHECK_NAN_SNIPPET+"\n  return (x < 0.0) ? 0.0 : x;\n",exports.RELU6=CHECK_NAN_SNIPPET+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",exports.ELU="return (x >= 0.0) ? x : (exp(x) - 1.0);",exports.SELU="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+selu_util.SELU_SCALEALPHA+";\n  float scale = "+selu_util.SELU_SCALE+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",exports.STEP=STEP,exports.NEG="return -x;",exports.CEIL="return ceil(x);",exports.FLOOR="return floor(x);",exports.SIGN="\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n",exports.IS_NAN="return float(isnan(x));",exports.IS_INF="return float(isinf(x));",exports.IS_FINITE="return float(!isnan(x) && !isinf(x));",exports.ROUND="\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n",exports.EXP="return exp(x);",exports.EXPM1="return exp(x) - 1.0;",exports.LOG="if (x < 0.0) return NAN;\n  return log(x);",exports.LOG1P="return log(1.0 + x);",exports.SQRT="return sqrt(x);",exports.RSQRT="return inversesqrt(x);",exports.SIGMOID="return 1.0 / (1.0 + exp(-1.0 * x));",exports.SOFTPLUS="\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n",exports.SIN=CHECK_NAN_SNIPPET+"\n  return sin(x);\n",exports.COS=CHECK_NAN_SNIPPET+"\n  return cos(x);\n",exports.TAN="return tan(x);",exports.ASIN=CHECK_NAN_SNIPPET+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",exports.ACOS=CHECK_NAN_SNIPPET+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",exports.ATAN=CHECK_NAN_SNIPPET+"\n  return atan(x);\n",exports.SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",exports.COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",exports.TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",exports.ASINH=CHECK_NAN_SNIPPET+"return log(x + sqrt(x * x + 1.0));",exports.ACOSH=CHECK_NAN_SNIPPET+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",exports.ATANH=CHECK_NAN_SNIPPET+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",exports.ERF='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '+erf_util.ERF_P+";\n  float a1 = "+erf_util.ERF_A1+";\n  float a2 = "+erf_util.ERF_A2+";\n  float a3 = "+erf_util.ERF_A3+";\n  float a4 = "+erf_util.ERF_A4+";\n  float a5 = "+erf_util.ERF_A5+";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n",exports.SQUARE="return x * x;",exports.RECIPROCAL="return 1.0 / x;",exports.LOGICAL_NOT="return float(!(x >= 1.0));",exports.TO_INT="return float(int(x));",exports.CLONE="return x;";

},{"../../ops/erf_util":214,"../../ops/selu_util":248}],157:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LINEAR="return x;",exports.LOG="\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",exports.RELU="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",exports.RELU6="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",exports.ELU="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n";var UnaryOpPackedProgram=function(){return function(e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+r+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}}();exports.UnaryOpPackedProgram=UnaryOpPackedProgram;

},{}],158:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),UnpackProgram=function(){return function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,r=packing_util_1.getChannels("rc",t),n=shader_compiler_1.getCoordsDataType(t),a=packing_util_1.getSourceCoords(t,r),i=r.slice(-2),p=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+n+" rc = getOutputCoords();\n        vec4 packedInput = getA("+a+");\n\n        setOutput(getChannel(packedInput, "+p+"));\n      }\n    "}}();exports.UnpackProgram=UnpackProgram;

},{"../packing_util":68,"./shader_compiler":146}],159:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),canvas_util_1=require("./canvas_util"),tex_util_1=require("./tex_util");function callAndCheck(e,r,t){var n=t();return r&&checkWebGLError(e),n}function checkWebGLError(e){var r=e.getError();if(r!==e.NO_ERROR)throw new Error("WebGL Error: "+getWebGLErrorMessage(e,r))}exports.callAndCheck=callAndCheck;var MIN_FLOAT16=5.96e-8,MAX_FLOAT16=65504;function canBeRepresented(e){return!!(environment_1.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||MIN_FLOAT16<Math.abs(e)&&Math.abs(e)<MAX_FLOAT16)}function getWebGLErrorMessage(e,r){switch(r){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+r}}function getExtensionOrThrow(e,r,t){return throwIfNull(e,r,function(){return e.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function createVertexShader(e,r,t){var n=throwIfNull(e,r,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(callAndCheck(e,r,function(){return e.shaderSource(n,t)}),callAndCheck(e,r,function(){return e.compileShader(n)}),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function createFragmentShader(e,r,t){var n=throwIfNull(e,r,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(callAndCheck(e,r,function(){return e.shaderSource(n,t)}),callAndCheck(e,r,function(){return e.compileShader(n)}),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw logShaderSourceAndInfoLog(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}exports.canBeRepresented=canBeRepresented,exports.getWebGLErrorMessage=getWebGLErrorMessage,exports.getExtensionOrThrow=getExtensionOrThrow,exports.createVertexShader=createVertexShader,exports.createFragmentShader=createFragmentShader;var MAX_TEXTURE_SIZE,MAX_TEXTURES_IN_SHADER,lineNumberRegex=/ERROR: [0-9]+:([0-9]+):/g;function logShaderSourceAndInfoLog(e,r){var t=lineNumberRegex.exec(r);if(null==t)return console.log("Couldn't parse line number in error: "+r),void console.log(e);for(var n=+t[1],a=e.split("\n"),o=a.length.toString().length+2,u=a.map(function(e,r){return util.rightPad((r+1).toString(),o)+e}),i=0,l=0;l<u.length;l++)i=Math.max(u[l].length,i);var f=u.slice(0,n-1),c=u.slice(n-1,n),E=u.slice(n);console.log(f.join("\n")),console.log(r.split("\n")[0]),console.log("%c "+util.rightPad(c[0],i),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(E.join("\n"))}function createProgram(e,r){return throwIfNull(e,r,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function linkProgram(e,r,t){if(callAndCheck(e,r,function(){return e.linkProgram(t)}),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function validateProgram(e,r,t){if(callAndCheck(e,r,function(){return e.validateProgram(t)}),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function createStaticVertexBuffer(e,r,t){var n=throwIfNull(e,r,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return callAndCheck(e,r,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),callAndCheck(e,r,function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}),n}function createStaticIndexBuffer(e,r,t){var n=throwIfNull(e,r,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return callAndCheck(e,r,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)}),callAndCheck(e,r,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)}),n}function getNumChannels(){return 2===environment_1.env().getNumber("WEBGL_VERSION")?1:4}function createTexture(e,r){return throwIfNull(e,r,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function validateTextureSize(e,r){var t=environment_1.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||r<=0){var n="["+e+"x"+r+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(e>t||r>t){n="["+e+"x"+r+"]";throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}}function createFramebuffer(e,r){return throwIfNull(e,r,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function bindVertexBufferToProgramAttribute(e,r,t,n,a,o,u,i){var l=e.getAttribLocation(t,n);return-1!==l&&(callAndCheck(e,r,function(){return e.bindBuffer(e.ARRAY_BUFFER,a)}),callAndCheck(e,r,function(){return e.vertexAttribPointer(l,o,e.FLOAT,!1,u,i)}),callAndCheck(e,r,function(){return e.enableVertexAttribArray(l)}),!0)}function bindTextureUnit(e,r,t,n){validateTextureUnit(e,n),callAndCheck(e,r,function(){return e.activeTexture(e.TEXTURE0+n)}),callAndCheck(e,r,function(){return e.bindTexture(e.TEXTURE_2D,t)})}function unbindTextureUnit(e,r,t){validateTextureUnit(e,t),callAndCheck(e,r,function(){return e.activeTexture(e.TEXTURE0+t)}),callAndCheck(e,r,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function getProgramUniformLocationOrThrow(e,r,t,n){return throwIfNull(e,r,function(){return e.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')}function getProgramUniformLocation(e,r,t){return e.getUniformLocation(r,t)}function bindTextureToProgramUniformSampler(e,r,t,n,a,o){callAndCheck(e,r,function(){return bindTextureUnit(e,r,n,o)}),callAndCheck(e,r,function(){return e.uniform1i(a,o)})}function bindCanvasToFramebuffer(e,r){callAndCheck(e,r,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),callAndCheck(e,r,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),callAndCheck(e,r,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})}function bindColorTextureToFramebuffer(e,r,t,n){callAndCheck(e,r,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),callAndCheck(e,r,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)})}function unbindColorTextureFromFramebuffer(e,r,t){callAndCheck(e,r,function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)}),callAndCheck(e,r,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function validateFramebuffer(e){var r=e.checkFramebufferStatus(e.FRAMEBUFFER);if(r!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+getFramebufferErrorMessage(e,r))}function getFramebufferErrorMessage(e,r){switch(r){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+r}}function throwIfNull(e,r,t,n){var a=callAndCheck(e,r,function(){return t()});if(null==a)throw new Error(n);return a}function validateTextureUnit(e,r){var t=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=r+e.TEXTURE0;if(n<e.TEXTURE0||n>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function getBatchDim(e,r){return void 0===r&&(r=2),util.sizeFromShape(e.slice(0,e.length-r))}function getRowsCols(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function getShapeAs3D(e){var r=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(r=[getBatchDim(e)].concat(getRowsCols(e))),r}function getTextureShapeFromLogicalShape(e,r){var t;void 0===r&&(r=!1);var n=environment_1.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r&&(n*=2,1===(e=e.map(function(r,t){return t>=e.length-2?util.nearestLargerEven(e[t]):e[t]})).length&&(e=[2,e[0]])),2!==e.length){var a=util.squeezeShape(e);e=a.newShape}var o=util.sizeFromShape(e);if(e.length<=1&&o<=n)return[1,o];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(r){var u=getBatchDim(e),i=2,l=2;return e.length&&(i=(t=getRowsCols(e))[0],l=t[1]),o=u*(i/2)*(l/2),util.sizeToSquarishShape(o).map(function(e){return 2*e})}return util.sizeToSquarishShape(o)}function isEven(e){return e%2==0}function isReshapeFree(e,r){if(e=e.slice(-2),r=r.slice(-2),util.arraysEqual(e,r))return!0;if(!e.length||!r.length)return!0;if(0===e[0]||0===e[1]||0===r[0]||0===r[1])return!0;if(e.length!==r.length){var t=e.slice(-1)[0],n=r.slice(-1)[0];if(t===n)return!0;if(isEven(t)&&isEven(n)&&(1===e[0]||1===r[0]))return!0}return e[1]===r[1]&&isEven(e[0])&&isEven(r[0])}function getWebGLMaxTextureSize(e){if(null==MAX_TEXTURE_SIZE){var r=canvas_util_1.getWebGLContext(e);MAX_TEXTURE_SIZE=r.getParameter(r.MAX_TEXTURE_SIZE)}return MAX_TEXTURE_SIZE}function resetMaxTextureSize(){MAX_TEXTURE_SIZE=null}function resetMaxTexturesInShader(){MAX_TEXTURES_IN_SHADER=null}function getMaxTexturesInShader(e){if(null==MAX_TEXTURES_IN_SHADER){var r=canvas_util_1.getWebGLContext(e);MAX_TEXTURES_IN_SHADER=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,MAX_TEXTURES_IN_SHADER)}function getWebGLDisjointQueryTimerVersion(e){if(0===e)return 0;var r=canvas_util_1.getWebGLContext(e);return hasExtension(r,"EXT_disjoint_timer_query_webgl2")&&2===e?2:hasExtension(r,"EXT_disjoint_timer_query")?1:0}function hasExtension(e,r){return null!=e.getExtension(r)}function isWebGLVersionEnabled(e){try{if(null!=canvas_util_1.getWebGLContext(e))return!0}catch(e){return!1}return!1}function isCapableOfRenderingToFloatTexture(e){if(0===e)return!1;var r=canvas_util_1.getWebGLContext(e);if(1===e){if(!hasExtension(r,"OES_texture_float"))return!1}else if(!hasExtension(r,"EXT_color_buffer_float"))return!1;return createFloatTextureAndBindToFramebuffer(r)}function isDownloadFloatTextureEnabled(e){if(0===e)return!1;var r=canvas_util_1.getWebGLContext(e);if(1!==e){if(hasExtension(r,"EXT_color_buffer_float"))return createFloatTextureAndBindToFramebuffer(r);return!!hasExtension(r,"EXT_color_buffer_half_float")&&createHalfFloatTextureAndBindToFramebuffer(r,r.getExtension("EXT_color_buffer_half_float"))}return!!hasExtension(r,"OES_texture_float")&&(!!hasExtension(r,"WEBGL_color_buffer_float")&&createFloatTextureAndBindToFramebuffer(r))}function createFloatTextureAndBindToFramebuffer(e){var r=tex_util_1.getTextureConfig(e),t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);e.texImage2D(e.TEXTURE_2D,0,r.internalFormatFloat,1,1,0,r.textureFormatFloat,r.textureTypeFloat,null);var n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(t),e.deleteFramebuffer(n),a}function createHalfFloatTextureAndBindToFramebuffer(e,r){var t=tex_util_1.getTextureConfig(e,r),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(a),o}function isWebGLFenceEnabled(e){return 2===e&&null!=canvas_util_1.getWebGLContext(e).fenceSync}exports.createProgram=createProgram,exports.linkProgram=linkProgram,exports.validateProgram=validateProgram,exports.createStaticVertexBuffer=createStaticVertexBuffer,exports.createStaticIndexBuffer=createStaticIndexBuffer,exports.getNumChannels=getNumChannels,exports.createTexture=createTexture,exports.validateTextureSize=validateTextureSize,exports.createFramebuffer=createFramebuffer,exports.bindVertexBufferToProgramAttribute=bindVertexBufferToProgramAttribute,exports.bindTextureUnit=bindTextureUnit,exports.unbindTextureUnit=unbindTextureUnit,exports.getProgramUniformLocationOrThrow=getProgramUniformLocationOrThrow,exports.getProgramUniformLocation=getProgramUniformLocation,exports.bindTextureToProgramUniformSampler=bindTextureToProgramUniformSampler,exports.bindCanvasToFramebuffer=bindCanvasToFramebuffer,exports.bindColorTextureToFramebuffer=bindColorTextureToFramebuffer,exports.unbindColorTextureFromFramebuffer=unbindColorTextureFromFramebuffer,exports.validateFramebuffer=validateFramebuffer,exports.getFramebufferErrorMessage=getFramebufferErrorMessage,exports.getBatchDim=getBatchDim,exports.getRowsCols=getRowsCols,exports.getShapeAs3D=getShapeAs3D,exports.getTextureShapeFromLogicalShape=getTextureShapeFromLogicalShape,exports.isReshapeFree=isReshapeFree,exports.getWebGLMaxTextureSize=getWebGLMaxTextureSize,exports.resetMaxTextureSize=resetMaxTextureSize,exports.resetMaxTexturesInShader=resetMaxTexturesInShader,exports.getMaxTexturesInShader=getMaxTexturesInShader,exports.getWebGLDisjointQueryTimerVersion=getWebGLDisjointQueryTimerVersion,exports.hasExtension=hasExtension,exports.isWebGLVersionEnabled=isWebGLVersionEnabled,exports.isCapableOfRenderingToFloatTexture=isCapableOfRenderingToFloatTexture,exports.isDownloadFloatTextureEnabled=isDownloadFloatTextureEnabled,exports.isWebGLFenceEnabled=isWebGLFenceEnabled;

},{"../../environment":164,"../../util":294,"./canvas_util":83,"./tex_util":151}],160:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var array_ops_1=require("../ops/array_ops");function whereImpl(e,r){for(var t=[],o=0;o<r.length;o++)r[o]&&t.push(o);var a=array_ops_1.buffer(e,"int32"),s=array_ops_1.buffer([t.length,e.length],"int32");for(o=0;o<t.length;o++){var n=a.indexToLoc(t[o]),p=o*e.length;s.values.set(n,p)}return s.toTensor()}exports.whereImpl=whereImpl;

},{"../ops/array_ops":192}],161:[function(require,module,exports){
(function (setImmediate){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var delayCallback="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function nextFrame(){return new Promise(function(e){return delayCallback(function(){return e()})})}exports.nextFrame=nextFrame;

}).call(this,require("timers").setImmediate)
},{"timers":333}],162:[function(require,module,exports){
"use strict";function isMobile(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}function isBrowser(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isMobile=isMobile,exports.isBrowser=isBrowser;

},{}],163:[function(require,module,exports){
(function (process,global){
"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,s){function a(t){try{u(r.next(t))}catch(t){s(t)}}function o(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,o)}u((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};Object.defineProperty(exports,"__esModule",{value:!0});var GLOBAL,environment_1=require("./environment"),kernel_registry_1=require("./kernel_registry"),profiler_1=require("./profiler"),tape_1=require("./tape"),tensor_1=require("./tensor"),tensor_util_1=require("./tensor_util"),util=require("./util"),util_1=require("./util"),EngineState=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),Engine=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new EngineState}return t.prototype.ready=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n;return __generator(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r;return __generator(this,function(i){switch(i.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new profiler_1.Profiler(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var t=this;kernel_registry_1.getKernelsForBackend(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)})},t.prototype.disposeRegisteredKernels=function(t){var e=this;kernel_registry_1.getKernelsForBackend(t).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(e.registry[t])})},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,s=r.then(function(n){return!(i<e.pendingBackendInitId)&&(e.registry[t]=n,e.pendingBackendInit=null,!0)}).catch(function(n){return!(i<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(n.stack||n.message),!1)});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(e){return console.warn("Initialization of backend "+t+" failed"),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),i=r.success,s=r.asyncInit;if(s||i)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e);r.disposeData(e),n.backend=t,t.move(e,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(t,e){var n,r=this,i=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return r.startScope(i)},function(){return r.endScope(n)},function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],function(t){return{x:function(){return t.toFloat()}}},[],{}),e},t.prototype.runKernel=function(t,e,n,r,i){return this.runKernelFunc(null,e,null,t,n,r,i)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(t,e,n){var r=this.backend.numDataIds(),i=0;n.forEach(function(t){i+="complex64"===t.dtype?3:1});var s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-e-i-s;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+t+"'")},t.prototype.runKernelFunc=function(t,e,n,r,i,s,a){var o,u=this,c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var d,h=this.state.numBytes,f=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var p,y=kernel_registry_1.getKernel(r,this.backendName);if(null!=y)d=function(){var t=u.backend.numDataIds();p=y.kernelFunc({inputs:e,attrs:i,backend:u.backend});var n=Array.isArray(p)?p:[p];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n);var o=n.map(function(t){var e=t.dataId,n=t.shape,r=t.dtype;return u.makeTensorFromDataId(e,n,r)});if(l){var d=u.getTensorsForGradient(r,e,o);if(null==d){null==a&&(a=[]);var h=o.filter(function(t,e){return a[e]});d=(s||[]).slice().concat(h)}c=u.saveTensorsForBackwardMode(d)}return o};else{var g=function(t){l&&(c=t.map(function(t){return u.keep(u.clone(t))}))};d=function(){var e=u.backend.numDataIds();p=u.tidy(function(){return t(u.backend,g)});var n=Array.isArray(p)?p:[p];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n),n}}return this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){o=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,e,function(){return d()}):d()}),l&&this.addTapeNode(r,e,o,n,c,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-f,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(t){return e[t].shape}),outputShapes:o.map(function(t){return t.shape})}),Array.isArray(p)?o:o[0]},t.prototype.saveTensorsForBackwardMode=function(t){var e=this;return t.map(function(t){return e.keep(e.clone(t))})},t.prototype.getTensorsForGradient=function(t,e,n){var r=kernel_registry_1.getGradient(t);if(null!=r){var i=r.inputsToSave||[],s=r.outputsToSave||[],a=i.map(function(t){return e[t]}),o=n.filter(function(t,e){return s[e]});return a.concat(o)}return null},t.prototype.makeTensor=function(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=t;"string"===n&&util.isString(t[0])&&(i=t.map(function(t){return util.encodeString(t)}));var s=r.write(i,e,n),a=new tensor_1.Tensor(e,n,s,this.nextTensorId());if(this.incRef(a,r),"string"===n){var o=this.state.tensorInfo.get(s),u=util_1.bytesFromStringArray(i);this.state.numBytes+=u-o.bytes,o.bytes=u}return a},t.prototype.makeTensorFromDataId=function(t,e,n,r){n=n||"float32";var i=new tensor_1.Tensor(e,n,t,this.nextTensorId());return this.incRef(i,r),i},t.prototype.makeVariable=function(t,e,n,r){void 0===e&&(e=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.asType(r));var i=new tensor_1.Variable(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},t.prototype.incRef=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(r=t.size*util.bytesPerElement(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof tensor_1.Variable||this.track(t)},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(r){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n,r,i,s){var a=this,o={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},u=kernel_registry_1.getGradient(t);null!=u&&(r=u.gradFunc),null!=r&&(o.gradient=function(t){return t=t.map(function(t,e){if(null==t){var r=n[e],i=util.makeZerosTypedArray(r.size,r.dtype);return a.makeTensor(i,r.shape,r.dtype)}return t}),r(t.length>1?t:t[0],i,s)}),this.state.activeTape.push(o)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=tensor_util_1.getTensorsInContainer(t),r=new Set(n.map(function(t){return t.id})),i=0;i<this.state.activeScope.track.length;i++){var s=this.state.activeScope.track[i];s.kept||r.has(s.id)||s.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(t){t.kept||t.scopeId!==a.id||e.track(t)})},t.prototype.gradients=function(t,e,n,r){var i=this;if(void 0===r&&(r=!1),util.assert(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var s=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",t)});util.assert(s instanceof tensor_1.Tensor,function(){return"The result y returned by f() must be a tensor."});var a=tape_1.getFilteredNodesXToY(this.state.activeTape,e,s);if(!r&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var t={};t[s.id]=null==n?ones(s.shape):n,tape_1.backpropagateGradients(t,a,function(t){return i.tidy(t)});var r=e.map(function(e){return t[e.id]});return 0===i.state.gradientDepth&&(i.state.activeTape.forEach(function(t){for(var e=0,n=t.saved;e<n.length;e++){n[e].dispose()}}),i.state.activeTape=null),{value:s,grads:r}})},t.prototype.customGrad=function(t){var e=this;return util.assert(util.isFunction(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];util.assert(r.every(function(t){return t instanceof tensor_1.Tensor}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return r.forEach(function(t,e){s[e]=t}),e.runKernelFunc(function(e,i){return n=t.apply(void 0,r.concat([i])),util.assert(n.value instanceof tensor_1.Tensor,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),util.assert(util.isFunction(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},s,function(t,e){var i=n.gradFunc(t,e),s=Array.isArray(i)?i:[i];util.assert(s.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),util.assert(s.every(function(t){return t instanceof tensor_1.Tensor}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var a={};return s.forEach(function(t,e){a[e]=function(){return t}}),a})}},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.time=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(r){switch(r.label){case 0:return e=util_1.now(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=util_1.now()-e,[2,n]}})})},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new EngineState,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}();function ones(t){var e=util_1.makeOnesTypedArray(util_1.sizeFromShape(t),"float32");return exports.ENGINE.makeTensor(e,t,"float32")}function getGlobalNamespace(){if(null==GLOBAL){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}GLOBAL=t}return GLOBAL}function getOrMakeEngine(){var t=getGlobalNamespace();if(null==t._tfengine){var e=new environment_1.Environment(t);t._tfengine=new Engine(e)}return environment_1.setEnvironmentGlobal(t._tfengine.ENV),tensor_1.setTensorTracker(function(){return t._tfengine}),t._tfengine}exports.Engine=Engine,exports.ENGINE=getOrMakeEngine();

}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./environment":164,"./kernel_registry":189,"./profiler":276,"./tape":286,"./tensor":287,"./tensor_util":289,"./util":294,"_process":321}],164:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var TENSORFLOWJS_FLAGS_PREFIX="tfjsflags",Environment=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,o){if(this.flagRegistry[t]={evaluationFn:e,setHook:o},null!=this.urlFlags[t]){var r=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+r+"."),this.set(t,r)}},t.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e=getQueryParams(this.global.location.search);if(TENSORFLOWJS_FLAGS_PREFIX in e)e[TENSORFLOWJS_FLAGS_PREFIX].split(",").forEach(function(e){var o=e.split(":"),r=o[0],n=o[1];t.urlFlags[r]=parseValue(r,n)})}},t}();function getQueryParams(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];return decodeParam(e,o[0],o[1]),o.join("=")}),e}function decodeParam(t,e,o){t[decodeURIComponent(e)]=decodeURIComponent(o||"")}function parseValue(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}function env(){return exports.ENV}function setEnvironmentGlobal(t){exports.ENV=t}exports.Environment=Environment,exports.getQueryParams=getQueryParams,exports.env=env,exports.ENV=null,exports.setEnvironmentGlobal=setEnvironmentGlobal;

},{}],165:[function(require,module,exports){
(function (process){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var device_util=require("./device_util"),environment_1=require("./environment"),ENV=environment_1.env();ENV.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),ENV.registerFlag("IS_BROWSER",function(){return device_util.isBrowser()}),ENV.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),ENV.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),ENV.registerFlag("PROD",function(){return!1}),ENV.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return ENV.getBool("DEBUG")}),ENV.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),ENV.registerFlag("IS_TEST",function(){return!1});

}).call(this,require('_process'))
},{"./device_util":162,"./environment":164,"_process":321}],166:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("./engine"),environment_1=require("./environment"),tensor_1=require("./tensor"),tensor_util_1=require("./tensor_util");function enableProdMode(){environment_1.env().set("PROD",!0)}function enableDebugMode(){environment_1.env().set("DEBUG",!0)}function disableDeprecationWarnings(){environment_1.env().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function deprecationWarn(e){environment_1.env().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function disposeVariables(){engine_1.ENGINE.disposeVariables()}function engine(){return engine_1.ENGINE}function memory(){return engine_1.ENGINE.memory()}function profile(e){return engine_1.ENGINE.profile(e)}function tidy(e,n){return engine_1.ENGINE.tidy(e,n)}function dispose(e){tensor_util_1.getTensorsInContainer(e).forEach(function(e){return e.dispose()})}function keep(e){return engine_1.ENGINE.keep(e)}function time(e){return engine_1.ENGINE.time(e)}function setBackend(e){return engine_1.ENGINE.setBackend(e)}function ready(){return engine_1.ENGINE.ready()}function getBackend(){return engine_1.ENGINE.backendName}function removeBackend(e){engine_1.ENGINE.removeBackend(e)}function findBackend(e){return engine_1.ENGINE.findBackend(e)}function findBackendFactory(e){return engine_1.ENGINE.findBackendFactory(e)}function registerBackend(e,n,r){return void 0===r&&(r=1),engine_1.ENGINE.registerBackend(e,n,r)}function backend(){return engine_1.ENGINE.backend}function setPlatform(e,n){environment_1.env().setPlatform(e,n)}exports.enableProdMode=enableProdMode,exports.enableDebugMode=enableDebugMode,exports.disableDeprecationWarnings=disableDeprecationWarnings,exports.deprecationWarn=deprecationWarn,tensor_1.setDeprecationWarningFn(deprecationWarn),exports.disposeVariables=disposeVariables,exports.engine=engine,exports.memory=memory,exports.profile=profile,exports.tidy=tidy,exports.dispose=dispose,exports.keep=keep,exports.time=time,exports.setBackend=setBackend,exports.ready=ready,exports.getBackend=getBackend,exports.removeBackend=removeBackend,exports.findBackend=findBackend,exports.findBackendFactory=findBackendFactory,exports.registerBackend=registerBackend,exports.backend=backend,exports.setPlatform=setPlatform;

},{"./engine":163,"./environment":164,"./tensor":287,"./tensor_util":289}],167:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("./engine"),tensor_1=require("./tensor"),tensor_util_env_1=require("./tensor_util_env"),util=require("./util");function grad(e){return util.assert(util.isFunction(e),function(){return"The f passed in grad(f) must be a function"}),function(n,r){var t=tensor_util_env_1.convertToTensor(n,"x","tf.grad",null),a=null!=r?tensor_util_env_1.convertToTensor(r,"dy","tf.grad"):null;return engine_1.ENGINE.tidy(function(){var n=engine_1.ENGINE.gradients(function(){return e(t)},[t],a),r=n.value,s=n.grads;return null!=a&&util.assertShapesMatch(r.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),checkGrads(s),s[0]})}}function grads(e){return util.assert(util.isFunction(e),function(){return"The f passed in grads(f) must be a function"}),function(n,r){util.assert(Array.isArray(n),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var t=tensor_util_env_1.convertToTensorArray(n,"args","tf.grads",null),a=null!=r?tensor_util_env_1.convertToTensor(r,"dy","tf.grads"):null;return engine_1.ENGINE.tidy(function(){var n=engine_1.ENGINE.gradients(function(){return e.apply(void 0,t)},t,a),r=n.value,s=n.grads;return null!=a&&util.assertShapesMatch(r.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),checkGrads(s),s})}}function valueAndGrad(e){return util.assert(util.isFunction(e),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(n,r){util.assert(n instanceof tensor_1.Tensor,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),util.assert(null==r||r instanceof tensor_1.Tensor,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var t=engine_1.ENGINE.gradients(function(){return e(n)},[n],r),a=t.grads,s=t.value;return checkGrads(a),{grad:a[0],value:s}}}function valueAndGrads(e){return util.assert(util.isFunction(e),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(n,r){util.assert(Array.isArray(n)&&n.every(function(e){return e instanceof tensor_1.Tensor}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),util.assert(null==r||r instanceof tensor_1.Tensor,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var t=engine_1.ENGINE.gradients(function(){return e.apply(void 0,n)},n,r);return null!=r&&util.assertShapesMatch(t.value.shape,r.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),checkGrads(t.grads),t}}function variableGrads(e,n){util.assert(util.isFunction(e),function(){return"The f passed in variableGrads(f) must be a function"}),util.assert(null==n||Array.isArray(n)&&n.every(function(e){return e instanceof tensor_1.Variable}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var r=null!=n;if(!r)for(var t in n=[],engine_1.ENGINE.registeredVariables)n.push(engine_1.ENGINE.registeredVariables[t]);var a=r?n.filter(function(e){return!e.trainable}):null,s=n.length;n=n.filter(function(e){return e.trainable}),util.assert(n.length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+s+" variables is trainable."});var u=engine_1.ENGINE.gradients(e,n,null,!0),i=u.value,o=u.grads;util.assert(o.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),util.assert(0===i.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+i.rank+" tensor"});var l={};return n.forEach(function(e,n){null!=o[n]&&(l[e.name]=o[n])}),null!=a&&a.forEach(function(e){return l[e.name]=null}),{value:i,grads:l}}function customGrad(e){return engine_1.ENGINE.customGrad(e)}function checkGrads(e){if(e.filter(function(e){return null==e}).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}exports.grad=grad,exports.grads=grads,exports.valueAndGrad=valueAndGrad,exports.valueAndGrads=valueAndGrads,exports.variableGrads=variableGrads,exports.customGrad=customGrad;

},{"./engine":163,"./tensor":287,"./tensor_util_env":290,"./util":294}],168:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../kernel_names");exports.broadcastToGradConfig={kernelName:kernel_names_1.BroadcastTo,gradFunc:function(e,r,a){for(var n=a,o=n.inputShape,t=n.shape,s=Array.from(t),u=o.length-1;u>=0;u--)if(o[u]===t[u])s[u]=1;else if(1!==o[u])throw new Error("broadcastTo(): ["+o+"] cannot be broadcast to ["+t+"].");var c=[];for(u=0;u<s.length;u++)s[u]>1&&c.push(u);return{x:function(){return e.sum(c,!0)}}}};

},{"../kernel_names":188}],169:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../kernel_names"),broadcast_util=require("../ops/broadcast_util"),div_1=require("../ops/div"),reduction_ops_1=require("../ops/reduction_ops"),square_1=require("../ops/square"),unary_ops_1=require("../ops/unary_ops");exports.divGradConfig={kernelName:kernel_names_1.Div,inputsToSave:["a","b"],gradFunc:function(e,r){var a=r[0],s=r[1],t=broadcast_util.assertAndGetBroadcastShape(a.shape,s.shape);return{a:function(){var r=div_1.div(e,s.toFloat()),o=broadcast_util.getReductionAxes(a.shape,t);return o.length>0?reduction_ops_1.sum(r,o).reshape(a.shape):r},b:function(){var r=e.mul(a.toFloat()),o=broadcast_util.getReductionAxes(s.shape,t);o.length>0&&(r=reduction_ops_1.sum(r,o).reshape(s.shape));var u=square_1.square(s);return unary_ops_1.neg(div_1.div(r,u.toFloat()))}}}};

},{"../kernel_names":188,"../ops/broadcast_util":199,"../ops/div":210,"../ops/reduction_ops":241,"../ops/square":256,"../ops/unary_ops":264}],170:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../kernel_names");exports.identityGradConfig={kernelName:kernel_names_1.Identity,gradFunc:function(e){return{x:function(){return e.toFloat()}}}};

},{"../kernel_names":188}],171:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../kernel_names"),tensor_ops_1=require("../ops/tensor_ops");exports.oneHotGradConfig={kernelName:kernel_names_1.OneHot,inputsToSave:["indices"],gradFunc:function(e,r){var n=r[0];return{indices:function(){return tensor_ops_1.zeros(n.shape,"float32")}}}};

},{"../kernel_names":188,"../ops/tensor_ops":259}],172:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../kernel_names");exports.squareGradConfig={kernelName:kernel_names_1.Square,inputsToSave:["x"],gradFunc:function(e,r){var n=r[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}};

},{"../kernel_names":188}],173:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../kernel_names"),binary_ops_1=require("../ops/binary_ops"),tensor_ops_1=require("../ops/tensor_ops");exports.squaredDifferenceGradConfig={kernelName:kernel_names_1.SquaredDifference,inputsToSave:["a","b"],gradFunc:function(e,r){var n=r[0],s=r[1],_=tensor_ops_1.scalar(2);return{a:function(){return binary_ops_1.mul(e,binary_ops_1.mul(_,binary_ops_1.sub(n,s)))},b:function(){return binary_ops_1.mul(e,binary_ops_1.mul(_,binary_ops_1.sub(s,n)))}}}};

},{"../kernel_names":188,"../ops/binary_ops":196,"../ops/tensor_ops":259}],174:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernel_names_1=require("../kernel_names"),tensor_ops_1=require("../ops/tensor_ops");exports.tileGradConfig={kernelName:kernel_names_1.Tile,inputsToSave:["x"],gradFunc:function(e,r,s){var a=r[0],o=s.reps;return{x:function(){var r=tensor_ops_1.zerosLike(a);if(1===a.rank)for(var s=0;s<o[0];++s)r=r.add(e.slice([s*a.shape[0]],[a.shape[0]]));else if(2===a.rank)for(s=0;s<o[0];++s)for(var n=0;n<o[1];++n)r=r.add(e.slice([s*a.shape[0],n*a.shape[1]],[a.shape[0],a.shape[1]]));else if(3===a.rank)for(s=0;s<o[0];++s)for(n=0;n<o[1];++n)for(var p=0;p<o[2];++p)r=r.add(e.slice([s*a.shape[0],n*a.shape[1],p*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(4!==a.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(s=0;s<o[0];++s)for(n=0;n<o[1];++n)for(p=0;p<o[2];++p)for(var i=0;i<o[3];++i)r=r.add(e.slice([s*a.shape[0],n*a.shape[1],p*a.shape[2],i*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return r}}}};

},{"../kernel_names":188,"../ops/tensor_ops":259}],175:[function(require,module,exports){
"use strict";function __export(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),require("./engine"),require("./flags"),require("./backends/webgl/backend_webgl"),require("./backends/cpu/backend_cpu"),require("./backends/cpu/register_all_kernels"),require("./backends/webgl/register_all_kernels"),require("./register_all_gradients"),require("./platforms/platform_browser"),require("./platforms/platform_node");var backend_util=require("./backends/backend_util");exports.backend_util=backend_util;var io=require("./io/io");exports.io=io;var math=require("./math");exports.math=math;var browser=require("./ops/browser");exports.browser=browser;var gather_util=require("./ops/gather_nd_util");exports.gather_util=gather_util;var scatter_util=require("./ops/scatter_nd_util");exports.scatter_util=scatter_util;var slice_util=require("./ops/slice_util");exports.slice_util=slice_util;var serialization=require("./serialization");exports.serialization=serialization;var tensor_1=require("./tensor"),tensor_util=require("./tensor_util");exports.tensor_util=tensor_util;var test_util=require("./test_util");exports.test_util=test_util;var util=require("./util");exports.util=util;var version_1=require("./version");exports.version_core=version_1.version;var webgl=require("./webgl");exports.webgl=webgl;var adadelta_optimizer_1=require("./optimizers/adadelta_optimizer");exports.AdadeltaOptimizer=adadelta_optimizer_1.AdadeltaOptimizer;var adagrad_optimizer_1=require("./optimizers/adagrad_optimizer");exports.AdagradOptimizer=adagrad_optimizer_1.AdagradOptimizer;var adam_optimizer_1=require("./optimizers/adam_optimizer");exports.AdamOptimizer=adam_optimizer_1.AdamOptimizer;var adamax_optimizer_1=require("./optimizers/adamax_optimizer");exports.AdamaxOptimizer=adamax_optimizer_1.AdamaxOptimizer;var momentum_optimizer_1=require("./optimizers/momentum_optimizer");exports.MomentumOptimizer=momentum_optimizer_1.MomentumOptimizer;var optimizer_1=require("./optimizers/optimizer");exports.Optimizer=optimizer_1.Optimizer;var rmsprop_optimizer_1=require("./optimizers/rmsprop_optimizer");exports.RMSPropOptimizer=rmsprop_optimizer_1.RMSPropOptimizer;var sgd_optimizer_1=require("./optimizers/sgd_optimizer");exports.SGDOptimizer=sgd_optimizer_1.SGDOptimizer;var tensor_2=require("./tensor");exports.Tensor=tensor_2.Tensor,exports.TensorBuffer=tensor_2.TensorBuffer,exports.Variable=tensor_2.Variable;var types_1=require("./types");exports.Rank=types_1.Rank,exports.sumOutType=types_1.sumOutType,__export(require("./ops/ops"));var loss_ops_1=require("./ops/loss_ops");exports.Reduction=loss_ops_1.Reduction,__export(require("./train")),__export(require("./globals")),__export(require("./kernel_registry"));var gradients_1=require("./gradients");exports.customGrad=gradients_1.customGrad,exports.grad=gradients_1.grad,exports.grads=gradients_1.grads,exports.valueAndGrad=gradients_1.valueAndGrad,exports.valueAndGrads=gradients_1.valueAndGrads,exports.variableGrads=gradients_1.variableGrads;var environment_1=require("./environment");exports.Environment=environment_1.Environment,exports.env=environment_1.env,exports.ENV=environment_1.ENV;var browser_util_1=require("./browser_util");exports.nextFrame=browser_util_1.nextFrame;var backend_1=require("./backends/backend");exports.KernelBackend=backend_1.KernelBackend,exports.DataStorage=backend_1.DataStorage;var ops=require("./ops/ops");tensor_1.setOpHandler(ops),require("./public/chained_ops/register_all_chained_ops");

},{"./backends/backend":55,"./backends/backend_util":56,"./backends/cpu/backend_cpu":58,"./backends/cpu/register_all_kernels":65,"./backends/webgl/backend_webgl":77,"./backends/webgl/register_all_kernels":134,"./browser_util":161,"./engine":163,"./environment":164,"./flags":165,"./globals":166,"./gradients":167,"./io/io":179,"./kernel_registry":189,"./math":191,"./ops/browser":200,"./ops/gather_nd_util":219,"./ops/loss_ops":224,"./ops/ops":233,"./ops/scatter_nd_util":245,"./ops/slice_util":251,"./optimizers/adadelta_optimizer":265,"./optimizers/adagrad_optimizer":266,"./optimizers/adam_optimizer":267,"./optimizers/adamax_optimizer":268,"./optimizers/momentum_optimizer":269,"./optimizers/optimizer":270,"./optimizers/rmsprop_optimizer":272,"./optimizers/sgd_optimizer":273,"./platforms/platform_browser":274,"./platforms/platform_node":275,"./public/chained_ops/register_all_chained_ops":281,"./register_all_gradients":284,"./serialization":285,"./tensor":287,"./tensor_util":289,"./test_util":291,"./train":292,"./types":293,"./util":294,"./version":295,"./webgl":296}],176:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),io_utils_1=require("./io_utils"),router_registry_1=require("./router_registry"),DEFAULT_FILE_NAME_PREFIX="model",DEFAULT_JSON_EXTENSION_NAME=".json",DEFAULT_WEIGHT_DATA_EXTENSION_NAME=".weights.bin";function defer(e){return new Promise(function(e){return setTimeout(e)}).then(e)}var BrowserDownloads=function(){function e(t){if(!environment_1.env().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t=DEFAULT_FILE_NAME_PREFIX),this.modelTopologyFileName=t+DEFAULT_JSON_EXTENSION_NAME,this.weightDataFileName=t+DEFAULT_WEIGHT_DATA_EXTENSION_NAME}return e.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,o,i,a;return __generator(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),(i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=o,[4,defer(function(){return i.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==e.weightData?[3,4]:((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,defer(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:io_utils_1.getModelArtifactsInfoForJSON(e)}]}})})},e.URL_SCHEME="downloads://",e}();exports.BrowserDownloads=BrowserDownloads;var BrowserFiles=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r=this;return __generator(this,function(n){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(n,o){var i=new FileReader;i.onload=function(i){var a=JSON.parse(i.target.result),s=a.modelTopology;if(null!=s){0===t.length&&n({modelTopology:s});var l=a.weightsManifest;if(null!=l){var u;try{u=r.checkManifestAndWeightFiles(l,t)}catch(e){return void o(e)}var f=[],c=[],h=[];l.forEach(function(e){e.paths.forEach(function(e){c.push(e),h.push(null)}),f.push.apply(f,e.weights)}),l.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var r=t.target.result,o=c.indexOf(e);h[o]=r,-1===h.indexOf(null)&&n({modelTopology:s,weightSpecs:f,weightData:io_utils_1.concatenateArrayBuffers(h),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(u[e])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},i.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],n=t.map(function(e){return io_utils_1.basename(e.name)}),o={},i=0,a=e;i<a.length;i++){a[i].paths.forEach(function(e){var i=io_utils_1.basename(e);if(-1!==r.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(r.push(i),-1===n.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");o[e]=t[n.indexOf(i)]})}if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},e}();function browserDownloads(e){return void 0===e&&(e="model"),new BrowserDownloads(e)}function browserFiles(e){return new BrowserFiles(e)}exports.browserDownloadsRouter=function(e){return environment_1.env().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(BrowserDownloads.URL_SCHEME)?browserDownloads(e.slice(BrowserDownloads.URL_SCHEME.length)):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.browserDownloadsRouter),exports.browserDownloads=browserDownloads,exports.browserFiles=browserFiles;

},{"../environment":164,"./io_utils":180,"./router_registry":185}],177:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,s){function i(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(i,a)}u((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,o,n,s,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,o&&(n=2&s[0]?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){i.label=s[1];break}if(6===s[0]&&i.label<n[1]){i.label=n[1],n=s;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(s);break}n[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),util_1=require("../util"),io_utils_1=require("./io_utils"),router_registry_1=require("./router_registry"),weights_loader_1=require("./weights_loader"),OCTET_STREAM_MIME_TYPE="application/octet-stream",JSON_TYPE="application/json",HTTPRequest=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(util_1.assert("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=environment_1.env().platform.fetch,util_1.assert(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&util_1.assert(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,o,n;return __generator(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],o={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(o)],{type:JSON_TYPE}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:OCTET_STREAM_MIME_TYPE}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((n=s.sent()).ok)return[2,{modelArtifactsInfo:io_utils_1.getModelArtifactsInfoForJSON(e),responses:[n]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+n.status+".")}})})},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,o,n,s,i,a,u,h,l,c;return __generator(this,function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,e.json()];case 3:return t=f.sent(),[3,5];case 4:throw f.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=t.modelTopology,n=t.weightsManifest,s=t.generatedBy,i=t.convertedBy,a=t.format,u=t.userDefinedMetadata,null==o&&null==n)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==n?[3,7]:[4,this.loadWeights(n)];case 6:c=f.sent(),h=c[0],l=c[1],f.label=7;case 7:return[2,{modelTopology:o,weightSpecs:h,weightData:l,userDefinedMetadata:u,generatedBy:s,convertedBy:i,format:a}]}})})},e.prototype.loadWeights=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,o,n,s,i,a,u,h,l,c;return __generator(this,function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=parseUrl(t),o=r[0],n=r[1],s=this.weightPathPrefix||o,i=[],a=0,u=e;a<u.length;a++)h=u[a],i.push.apply(i,h.weights);return l=[],e.forEach(function(e){e.paths.forEach(function(e){l.push(s+e+n)})}),[4,weights_loader_1.loadWeightsAsArrayBuffer(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return c=f.sent(),[2,[i,io_utils_1.concatenateArrayBuffers(c)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function parseUrl(e){var t=e.lastIndexOf("/"),r=e.lastIndexOf("?");return[e.substring(0,t)+"/",r>t?e.substring(r):""]}function isHTTPScheme(e){return null!=e.match(HTTPRequest.URL_SCHEME_REGEX)}function http(e,t){return new HTTPRequest(e,t)}function browserHTTPRequest(e,t){return http(e,t)}exports.HTTPRequest=HTTPRequest,exports.parseUrl=parseUrl,exports.isHTTPScheme=isHTTPScheme,exports.httpRouter=function(e,t){if("undefined"==typeof fetch)return null;return(Array.isArray(e)?e.every(function(e){return isHTTPScheme(e)}):isHTTPScheme(e))?http(e,{onProgress:t}):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.httpRouter),router_registry_1.IORouterRegistry.registerLoadRouter(exports.httpRouter),exports.http=http,exports.browserHTTPRequest=browserHTTPRequest;

},{"../environment":164,"../util":294,"./io_utils":180,"./router_registry":185,"./weights_loader":187}],178:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(a,s)}u((n=n.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(e,r){var t,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(e){i=[6,e],n=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),io_utils_1=require("./io_utils"),model_management_1=require("./model_management"),router_registry_1=require("./router_registry"),DATABASE_NAME="tensorflowjs",DATABASE_VERSION=1,MODEL_STORE_NAME="models_store",INFO_STORE_NAME="model_info_store";function deleteDatabase(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){return e=getIndexedDBFactory(),[2,new Promise(function(r,t){var n=e.deleteDatabase(DATABASE_NAME);n.onsuccess=function(){return r()},n.onerror=function(e){return t(e)}})]})})}function getIndexedDBFactory(){if(!environment_1.env().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,r=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==r)throw new Error("The current browser does not appear to support IndexedDB.");return r}function setUpDatabase(e){var r=e.result;r.createObjectStore(MODEL_STORE_NAME,{keyPath:"modelPath"}),r.createObjectStore(INFO_STORE_NAME,{keyPath:"modelPath"})}exports.deleteDatabase=deleteDatabase;var BrowserIndexedDB=function(){function e(e){if(this.indexedDB=getIndexedDBFactory(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,r){var t=this;return new Promise(function(e,n){var o=t.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);o.onupgradeneeded=function(){return setUpDatabase(o)},o.onsuccess=function(){var i=o.result;if(null==r){var a=i.transaction(MODEL_STORE_NAME,"readonly"),s=a.objectStore(MODEL_STORE_NAME).get(t.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),n(new Error("Cannot find model with path '"+t.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),n(s.error)},a.oncomplete=function(){return i.close()}}else{var u,c=io_utils_1.getModelArtifactsInfoForJSON(r),d=i.transaction(INFO_STORE_NAME,"readwrite"),l=d.objectStore(INFO_STORE_NAME),f=l.put({modelPath:t.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var o=(u=i.transaction(MODEL_STORE_NAME,"readwrite")).objectStore(MODEL_STORE_NAME).put({modelPath:t.modelPath,modelArtifacts:r,modelArtifactsInfo:c});o.onsuccess=function(){return e({modelArtifactsInfo:c})},o.onerror=function(e){var r=(l=d.objectStore(INFO_STORE_NAME)).delete(t.modelPath);r.onsuccess=function(){return i.close(),n(o.error)},r.onerror=function(e){return i.close(),n(o.error)}}},f.onerror=function(e){return i.close(),n(f.error)},d.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},o.onerror=function(e){return n(o.error)}})},e.URL_SCHEME="indexeddb://",e}();function browserIndexedDB(e){return new BrowserIndexedDB(e)}function maybeStripScheme(e){return e.startsWith(BrowserIndexedDB.URL_SCHEME)?e.slice(BrowserIndexedDB.URL_SCHEME.length):e}exports.BrowserIndexedDB=BrowserIndexedDB,exports.indexedDBRouter=function(e){return environment_1.env().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(BrowserIndexedDB.URL_SCHEME)?browserIndexedDB(e.slice(BrowserIndexedDB.URL_SCHEME.length)):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.indexedDBRouter),router_registry_1.IORouterRegistry.registerLoadRouter(exports.indexedDBRouter),exports.browserIndexedDB=browserIndexedDB;var BrowserIndexedDBManager=function(){function e(){this.indexedDB=getIndexedDBFactory()}return e.prototype.listModels=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(r){return[2,new Promise(function(r,t){var n=e.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);n.onupgradeneeded=function(){return setUpDatabase(n)},n.onsuccess=function(){var e=n.result,o=e.transaction(INFO_STORE_NAME,"readonly"),i=o.objectStore(INFO_STORE_NAME).getAll();i.onsuccess=function(){for(var e={},t=0,n=i.result;t<n.length;t++){var o=n[t];e[o.modelPath]=o.modelArtifactsInfo}r(e)},i.onerror=function(r){return e.close(),t(i.error)},o.oncomplete=function(){return e.close()}},n.onerror=function(e){return t(n.error)}})]})})},e.prototype.removeModel=function(e){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(t){return e=maybeStripScheme(e),[2,new Promise(function(t,n){var o=r.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);o.onupgradeneeded=function(){return setUpDatabase(o)},o.onsuccess=function(){var r,i=o.result,a=i.transaction(INFO_STORE_NAME,"readwrite"),s=a.objectStore(INFO_STORE_NAME),u=s.get(e);u.onsuccess=function(){if(null==u.result)return i.close(),n(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=s.delete(e),a=function(){var o=(r=i.transaction(MODEL_STORE_NAME,"readwrite")).objectStore(MODEL_STORE_NAME).delete(e);o.onsuccess=function(){return t(u.result.modelArtifactsInfo)},o.onerror=function(e){return n(u.error)}};o.onsuccess=a,o.onerror=function(e){return a(),i.close(),n(u.error)}},u.onerror=function(e){return i.close(),n(u.error)},a.oncomplete=function(){null==r?i.close():r.oncomplete=function(){return i.close()}}},o.onerror=function(e){return n(o.error)}})]})})},e}();if(exports.BrowserIndexedDBManager=BrowserIndexedDBManager,environment_1.env().getBool("IS_BROWSER"))try{model_management_1.ModelStoreManagerRegistry.registerManager(BrowserIndexedDB.URL_SCHEME,new BrowserIndexedDBManager)}catch(e){}

},{"../environment":164,"./io_utils":180,"./model_management":182,"./router_registry":185}],179:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("./indexed_db"),require("./local_storage");var browser_files_1=require("./browser_files");exports.browserFiles=browser_files_1.browserFiles;var http_1=require("./http");exports.browserHTTPRequest=http_1.browserHTTPRequest,exports.http=http_1.http,exports.isHTTPScheme=http_1.isHTTPScheme;var io_utils_1=require("./io_utils");exports.concatenateArrayBuffers=io_utils_1.concatenateArrayBuffers,exports.decodeWeights=io_utils_1.decodeWeights,exports.encodeWeights=io_utils_1.encodeWeights,exports.getModelArtifactsInfoForJSON=io_utils_1.getModelArtifactsInfoForJSON;var passthrough_1=require("./passthrough");exports.fromMemory=passthrough_1.fromMemory,exports.withSaveHandler=passthrough_1.withSaveHandler;var router_registry_1=require("./router_registry");exports.getLoadHandlers=router_registry_1.getLoadHandlers,exports.getSaveHandlers=router_registry_1.getSaveHandlers,exports.registerLoadRouter=router_registry_1.registerLoadRouter,exports.registerSaveRouter=router_registry_1.registerSaveRouter;var weights_loader_1=require("./weights_loader");exports.loadWeights=weights_loader_1.loadWeights,exports.weightsLoaderFactory=weights_loader_1.weightsLoaderFactory;var model_management_1=require("./model_management");exports.copyModel=model_management_1.copyModel,exports.listModels=model_management_1.listModels,exports.moveModel=model_management_1.moveModel,exports.removeModel=model_management_1.removeModel;

},{"./browser_files":176,"./http":177,"./indexed_db":178,"./io_utils":180,"./local_storage":181,"./model_management":182,"./passthrough":183,"./router_registry":185,"./weights_loader":187}],180:[function(require,module,exports){
(function (Buffer){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,a){function i(e){try{f(n.next(e))}catch(e){a(e)}}function s(e){try{f(n.throw(e))}catch(e){a(e)}}function f(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,s)}f((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops"),util_1=require("../util"),types_1=require("./types"),NUM_BYTES_STRING_LENGTH=4;function encodeWeights(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,o,a,i,s=this;return __generator(this,function(f){switch(f.label){case 0:for(r=[],n=[],o=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e),a=function(a){var i=o[a],f=Array.isArray(e)?e[a].tensor:e[i];if("float32"!==f.dtype&&"int32"!==f.dtype&&"bool"!==f.dtype&&"string"!==f.dtype)throw new Error("Unsupported dtype in weight '"+i+"': "+f.dtype);var u={name:i,shape:f.shape,dtype:f.dtype};if("string"===f.dtype){var y=new Promise(function(e){return __awaiter(s,void 0,void 0,function(){var t,r,n,o,a,i,s;return __generator(this,function(u){switch(u.label){case 0:return[4,f.bytes()];case 1:for(t=u.sent(),r=t.reduce(function(e,t){return e+t.length},0)+NUM_BYTES_STRING_LENGTH*t.length,n=new Uint8Array(r),o=0,a=0;a<t.length;a++)i=t[a],s=new Uint8Array(new Uint32Array([i.length]).buffer),n.set(s,o),o+=NUM_BYTES_STRING_LENGTH,n.set(i,o),o+=i.length;return e(n),[2]}})})});n.push(y)}else n.push(f.data());null!=t&&(u.group=t),r.push(u)},i=0;i<o.length;++i)a(i);return[4,Promise.all(n)];case 1:return[2,{data:concatenateTypedArrays(f.sent()),specs:r}]}})})}function decodeWeights(e,t){for(var r={},n=0,o=function(t){var o=t.name,a=t.dtype,i=t.shape,s=util_1.sizeFromShape(i),f=void 0;if("quantization"in t){var u=t.quantization;if("uint8"!==u.dtype&&"uint16"!==u.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+u.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var y=types_1.DTYPE_VALUE_SIZE_MAP[u.dtype],c=e.slice(n,n+s*y),l="uint8"===u.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===a)f=Float32Array.from(l,function(e){return e*u.scale+u.min});else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);f=Int32Array.from(l,function(e){return Math.round(e*u.scale+u.min)})}n+=s*y}else if("string"===a){var p=util_1.sizeFromShape(t.shape);f=[];for(var h=0;h<p;h++){var d=new Uint32Array(e.slice(n,n+NUM_BYTES_STRING_LENGTH))[0];n+=NUM_BYTES_STRING_LENGTH;var g=new Uint8Array(e.slice(n,n+d));f.push(g),n+=d}}else{var w=types_1.DTYPE_VALUE_SIZE_MAP[a];c=e.slice(n,n+s*w);if("float32"===a)f=new Float32Array(c);else if("int32"===a)f=new Int32Array(c);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);f=new Uint8Array(c)}n+=s*w}r[o]=tensor_ops_1.tensor(f,i,a)},a=0,i=t;a<i.length;a++){o(i[a])}return r}function concatenateTypedArrays(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,r=[];e.forEach(function(e){if(t+=e.byteLength,r.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var n=new Uint8Array(t),o=0;return r.forEach(function(e){n.set(new Uint8Array(e.buffer),o),o+=e.byteLength}),n.buffer}exports.encodeWeights=encodeWeights,exports.decodeWeights=decodeWeights,exports.concatenateTypedArrays=concatenateTypedArrays;var useNodeBuffer="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function stringByteLength(e){return useNodeBuffer?Buffer.byteLength(e):new Blob([e]).size}function arrayBufferToBase64String(e){if(useNodeBuffer)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),r="",n=0,o=t.length;n<o;n++)r+=String.fromCharCode(t[n]);return btoa(r)}function base64StringToArrayBuffer(e){if(useNodeBuffer){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var r=atob(e),n=new Uint8Array(r.length),o=0;o<r.length;++o)n.set([r.charCodeAt(o)],o);return n.buffer}function concatenateArrayBuffers(e){var t=0;e.forEach(function(e){t+=e.byteLength});var r=new Uint8Array(t),n=0;return e.forEach(function(e){r.set(new Uint8Array(e),n),n+=e.byteLength}),r.buffer}function basename(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function getModelArtifactsInfoForJSON(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:stringByteLength(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:stringByteLength(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}exports.stringByteLength=stringByteLength,exports.arrayBufferToBase64String=arrayBufferToBase64String,exports.base64StringToArrayBuffer=base64StringToArrayBuffer,exports.concatenateArrayBuffers=concatenateArrayBuffers,exports.basename=basename,exports.getModelArtifactsInfoForJSON=getModelArtifactsInfoForJSON;

}).call(this,require("buffer").Buffer)
},{"../ops/tensor_ops":259,"../util":294,"./types":186,"buffer":300}],181:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))(function(n,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?n(e.value):new o(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var o,r,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),util_1=require("../util"),io_utils_1=require("./io_utils"),model_management_1=require("./model_management"),router_registry_1=require("./router_registry"),PATH_SEPARATOR="/",PATH_PREFIX="tensorflowjs_models",INFO_SUFFIX="info",MODEL_TOPOLOGY_SUFFIX="model_topology",WEIGHT_SPECS_SUFFIX="weight_specs",WEIGHT_DATA_SUFFIX="weight_data",MODEL_METADATA_SUFFIX="model_metadata";function purgeLocalStorageArtifacts(){if(!environment_1.env().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("purgeLocalStorageModels() cannot proceed because local storage is unavailable in the current environment.");for(var e=window.localStorage,t=[],o=0;o<e.length;++o){var r=e.key(o),n=PATH_PREFIX+PATH_SEPARATOR;if(r.startsWith(n)&&r.length>n.length){e.removeItem(r);var i=getModelPathFromKey(r);-1===t.indexOf(i)&&t.push(i)}}return t}function getModelKeys(e){return{info:[PATH_PREFIX,e,INFO_SUFFIX].join(PATH_SEPARATOR),topology:[PATH_PREFIX,e,MODEL_TOPOLOGY_SUFFIX].join(PATH_SEPARATOR),weightSpecs:[PATH_PREFIX,e,WEIGHT_SPECS_SUFFIX].join(PATH_SEPARATOR),weightData:[PATH_PREFIX,e,WEIGHT_DATA_SUFFIX].join(PATH_SEPARATOR),modelMetadata:[PATH_PREFIX,e,MODEL_METADATA_SUFFIX].join(PATH_SEPARATOR)}}function getModelPathFromKey(e){var t=e.split(PATH_SEPARATOR);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(PATH_SEPARATOR)}function maybeStripScheme(e){return e.startsWith(BrowserLocalStorage.URL_SCHEME)?e.slice(BrowserLocalStorage.URL_SCHEME.length):e}exports.purgeLocalStorageArtifacts=purgeLocalStorageArtifacts;var BrowserLocalStorage=function(){function e(e){if(!environment_1.env().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=getModelKeys(this.modelPath)}return e.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){var t,o,r;return __generator(this,function(n){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),o=JSON.stringify(e.weightSpecs),r=io_utils_1.getModelArtifactsInfoForJSON(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,io_utils_1.arrayBufferToBase64String(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,t,o,r,n,i,a;return __generator(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(o=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=o,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(n=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(n),t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,t.userDefinedMetadata=i.userDefinedMetadata),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=io_utils_1.base64StringToArrayBuffer(a),[2,t]})})},e.URL_SCHEME="localstorage://",e}();function browserLocalStorage(e){return new BrowserLocalStorage(e)}exports.BrowserLocalStorage=BrowserLocalStorage,exports.localStorageRouter=function(e){return environment_1.env().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(BrowserLocalStorage.URL_SCHEME)?browserLocalStorage(e.slice(BrowserLocalStorage.URL_SCHEME.length)):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.localStorageRouter),router_registry_1.IORouterRegistry.registerLoadRouter(exports.localStorageRouter),exports.browserLocalStorage=browserLocalStorage;var BrowserLocalStorageManager=function(){function e(){util_1.assert(environment_1.env().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),util_1.assert("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return __awaiter(this,void 0,void 0,function(){var e,t,o,r,n,i;return __generator(this,function(a){for(e={},t=PATH_PREFIX+PATH_SEPARATOR,o=PATH_SEPARATOR+INFO_SUFFIX,r=0;r<this.LS.length;++r)(n=this.LS.key(r)).startsWith(t)&&n.endsWith(o)&&(i=getModelPathFromKey(n),e[i]=JSON.parse(this.LS.getItem(n)));return[2,e]})})},e.prototype.removeModel=function(e){return __awaiter(this,void 0,void 0,function(){var t,o;return __generator(this,function(r){if(e=maybeStripScheme(e),t=getModelKeys(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return o=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,o]})})},e}();if(exports.BrowserLocalStorageManager=BrowserLocalStorageManager,environment_1.env().getBool("IS_BROWSER"))try{model_management_1.ModelStoreManagerRegistry.registerManager(BrowserLocalStorage.URL_SCHEME,new BrowserLocalStorageManager)}catch(e){}

},{"../environment":164,"../util":294,"./io_utils":180,"./model_management":182,"./router_registry":185}],182:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,a){function i(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,s)}u((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util"),router_registry_1=require("./router_registry"),URL_SCHEME_SUFFIX="://",ModelStoreManagerRegistry=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,r){util_1.assert(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(URL_SCHEME_SUFFIX)&&(t=t.slice(0,t.indexOf(URL_SCHEME_SUFFIX))),util_1.assert(t.length>0,function(){return"scheme must not be an empty string."});var n=e.getInstance();util_1.assert(null==n.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),n.managers[t]=r},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function parseURL(e){if(-1===e.indexOf(URL_SCHEME_SUFFIX))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ModelStoreManagerRegistry.getSchemes().join(","));return{scheme:e.split(URL_SCHEME_SUFFIX)[0],path:e.split(URL_SCHEME_SUFFIX)[1]}}function cloneModelInternal(e,t,r){return void 0===r&&(r=!1),__awaiter(this,void 0,void 0,function(){var n,o,a,i,s,u,l,c,d;return __generator(this,function(f){switch(f.label){case 0:return util_1.assert(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),n=router_registry_1.IORouterRegistry.getLoadHandlers(e),util_1.assert(n.length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),util_1.assert(n.length<2,function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+e+"."}),o=n[0],a=router_registry_1.IORouterRegistry.getSaveHandlers(t),util_1.assert(a.length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),util_1.assert(a.length<2,function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+t+"."}),i=a[0],s=parseURL(e).scheme,u=parseURL(e).path,l=s===parseURL(e).scheme,[4,o.load()];case 1:return c=f.sent(),r&&l?[4,ModelStoreManagerRegistry.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,i.save(c)];case 4:return d=f.sent(),!r||l?[3,6]:[4,ModelStoreManagerRegistry.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}function listModels(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,o,a,i;return __generator(this,function(s){switch(s.label){case 0:e=ModelStoreManagerRegistry.getSchemes(),t={},r=0,n=e,s.label=1;case 1:return r<n.length?(o=n[r],[4,ModelStoreManagerRegistry.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+URL_SCHEME_SUFFIX+i]=a[i];s.label=3;case 3:return r++,[3,1];case 4:return[2,t]}})})}function removeModel(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){return t=parseURL(e),[2,ModelStoreManagerRegistry.getManager(t.scheme).removeModel(t.path)]})})}function copyModel(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,cloneModelInternal(e,t,!1)]})})}function moveModel(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,cloneModelInternal(e,t,!0)]})})}exports.ModelStoreManagerRegistry=ModelStoreManagerRegistry,exports.listModels=listModels,exports.removeModel=removeModel,exports.copyModel=copyModel,exports.moveModel=moveModel;

},{"../util":294,"./router_registry":185}],183:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function u(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,u)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var PassthroughLoader=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.modelArtifacts]})})},e}(),PassthroughSaver=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.saveHandler(e)]})})},e}();function fromMemory(e,t,r,n){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new PassthroughLoader(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new PassthroughLoader({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new PassthroughLoader({modelTopology:e,weightSpecs:t,weightData:r,trainingConfig:n}))}function withSaveHandler(e){return new PassthroughSaver(e)}exports.fromMemory=fromMemory,exports.withSaveHandler=withSaveHandler;

},{}],184:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");function monitorPromisesProgress(r,t,n,e){!function(r){util_1.assert(null!=r&&Array.isArray(r)&&r.length>0,function(){return"promises must be a none empty array"})}(r),function(r,t){util_1.assert(r>=0&&r<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+r}),util_1.assert(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),util_1.assert(t>=r,function(){return"startFraction must be no more than endFraction, but got startFraction "+r+" and endFraction "+t})}(n=null==n?0:n,e=null==e?1:e);var o=0;return Promise.all(r.map(function(s){return s.then(function(s){var i=n+ ++o/r.length*(e-n);return t(i),s}),s}))}exports.monitorPromisesProgress=monitorPromisesProgress;

},{"../util":294}],185:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var IORouterRegistry=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,r){return e.getHandlers(t,"load",r)},e.getHandlers=function(t,r,n){var s=[];return("load"===r?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var r=e(t,n);null!==r&&s.push(r)}),s},e}();exports.IORouterRegistry=IORouterRegistry,exports.registerSaveRouter=function(e){return IORouterRegistry.registerSaveRouter(e)},exports.registerLoadRouter=function(e){return IORouterRegistry.registerLoadRouter(e)},exports.getSaveHandlers=function(e){return IORouterRegistry.getSaveHandlers(e)},exports.getLoadHandlers=function(e,t){return IORouterRegistry.getLoadHandlers(e,t)};

},{}],186:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DTYPE_VALUE_SIZE_MAP={float32:4,int32:4,uint16:2,uint8:1,bool:1};

},{}],187:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(a,s)}u((n=n.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(e,r){var t,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(e){i=[6,e],n=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),util=require("../util"),io_utils_1=require("./io_utils"),progress_1=require("./progress"),types_1=require("./types");function loadWeightsAsArrayBuffer(e,r){return __awaiter(this,void 0,void 0,function(){var t,n,o,i,a,s,u,c,f;return __generator(this,function(l){switch(l.label){case 0:return null==r&&(r={}),t=null==r.fetchFunc?environment_1.env().platform.fetch:r.fetchFunc,n=e.map(function(e){return t(e,r.requestInit,{isBinary:!0})}),o=0,i=.5,null!=r.onProgress?[3,2]:[4,Promise.all(n)];case 1:return a=l.sent(),[3,4];case 2:return[4,progress_1.monitorPromisesProgress(n,r.onProgress,o,i)];case 3:a=l.sent(),l.label=4;case 4:return s=a.map(function(e){return e.arrayBuffer()}),u=.5,c=1,null!=r.onProgress?[3,6]:[4,Promise.all(s)];case 5:return f=l.sent(),[3,8];case 6:return[4,progress_1.monitorPromisesProgress(s,r.onProgress,u,c)];case 7:f=l.sent(),l.label=8;case 8:return[2,f]}})})}function loadWeights(e,r,t,n){return void 0===r&&(r=""),__awaiter(this,void 0,void 0,function(){return __generator(this,function(o){return[2,weightsLoaderFactory(function(e){return loadWeightsAsArrayBuffer(e,{requestInit:n})})(e,r,t)]})})}function weightsLoaderFactory(e){var r=this;return function(t,n,o){return void 0===n&&(n=""),__awaiter(r,void 0,void 0,function(){var r,i,a,s,u,c,f,l,h,p;return __generator(this,function(y){switch(y.label){case 0:if(r=t.map(function(){return!1}),i={},a=null!=o?o.map(function(){return!1}):[],s=[],t.forEach(function(e,t){var n=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,c=types_1.DTYPE_VALUE_SIZE_MAP[u]*util.sizeFromShape(e.shape),f=function(){r[t]=!0,null==i[t]&&(i[t]=[]),i[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=o?o.forEach(function(r,t){r===e.name&&(f(),a[t]=!0)}):f(),s.push(e.name),n+=c})}),!a.every(function(e){return e}))throw u=o.filter(function(e,r){return!a[r]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return c=r.reduce(function(e,r,t){return r&&e.push(t),e},[]),f=[],c.forEach(function(e){t[e].paths.forEach(function(e){var r=n+(n.endsWith("/")?"":"/")+e;f.push(r)})}),[4,e(f)];case 1:return l=y.sent(),h={},p=0,c.forEach(function(e){for(var r=t[e].paths.length,n=0,o=0;o<r;o++)n+=l[p+o].byteLength;for(var a=new ArrayBuffer(n),s=new Uint8Array(a),u=0,c=0;c<r;c++){var f=new Uint8Array(l[p+c]);s.set(f,u),u+=f.byteLength}i[e].forEach(function(e){var r=a.slice(e.groupOffset,e.groupOffset+e.sizeBytes),t=io_utils_1.decodeWeights(r,[e.manifestEntry]);for(var n in t)h[n]=t[n]}),p+=r}),[2,h]}})})}}exports.loadWeightsAsArrayBuffer=loadWeightsAsArrayBuffer,exports.loadWeights=loadWeights,exports.weightsLoaderFactory=weightsLoaderFactory;

},{"../environment":164,"../util":294,"./io_utils":180,"./progress":184,"./types":186}],188:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Div="Div",exports.SquaredDifference="SquaredDifference",exports.Square="Square",exports.NonMaxSuppressionV5="NonMaxSuppressionV5",exports.BroadcastTo="BroadcastTo",exports.OneHot="OneHot",exports.Identity="Identity",exports.Tile="Tile",exports.FromPixels="FromPixels";

},{}],189:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var kernelRegistry=new Map,gradRegistry=new Map;function getKernel(e,r){var t=makeKey(e,r);return kernelRegistry.get(t)}function getGradient(e){return gradRegistry.get(e)}function getKernelsForBackend(e){for(var r=kernelRegistry.entries(),t=[];;){var n=r.next(),i=n.done,s=n.value;if(i)break;var a=s[0],g=s[1];a.split("_")[0]===e&&t.push(g)}return t}function registerKernel(e){var r=e.kernelName,t=e.backendName,n=makeKey(r,t);if(kernelRegistry.has(n))throw new Error("The kernel '"+r+"' for backend '"+t+"' is already registered");kernelRegistry.set(n,e)}function registerGradient(e){var r=e.kernelName;gradRegistry.has(r)&&console.warn("Overriding the gradient for '"+r+"'"),gradRegistry.set(r,e)}function unregisterKernel(e,r){var t=makeKey(e,r);if(!kernelRegistry.has(t))throw new Error("The kernel '"+e+"' for backend '"+r+"' is not registered");kernelRegistry.delete(t)}function unregisterGradient(e){if(!gradRegistry.has(e))throw new Error("The gradient '"+e+"' for backend is not registered");gradRegistry.delete(e)}function makeKey(e,r){return r+"_"+e}exports.getKernel=getKernel,exports.getGradient=getGradient,exports.getKernelsForBackend=getKernelsForBackend,exports.registerKernel=registerKernel,exports.registerGradient=registerGradient,exports.unregisterKernel=unregisterKernel,exports.unregisterGradient=unregisterGradient;

},{}],190:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment");function warn(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];environment_1.env().getBool("IS_TEST")||console.warn.apply(console,e)}function log(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];environment_1.env().getBool("IS_TEST")||console.log.apply(console,e)}exports.warn=warn,exports.log=log;

},{"./environment":164}],191:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var confusion_matrix_1=require("./ops/confusion_matrix");exports.confusionMatrix=confusion_matrix_1.confusionMatrix;

},{"./ops/confusion_matrix":206}],192:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(o,s){function a(e){try{i(r.next(e))}catch(e){s(e)}}function u(e){try{i(r.throw(e))}catch(e){s(e)}}function i(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(a,u)}i((r=r.apply(e,n||[])).next())})},__generator=this&&this.__generator||function(e,n){var t,r,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=n.call(e,a)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_1=require("../tensor"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),axis_util_1=require("./axis_util"),concat_split_1=require("./concat_split"),operation_1=require("./operation");function reshape_(e,n){var t=tensor_util_env_1.convertToTensor(e,"x","reshape",null);n=util.inferFromImplicitShape(n,t.size),util.assert(t.size===util.sizeFromShape(n),function(){return"new shape and old shape must have the same number of elements."});var r={shape:n};return engine_1.ENGINE.runKernelFunc(function(e){return e.reshape(t,n)},{x:t},function(e){return{x:function(){return e.reshape(t.shape)}}},"Reshape",r)}function squeeze_(e,n){var t=tensor_util_env_1.convertToTensor(e,"x","squeeze");return exports.reshape(t,util.squeezeShape(t.shape,n).newShape)}function cast_(e,n){var t=tensor_util_env_1.convertToTensor(e,"x","cast");if(!util.isValidDtype(n))throw new Error("Failed to cast to unknown dtype "+n);if("string"===n&&"string"!==t.dtype||"string"!==n&&"string"===t.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:n};return engine_1.ENGINE.runKernelFunc(function(e){return e.cast(t,n)},{x:t},function(e){return{x:function(){return e.clone()}}},"Cast",r)}function pad1d_(e,n,t){return void 0===t&&(t=0),util.assert(2===n.length,function(){return"Invalid number of paddings. Must be length of 2."}),exports.pad(e,[n],t)}function pad2d_(e,n,t){return void 0===t&&(t=0),util.assert(2===n.length&&2===n[0].length&&2===n[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),exports.pad(e,n,t)}function pad3d_(e,n,t){return void 0===t&&(t=0),util.assert(3===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),exports.pad(e,n,t)}function pad4d_(e,n,t){return void 0===t&&(t=0),util.assert(4===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length&&2===n[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),exports.pad(e,n,t)}function pad_(e,n,t){void 0===t&&(t=0);var r=tensor_util_env_1.convertToTensor(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:n,constantValue:t};return engine_1.ENGINE.runKernelFunc(function(e){return e.pad(r,n,t)},{x:r},function(e){var t=n.map(function(e){return e[0]});return{x:function(){return e.slice(t,r.shape)}}},"PadV2",o)}function stack_(e,n){void 0===n&&(n=0);var t=tensor_util_env_1.convertToTensorArray(e,"tensors","stack");if(util.assert(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===t.length)return t[0].expandDims(n);var r=t[0].rank,o=t[0].shape,s=t[0].dtype;util.assert(n<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(e){util.assertShapesMatch(o,e.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(e){util.assert(s===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(e){return e.expandDims(n)});return concat_split_1.concat(a,n)}function batchToSpaceND_(e,n,t){var r=tensor_util_env_1.convertToTensor(e,"x","batchToSpaceND"),o=n.reduce(function(e,n){return e*n});util.assert(r.rank>=1+n.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+n.length}),util.assert(t.length===n.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+n.length}),util.assert(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+o});return engine_1.ENGINE.runKernelFunc(function(e){return e.batchToSpaceND(r,n,t)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(n,t)}}})}function spaceToBatchND_(e,n,t){var r=tensor_util_env_1.convertToTensor(e,"x","spaceToBatchND");util.assert(r.rank>=1+n.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+n.length}),util.assert(t.length===n.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+n.length}),util.assert(r.shape.reduce(function(e,r,o){return o>0&&o<=n.length?e&&(r+t[o-1][0]+t[o-1][1])%n[o-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+n.toString()});return engine_1.ENGINE.runKernelFunc(function(e){return e.spaceToBatchND(r,n,t)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(n,t)}}})}function unstack_(e,n){void 0===n&&(n=0),n=n||0;var t=tensor_util_env_1.convertToTensor(e,"x","unstack");util.assert(n>=-t.shape.length&&n<t.shape.length,function(){return"Axis = "+n+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),n<0&&(n+=t.shape.length);var r={axis:n};return engine_1.ENGINE.runKernelFunc(function(e){return e.unstack(t,n)},{x:t},function(e){return{x:function(){return exports.stack(e,n)}}},"Unpack",r)}function cumsum_(e,n,t,r){void 0===n&&(n=0),void 0===t&&(t=!1),void 0===r&&(r=!1);var o=tensor_util_env_1.convertToTensor(e,"x","cumsum");n|=0;var s=axis_util_1.getAxesPermutation([n],o.rank),a=o;null!=s&&(a=o.transpose(s));var u=axis_util_1.getInnerMostAxes(1,o.rank)[0],i=engine_1.ENGINE.runKernelFunc(function(e){return e.cumsum(a,u,t,r)},{permutedX:a},function(e){return{permutedX:function(){return e.cumsum(n,t,!r)}}});return null!=s&&(i=i.transpose(s)),i}function expandDims_(e,n){void 0===n&&(n=0);var t=tensor_util_env_1.convertToTensor(e,"x","expandDims",null);util.assert(n<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return n<0&&(util.assert(-(t.rank+1)<=n,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),n=t.rank+n+1),r.splice(n,0,1),exports.reshape(t,r)}function depthToSpace_(e,n,t){void 0===t&&(t="NHWC");var r=tensor_util_env_1.convertToTensor(e,"x","depthToSpace"),o="NHWC"===t?r.shape[1]:r.shape[2],s="NHWC"===t?r.shape[2]:r.shape[3],a="NHWC"===t?r.shape[3]:r.shape[1];return util.assert(o*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+n+"  for depthToSpace with input shape\n      "+r.shape}),util.assert(s*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+s+" and "+n+" for depthToSpace with input shape\n          "+r.shape}),util.assert(a%(n*n)==0,function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+a+" for depthToSpace with input shape "+r.shape}),engine_1.ENGINE.runKernelFunc(function(e){return e.depthToSpace(r,n,t)},{$x:r})}function setdiff1dAsync_(e,n){return __awaiter(this,void 0,void 0,function(){var t,r,o,s,a,u,i,p,c,l;return __generator(this,function(h){switch(h.label){case 0:return t=tensor_util_env_1.convertToTensor(e,"x","setdiff1d"),r=tensor_util_env_1.convertToTensor(n,"y","setdiff1d"),util.assert(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),util.assert(1===t.rank,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),util.assert(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return o=h.sent(),[4,r.data()];case 2:for(s=h.sent(),a=new Set(s),u=0,c=0;c<o.length;c++)a.has(o[c])||u++;for(i=new tensor_1.TensorBuffer([u],t.dtype),p=new tensor_1.TensorBuffer([u],"int32"),c=0,l=0;c<o.length;c++)a.has(o[c])||(i.values[l]=o[c],p.values[l]=c,l++);return[2,[i.toTensor(),p.toTensor()]]}})})}function buffer(e,n,t){return void 0===n&&(n="float32"),n=n||"float32",util.assertNonNegativeIntegerDimensions(e),new tensor_1.TensorBuffer(e,n,t)}function print(e,n){void 0===n&&(n=!1),console.log(e.toString(n))}exports.buffer=buffer,exports.print=print,exports.batchToSpaceND=operation_1.op({batchToSpaceND_:batchToSpaceND_}),exports.cast=operation_1.op({cast_:cast_}),exports.cumsum=operation_1.op({cumsum_:cumsum_}),exports.depthToSpace=operation_1.op({depthToSpace_:depthToSpace_}),exports.expandDims=operation_1.op({expandDims_:expandDims_}),exports.pad=operation_1.op({pad_:pad_}),exports.pad1d=operation_1.op({pad1d_:pad1d_}),exports.pad2d=operation_1.op({pad2d_:pad2d_}),exports.pad3d=operation_1.op({pad3d_:pad3d_}),exports.pad4d=operation_1.op({pad4d_:pad4d_}),exports.reshape=operation_1.op({reshape_:reshape_}),exports.spaceToBatchND=operation_1.op({spaceToBatchND_:spaceToBatchND_}),exports.squeeze=operation_1.op({squeeze_:squeeze_}),exports.stack=operation_1.op({stack_:stack_}),exports.unstack=operation_1.op({unstack_:unstack_}),exports.setdiff1dAsync=setdiff1dAsync_;

},{"../engine":163,"../tensor":287,"../tensor_util_env":290,"../util":294,"./axis_util":194,"./concat_split":204,"./operation":232}],193:[function(require,module,exports){
"use strict";function getReshaped(e,t,r,s){void 0===s&&(s=!0);var u=[];if(s)(u=u.concat(t.slice(0))).push(e[0]/r),u=u.concat(e.slice(1));else{u=u.concat(e[0]);for(var p=t.length,o=0;o<p;++o)u=u.concat([e[o+1]/t[o],t[o]]);u=u.concat(e.slice(p+1))}return u}function getPermuted(e,t,r){void 0===r&&(r=!0);var s=[];if(r){s.push(t);for(var u=t+1;u<e;++u)u<=2*t?(s.push(u),s.push(u-(t+1))):s.push(u)}else{var p=[],o=[];for(u=1;u<e;++u)u>=2*t+1||u%2==1?o.push(u):p.push(u);s.push.apply(s,p),s.push(0),s.push.apply(s,o)}return s}function getReshapedPermuted(e,t,r,s){void 0===s&&(s=!0);var u=[];s?u.push(e[0]/r):u.push(e[0]*r);for(var p=1;p<e.length;++p)p<=t.length?s?u.push(t[p-1]*e[p]):u.push(e[p]/t[p-1]):u.push(e[p]);return u}function getSliceBeginCoords(e,t){for(var r=[0],s=0;s<t;++s)r.push(e[s][0]);return r}function getSliceSize(e,t,r){for(var s=e.slice(0,1),u=0;u<r;++u)s.push(e[u+1]-t[u][0]-t[u][1]);return s}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getReshaped=getReshaped,exports.getPermuted=getPermuted,exports.getReshapedPermuted=getReshapedPermuted,exports.getSliceBeginCoords=getSliceBeginCoords,exports.getSliceSize=getSliceSize;

},{}],194:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function axesAreInnerMostDims(e,n){for(var t=0;t<e.length;++t)if(e[e.length-t-1]!==n-1-t)return!1;return!0}function combineLocations(e,n,t){for(var r=e.length+n.length,o=[],s=0,u=0,i=0;i<r;i++)-1===t.indexOf(i)?o.push(e[s++]):o.push(n[u++]);return o}function computeOutAndReduceShapes(e,n){for(var t=[],r=e.length,o=0;o<r;o++)-1===n.indexOf(o)&&t.push(e[o]);return[t,n.map(function(n){return e[n]})]}function expandShapeToKeepDim(e,n){return combineLocations(e,n.map(function(e){return 1}),n)}function assertAxesAreInnerMostDims(e,n,t){util.assert(axesAreInnerMostDims(n,t),function(){return e+" supports only inner-most axes for now. Got axes "+n+" and rank-"+t+" input."})}function getAxesPermutation(e,n){if(axesAreInnerMostDims(e,n))return null;for(var t=[],r=0;r<n;++r)-1===e.indexOf(r)&&t.push(r);return e.forEach(function(e){return t.push(e)}),t}function getUndoAxesPermutation(e){return e.map(function(e,n){return[n,e]}).sort(function(e,n){return e[1]-n[1]}).map(function(e){return e[0]})}function getInnerMostAxes(e,n){for(var t=[],r=n-e;r<n;++r)t.push(r);return t}exports.axesAreInnerMostDims=axesAreInnerMostDims,exports.combineLocations=combineLocations,exports.computeOutAndReduceShapes=computeOutAndReduceShapes,exports.expandShapeToKeepDim=expandShapeToKeepDim,exports.assertAxesAreInnerMostDims=assertAxesAreInnerMostDims,exports.getAxesPermutation=getAxesPermutation,exports.getUndoAxesPermutation=getUndoAxesPermutation,exports.getInnerMostAxes=getInnerMostAxes;

},{"../util":294}],195:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),broadcast_util_1=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops"),tile_1=require("./tile"),unary_ops_1=require("./unary_ops");function batchNorm2d_(r,n,a,t,o,e){var s,u,i=tensor_util_env_1.convertToTensor(r,"x","batchNorm"),c=tensor_util_env_1.convertToTensor(n,"mean","batchNorm"),l=tensor_util_env_1.convertToTensor(a,"variance","batchNorm");return null!=o&&(s=tensor_util_env_1.convertToTensor(o,"scale","batchNorm")),null!=t&&(u=tensor_util_env_1.convertToTensor(t,"offset","batchNorm")),util.assert(2===i.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+i.rank+"."}),util.assert(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),util.assert(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=s&&util.assert(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),null!=u&&util.assert(2===u.rank||1===u.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."}),batchNorm_(i,c,l,u,s,e)}function batchNorm3d_(r,n,a,t,o,e){var s,u,i=tensor_util_env_1.convertToTensor(r,"x","batchNorm"),c=tensor_util_env_1.convertToTensor(n,"mean","batchNorm"),l=tensor_util_env_1.convertToTensor(a,"variance","batchNorm");return null!=o&&(s=tensor_util_env_1.convertToTensor(o,"scale","batchNorm")),null!=t&&(u=tensor_util_env_1.convertToTensor(t,"offset","batchNorm")),util.assert(3===i.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+i.rank+"."}),util.assert(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),util.assert(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=s&&util.assert(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),null!=u&&util.assert(3===u.rank||1===u.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."}),batchNorm_(i,c,l,u,s,e)}function batchNorm4d_(r,n,a,t,o,e){var s,u,i=tensor_util_env_1.convertToTensor(r,"x","batchNorm"),c=tensor_util_env_1.convertToTensor(n,"mean","batchNorm"),l=tensor_util_env_1.convertToTensor(a,"variance","batchNorm");return null!=o&&(s=tensor_util_env_1.convertToTensor(o,"scale","batchNorm")),null!=t&&(u=tensor_util_env_1.convertToTensor(t,"offset","batchNorm")),util.assert(4===i.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+i.rank+"."}),util.assert(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),util.assert(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=s&&util.assert(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),null!=u&&util.assert(4===u.rank||1===u.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."}),batchNorm_(i,c,l,u,s,e)}function batchNormalization_(r,n,a,t,o,e){return void 0===t&&(t=.001),warnDeprecation(),batchNorm_(r,n,a,e,o,t)}function batchNorm_(r,n,a,t,o,e){null==e&&(e=.001);var s,u,i,c=tensor_util_env_1.convertToTensor(r,"x","batchNorm"),l=tensor_util_env_1.convertToTensor(n,"mean","batchNorm"),_=tensor_util_env_1.convertToTensor(a,"variance","batchNorm");null!=o&&(s=tensor_util_env_1.convertToTensor(o,"scale","batchNorm")),null!=t&&(u=tensor_util_env_1.convertToTensor(t,"offset","batchNorm")),util.assert(l.rank===_.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),util.assert(null==u||l.rank===u.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),util.assert(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),i=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var m=[c,l,_,s];return engine_1.ENGINE.runKernelFunc(function(r,n){var a=r.batchNormalization(i,batchnormReshape4D(l),batchnormReshape4D(_),e,batchnormReshape4D(s),batchnormReshape4D(u));return n([c,l,_,s]),a},{x:c,mean:l,variance:_,scale:s,offset:u},function(r,n){var a=n,t=a[0],o=a[1],s=a[2],u=a[3],c=null==u?tensor_ops_1.scalar(1):u,l=broadcast_util_1.getReductionAxes(o.shape,i.shape),_=[];if(1===o.rank){for(var m=0;m<i.shape.length-1;++m)_.push(i.shape[m]);_.push(1)}var h=t.sub(o),b=r.mul(c),k=unary_ops_1.rsqrt(s.add(tensor_ops_1.scalar(e))),p=k.mul(k).mul(k).mul(tensor_ops_1.scalar(-.5));return{x:function(){return 1===o.rank?r.mul(tile_1.tile(k.as4D(1,1,1,o.shape[0]),_)).mul(c).reshape(t.shape):r.mul(k).mul(c).reshape(t.shape)},mean:function(){var r=k.mul(tensor_ops_1.scalar(-1)).mul(b);return 1===o.rank&&(r=r.sum(l)),r.reshape(o.shape)},variance:function(){var r=p.mul(h).mul(b);return 1===o.rank&&(r=r.sum(l)),r.reshape(o.shape)},scale:function(){var n=h.mul(k),a=r.mul(n);return 1===o.rank&&(a=a.sum(l)),a.reshape(o.shape)},offset:function(){var n=r;return 1===o.rank&&(n=n.sum(l)),n.reshape(o.shape)}}},"BatchNormalization",{varianceEpsilon:e},m).reshape(c.shape)}function batchnormReshape4D(r){return null==r?null:0===r.rank?r.as1D():1===r.rank?r:2===r.rank?r.as4D(1,1,r.shape[0],r.shape[1]):3===r.rank?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function batchNormalization2d_(r,n,a,t,o,e){return void 0===t&&(t=.001),warnDeprecation(),batchNorm2d_(r,n,a,e,o,t)}function batchNormalization3d_(r,n,a,t,o,e){return void 0===t&&(t=.001),warnDeprecation(),batchNorm3d_(r,n,a,e,o,t)}function batchNormalization4d_(r,n,a,t,o,e){return void 0===t&&(t=.001),warnDeprecation(),batchNorm4d_(r,n,a,e,o,t)}function warnDeprecation(){globals_1.deprecationWarn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}exports.batchNormalization2d=operation_1.op({batchNormalization2d_:batchNormalization2d_}),exports.batchNormalization3d=operation_1.op({batchNormalization3d_:batchNormalization3d_}),exports.batchNormalization4d=operation_1.op({batchNormalization4d_:batchNormalization4d_}),exports.batchNormalization=operation_1.op({batchNormalization_:batchNormalization_}),exports.batchNorm=operation_1.op({batchNorm_:batchNorm_}),exports.batchNorm2d=operation_1.op({batchNorm2d_:batchNorm2d_}),exports.batchNorm3d=operation_1.op({batchNorm3d_:batchNorm3d_}),exports.batchNorm4d=operation_1.op({batchNorm4d_:batchNorm4d_});

},{"../engine":163,"../globals":166,"../tensor_util_env":290,"../util":294,"./broadcast_util":199,"./operation":232,"./tensor_ops":259,"./tile":260,"./unary_ops":264}],196:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),broadcast_util=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops"),unary_ops_1=require("./unary_ops");function add_(t,e){var r,n=tensor_util_env_1.convertToTensor(t,"a","add"),o=tensor_util_env_1.convertToTensor(e,"b","add");r=tensor_util_1.makeTypesMatch(n,o),n=r[0],o=r[1];var a=broadcast_util.assertAndGetBroadcastShape(n.shape,o.shape);return engine_1.ENGINE.runKernelFunc(function(t){return t.add(n,o)},{a:n,b:o},function(t){return{a:function(){var e=t,r=broadcast_util.getReductionAxes(n.shape,a);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},b:function(){var e=t,r=broadcast_util.getReductionAxes(o.shape,a);return r.length>0&&(e=e.sum(r)),e.reshape(o.shape)}}},"Add")}function addN_(t){util.assert(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),util.assert(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(t,e){return tensor_util_env_1.convertToTensor(t,"tensors"+e,"addN")}),r=e[0];e.forEach(function(t){if(t.dtype!==r.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(t){if(!util.arraysEqual(t.shape,r.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return engine_1.ENGINE.runKernelFunc(function(t){return t.addN(e)},n,function(t){var r={};return e.forEach(function(e,n){r[n]=function(){return t.clone()}}),r},"AddN")}function addStrict_(t,e){var r=tensor_util_env_1.convertToTensor(t,"a","addStrict"),n=tensor_util_env_1.convertToTensor(e,"b","addStrict");return util.assertShapesMatch(r.shape,n.shape,"Error in addStrict: "),r.add(n)}function sub_(t,e){var r,n=tensor_util_env_1.convertToTensor(t,"a","sub"),o=tensor_util_env_1.convertToTensor(e,"b","sub");r=tensor_util_1.makeTypesMatch(n,o),n=r[0],o=r[1];var a=broadcast_util.assertAndGetBroadcastShape(n.shape,o.shape);return engine_1.ENGINE.runKernelFunc(function(t){return t.subtract(n,o)},{a:n,b:o},function(t){return{a:function(){var e=t,r=broadcast_util.getReductionAxes(n.shape,a);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},b:function(){var e=t,r=broadcast_util.getReductionAxes(o.shape,a);return r.length>0&&(e=e.sum(r)),e.neg().reshape(o.shape)}}},"Sub")}function subStrict_(t,e){var r=tensor_util_env_1.convertToTensor(t,"a","subStrict"),n=tensor_util_env_1.convertToTensor(e,"b","subStrict");return util.assertShapesMatch(r.shape,n.shape,"Error in subStrict: "),r.sub(n)}function pow_(t,e){var r,n=tensor_util_env_1.convertToTensor(t,"base","pow"),o=tensor_util_env_1.convertToTensor(e,"exp","pow");r=tensor_util_1.makeTypesMatch(n,o),n=r[0],o=r[1];var a=broadcast_util.assertAndGetBroadcastShape(n.shape,o.shape),s=[n,o];return engine_1.ENGINE.runKernelFunc(function(t,e){var r=t.pow(n,o);return e([n,o,r]),r},{a:n,b:o},function(t,e){var r=e[0],n=e[1],o=e[2];return{a:function(){var e=n.toFloat(),o=t.mul(e.mul(r.pow(e.sub(tensor_ops_1.scalar(1))))),s=broadcast_util.getReductionAxes(r.shape,a);return s.length>0&&(o=o.sum(s)),o.reshape(r.shape)},b:function(){var e=r.greater(0),s=r.log().where(e,tensor_ops_1.zerosLike(r)),u=t.mul(o.mul(s)),i=broadcast_util.getReductionAxes(n.shape,a);return i.length>0&&(u=u.sum(i)),u.reshape(n.shape)}}},"Pow",{},s,[!0])}function powStrict_(t,e){return util.assertShapesMatch(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}function mul_(t,e){var r,n=tensor_util_env_1.convertToTensor(t,"a","mul"),o=tensor_util_env_1.convertToTensor(e,"b","mul");r=tensor_util_1.makeTypesMatch(n,o),n=r[0],o=r[1];var a=broadcast_util.assertAndGetBroadcastShape(n.shape,o.shape);return engine_1.ENGINE.runKernelFunc(function(t,e){var r=t.multiply(n,o);return e([n,o]),r},{a:n,b:o},function(t,e){var r=e[0],n=e[1];return{a:function(){var e=t.mul(n.toFloat()),o=broadcast_util.getReductionAxes(r.shape,a);return o.length>0?e.sum(o).reshape(r.shape):e},b:function(){var e=t.mul(r.toFloat()),o=broadcast_util.getReductionAxes(n.shape,a);return o.length>0?e.sum(o).reshape(n.shape):e}}},"Mul")}function mulStrict_(t,e){var r=tensor_util_env_1.convertToTensor(t,"a","mul"),n=tensor_util_env_1.convertToTensor(e,"b","mul");return util.assertShapesMatch(r.shape,n.shape,"Error in multiplyStrict: "),r.mul(n)}function floorDiv_(t,e){var r,n=tensor_util_env_1.convertToTensor(t,"a","floorDiv"),o=tensor_util_env_1.convertToTensor(e,"b","floorDiv");r=tensor_util_1.makeTypesMatch(n,o),n=r[0],o=r[1];var a=broadcast_util.assertAndGetBroadcastShape(n.shape,o.shape);return engine_1.ENGINE.runKernelFunc(function(t,e){var r=t.floorDiv(n,o);return e([n,o]),r},{a:n,b:o},function(t,e){var r=e[0],n=e[1];return{a:function(){var e=t.div(n.toFloat()),o=broadcast_util.getReductionAxes(r.shape,a);return o.length>0?e.sum(o).reshape(r.shape):e},b:function(){var e=t.mul(r.toFloat()),o=broadcast_util.getReductionAxes(n.shape,a);o.length>0&&(e=e.sum(o).reshape(n.shape));var s=n.square();return e.div(s.toFloat()).neg()}}},"FloorDiv")}function divStrict_(t,e){var r=tensor_util_env_1.convertToTensor(t,"a","div"),n=tensor_util_env_1.convertToTensor(e,"b","div");return util.assertShapesMatch(r.shape,n.shape,"Error in divideStrict: "),r.div(n)}function mod_(t,e){var r,n=tensor_util_env_1.convertToTensor(t,"a","mod"),o=tensor_util_env_1.convertToTensor(e,"b","mod");r=tensor_util_1.makeTypesMatch(n,o),n=r[0],o=r[1];var a=broadcast_util.assertAndGetBroadcastShape(n.shape,o.shape);return engine_1.ENGINE.runKernelFunc(function(t,e){var r=t.mod(n,o);return e([n,o]),r},{$a:n,$b:o},function(t,e){var r=e[0],n=e[1];return{$a:function(){var e=broadcast_util.getReductionAxes(r.shape,a);return e.length>0?t.sum(e).reshape(r.shape):t},$b:function(){var e=t.mul(r.div(n).floor().neg()),o=broadcast_util.getReductionAxes(n.shape,a);return o.length>0?e.sum(o).reshape(n.shape):e}}})}function modStrict_(t,e){var r=tensor_util_env_1.convertToTensor(t,"a","modStrict"),n=tensor_util_env_1.convertToTensor(e,"b","modStrict");return util.assertShapesMatch(r.shape,n.shape,"Error in modStrict: "),r.mod(n)}function minimum_(t,e){var r,n=tensor_util_env_1.convertToTensor(t,"a","minimum"),o=tensor_util_env_1.convertToTensor(e,"b","minimum");r=tensor_util_1.makeTypesMatch(n,o),n=r[0],o=r[1],"bool"===n.dtype&&(n=n.toInt(),o=o.toInt()),broadcast_util.assertAndGetBroadcastShape(n.shape,o.shape);return engine_1.ENGINE.runKernelFunc(function(t,e){var r=t.minimum(n,o);return e([n,o]),r},{a:n,b:o},function(t,e){var r=e[0],n=e[1];return{a:function(){return t.mul(r.lessEqual(n).toFloat())},b:function(){return t.mul(r.greater(n).toFloat())}}},"Minimum")}function minimumStrict_(t,e){var r=tensor_util_env_1.convertToTensor(t,"a","minimumStrict"),n=tensor_util_env_1.convertToTensor(e,"b","minimumStrict");return util.assertShapesMatch(r.shape,n.shape,"Error in minimumStrict: "),r.minimum(n)}function maximum_(t,e){var r,n=tensor_util_env_1.convertToTensor(t,"a","maximum"),o=tensor_util_env_1.convertToTensor(e,"b","maximum");r=tensor_util_1.makeTypesMatch(n,o),n=r[0],o=r[1],"bool"===n.dtype&&(n=n.toInt(),o=o.toInt()),broadcast_util.assertAndGetBroadcastShape(n.shape,o.shape);return engine_1.ENGINE.runKernelFunc(function(t,e){var r=t.maximum(n,o);return e([n,o]),r},{a:n,b:o},function(t,e){var r=e[0],n=e[1];return{a:function(){return t.mul(r.greaterEqual(n).toFloat())},b:function(){return t.mul(r.less(n).toFloat())}}},"Maximum")}function maximumStrict_(t,e){var r=tensor_util_env_1.convertToTensor(t,"a","maximumStrict"),n=tensor_util_env_1.convertToTensor(e,"b","maximumStrict");return util.assertShapesMatch(r.shape,n.shape,"Error in maximumStrict: "),r.maximum(n)}function squaredDifferenceStrict_(t,e){var r=tensor_util_env_1.convertToTensor(t,"a","squaredDifferenceStrict"),n=tensor_util_env_1.convertToTensor(e,"b","squaredDifferenceStrict");return util.assertShapesMatch(r.shape,n.shape,"Error in squaredDifferenceStrict: "),r.squaredDifference(n)}function atan2_(t,e){var r,n=tensor_util_env_1.convertToTensor(t,"a","atan2"),o=tensor_util_env_1.convertToTensor(e,"b","atan2");r=tensor_util_1.makeTypesMatch(n,o),n=r[0],o=r[1];var a=broadcast_util.assertAndGetBroadcastShape(n.shape,o.shape);return engine_1.ENGINE.runKernelFunc(function(t,e){var r=t.atan2(n,o);return e([n,o]),r},{$a:n,$b:o},function(t,e){var r=e[0],n=e[1];return{$a:function(){var e=exports.add(r.square(),n.square()),o=t.mul(n.div(e)),s=broadcast_util.getReductionAxes(r.shape,a);return s.length>0&&(o=o.sum(s)),o.reshape(r.shape)},$b:function(){var e=exports.add(r.square(),n.square()),o=unary_ops_1.neg(t.mul(r.div(e))),s=broadcast_util.getReductionAxes(n.shape,a);return s.length>0&&(o=o.sum(s)),o.reshape(n.shape)}}})}exports.add=operation_1.op({add_:add_}),exports.addN=operation_1.op({addN_:addN_}),exports.addStrict=operation_1.op({addStrict_:addStrict_}),exports.atan2=operation_1.op({atan2_:atan2_}),exports.divStrict=operation_1.op({divStrict_:divStrict_}),exports.floorDiv=operation_1.op({floorDiv_:floorDiv_}),exports.maximum=operation_1.op({maximum_:maximum_}),exports.maximumStrict=operation_1.op({maximumStrict_:maximumStrict_}),exports.minimum=operation_1.op({minimum_:minimum_}),exports.minimumStrict=operation_1.op({minimumStrict_:minimumStrict_}),exports.mod=operation_1.op({mod_:mod_}),exports.modStrict=operation_1.op({modStrict_:modStrict_}),exports.mul=operation_1.op({mul_:mul_}),exports.mulStrict=operation_1.op({mulStrict_:mulStrict_}),exports.pow=operation_1.op({pow_:pow_}),exports.powStrict=operation_1.op({powStrict_:powStrict_}),exports.squaredDifferenceStrict=operation_1.op({squaredDifferenceStrict_:squaredDifferenceStrict_}),exports.sub=operation_1.op({sub_:sub_}),exports.subStrict=operation_1.op({subStrict_:subStrict_});

},{"../engine":163,"../tensor_util":289,"../tensor_util_env":290,"../util":294,"./broadcast_util":199,"./operation":232,"./tensor_ops":259,"./unary_ops":264}],197:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function i(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,i)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var n,r,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),logical_ops_1=require("./logical_ops"),segment_ops_1=require("./segment_ops");function booleanMaskAsync_(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,o,s,a,i,l,u,c,p,_,h,f,b;return __generator(this,function(v){switch(v.label){case 0:for(r=tensor_util_env_1.convertToTensor(e,"tensor","boolMask"),o=tensor_util_env_1.convertToTensor(t,"mask","boolMask","bool"),s=null==n?0:n,a=o.rank,i=r.shape,util.assert(a>0,function(){return"mask cannot be scalar"}),util.assertShapesMatch(i.slice(s,s+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),l=1,u=s;u<s+a;u++)l*=i[u];return c=i.slice(0,s).concat([l],i.slice(s+a)),p=r.reshape(c),_=o.reshape([-1]),[4,logical_ops_1.whereAsync(_)];case 1:return h=v.sent(),f=h.squeeze([1]),b=segment_ops_1.gather(p,f,s),e!==r&&r.dispose(),t!==o&&o.dispose(),f.dispose(),p.dispose(),_.dispose(),h.dispose(),[2,b]}})})}exports.booleanMaskAsync=booleanMaskAsync_;

},{"../tensor_util_env":290,"../util":294,"./logical_ops":223,"./segment_ops":246}],198:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),kernel_names_1=require("../kernel_names"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function broadcastTo_(e,r){var n=tensor_util_env_1.convertToTensor(e,"broadcastTo","x"),t=n.shape;if(r.some(function(e){return!(e>0)||e%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+r+"].");if(r.length<n.rank)throw new Error("broadcastTo(): shape.length="+r.length+" < input.rank="+n.rank+".");if(r.length>n.rank){for(var o=n.shape.slice();o.length<r.length;)o.unshift(1);n=n.reshape(o)}for(var a=n.shape,s=Array.from(r),i=r.length-1;i>=0;i--)if(a[i]===r[i])s[i]=1;else if(1!==n.shape[i])throw new Error("broadcastTo(): ["+t+"] cannot be broadcast to ["+r+"].");var u=s.map(function(e,r){return e>1?r:-1}).filter(function(e){return e>=0});if(0===u.length)return n.clone();var c={x:n},l={shape:r,inputShape:a};return engine_1.ENGINE.runKernelFunc(function(e){return e.tile(n,s)},c,function(e){return{x:function(){return e.sum(u,!0)}}},kernel_names_1.BroadcastTo,l)}exports.broadcastTo=operation_1.op({broadcastTo_:broadcastTo_});

},{"../engine":163,"../kernel_names":188,"../tensor_util_env":290,"./operation":232}],199:[function(require,module,exports){
"use strict";function getBroadcastDims(t,e){for(var r=t.length,n=[],s=0;s<r;s++){var a=r-1-s,o=t[a]||1;(e[e.length-1-s]||1)>1&&1===o&&n.unshift(a)}return n}function getReductionAxes(t,e){for(var r=[],n=0;n<e.length;n++){var s=t[t.length-n-1],a=e.length-n-1,o=e[a];(null==s||1===s&&o>1)&&r.unshift(a)}return r}function assertAndGetBroadcastShape(t,e){for(var r=[],n=Math.max(t.length,e.length),s=0;s<n;s++){var a=t[t.length-s-1];null==a&&(a=1);var o=e[e.length-s-1];if(null==o&&(o=1),1===a)r.unshift(o);else if(1===o)r.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");r.unshift(a)}}return r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBroadcastDims=getBroadcastDims,exports.getReductionAxes=getReductionAxes,exports.assertAndGetBroadcastShape=assertAndGetBroadcastShape;

},{}],200:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var fromPixels2DContext,engine_1=require("../engine"),kernel_registry_1=require("../kernel_registry"),tensor_1=require("../tensor"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function fromPixels_(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r=!1,n=!1,o=!1,a=!1,i=!1;if(e.data instanceof Uint8Array)r=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)n=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);i=!0}if(o){if(o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=kernel_registry_1.getKernel("FromPixels",engine_1.ENGINE.backendName))return engine_1.ENGINE.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,l,u=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],f=u[0],d=u[1];if(i?s=e.getContext("2d").getImageData(0,0,f,d).data:n||r?s=e.data:(a||o)&&(null==fromPixels2DContext&&(fromPixels2DContext=document.createElement("canvas").getContext("2d")),fromPixels2DContext.canvas.width=f,fromPixels2DContext.canvas.height=d,fromPixels2DContext.drawImage(e,0,0,f,d),s=fromPixels2DContext.getImageData(0,0,f,d).data),4===t)l=new Int32Array(s);else{var c=f*d;l=new Int32Array(c*t);for(var h=0;h<c;h++)for(var m=0;m<t;++m)l[h*t+m]=s[4*h+m]}var p=[d,f,t];return tensor_ops_1.tensor3d(l,p,"int32")}function toPixels(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,o,a,i,s,l,u,f,d,c,h,m,p,w,g,x,_,v,y,b,P,E;return __generator(this,function(I){switch(I.label){case 0:if(r=tensor_util_env_1.convertToTensor(e,"img","toPixels"),e instanceof tensor_1.Tensor||(r=r.toInt()),2!==r.rank&&3!==r.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+r.rank+".");if(n=r.shape.slice(0,2),o=n[0],a=n[1],(i=2===r.rank?1:r.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,r.data()];case 1:return s=I.sent(),l=r.min(),u=r.max(),[4,Promise.all([l.data(),u.data()])];case 2:if(f=I.sent(),d=f[0],c=f[1],h=d[0],m=c[0],l.dispose(),u.dispose(),"float32"===r.dtype){if(h<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+m+"].")}else{if("int32"!==r.dtype)throw new Error("Unsupported type for toPixels: "+r.dtype+". Please use float32 or int32 tensors.");if(h<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+m+"].")}for(p="float32"===r.dtype?255:1,w=new Uint8ClampedArray(a*o*4),g=0;g<o*a;++g)x=void 0,_=void 0,v=void 0,y=void 0,1===i?(x=s[g]*p,_=s[g]*p,v=s[g]*p,y=255):3===i?(x=s[3*g]*p,_=s[3*g+1]*p,v=s[3*g+2]*p,y=255):4===i&&(x=s[4*g]*p,_=s[4*g+1]*p,v=s[4*g+2]*p,y=s[4*g+3]*p),w[(b=4*g)+0]=Math.round(x),w[b+1]=Math.round(_),w[b+2]=Math.round(v),w[b+3]=Math.round(y);return null!=t&&(t.width=a,t.height=o,P=t.getContext("2d"),E=new ImageData(w,a,o),P.putImageData(E,0,0)),r!==e&&r.dispose(),[2,w]}})})}exports.toPixels=toPixels,exports.fromPixels=operation_1.op({fromPixels_:fromPixels_});

},{"../engine":163,"../kernel_registry":189,"../tensor":287,"../tensor_util_env":290,"./operation":232,"./tensor_ops":259}],201:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),kernel_names_1=require("../kernel_names"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function clone_(e){var n=tensor_util_env_1.convertToTensor(e,"x","clone",null);return engine_1.ENGINE.runKernelFunc(function(){return engine_1.ENGINE.makeTensorFromDataId(n.dataId,n.shape,n.dtype)},{x:n},null,kernel_names_1.Identity)}exports.clone=operation_1.op({clone_:clone_});

},{"../engine":163,"../kernel_names":188,"../tensor_util_env":290,"./operation":232}],202:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),broadcast_util_1=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function notEqual_(e,t){var r,n=tensor_util_env_1.convertToTensor(e,"a","notEqual"),a=tensor_util_env_1.convertToTensor(t,"b","notEqual");return r=tensor_util_1.makeTypesMatch(n,a),n=r[0],a=r[1],broadcast_util_1.assertAndGetBroadcastShape(n.shape,a.shape),engine_1.ENGINE.runKernelFunc(function(e){return e.notEqual(n,a)},{a:n,b:a},null,"NotEqual")}function notEqualStrict_(e,t){var r=tensor_util_env_1.convertToTensor(e,"a","notEqualStrict"),n=tensor_util_env_1.convertToTensor(t,"b","notEqualStrict");return util_1.assertShapesMatch(r.shape,n.shape,"Error in notEqualStrict: "),r.notEqual(n)}function less_(e,t){var r,n=tensor_util_env_1.convertToTensor(e,"a","less"),a=tensor_util_env_1.convertToTensor(t,"b","less");return r=tensor_util_1.makeTypesMatch(n,a),n=r[0],a=r[1],broadcast_util_1.assertAndGetBroadcastShape(n.shape,a.shape),engine_1.ENGINE.runKernelFunc(function(e){return e.less(n,a)},{a:n,b:a},null,"Less")}function lessStrict_(e,t){var r=tensor_util_env_1.convertToTensor(e,"a","lessStrict"),n=tensor_util_env_1.convertToTensor(t,"b","lessStrict");return util_1.assertShapesMatch(r.shape,n.shape,"Error in lessStrict: "),r.less(n)}function equal_(e,t){var r,n=tensor_util_env_1.convertToTensor(e,"a","equal"),a=tensor_util_env_1.convertToTensor(t,"b","equal");return r=tensor_util_1.makeTypesMatch(n,a),n=r[0],a=r[1],broadcast_util_1.assertAndGetBroadcastShape(n.shape,a.shape),engine_1.ENGINE.runKernelFunc(function(e){return e.equal(n,a)},{$a:n,$b:a})}function equalStrict_(e,t){var r=tensor_util_env_1.convertToTensor(e,"a","equalStrict"),n=tensor_util_env_1.convertToTensor(t,"b","equalStrict");return util_1.assertShapesMatch(r.shape,n.shape,"Error in equalStrict: "),r.equal(n)}function lessEqual_(e,t){var r,n=tensor_util_env_1.convertToTensor(e,"a","lessEqual"),a=tensor_util_env_1.convertToTensor(t,"b","lessEqual");return r=tensor_util_1.makeTypesMatch(n,a),n=r[0],a=r[1],broadcast_util_1.assertAndGetBroadcastShape(n.shape,a.shape),engine_1.ENGINE.runKernelFunc(function(e,t){var r=e.lessEqual(n,a);return t([n,a]),r},{a:n,b:a},null,"LessEqual")}function lessEqualStrict_(e,t){var r=tensor_util_env_1.convertToTensor(e,"a","lessEqualStrict"),n=tensor_util_env_1.convertToTensor(t,"b","lessEqualStrict");return util_1.assertShapesMatch(r.shape,n.shape,"Error in lessEqualStrict: "),r.lessEqual(n)}function greater_(e,t){var r,n=tensor_util_env_1.convertToTensor(e,"a","greater"),a=tensor_util_env_1.convertToTensor(t,"b","greater");return r=tensor_util_1.makeTypesMatch(n,a),n=r[0],a=r[1],broadcast_util_1.assertAndGetBroadcastShape(n.shape,a.shape),engine_1.ENGINE.runKernelFunc(function(e){return e.greater(n,a)},{a:n,b:a},null,"Greater")}function greaterStrict_(e,t){var r=tensor_util_env_1.convertToTensor(e,"a","greaterStrict"),n=tensor_util_env_1.convertToTensor(t,"b","greaterStrict");return util_1.assertShapesMatch(r.shape,n.shape,"Error in greaterStrict: "),r.greater(n)}function greaterEqual_(e,t){var r,n=tensor_util_env_1.convertToTensor(e,"a","greaterEqual"),a=tensor_util_env_1.convertToTensor(t,"b","greaterEqual");r=tensor_util_1.makeTypesMatch(n,a),n=r[0],a=r[1],broadcast_util_1.assertAndGetBroadcastShape(n.shape,a.shape);return engine_1.ENGINE.runKernelFunc(function(e,t){var r=e.greaterEqual(n,a);return t([n,a]),r},{a:n,b:a},function(e,t){var r=t[0],n=t[1];return{a:function(){return tensor_ops_1.zerosLike(r)},b:function(){return tensor_ops_1.zerosLike(n)}}},"GreaterEqual")}function greaterEqualStrict_(e,t){var r=tensor_util_env_1.convertToTensor(e,"a","greaterEqualStrict"),n=tensor_util_env_1.convertToTensor(t,"b","greaterEqualStrict");return util_1.assertShapesMatch(r.shape,n.shape,"Error in greaterEqualStrict: "),r.greaterEqual(n)}exports.equal=operation_1.op({equal_:equal_}),exports.equalStrict=operation_1.op({equalStrict_:equalStrict_}),exports.greater=operation_1.op({greater_:greater_}),exports.greaterEqual=operation_1.op({greaterEqual_:greaterEqual_}),exports.greaterEqualStrict=operation_1.op({greaterEqualStrict_:greaterEqualStrict_}),exports.greaterStrict=operation_1.op({greaterStrict_:greaterStrict_}),exports.less=operation_1.op({less_:less_}),exports.lessEqual=operation_1.op({lessEqual_:lessEqual_}),exports.lessEqualStrict=operation_1.op({lessEqualStrict_:lessEqualStrict_}),exports.lessStrict=operation_1.op({lessStrict_:lessStrict_}),exports.notEqual=operation_1.op({notEqual_:notEqual_}),exports.notEqualStrict=operation_1.op({notEqualStrict_:notEqualStrict_});

},{"../engine":163,"../tensor_util":289,"../tensor_util_env":290,"../util":294,"./broadcast_util":199,"./operation":232,"./tensor_ops":259}],203:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function complex_(e,n){var r=tensor_util_env_1.convertToTensor(e,"real","complex"),t=tensor_util_env_1.convertToTensor(n,"imag","complex");return util.assertShapesMatch(r.shape,t.shape,"real and imag shapes, "+r.shape+" and "+t.shape+", must match in call to tf.complex()."),engine_1.ENGINE.runKernelFunc(function(e){return e.complex(r,t)},{$real:r,$imag:t})}function real_(e){var n=tensor_util_env_1.convertToTensor(e,"input","real");return engine_1.ENGINE.runKernelFunc(function(e){return e.real(n)},{$input:n})}function imag_(e){var n=tensor_util_env_1.convertToTensor(e,"input","imag");return engine_1.ENGINE.runKernelFunc(function(e){return e.imag(n)},{$input:n})}exports.complex=operation_1.op({complex_:complex_}),exports.real=operation_1.op({real_:real_}),exports.imag=operation_1.op({imag_:imag_});

},{"../engine":163,"../tensor_util_env":290,"../util":294,"./operation":232}],204:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),util_2=require("../util"),concat_util_1=require("./concat_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function concat1d_(t){return exports.concat(t,0)}function concat2d_(t,n){return exports.concat(t,n)}function concat3d_(t,n){return exports.concat(t,n)}function concat4d_(t,n){return exports.concat(t,n)}function concat_(t,n){void 0===n&&(n=0),util_1.assert(t.length>=1,function(){return"Pass at least one tensor to concat"});var e=tensor_util_env_1.convertToTensorArray(t,"tensors","concat");"complex64"===e[0].dtype&&e.forEach(function(t){if("complex64"!==t.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+t.dtype+". ")}),n=util_2.parseAxisParam(n,e[0].shape)[0];var r=concat_util_1.computeOutShape(e.map(function(t){return t.shape}),n);if(0===util_1.sizeFromShape(r))return tensor_ops_1.tensor([],r);if(1===(e=e.filter(function(t){return t.size>0})).length)return e[0];var o=e.map(function(t){return t.shape});concat_util_1.assertParamsConsistent(o,n);var c=e,i={axis:n};return engine_1.ENGINE.runKernelFunc(function(t){return t.concat(e,n)},c,function(t){var e=o.map(function(t){return t[n]});return exports.split(t,e,n).map(function(t){return function(){return t}})},"Concat",i)}function split_(t,n,e){void 0===e&&(e=0);var r,o=tensor_util_env_1.convertToTensor(t,"x","split");e=util_2.parseAxisParam(e,o.shape)[0],"number"==typeof n?(util_1.assert(o.shape[e]%n==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(n).fill(o.shape[e]/n)):(util_1.assert(o.shape[e]===n.reduce(function(t,n){return t+n}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=n);return engine_1.ENGINE.runKernelFunc(function(t){return t.split(o,r,e)},{$x:o},function(t){return{$x:function(){return exports.concat(t,e)}}})}exports.concat=operation_1.op({concat_:concat_}),exports.concat1d=operation_1.op({concat1d_:concat1d_}),exports.concat2d=operation_1.op({concat2d_:concat2d_}),exports.concat3d=operation_1.op({concat3d_:concat3d_}),exports.concat4d=operation_1.op({concat4d_:concat4d_}),exports.split=operation_1.op({split_:split_});

},{"../engine":163,"../tensor_util_env":290,"../util":294,"./concat_util":205,"./operation":232,"./tensor_ops":259}],205:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function assertParamsConsistent(t,e){var r=t[0].length;t.forEach(function(t,e){util.assert(t.length===r,function(){return"Error in concat"+r+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+r+")"})}),util.assert(e>=0&&e<r,function(){return"Error in concat"+r+"D: axis must be between 0 and "+(r-1)+"."});var n=t[0];t.forEach(function(t,s){for(var a=0;a<r;a++)util.assert(a===e||t[a]===n[a],function(){return"Error in concat"+r+"D: Shape of tensors["+s+"] ("+t+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+s+"."})})}function computeOutShape(t,e){for(var r=t[0].slice(),n=1;n<t.length;n++)r[e]+=t[n][e];return r}exports.assertParamsConsistent=assertParamsConsistent,exports.computeOutShape=computeOutShape;

},{"../util":294}],206:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),one_hot_1=require("./one_hot"),operation_1=require("./operation");function confusionMatrix_(e,t,n){var o=tensor_util_env_1.convertToTensor(e,"labels","confusionMatrix"),r=tensor_util_env_1.convertToTensor(t,"predictions","confusionMatrix");util.assert(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),util.assert(1===o.rank,function(){return"Expected the rank of labels to be 1, but got "+o.rank}),util.assert(1===r.rank,function(){return"Expected the rank of predictions to be 1, but got "+r.rank}),util.assert(o.shape[0]===r.shape[0],function(){return"Mismatch in the number of examples: "+o.shape[0]+" vs. "+r.shape[0]+". Labels and predictions should have the same number of elements."}),util.assert(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=one_hot_1.oneHot(o.asType("int32"),n),s=one_hot_1.oneHot(r.asType("int32"),n);return i.transpose().matMul(s).asType("int32")}exports.confusionMatrix_=confusionMatrix_,exports.confusionMatrix=operation_1.op({confusionMatrix_:confusionMatrix_});

},{"../tensor_util_env":290,"../util":294,"./one_hot":231,"./operation":232}],207:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),conv_util=require("./conv_util"),operation_1=require("./operation");function conv1d_(n,e,r,t,o,s,i){void 0===o&&(o="NWC"),void 0===s&&(s=1);var a=tensor_util_env_1.convertToTensor(n,"x","conv1d"),u=tensor_util_env_1.convertToTensor(e,"filter","conv1d"),p=a,d=!1;2===a.rank&&(d=!0,p=a.as3D(1,a.shape[0],a.shape[1])),util.assert(3===p.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+p.rank+"."}),util.assert(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=i&&util.assert(util.isInt(t),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+t+"."}),util.assert(p.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+p.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),util.assert(conv_util.eitherStridesOrDilationsAreOne(r,s),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+r+" and dilation '"+s+"'"}),util.assert("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),c=p.as4D(p.shape[0],1,p.shape[1],p.shape[2]),l=[1,r],v=[1,s],f=exports.conv2d(c,h,l,t,"NHWC",v,i);return d?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}function conv2d_(n,e,r,t,o,s,i){void 0===o&&(o="NHWC"),void 0===s&&(s=[1,1]);var a=tensor_util_env_1.convertToTensor(n,"x","conv2d"),u=tensor_util_env_1.convertToTensor(e,"filter","conv2d"),p=a,d=!1;3===a.rank&&(d=!0,p=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),util.assert(4===p.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+p.rank+"."}),util.assert(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=i&&util.assert(util.isInt(t),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+t+"."});var h="NHWC"===o?p.shape[3]:p.shape[1];util.assert(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),util.assert(conv_util.eitherStridesOrDilationsAreOne(r,s),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+s+"'"});var c=conv_util.convertConv2DDataFormat(o),l=conv_util.computeConv2DInfo(p.shape,u.shape,r,s,t,i,!1,c),v=[u,p],f=engine_1.ENGINE.runKernelFunc(function(n,e){var r=n.conv2d(p,u,l);return e([u,p]),r},{x:p,filter:u},function(n,e){var i=e,a=i[0],u=i[1];return util.assert(conv_util.tupleValuesAreOne(s),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"}),{x:function(){return exports.conv2dDerInput(u.shape,n,a,r,t,o)},filter:function(){return exports.conv2dDerFilter(u,n,a.shape,r,t,o)}}},"Conv2D",l,v);return d?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function conv2dDerInput_(n,e,r,t,o,s,i){void 0===s&&(s="NHWC"),util.assert(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var a=n,u=e,p=!1;3===e.rank&&(p=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]),util.assert(4===a.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),util.assert(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),util.assert(4===r.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+r.rank});var d="NHWC"===s?a[3]:a[1],h="NHWC"===s?u.shape[3]:u.shape[1];util.assert(d===r.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+d+") must match input depth for filter "+r.shape[2]+"."}),util.assert(h===r.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+r.shape[3]+"."}),null!=i&&util.assert(util.isInt(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=conv_util.convertConv2DDataFormat(s),l=conv_util.computeConv2DInfo(a,r.shape,t,1,o,i,!1,c),v=engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.conv2dDerInput(u,r,l);return e([r,u]),t},{dy4D:u,filter:r},function(n,e){var r=e[0],a=e[1];return{dy4D:function(){return exports.conv2d(n,r,t,o,s,1,i)},filter:function(){return exports.conv2dDerFilter(n,a,r.shape,t,o,s,i)}}});return p?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function conv2dDerFilter_(n,e,r,t,o,s,i){void 0===s&&(s="NHWC");var a=n;3===n.rank&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=e;3===u.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),util.assert(4===a.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),util.assert(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),util.assert(4===r.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+r+"."});var p="NHWC"===s?a.shape[3]:a.shape[1],d="NHWC"===s?u.shape[3]:u.shape[1];util.assert(p===r[2],function(){return"Error in conv2dDerFilter: depth of input "+p+") must match input depth in filter ("+r[2]+"."}),util.assert(d===r[3],function(){return"Error in conv2dDerFilter: depth of dy ("+d+") must match output depth for filter ("+r[3]+")."}),null!=i&&util.assert(util.isInt(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var h=conv_util.convertConv2DDataFormat(s),c=conv_util.computeConv2DInfo(a.shape,r,t,1,o,i,!1,h);return engine_1.ENGINE.runKernelFunc(function(n){return n.conv2dDerFilter(a,u,c)},{x4D:a,dy4D:u})}function conv2dTranspose_(n,e,r,t,o,s){return conv2dDerInput_(r,tensor_util_env_1.convertToTensor(n,"x","conv2dTranspose"),tensor_util_env_1.convertToTensor(e,"filter","conv2dTranspose"),t,o,"NHWC",s)}function depthwiseConv2d_(n,e,r,t,o,s,i){void 0===o&&(o="NHWC"),void 0===s&&(s=[1,1]);var a=tensor_util_env_1.convertToTensor(n,"x","depthwiseConv2d"),u=tensor_util_env_1.convertToTensor(e,"filter","depthwiseConv2d"),p=a,d=!1;3===a.rank&&(d=!0,p=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),util.assert(4===p.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+p.rank+"."}),util.assert(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),util.assert(p.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+p.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==s&&(s=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(r,s),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+s+"'"}),null!=i&&util.assert(util.isInt(t),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+t+"."});var h=conv_util.computeConv2DInfo(p.shape,u.shape,r,s,t,i,!0),c=[p,u],l=engine_1.ENGINE.runKernelFunc(function(n,e){var r=n.depthwiseConv2D(p,u,h);return e([p,u]),r},{x:p,filter:u},function(n,e){util.assert(conv_util.tupleValuesAreOne(s),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+s+"'"});var r=e[0],t=e[1];return{x:function(){return exports.depthwiseConv2dDerInput(r.shape,n,t,h)},filter:function(){return exports.depthwiseConv2dDerFilter(r,n,t.shape,h)}}},"DepthwiseConv2dNative",h,c);return d?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function separableConv2d_(n,e,r,t,o,s,i){void 0===s&&(s=[1,1]),void 0===i&&(i="NHWC");var a=tensor_util_env_1.convertToTensor(n,"x","separableConv2d"),u=tensor_util_env_1.convertToTensor(e,"depthwiseFilter","separableConv2d"),p=tensor_util_env_1.convertToTensor(r,"pointwiseFilter","separableConv2d"),d=a,h=!1;if(3===a.rank&&(h=!0,d=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");util.assert(4===d.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+d.rank+"."}),util.assert(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),util.assert(4===p.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),util.assert(1===p.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+p.shape[0]+"."}),util.assert(1===p.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+p.shape[1]+"."});var c=u.shape[2],l=u.shape[3];util.assert(p.shape[2]===c*l,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+c*l+", but got "+p.shape[2]+"."});var v=exports.depthwiseConv2d(d,u,t,o,i,s),f=exports.conv2d(v,p,1,"valid",i);return h?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function parseTupleParam(n){return"number"==typeof n?[n,n,n]:2===n.length?[n[0],n[1],1]:n}function tupleValuesAreOne(n){var e=parseTupleParam(n),r=e[0],t=e[1],o=e[2];return 1===r&&1===t&&1===o}function eitherStridesOrDilationsAreOne(n,e){return tupleValuesAreOne(n)||tupleValuesAreOne(e)}function depthwiseConv2dDerInput_(n,e,r,t){var o=e,s=!1;3===e.rank&&(s=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=engine_1.ENGINE.runKernelFunc(function(n){return n.depthwiseConv2DDerInput(o,r,t)},{dy4D:o});return s?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}function depthwiseConv2dDerFilter_(n,e,r,t){var o=n;3===n.rank&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=e;return 3===s.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),engine_1.ENGINE.runKernelFunc(function(n){return n.depthwiseConv2DDerFilter(o,s,t)},{x4D:o,dy4D:s})}function conv3d_(n,e,r,t,o,s){void 0===o&&(o="NDHWC"),void 0===s&&(s=[1,1,1]);var i=tensor_util_env_1.convertToTensor(n,"x","conv3d"),a=tensor_util_env_1.convertToTensor(e,"filter","conv3d"),u=i,p=!1;4===i.rank&&(p=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),util.assert(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),util.assert(5===a.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),util.assert(u.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),util.assert(eitherStridesOrDilationsAreOne(r,s),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+s+"'"}),util.assert("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var d=conv_util.computeConv3DInfo(u.shape,a.shape,r,s,t),h=engine_1.ENGINE.runKernelFunc(function(n,e){var r=n.conv3d(u,a,d);return e([u,a]),r},{x:u,$filter:a},function(n,e){util.assert(tupleValuesAreOne(s),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"});var o=e[0],i=e[1];return{x:function(){return conv3dDerInput_(o.shape,n,i,r,t)},$filter:function(){return conv3dDerFilter_(o,n,i.shape,r,t)}}});return p?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}function conv3dDerInput_(n,e,r,t,o){util.assert(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var s=n,i=e,a=!1;4===e.rank&&(a=!0,i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),s=[1,n[0],n[1],n[2],n[3]]);var u=s[4],p=i.shape[4];util.assert(5===s.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+s.length+"."}),util.assert(5===i.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),util.assert(5===r.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+r.rank}),util.assert(u===r.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+r.shape[3]+"."}),util.assert(p===r.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+p+") must match output depth for filter "+r.shape[4]+"."});var d=conv_util.computeConv3DInfo(s,r.shape,t,1,o),h=engine_1.ENGINE.runKernelFunc(function(n){return n.conv3dDerInput(i,r,d)},{dy5D:i});return a?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}function conv3dDerFilter_(n,e,r,t,o){var s=n;4===n.rank&&(s=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]));var i=e;4===i.rank&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),util.assert(5===s.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+s.shape+"."}),util.assert(5===i.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."}),util.assert(5===r.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+r+"."}),util.assert(s.shape[4]===r[3],function(){return"Error in conv3dDerFilter: depth of input "+s.shape[4]+") must match input depth in filter ("+r[3]+"."}),util.assert(i.shape[4]===r[4],function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+r[4]+")."});var a=conv_util.computeConv3DInfo(s.shape,r,t,1,o);return engine_1.ENGINE.runKernelFunc(function(n){return n.conv3dDerFilter(s,i,a)},{x5D:s,dy5D:i})}function conv3dTranspose_(n,e,r,t,o){return conv3dDerInput_(r,tensor_util_env_1.convertToTensor(n,"x","conv3dTranspose"),tensor_util_env_1.convertToTensor(e,"filter","conv3dTranspose"),t,o)}exports.conv1d=operation_1.op({conv1d_:conv1d_}),exports.conv2d=operation_1.op({conv2d_:conv2d_}),exports.conv3d=operation_1.op({conv3d_:conv3d_}),exports.conv2dDerFilter=operation_1.op({conv2dDerFilter_:conv2dDerFilter_}),exports.conv2dDerInput=operation_1.op({conv2dDerInput_:conv2dDerInput_}),exports.depthwiseConv2d=operation_1.op({depthwiseConv2d_:depthwiseConv2d_}),exports.depthwiseConv2dDerInput=operation_1.op({depthwiseConv2dDerInput_:depthwiseConv2dDerInput_}),exports.depthwiseConv2dDerFilter=operation_1.op({depthwiseConv2dDerFilter_:depthwiseConv2dDerFilter_}),exports.separableConv2d=operation_1.op({separableConv2d_:separableConv2d_}),exports.conv2dTranspose=operation_1.op({conv2dTranspose_:conv2dTranspose_}),exports.conv3dTranspose=operation_1.op({conv3dTranspose_:conv3dTranspose_});

},{"../engine":163,"../tensor_util_env":290,"../util":294,"./conv_util":208,"./operation":232}],208:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function computePool2DInfo(t,e,n,o,r,a,i){void 0===i&&(i="channelsLast");var u,l=parseTupleParam(e),h=l[0],f=l[1];if("channelsLast"===i)u=[h,f,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);u=[h,f,t[1],t[1]]}return computeConv2DInfo(t,u,n,o,r,a,!1,i)}function computePool3DInfo(t,e,n,o,r,a,i){void 0===i&&(i="NDHWC");var u,l,h=parse3TupleParam(e),f=h[0],s=h[1],p=h[2];if("NDHWC"===i)l="channelsLast",u=[f,s,p,t[4],t[4]];else{if("NCDHW"!==i)throw new Error("Unknown dataFormat "+i);l="channelsFirst",u=[f,s,p,t[1],t[1]]}return computeConv3DInfo(t,u,n,o,r,!1,l,a)}function computeConv2DInfo(t,e,n,o,r,a,i,u){void 0===i&&(i=!1),void 0===u&&(u="channelsLast");var l=[-1,-1,-1,-1],h=l[0],f=l[1],s=l[2],p=l[3];if("channelsLast"===u)h=t[0],f=t[1],s=t[2],p=t[3];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat "+u);h=t[0],p=t[1],f=t[2],s=t[3]}var c,d=e[0],m=e[1],v=e[3],D=parseTupleParam(n),g=D[0],I=D[1],F=parseTupleParam(o),M=F[0],w=F[1],C=getEffectiveFilterSize(d,M),P=getEffectiveFilterSize(m,w),S=getPadAndOutInfo(r,f,s,g,I,C,P,a),b=S.padInfo,H=S.outHeight,W=S.outWidth,O=i?v*p:v;return"channelsFirst"===u?c=[h,O,H,W]:"channelsLast"===u&&(c=[h,H,W,O]),{batchSize:h,dataFormat:u,inHeight:f,inWidth:s,inChannels:p,outHeight:H,outWidth:W,outChannels:O,padInfo:b,strideHeight:g,strideWidth:I,filterHeight:d,filterWidth:m,effectiveFilterHeight:C,effectiveFilterWidth:P,dilationHeight:M,dilationWidth:w,inShape:t,outShape:c,filterShape:e}}function computeConv3DInfo(t,e,n,o,r,a,i,u){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var l=[-1,-1,-1,-1,-1],h=l[0],f=l[1],s=l[2],p=l[3],c=l[4];if("channelsLast"===i)h=t[0],f=t[1],s=t[2],p=t[3],c=t[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);h=t[0],c=t[1],f=t[2],s=t[3],p=t[4]}var d,m=e[0],v=e[1],D=e[2],g=e[4],I=parse3TupleParam(n),F=I[0],M=I[1],w=I[2],C=parse3TupleParam(o),P=C[0],S=C[1],b=C[2],H=getEffectiveFilterSize(m,P),W=getEffectiveFilterSize(v,S),O=getEffectiveFilterSize(D,b),E=get3DPadAndOutInfo(r,f,s,p,F,M,w,H,W,O,u),A=E.padInfo,z=E.outDepth,L=E.outHeight,T=E.outWidth,k=a?g*c:g;return"channelsFirst"===i?d=[h,k,z,L,T]:"channelsLast"===i&&(d=[h,z,L,T,k]),{batchSize:h,dataFormat:i,inDepth:f,inHeight:s,inWidth:p,inChannels:c,outDepth:z,outHeight:L,outWidth:T,outChannels:k,padInfo:A,strideDepth:F,strideHeight:M,strideWidth:w,filterDepth:m,filterHeight:v,filterWidth:D,effectiveFilterDepth:H,effectiveFilterHeight:W,effectiveFilterWidth:O,dilationDepth:P,dilationHeight:S,dilationWidth:b,inShape:t,outShape:d,filterShape:e}}function computeOutputShape2D(t,e,n,o,r){null==o&&(o=computeDefaultPad(t,e,n));var a=t[0],i=t[1],u=conditionalRound((a-e+2*o)/n+1,r);util.assert(util.isInt(u),function(){return"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=conditionalRound((i-e+2*o)/n+1,r);return util.assert(util.isInt(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l]}function computeOutputShape4D(t,e,n,o,r,a){null==r&&(r=computeDefaultPad(t,e,o));var i=t[0],u=t[1],l=t[2],h=conditionalRound((i-e+2*r)/o+1,a);util.assert(util.isInt(h),function(){return"The output # of depths ("+h+") must be an integer. Change the stride and/or zero pad parameters"});var f=conditionalRound((u-e+2*r)/o+1,a);util.assert(util.isInt(f),function(){return"The output # of rows ("+f+") must be an integer. Change the stride and/or zero pad parameters"});var s=conditionalRound((l-e+2*r)/o+1,a);return util.assert(util.isInt(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[h,f,s,n]}function computeDefaultPad(t,e,n,o){void 0===o&&(o=1);var r=getEffectiveFilterSize(e,o);return Math.floor((t[0]*(n-1)-n+r)/2)}function parseTupleParam(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function parse3TupleParam(t){return"number"==typeof t?[t,t,t]:t}function getEffectiveFilterSize(t,e){return e<=1?t:t+(t-1)*(e-1)}function getPadAndOutInfo(t,e,n,o,r,a,i,u){var l,h,f;if("number"==typeof t){l={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var s=computeOutputShape2D([e,n],a,o,t,u);h=s[0],f=s[1]}else if("same"===t){h=Math.ceil(e/o),f=Math.ceil(n/r);var p=Math.max(0,(h-1)*o+a-e),c=Math.max(0,(f-1)*r+i-n),d=Math.floor(p/2),m=p-d,v=Math.floor(c/2);l={top:d,bottom:m,left:v,right:c-v,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);l={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((e-a+1)/o),f=Math.ceil((n-i+1)/r)}return{padInfo:l,outHeight:h,outWidth:f}}function get3DPadAndOutInfo(t,e,n,o,r,a,i,u,l,h,f){var s,p,c,d;if("number"==typeof t){s={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};var m=computeOutputShape4D([e,n,o,1],u,1,r,t,f);p=m[0],c=m[1],d=m[2]}else if("same"===t){var v=((p=Math.ceil(e/r))-1)*r+u-e,D=((c=Math.ceil(n/a))-1)*a+l-n,g=((d=Math.ceil(o/i))-1)*i+h-o,I=Math.floor(v/2),F=v-I,M=Math.floor(D/2),w=D-M,C=Math.floor(g/2);s={top:M,bottom:w,left:C,right:g-C,front:I,back:F,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);s={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((e-u+1)/r),c=Math.ceil((n-l+1)/a),d=Math.ceil((o-h+1)/i)}return{padInfo:s,outDepth:p,outHeight:c,outWidth:d}}function conditionalRound(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function tupleValuesAreOne(t){var e=parseTupleParam(t),n=e[0],o=e[1],r=e[2];return 1===n&&1===o&&1===r}function eitherStridesOrDilationsAreOne(t,e){return tupleValuesAreOne(t)||tupleValuesAreOne(e)}function convertConv2DDataFormat(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}exports.computePool2DInfo=computePool2DInfo,exports.computePool3DInfo=computePool3DInfo,exports.computeConv2DInfo=computeConv2DInfo,exports.computeConv3DInfo=computeConv3DInfo,exports.computeDefaultPad=computeDefaultPad,exports.tupleValuesAreOne=tupleValuesAreOne,exports.eitherStridesOrDilationsAreOne=eitherStridesOrDilationsAreOne,exports.convertConv2DDataFormat=convertConv2DDataFormat;

},{"../util":294}],209:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function diag_(e){var n=tensor_util_env_1.convertToTensor(e,"x","diag").flatten(),r=e.shape.concat(e.shape);return engine_1.ENGINE.runKernelFunc(function(e){return e.diag(n)},{$x:n}).reshape(r)}exports.diag=operation_1.op({diag_:diag_});

},{"../engine":163,"../tensor_util_env":290,"./operation":232}],210:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),kernel_names_1=require("../kernel_names"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),binary_ops_1=require("./binary_ops"),operation_1=require("./operation");function div_(e,r){var n,i=tensor_util_env_1.convertToTensor(e,"a","div"),t=tensor_util_env_1.convertToTensor(r,"b","div");if(n=tensor_util_1.makeTypesMatch(i,t),i=n[0],t=n[1],"int32"===i.dtype&&"int32"===t.dtype)return binary_ops_1.floorDiv(i,t);var _={a:i,b:t};return engine_1.ENGINE.runKernelFunc(function(e,r){var n=e.realDivide(i,t);return r([i,t]),n},_,null,kernel_names_1.Div,{})}exports.div=operation_1.op({div_:div_});

},{"../engine":163,"../kernel_names":188,"../tensor_util":289,"../tensor_util_env":290,"./binary_ops":196,"./operation":232}],211:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),div_1=require("./div"),logical_ops_1=require("./logical_ops"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function divNoNan_(e,o){var r,_=tensor_util_env_1.convertToTensor(e,"a","div"),i=tensor_util_env_1.convertToTensor(o,"b","div");_=(r=tensor_util_1.makeTypesMatch(_,i))[0],i=r[1];var t=div_1.div(_,i),n=tensor_ops_1.zerosLike(t),s=i.equal(n);return logical_ops_1.where(s,n,t)}exports.divNoNan=operation_1.op({divNoNan_:divNoNan_});

},{"../tensor_util":289,"../tensor_util_env":290,"./div":210,"./logical_ops":223,"./operation":232,"./tensor_ops":259}],212:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("../tensor"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),dropout_util_1=require("./dropout_util"),operation_1=require("./operation"),random_uniform_1=require("./random_uniform");function dropout_(o,t,r,e){var n=tensor_util_env_1.convertToTensor(o,"x","dropout");if(util.assert("float32"===n.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+n.dtype+" tensor instead."}),util.assert(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return o instanceof tensor_1.Tensor?n.clone():n;var u=dropout_util_1.getNoiseShape(n,r),i=1-t,a=random_uniform_1.randomUniform(u,0,1,"float32",e).add(i).floor().div(i);return n.mul(a)}exports.dropout=operation_1.op({dropout_:dropout_});

},{"../tensor":287,"../tensor_util_env":290,"../util":294,"./dropout_util":213,"./operation":232,"./random_uniform":239}],213:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function getNoiseShape(e,r){if(null==r)return e.shape.slice();if(util.arraysEqual(e.shape,r))return r;if(e.shape.length===r.length){for(var t=[],s=0;s<e.shape.length;s++)null==r[s]&&null!=e.shape[s]?t.push(e.shape[s]):t.push(r[s]);return t}return r}exports.getNoiseShape=getNoiseShape;

},{"../util":294}],214:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ERF_P=.3275911,exports.ERF_A1=.254829592,exports.ERF_A2=-.284496736,exports.ERF_A3=1.421413741,exports.ERF_A4=-1.453152027,exports.ERF_A5=1.061405429;

},{}],215:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var array_ops_1=require("./array_ops"),operation_1=require("./operation"),tile_1=require("./tile");function eye_(e,r,a,t){void 0===t&&(t="float32"),null==r&&(r=e);for(var o=array_ops_1.buffer([e,r],t),i=e<=r?e:r,_=0;_<i;++_)o.set(1,_,_);var n=o.toTensor().as2D(e,r);if(null==a)return n;if(1===a.length)return tile_1.tile(array_ops_1.expandDims(n,0),[a[0],1,1]);if(2===a.length)return tile_1.tile(array_ops_1.expandDims(array_ops_1.expandDims(n,0),0),[a[0],a[1],1,1]);if(3===a.length)return tile_1.tile(array_ops_1.expandDims(array_ops_1.expandDims(array_ops_1.expandDims(n,0),0),0),[a[0],a[1],a[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+a.length+"D.")}exports.eye=operation_1.op({eye_:eye_});

},{"./array_ops":192,"./operation":232,"./tile":260}],216:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),conv_1=require("../ops/conv"),conv_util=require("../ops/conv_util"),operation_1=require("../ops/operation"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),binary_ops_1=require("./binary_ops"),broadcast_util=require("./broadcast_util"),conv_2=require("./conv"),fused_util_1=require("./fused_util"),matmul_1=require("./matmul"),relu_ops_1=require("./relu_ops"),getFusedDyActivation=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},getFusedBiasGradient=function(e,t){var n=t,r=broadcast_util.getReductionAxes(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},applyActivation=function(e,t,n){if("linear"===t)return e;if("relu"===t)return relu_ops_1.relu(e);if("elu"===t)return relu_ops_1.elu(e);if("relu6"===t)return relu_ops_1.relu6(e);if("prelu"===t)return relu_ops_1.prelu(e,n);throw new Error("Unknown fused activation "+t+".")};function fusedMatMul_(e){var t,n=e.a,r=e.b,i=e.transposeA,a=void 0!==i&&i,s=e.transposeB,u=void 0!==s&&s,o=e.bias,l=e.activation,d=void 0===l?"linear":l,p=e.preluActivationWeights;if(!1===fused_util_1.shouldFuse(engine_1.ENGINE.state.gradientDepth,d)){var c=matmul_1.matMul(n,r,a,u);return null!=o&&(c=binary_ops_1.add(c,o)),applyActivation(c,d,p)}var v=tensor_util_env_1.convertToTensor(n,"a","fused matMul"),_=tensor_util_env_1.convertToTensor(r,"b","fused matMul");t=tensor_util_1.makeTypesMatch(v,_),v=t[0],_=t[1];var h=a?v.shape[v.rank-2]:v.shape[v.rank-1],f=u?_.shape[_.rank-1]:_.shape[_.rank-2],m=a?v.shape[v.rank-1]:v.shape[v.rank-2],g=u?_.shape[_.rank-2]:_.shape[_.rank-1],b=v.shape.slice(0,-2),k=_.shape.slice(0,-2),M=util.sizeFromShape(b),D=util.sizeFromShape(k);util.assert(v.rank>=2&&_.rank>=2&&v.rank===_.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+v.rank+" and "+_.rank+"."}),util.assert(util.arraysEqual(b,k),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+k+") of Tensors with shapes "+v.shape+" and "+_.shape+" must match."}),util.assert(h===f,function(){return"Error in fused matMul: inner shapes ("+h+") and ("+f+") of Tensors with shapes "+v.shape+" and "+_.shape+" and transposeA="+a+" and transposeB="+u+" must match."});var E,w,C=v.shape.slice(0,-2).concat([m,g]),T=a?v.as3D(M,h,m):v.as3D(M,m,h),A=u?_.as3D(D,g,f):_.as3D(D,f,g);null!=o&&(E=tensor_util_env_1.convertToTensor(o,"bias","fused matMul"),E=tensor_util_1.makeTypesMatch(E,v)[0],broadcast_util.assertAndGetBroadcastShape(C,E.shape)),null!=p&&(w=tensor_util_env_1.convertToTensor(p,"prelu weights","fused matMul"));var y={a:T,b:A};null!=o&&(y.bias=E),null!=p&&(y.preluActivationWeights=w);var F=[T,A];return engine_1.ENGINE.runKernelFunc(function(e,t){var n=e.fusedBatchMatMul({a:T,b:A,transposeA:a,transposeB:u,bias:E,activation:d,preluActivationWeights:w});return t([T,A,n]),n},y,function(e,t){var n=t[0],r=t[1],i=t[2],s=getFusedDyActivation(e,i,d),l={};return null!=o&&(l={bias:function(){return getFusedBiasGradient(E,s)}}),a||u?!a&&u?Object.assign({a:function(){return s.matMul(r,!1,!1)},b:function(){return s.matMul(n,!0,!1)}},l):a&&!u?Object.assign({a:function(){return r.matMul(s,!1,!0)},b:function(){return n.matMul(s,!1,!1)}},l):Object.assign({a:function(){return r.matMul(s,!0,!0)},b:function(){return s.matMul(n,!0,!0)}},l):Object.assign({a:function(){return s.matMul(r,!1,!0)},b:function(){return n.matMul(s,!0,!1)}},l)},"_FusedMatMul",{transposeA:a,transposeB:u,activation:d},F,[!0]).reshape(C)}function fusedConv2d_(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,s=void 0===a?"NHWC":a,u=e.dilations,o=void 0===u?[1,1]:u,l=e.dimRoundingMode,d=e.bias,p=e.activation,c=void 0===p?"linear":p,v=e.preluActivationWeights;if(c=c||"linear",!1===fused_util_1.shouldFuse(engine_1.ENGINE.state.gradientDepth,c)){var _=conv_2.conv2d(t,n,r,i,s,o,l);return null!=d&&(_=binary_ops_1.add(_,d)),applyActivation(_,c,v)}var h=tensor_util_env_1.convertToTensor(t,"x","conv2d"),f=tensor_util_env_1.convertToTensor(n,"filter","conv2d"),m=h,g=!1;3===h.rank&&(g=!0,m=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),util.assert(4===m.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+m.rank+"."}),util.assert(4===f.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+f.rank+"."}),null!=l&&util.assert(util.isInt(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."}),util.assert(m.shape[3]===f.shape[2],function(){return"Error in conv2d: depth of input ("+m.shape[3]+") must match input depth for filter "+f.shape[2]+"."}),util.assert(conv_util.eitherStridesOrDilationsAreOne(r,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),util.assert("NHWC"===s,function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var b,k,M=conv_util.computeConv2DInfo(m.shape,f.shape,r,o,i,l);null!=d&&(b=tensor_util_env_1.convertToTensor(d,"bias","fused conv2d"),b=tensor_util_1.makeTypesMatch(b,h)[0],broadcast_util.assertAndGetBroadcastShape(M.outShape,b.shape)),null!=v&&(k=tensor_util_env_1.convertToTensor(v,"prelu weights","fused conv2d"));var D={x:m,filter:f};null!=d&&(D.bias=b),null!=v&&(D.preluActivationWeights=k);var E=[f,m],w=engine_1.ENGINE.runKernelFunc(function(e,t){var n=e.fusedConv2d({input:m,filter:f,convInfo:M,bias:b,activation:c,preluActivationWeights:k});return t([f,m,n]),n},D,function(e,t){var n=t,a=n[0],s=n[1],u=n[2],l=getFusedDyActivation(e,u,c);util.assert(conv_util.tupleValuesAreOne(o),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var p={};return null!=d&&(p={bias:function(){return getFusedBiasGradient(b,l)}}),Object.assign({x:function(){return conv_1.conv2dDerInput(s.shape,l,a,r,i)},filter:function(){return conv_1.conv2dDerFilter(s,l,a.shape,r,i)}},p)},"FusedConv2D",{convInfo:M,activation:c},E,[!0]);return g?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}function fusedDepthwiseConv2d_(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,s=void 0===a?"NHWC":a,u=e.dilations,o=void 0===u?[1,1]:u,l=e.dimRoundingMode,d=e.bias,p=e.activation,c=void 0===p?"linear":p,v=e.preluActivationWeights;if(!1===fused_util_1.shouldFuse(engine_1.ENGINE.state.gradientDepth,c)){var _=conv_2.depthwiseConv2d(t,n,r,i,s,o,l);return null!=d&&(_=binary_ops_1.add(_,d)),applyActivation(_,c,v)}var h=tensor_util_env_1.convertToTensor(t,"x","depthwiseConv2d"),f=tensor_util_env_1.convertToTensor(n,"filter","depthwiseConv2d"),m=h,g=!1;3===h.rank&&(g=!0,m=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),util.assert(4===m.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."}),util.assert(4===f.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+f.rank+"."}),util.assert(m.shape[3]===f.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+f.shape[2]+"."}),null==o&&(o=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(r,o),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),null!=l&&util.assert(util.isInt(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."});var b,k,M=conv_util.computeConv2DInfo(m.shape,f.shape,r,o,i,l,!0);null!=d&&(b=tensor_util_env_1.convertToTensor(d,"bias","fused conv2d"),b=tensor_util_1.makeTypesMatch(b,h)[0],broadcast_util.assertAndGetBroadcastShape(M.outShape,b.shape)),null!=v&&(k=tensor_util_env_1.convertToTensor(v,"prelu weights","fused depthwiseConv2d"));var D={x:m,filter:f};null!=d&&(D.bias=b),null!=v&&(D.preluActivationWeights=k);var E=[f,m],w=engine_1.ENGINE.runKernelFunc(function(e,t){var n=e.fusedDepthwiseConv2D({input:m,filter:f,convInfo:M,bias:b,activation:c,preluActivationWeights:k});return t([f,m,n]),n},D,function(e,t){util.assert(conv_util.tupleValuesAreOne(o),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var n=t[0],r=t[1],i=t[2],a=getFusedDyActivation(e,i,c),s={};return null!=d&&(s={bias:function(){return getFusedBiasGradient(b,a)}}),Object.assign({x:function(){return conv_1.depthwiseConv2dDerInput(r.shape,a,n,M)},filter:function(){return conv_1.depthwiseConv2dDerFilter(r,a,n.shape,M)}},s)},"FusedDepthwiseConv2D",{convInfo:M,activation:c},E,[!0]);return g?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}exports.matMul=operation_1.op({fusedMatMul_:fusedMatMul_}),exports.conv2d=operation_1.op({fusedConv2d_:fusedConv2d_}),exports.depthwiseConv2d=operation_1.op({fusedDepthwiseConv2d_:fusedDepthwiseConv2d_});

},{"../engine":163,"../ops/conv":207,"../ops/conv_util":208,"../ops/operation":232,"../tensor_util":289,"../tensor_util_env":290,"../util":294,"./binary_ops":196,"./broadcast_util":199,"./conv":207,"./fused_util":217,"./matmul":227,"./relu_ops":242}],217:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shouldFuse=function(e,r){return!(e>0)||"linear"===r};

},{}],218:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function gatherND_(e,r){var n=tensor_util_env_1.convertToTensor(r,"indices","gatherND","int32"),t=tensor_util_env_1.convertToTensor(e,"x","gatherND");return engine_1.ENGINE.runKernelFunc(function(e){return e.gatherND(t,n)},{x:t,indices:n},null,"GatherNd")}exports.gatherND=operation_1.op({gatherND_:gatherND_});

},{"../engine":163,"../tensor_util_env":290,"./operation":232}],219:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");function prepareAndValidate(e,r){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(r.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+r.rank+".");if("int32"!==r.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+r.dtype+".");if(r.shape[r.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+r.shape[r.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var t=r.shape,n=t[t.length-1],a=1,i=0;i<t.length-1;++i)a*=t[i];var s=e.shape,p=t.slice();p.pop();var h=1;for(i=n;i<e.rank;++i)h*=s[i],p.push(s[i]);var o=util_1.computeStrides(e.shape).map(function(e){return e/h}).concat([1]).slice(0,n);return[p,a,h,o]}exports.prepareAndValidate=prepareAndValidate;

},{"../util":294}],220:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,n,r,o){return new(r||(r=Promise))(function(t,s){function i(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){e.done?t(e.value):new r(function(n){n(e.value)}).then(i,a)}u((o=o.apply(e,n||[])).next())})},__generator=this&&this.__generator||function(e,n){var r,o,t,s,i={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,o&&(t=2&s[0]?o.return:s[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,s[1])).done)return t;switch(o=0,t&&(s=[2&s[0],t.value]),s[0]){case 0:case 1:t=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(t=(t=i.trys).length>0&&t[t.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!t||s[1]>t[0]&&s[1]<t[3])){i.label=s[1];break}if(6===s[0]&&i.label<t[1]){i.label=t[1],t=s;break}if(t&&i.label<t[2]){i.label=t[2],i.ops.push(s);break}t[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{r=t=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var non_max_suppression_impl_1=require("../backends/non_max_suppression_impl"),engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function resizeBilinear_(e,n,r){void 0===r&&(r=!1);var o=tensor_util_env_1.convertToTensor(e,"images","resizeBilinear");util.assert(3===o.rank||4===o.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+o.rank+"."}),util.assert(2===n.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."});var t=o,s=!1;3===o.rank&&(s=!0,t=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var i=n[0],a=n[1],u=engine_1.ENGINE.runKernelFunc(function(e,n){return n([t]),e.resizeBilinear(t,i,a,r)},{x:t},function(e,n){return{x:function(){return engine_1.ENGINE.runKernelFunc(function(o){return o.resizeBilinearBackprop(e,n[0],r)},{})}}},"ResizeBilinear",{alignCorners:r,newHeight:i,newWidth:a});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}function resizeNearestNeighbor_(e,n,r){void 0===r&&(r=!1);var o=tensor_util_env_1.convertToTensor(e,"images","resizeNearestNeighbor");util.assert(3===o.rank||4===o.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+o.rank+"."}),util.assert(2===n.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."}),util.assert("float32"===o.dtype||"int32"===o.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var t=o,s=!1;3===o.rank&&(s=!0,t=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var i=n[0],a=n[1],u=engine_1.ENGINE.runKernelFunc(function(e,n){return n([t]),e.resizeNearestNeighbor(t,i,a,r)},{batchImages:t},function(e,n){return{batchImages:function(){return engine_1.ENGINE.runKernelFunc(function(o){return o.resizeNearestNeighborBackprop(e,n[0],r)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}function nonMaxSuppression_(e,n,r,o,t){void 0===o&&(o=.5),void 0===t&&(t=Number.NEGATIVE_INFINITY);var s=tensor_util_env_1.convertToTensor(e,"boxes","nonMaxSuppression"),i=tensor_util_env_1.convertToTensor(n,"scores","nonMaxSuppression"),a=nonMaxSuppSanityCheck(s,i,r,o,t);r=a.maxOutputSize,o=a.iouThreshold,t=a.scoreThreshold;var u={maxOutputSize:r,iouThreshold:o,scoreThreshold:t};return engine_1.ENGINE.runKernelFunc(function(e){return e.nonMaxSuppression(s,i,r,o,t)},{boxes:s,scores:i},null,"NonMaxSuppressionV3",u)}function nonMaxSuppressionAsync_(e,n,r,o,t){return void 0===o&&(o=.5),void 0===t&&(t=Number.NEGATIVE_INFINITY),__awaiter(this,void 0,void 0,function(){var s,i,a,u,p,c,l;return __generator(this,function(h){switch(h.label){case 0:return s=tensor_util_env_1.convertToTensor(e,"boxes","nonMaxSuppressionAsync"),i=tensor_util_env_1.convertToTensor(n,"scores","nonMaxSuppressionAsync"),a=nonMaxSuppSanityCheck(s,i,r,o,t),r=a.maxOutputSize,o=a.iouThreshold,t=a.scoreThreshold,[4,Promise.all([s.data(),i.data()])];case 1:return u=h.sent(),p=u[0],c=u[1],l=non_max_suppression_impl_1.nonMaxSuppressionV3(p,c,r,o,t),s!==e&&s.dispose(),i!==n&&i.dispose(),[2,l]}})})}function nonMaxSuppressionWithScore_(e,n,r,o,t,s){void 0===o&&(o=.5),void 0===t&&(t=Number.NEGATIVE_INFINITY),void 0===s&&(s=0);var i=tensor_util_env_1.convertToTensor(e,"boxes","nonMaxSuppression"),a=tensor_util_env_1.convertToTensor(n,"scores","nonMaxSuppression"),u=nonMaxSuppSanityCheck(i,a,r,o,t,s),p={maxOutputSize:r=u.maxOutputSize,iouThreshold:o=u.iouThreshold,scoreThreshold:t=u.scoreThreshold,softNmsSigma:s=u.softNmsSigma},c=engine_1.ENGINE.runKernel("NonMaxSuppressionV5",{boxes:i,scores:a},p);return{selectedIndices:c[0],selectedScores:c[1]}}function nonMaxSuppressionWithScoreAsync_(e,n,r,o,t,s){return void 0===o&&(o=.5),void 0===t&&(t=Number.NEGATIVE_INFINITY),void 0===s&&(s=0),__awaiter(this,void 0,void 0,function(){var i,a,u,p,c,l,h;return __generator(this,function(_){switch(_.label){case 0:return i=tensor_util_env_1.convertToTensor(e,"boxes","nonMaxSuppressionAsync"),a=tensor_util_env_1.convertToTensor(n,"scores","nonMaxSuppressionAsync"),u=nonMaxSuppSanityCheck(i,a,r,o,t,s),r=u.maxOutputSize,o=u.iouThreshold,t=u.scoreThreshold,s=u.softNmsSigma,[4,Promise.all([i.data(),a.data()])];case 1:return p=_.sent(),c=p[0],l=p[1],h=non_max_suppression_impl_1.nonMaxSuppressionV5(c,l,r,o,t,s),i!==e&&i.dispose(),a!==n&&a.dispose(),[2,h]}})})}function nonMaxSuppSanityCheck(e,n,r,o,t,s){null==o&&(o=.5),null==t&&(t=Number.NEGATIVE_INFINITY),null==s&&(s=0);var i=e.shape[0];return r=Math.min(r,i),util.assert(0<=o&&o<=1,function(){return"iouThreshold must be in [0, 1], but was '"+o+"'"}),util.assert(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),util.assert(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),util.assert(1===n.rank,function(){return"scores must be a 1D tensor"}),util.assert(n.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+n.shape[0]}),util.assert(0<=s&&s<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+s+"'"}),{maxOutputSize:r,iouThreshold:o,scoreThreshold:t,softNmsSigma:s}}function cropAndResize_(e,n,r,o,t,s){var i=tensor_util_env_1.convertToTensor(e,"image","cropAndResize"),a=tensor_util_env_1.convertToTensor(n,"boxes","cropAndResize","float32"),u=tensor_util_env_1.convertToTensor(r,"boxInd","cropAndResize","int32");t=t||"bilinear",s=s||0;var p=a.shape[0];util.assert(4===i.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),util.assert(2===a.rank&&4===a.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+p+",4] but had shape "+a.shape+"."}),util.assert(1===u.rank&&u.shape[0]===p,function(){return"Error in cropAndResize: boxInd must be have size ["+p+"] but had shape "+a.shape+"."}),util.assert(2===o.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+o.length+"."}),util.assert(o[0]>=1&&o[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+o}),util.assert("bilinear"===t||"nearest"===t,function(){return"method must be bilinear or nearest, but was "+t});return engine_1.ENGINE.runKernelFunc(function(e,n){return e.cropAndResize(i,a,u,o,t,s)},{images:i,boxes:a,boxInd:u},null,"CropAndResize",{method:t,extrapolationValue:s,cropSize:o})}exports.resizeBilinear=operation_1.op({resizeBilinear_:resizeBilinear_}),exports.resizeNearestNeighbor=operation_1.op({resizeNearestNeighbor_:resizeNearestNeighbor_}),exports.nonMaxSuppression=operation_1.op({nonMaxSuppression_:nonMaxSuppression_}),exports.nonMaxSuppressionAsync=nonMaxSuppressionAsync_,exports.nonMaxSuppressionWithScore=operation_1.op({nonMaxSuppressionWithScore_:nonMaxSuppressionWithScore_}),exports.nonMaxSuppressionWithScoreAsync=nonMaxSuppressionWithScoreAsync_,exports.cropAndResize=operation_1.op({cropAndResize_:cropAndResize_});

},{"../backends/non_max_suppression_impl":67,"../engine":163,"../tensor_util_env":290,"../util":294,"./operation":232}],221:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),tensor_ops_1=require("./tensor_ops");function inTopKAsync_(e,t,n){return void 0===n&&(n=1),__awaiter(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p,h,f,_,d,b;return __generator(this,function(v){switch(v.label){case 0:return r=tensor_util_env_1.convertToTensor(e,"predictions","inTopK"),o=tensor_util_env_1.convertToTensor(t,"targets","inTopK"),util_1.assert(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),util_1.assert(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),util_1.assertShapesMatch(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],util_1.assert(n>0&&n<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n}),[4,r.data()];case 1:return a=v.sent(),[4,o.data()];case 2:for(s=v.sent(),u=[a.length/i,i],l=u[0],c=u[1],p=util_1.getTypedArrayFromDType("bool",l),h=0;h<l;h++){for(f=h*c,_=a.subarray(f,f+c),d=[],b=0;b<_.length;b++)d.push({value:_[b],index:b});for(d.sort(function(e,t){return t.value-e.value}),p[h]=0,b=0;b<n;b++)if(d[b].index===s[h]){p[h]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,tensor_ops_1.tensor(p,o.shape,"bool")]}})})}exports.inTopKAsync=inTopKAsync_;

},{"../tensor_util_env":290,"../util":294,"./tensor_ops":259}],222:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),array_ops_1=require("./array_ops"),binary_ops_1=require("./binary_ops"),concat_split_1=require("./concat_split"),eye_1=require("./eye"),logical_ops_1=require("./logical_ops"),norm_1=require("./norm"),operation_1=require("./operation"),reduction_ops_1=require("./reduction_ops"),tensor_ops_1=require("./tensor_ops");function bandPart_(r,e,n){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var t=tensor_util_env_1.convertToTensor(r,"a","bandPart");if(t.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+t.rank+".");var a=t.shape,s=t.shape.slice(-2),o=s[0],i=s[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+o+").");if(!(n<=i))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+i+").");e<0&&(e=o),n<0&&(n=i);var u=tensor_ops_1.range(0,o,1,"int32").reshape([-1,1]),p=tensor_ops_1.range(0,i,1,"int32"),_=binary_ops_1.sub(u,p),l=logical_ops_1.logicalAnd(_.lessEqual(tensor_ops_1.scalar(+e,"int32")),_.greaterEqual(tensor_ops_1.scalar(-n,"int32"))),c=tensor_ops_1.zeros([o,i],t.dtype);return array_ops_1.stack(array_ops_1.unstack(t.reshape([-1,o,i])).map(function(r){return logical_ops_1.where(l,r,c)})).reshape(a)}function gramSchmidt_(r){var e;if(Array.isArray(r)){e=!1,util_1.assert(null!=r&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=r[0].shape[0],t=function(e){util_1.assert(r[e].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[e].shape[0]+" vs. "+n+")"})},a=1;a<r.length;++a)t(a)}else e=!0,r=concat_split_1.split(r,r.shape[0],0).map(function(r){return array_ops_1.squeeze(r,[0])});util_1.assert(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var s=[],o=r,i=function(r){s.push(engine_1.ENGINE.tidy(function(){var e=o[r];if(r>0)for(var n=0;n<r;++n){var t=reduction_ops_1.sum(s[n].mulStrict(e)).mul(s[n]);e=e.sub(t)}return e.div(norm_1.norm(e,"euclidean"))}))};for(a=0;a<r.length;++a)i(a);return e?array_ops_1.stack(s,0):s}function qr_(r,e){if(void 0===e&&(e=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(2===r.rank)return qr2d(r,e);var n=r.shape.slice(0,r.shape.length-2).reduce(function(r,e){return r*e}),t=[],a=[];return array_ops_1.unstack(r.reshape([n,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0).forEach(function(r){var n=qr2d(r,e),s=n[0],o=n[1];t.push(s),a.push(o)}),[array_ops_1.stack(t,0).reshape(r.shape),array_ops_1.stack(a,0).reshape(r.shape)]}function qr2d(r,e){return void 0===e&&(e=!1),engine_1.ENGINE.tidy(function(){if(2!==r.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var n=r.shape[0],t=r.shape[1],a=eye_1.eye(n),s=r.clone(),o=tensor_ops_1.tensor2d([[1]],[1,1]),i=o.clone(),u=n>=t?t:n,p=function(r){var e,u=s,p=i,_=a;e=engine_1.ENGINE.tidy(function(){var e=s.slice([r,r],[n-r,1]),u=e.norm(),p=s.slice([r,r],[1,1]),_=tensor_ops_1.tensor2d([[-1]]).where(p.greater(0),tensor_ops_1.tensor2d([[1]])),l=p.sub(_.mul(u)),c=e.div(l);i=1===c.shape[0]?o.clone():o.concat(c.slice([1,0],[c.shape[0]-1,c.shape[1]]),0);var h=_.matMul(l).div(u).neg(),m=s.slice([r,0],[n-r,t]),d=h.mul(i);if(0===r)s=m.sub(d.matMul(i.transpose().matMul(m)));else{var g=m.sub(d.matMul(i.transpose().matMul(m)));s=s.slice([0,0],[r,t]).concat(g,0)}var f=a.slice([0,r],[n,a.shape[1]-r]);if(0===r)a=f.sub(f.matMul(i).matMul(d.transpose()));else{var b=f.sub(f.matMul(i).matMul(d.transpose()));a=a.slice([0,0],[n,r]).concat(b,1)}return[i,s,a]}),i=e[0],s=e[1],a=e[2],globals_1.dispose([u,p,_])},_=0;_<u;++_)p(_);return!e&&n>t&&(a=a.slice([0,0],[n,t]),s=s.slice([0,0],[t,t])),[a,s]})}exports.bandPart=operation_1.op({bandPart_:bandPart_}),exports.gramSchmidt=operation_1.op({gramSchmidt_:gramSchmidt_}),exports.qr=operation_1.op({qr_:qr_});

},{"../engine":163,"../globals":166,"../tensor_util_env":290,"../util":294,"./array_ops":192,"./binary_ops":196,"./concat_split":204,"./eye":215,"./logical_ops":223,"./norm":230,"./operation":232,"./reduction_ops":241,"./tensor_ops":259}],223:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,r,o,n){return new(o||(o=Promise))(function(t,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function l(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?t(e.value):new o(function(r){r(e.value)}).then(a,l)}c((n=n.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(e,r){var o,n,t,i,a={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(t=2&i[0]?n.return:i[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,i[1])).done)return t;switch(n=0,t&&(i=[2&i[0],t.value]),i[0]){case 0:case 1:t=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(t=(t=a.trys).length>0&&t[t.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!t||i[1]>t[0]&&i[1]<t[3])){a.label=i[1];break}if(6===i[0]&&a.label<t[1]){a.label=t[1],t=i;break}if(t&&a.label<t[2]){a.label=t[2],a.ops.push(i);break}t[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(e){i=[6,e],n=0}finally{o=t=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};Object.defineProperty(exports,"__esModule",{value:!0});var where_impl_1=require("../backends/where_impl"),engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),broadcast_util_1=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function logicalNot_(e){var r=tensor_util_env_1.convertToTensor(e,"x","logicalNot","bool");return engine_1.ENGINE.runKernelFunc(function(e){return e.logicalNot(r)},{$x:r})}function logicalAnd_(e,r){var o=tensor_util_env_1.convertToTensor(e,"a","logicalAnd","bool"),n=tensor_util_env_1.convertToTensor(r,"b","logicalAnd","bool");return broadcast_util_1.assertAndGetBroadcastShape(o.shape,n.shape),engine_1.ENGINE.runKernelFunc(function(e){return e.logicalAnd(o,n)},{a:o,b:n},null,"LogicalAnd")}function logicalOr_(e,r){var o=tensor_util_env_1.convertToTensor(e,"a","logicalOr","bool"),n=tensor_util_env_1.convertToTensor(r,"b","logicalOr","bool");return broadcast_util_1.assertAndGetBroadcastShape(o.shape,n.shape),engine_1.ENGINE.runKernelFunc(function(e){return e.logicalOr(o,n)},{$a:o,$b:n})}function logicalXor_(e,r){var o=tensor_util_env_1.convertToTensor(e,"a","logicalXor","bool"),n=tensor_util_env_1.convertToTensor(r,"b","logicalXor","bool");return broadcast_util_1.assertAndGetBroadcastShape(o.shape,n.shape),exports.logicalOr(e,r).logicalAnd(exports.logicalAnd(e,r).logicalNot())}function where_(e,r,o){var n=tensor_util_env_1.convertToTensor(r,"a","where"),t=tensor_util_env_1.convertToTensor(o,"b","where"),i=tensor_util_env_1.convertToTensor(e,"condition","where","bool");util_1.assertShapesMatch(n.shape,t.shape,"Error in where: "),1===i.rank?util_1.assert(i.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):util_1.assertShapesMatch(i.shape,t.shape,"Error in where: ");return engine_1.ENGINE.runKernelFunc(function(e,r){var o=e.select(i,n,t);return r([i]),o},{$condition:i,$a:n,$b:t},function(e,r){var o=r[0];return{$condition:function(){return tensor_ops_1.zerosLike(o).toFloat()},$a:function(){return e.mul(o.cast(e.dtype))},$b:function(){return e.mul(o.logicalNot().cast(e.dtype))}}})}function whereAsync_(e){return __awaiter(this,void 0,void 0,function(){var r,o,n;return __generator(this,function(t){switch(t.label){case 0:return[4,(r=tensor_util_env_1.convertToTensor(e,"condition","whereAsync","bool")).data()];case 1:return o=t.sent(),n=where_impl_1.whereImpl(r.shape,o),e!==r&&r.dispose(),[2,n]}})})}exports.logicalAnd=operation_1.op({logicalAnd_:logicalAnd_}),exports.logicalNot=operation_1.op({logicalNot_:logicalNot_}),exports.logicalOr=operation_1.op({logicalOr_:logicalOr_}),exports.logicalXor=operation_1.op({logicalXor_:logicalXor_}),exports.where=operation_1.op({where_:where_}),exports.whereAsync=whereAsync_;

},{"../backends/where_impl":160,"../engine":163,"../tensor_util_env":290,"../util":294,"./broadcast_util":199,"./operation":232,"./tensor_ops":259}],224:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Reduction,gradients_1=require("../gradients"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),axis_util_1=require("./axis_util"),binary_ops_1=require("./binary_ops"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function computeWeightedLoss_(o,e,s){void 0===s&&(s=Reduction.SUM_BY_NONZERO_WEIGHTS);var r=tensor_util_env_1.convertToTensor(o,"losses","computeWeightedLoss"),t=null;null!=e&&(t=tensor_util_env_1.convertToTensor(e,"weights","computeWeightedLoss"));var n=null==t?r:r.mul(t);if(s===Reduction.NONE)return n;if(s===Reduction.SUM)return n.sum();if(s===Reduction.MEAN){if(null==t)return n.mean();var i=r.size/t.size,_=n.sum().div(t.sum());return i>1?_.div(tensor_ops_1.scalar(i)):_}if(s===Reduction.SUM_BY_NONZERO_WEIGHTS){if(null==t)return n.sum().div(tensor_ops_1.scalar(r.size));var a=t.mul(tensor_ops_1.ones(r.shape)).notEqual(tensor_ops_1.scalar(0)).sum().toFloat();return n.sum().div(a)}throw Error("Unknown reduction: "+s)}function absoluteDifference_(o,e,s,r){void 0===r&&(r=Reduction.SUM_BY_NONZERO_WEIGHTS);var t=tensor_util_env_1.convertToTensor(o,"labels","absoluteDifference"),n=tensor_util_env_1.convertToTensor(e,"predictions","absoluteDifference"),i=null;null!=s&&(i=tensor_util_env_1.convertToTensor(s,"weights","absoluteDifference")),util_1.assertShapesMatch(t.shape,n.shape,"Error in absoluteDifference: ");var _=t.sub(n).abs();return exports.computeWeightedLoss(_,i,r)}function meanSquaredError_(o,e,s,r){void 0===r&&(r=Reduction.SUM_BY_NONZERO_WEIGHTS);var t=tensor_util_env_1.convertToTensor(o,"labels","meanSquaredError"),n=tensor_util_env_1.convertToTensor(e,"predictions","meanSquaredError"),i=null;null!=s&&(i=tensor_util_env_1.convertToTensor(s,"weights","meanSquaredError")),util_1.assertShapesMatch(t.shape,n.shape,"Error in meanSquaredError: ");var _=t.squaredDifference(n);return exports.computeWeightedLoss(_,i,r)}function cosineDistance_(o,e,s,r,t){void 0===t&&(t=Reduction.SUM_BY_NONZERO_WEIGHTS);var n=tensor_util_env_1.convertToTensor(o,"labels","cosineDistance"),i=tensor_util_env_1.convertToTensor(e,"predictions","cosineDistance"),_=null;null!=r&&(_=tensor_util_env_1.convertToTensor(r,"weights","cosineDistance")),util_1.assertShapesMatch(n.shape,i.shape,"Error in cosineDistance: ");var a=tensor_ops_1.scalar(1).sub(n.mul(i).sum(s,!0));return exports.computeWeightedLoss(a,_,t)}function hingeLoss_(o,e,s,r){void 0===r&&(r=Reduction.SUM_BY_NONZERO_WEIGHTS);var t=tensor_util_env_1.convertToTensor(o,"labels","hingeLoss"),n=tensor_util_env_1.convertToTensor(e,"predictions","hingeLoss"),i=null;null!=s&&(i=tensor_util_env_1.convertToTensor(s,"weights","hingeLoss")),util_1.assertShapesMatch(t.shape,n.shape,"Error in hingeLoss: ");var _=tensor_ops_1.scalar(1);t=tensor_ops_1.scalar(2).mul(t).sub(_);var a=_.sub(t.mul(n)).relu();return exports.computeWeightedLoss(a,i,r)}function logLoss_(o,e,s,r,t){void 0===r&&(r=1e-7),void 0===t&&(t=Reduction.SUM_BY_NONZERO_WEIGHTS);var n=tensor_util_env_1.convertToTensor(o,"labels","logLoss"),i=tensor_util_env_1.convertToTensor(e,"predictions","logLoss"),_=null;null!=s&&(_=tensor_util_env_1.convertToTensor(s,"weights","logLoss")),util_1.assertShapesMatch(n.shape,i.shape,"Error in logLoss: ");var a=tensor_ops_1.scalar(1),u=tensor_ops_1.scalar(r),l=n.mul(i.add(u).log()).neg().sub(a.sub(n).mul(a.sub(i).add(u).log()));return exports.computeWeightedLoss(l,_,t)}function sigmoidCrossEntropyWithLogits_(o,e){var s=tensor_util_env_1.convertToTensor(o,"labels","sigmoidCrossEntropyWithLogits"),r=tensor_util_env_1.convertToTensor(e,"logits","sigmoidCrossEntropyWithLogits");util_1.assertShapesMatch(s.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var t=r.relu(),n=r.mul(s),i=r.abs().neg().exp().log1p();return t.sub(n).add(i)}function sigmoidCrossEntropy_(o,e,s,r,t){void 0===r&&(r=0),void 0===t&&(t=Reduction.SUM_BY_NONZERO_WEIGHTS);var n=tensor_util_env_1.convertToTensor(o,"multiClassLabels","sigmoidCrossEntropy"),i=tensor_util_env_1.convertToTensor(e,"logits","sigmoidCrossEntropy"),_=null;if(null!=s&&(_=tensor_util_env_1.convertToTensor(s,"weights","sigmoidCrossEntropy")),util_1.assertShapesMatch(n.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var a=tensor_ops_1.scalar(r),u=tensor_ops_1.scalar(1),l=tensor_ops_1.scalar(.5);n=n.mul(u.sub(a)).add(l.mul(a))}var p=sigmoidCrossEntropyWithLogits_(n,i);return exports.computeWeightedLoss(p,_,t)}function huberLoss_(o,e,s,r,t){void 0===r&&(r=1),void 0===t&&(t=Reduction.SUM_BY_NONZERO_WEIGHTS);var n=tensor_util_env_1.convertToTensor(o,"labels","huberLoss"),i=tensor_util_env_1.convertToTensor(e,"predictions","huberLoss"),_=null;null!=s&&(_=tensor_util_env_1.convertToTensor(s,"weights","huberLoss")),util_1.assertShapesMatch(n.shape,i.shape,"Error in huberLoss: ");var a=tensor_ops_1.scalar(r),u=i.sub(n).abs(),l=binary_ops_1.minimum(u,a),p=u.sub(l),c=tensor_ops_1.scalar(.5).mul(l.square()).add(a.mul(p));return exports.computeWeightedLoss(c,_,t)}function softmaxCrossEntropyWithLogits_(o,e,s){if(void 0===s&&(s=-1),-1===s&&(s=e.rank-1),s!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+s);return gradients_1.customGrad(function(o,e,r){var t=e.logSumExp([s],!0),n=e.toFloat().sub(t);r([o,n]);return{value:n.mul(o).neg().sum([s]),gradFunc:function(o,e){var r=e[0],t=e[1],n=axis_util_1.expandShapeToKeepDim(o.shape,[s]);return[o.reshape(n).mul(r.toFloat().sub(t.exp())),o.reshape(n).mul(t.exp().sub(r.toFloat()))]}}})(o,e)}function softmaxCrossEntropy_(o,e,s,r,t){void 0===r&&(r=0),void 0===t&&(t=Reduction.SUM_BY_NONZERO_WEIGHTS);var n=tensor_util_env_1.convertToTensor(o,"onehotLabels","softmaxCrossEntropy"),i=tensor_util_env_1.convertToTensor(e,"logits","softmaxCrossEntropy"),_=null;if(null!=s&&(_=tensor_util_env_1.convertToTensor(s,"weights","softmaxCrossEntropy")),util_1.assertShapesMatch(n.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var a=tensor_ops_1.scalar(r),u=tensor_ops_1.scalar(1),l=tensor_ops_1.scalar(n.shape[1]);n=n.mul(u.sub(a)).add(a.div(l))}var p=softmaxCrossEntropyWithLogits_(n,i);return exports.computeWeightedLoss(p,_,t)}!function(o){o[o.NONE=0]="NONE",o[o.MEAN=1]="MEAN",o[o.SUM=2]="SUM",o[o.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Reduction=exports.Reduction||(exports.Reduction={})),exports.absoluteDifference=operation_1.op({absoluteDifference_:absoluteDifference_}),exports.computeWeightedLoss=operation_1.op({computeWeightedLoss_:computeWeightedLoss_}),exports.cosineDistance=operation_1.op({cosineDistance_:cosineDistance_}),exports.hingeLoss=operation_1.op({hingeLoss_:hingeLoss_}),exports.huberLoss=operation_1.op({huberLoss_:huberLoss_}),exports.logLoss=operation_1.op({logLoss_:logLoss_}),exports.meanSquaredError=operation_1.op({meanSquaredError_:meanSquaredError_}),exports.sigmoidCrossEntropy=operation_1.op({sigmoidCrossEntropy_:sigmoidCrossEntropy_}),exports.softmaxCrossEntropy=operation_1.op({softmaxCrossEntropy_:softmaxCrossEntropy_});

},{"../gradients":167,"../tensor_util_env":290,"../util":294,"./axis_util":194,"./binary_ops":196,"./operation":232,"./tensor_ops":259}],225:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function localResponseNormalization_(e,n,r,o,t){void 0===n&&(n=5),void 0===r&&(r=1),void 0===o&&(o=1),void 0===t&&(t=.5);var a=tensor_util_env_1.convertToTensor(e,"x","localResponseNormalization");util.assert(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),util.assert(util.isInt(n),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."});var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=engine_1.ENGINE.runKernelFunc(function(e,a){var s=e.localResponseNormalization4D(i,n,r,o,t);return a([i,s]),s},{x4D:i},function(e,a){var i=a[0],s=a[1];return{x4D:function(){return engine_1.ENGINE.runKernelFunc(function(a){return a.LRNGrad(e,i,s,n,r,o,t)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}exports.localResponseNormalization=operation_1.op({localResponseNormalization_:localResponseNormalization_});

},{"../engine":163,"../tensor_util_env":290,"../util":294,"./operation":232}],226:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function multiRNNCell_(e,t,l,r){for(var o=tensor_util_env_1.convertToTensor(t,"data","multiRNNCell"),n=tensor_util_env_1.convertToTensorArray(l,"c","multiRNNCell"),i=tensor_util_env_1.convertToTensorArray(r,"h","multiRNNCell"),s=o,_=[],a=0;a<e.length;a++){var c=e[a](s,n[a],i[a]);_.push(c[0]),_.push(c[1]),s=c[1]}var u=[],T=[];for(a=0;a<_.length;a+=2)u.push(_[a]),T.push(_[a+1]);return[u,T]}function basicLSTMCell_(e,t,l,r,o,n){var i=tensor_util_env_1.convertToTensor(e,"forgetBias","basicLSTMCell"),s=tensor_util_env_1.convertToTensor(t,"lstmKernel","basicLSTMCell"),_=tensor_util_env_1.convertToTensor(l,"lstmBias","basicLSTMCell"),a=tensor_util_env_1.convertToTensor(r,"data","basicLSTMCell"),c=tensor_util_env_1.convertToTensor(o,"c","basicLSTMCell"),u=tensor_util_env_1.convertToTensor(n,"h","basicLSTMCell"),T=a.concat(u,1).matMul(s).add(_),v=T.shape[0],C=T.shape[1]/4,m=[v,C],p=T.slice([0,0],m),N=T.slice([0,C],m),S=T.slice([0,2*C],m),d=T.slice([0,3*C],m),h=p.sigmoid().mulStrict(N.tanh()).addStrict(c.mulStrict(i.add(S).sigmoid()));return[h,h.tanh().mulStrict(d.sigmoid())]}exports.basicLSTMCell=operation_1.op({basicLSTMCell_:basicLSTMCell_}),exports.multiRNNCell=operation_1.op({multiRNNCell_:multiRNNCell_});

},{"../tensor_util_env":290,"./operation":232}],227:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function matMul_(r,t,n,a){var e;void 0===n&&(n=!1),void 0===a&&(a=!1);var u=tensor_util_env_1.convertToTensor(r,"a","matMul"),s=tensor_util_env_1.convertToTensor(t,"b","matMul");e=tensor_util_1.makeTypesMatch(u,s),u=e[0],s=e[1];var o=n?u.shape[u.rank-2]:u.shape[u.rank-1],i=a?s.shape[s.rank-1]:s.shape[s.rank-2],l=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=a?s.shape[s.rank-2]:s.shape[s.rank-1],c=u.shape.slice(0,-2),_=s.shape.slice(0,-2),k=util.sizeFromShape(c),h=util.sizeFromShape(_);util.assert(u.rank>=2&&s.rank>=2&&u.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+u.rank+" and "+s.rank+"."}),util.assert(util.arraysEqual(c,_),function(){return"Error in matMul: outer dimensions ("+c+") and ("+_+") of Tensors with shapes "+u.shape+" and "+s.shape+" must match."}),util.assert(o===i,function(){return"Error in matMul: inner shapes ("+o+") and ("+i+") of Tensors with shapes "+u.shape+" and "+s.shape+" and transposeA="+n+" and transposeB="+a+" must match."});var m=u.shape.slice(0,-2).concat([l,p]),d=n?u.as3D(k,o,l):u.as3D(k,l,o),v=a?s.as3D(h,p,i):s.as3D(h,i,p),M={transposeA:n,transposeB:a};return engine_1.ENGINE.runKernelFunc(function(r,t){var e=r.batchMatMul(d,v,n,a);return t([d,v]),e},{a:d,b:v},function(r,t){var e=t,u=e[0],s=e[1];return n||a?!n&&a?{a:function(){return r.matMul(s,!1,!1)},b:function(){return r.matMul(u,!0,!1)}}:n&&!a?{a:function(){return s.matMul(r,!1,!0)},b:function(){return u.matMul(r,!1,!1)}}:{a:function(){return s.matMul(r,!0,!0)},b:function(){return r.matMul(u,!0,!0)}}:{a:function(){return r.matMul(s,!1,!0)},b:function(){return u.matMul(r,!0,!1)}}},"BatchMatMul",M).reshape(m)}function outerProduct_(r,t){var n=tensor_util_env_1.convertToTensor(r,"v1","outerProduct"),a=tensor_util_env_1.convertToTensor(t,"v2","outerProduct");return util.assert(1===n.rank&&1===a.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+a.rank+"."}),n.as2D(-1,1).matMul(a.as2D(1,-1))}function dot_(r,t){var n=tensor_util_env_1.convertToTensor(r,"t1","dot"),a=tensor_util_env_1.convertToTensor(t,"t2","dot");util.assert(!(1!==n.rank&&2!==n.rank||1!==a.rank&&2!==a.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+a.rank+"."});var e=1===n.rank?n.size:n.shape[1],u=1===a.rank?a.size:a.shape[0];return util.assert(e===u,function(){return"Error in dot: inner dimensions of inputs must match, but got "+e+" and "+u+"."}),1===n.rank&&1===a.rank?n.as2D(1,-1).matMul(a.as2D(-1,1)).asScalar():1===n.rank&&2===a.rank?n.as2D(1,-1).matMul(a.as2D(a.shape[0],a.shape[1])).as1D():2===n.rank&&1===a.rank?n.matMul(a.as2D(-1,1)).as1D():n.matMul(a.as2D(a.shape[0],a.shape[1]))}exports.matMul=operation_1.op({matMul_:matMul_}),exports.dot=operation_1.op({dot_:dot_}),exports.outerProduct=operation_1.op({outerProduct_:outerProduct_});

},{"../engine":163,"../tensor_util":289,"../tensor_util_env":290,"../util":294,"./operation":232}],228:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),binary_ops_1=require("./binary_ops"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function movingAverage_(e,r,n,o,t){void 0===t&&(t=!0);var i=tensor_util_env_1.convertToTensor(e,"v","movingAverage"),s=tensor_util_env_1.convertToTensor(r,"x","movingAverage"),_=tensor_util_env_1.convertToTensor(n,"decay","movingAverage");tensor_util_1.assertTypesMatch(i,s),util.assert(util.arraysEqual(i.shape,s.shape),function(){return"Shape mismatch in v and x"});var u=tensor_ops_1.scalar(1),a=u.sub(_),v=s.sub(i).mul(a);if(t){util.assert(null!=o,function(){return"When using zeroDebias: true, step is required."});var l=tensor_util_env_1.convertToTensor(o,"step","movingAverage");v=v.div(u.sub(binary_ops_1.pow(_,l)))}return i.add(v)}exports.movingAverage=operation_1.op({movingAverage_:movingAverage_});

},{"../tensor_util":289,"../tensor_util_env":290,"../util":294,"./binary_ops":196,"./operation":232,"./tensor_ops":259}],229:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function multinomial_(e,r,o,i){void 0===i&&(i=!1);var n=tensor_util_env_1.convertToTensor(e,"logits","multinomial"),t=n.size,u=n.rank;if(t<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+t+".");if(u>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+u);o=o||Math.random();var l=1===u?n.as2D(1,-1):n,a=engine_1.ENGINE.runKernelFunc(function(e){return e.multinomial(l,i,r,o)},{logits2D:l});return 1===u?a.as1D():a}exports.multinomial=operation_1.op({multinomial_:multinomial_});

},{"../engine":163,"../tensor_util_env":290,"./operation":232}],230:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function norm_(r,e,n,i){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===i&&(i=!1);var o=normImpl(r=tensor_util_env_1.convertToTensor(r,"x","norm"),e,n),a=o.shape;if(i){var t=util_1.parseAxisParam(n,r.shape);a=axis_util.expandShapeToKeepDim(o.shape,t)}return o.reshape(a)}function normImpl(r,e,n){if(void 0===n&&(n=null),0===r.rank)return r.abs();if(1!==r.rank&&null===n)return normImpl(r.reshape([-1]),e,n);if(1===r.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return r.abs().sum(n);if(e===1/0)return r.abs().max(n);if(e===-1/0)return r.abs().min(n);if("euclidean"===e||2===e)return r.abs().pow(tensor_ops_1.scalar(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(n)&&2===n.length){if(1===e)return r.abs().sum(n[0]).max(n[1]-1);if(e===1/0)return r.abs().sum(n[1]).max(n[0]);if(e===-1/0)return r.abs().sum(n[1]).min(n[0]);if("fro"===e||"euclidean"===e)return r.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+n)}exports.norm=operation_1.op({norm_:norm_});

},{"../tensor_util_env":290,"../util":294,"./axis_util":194,"./operation":232,"./tensor_ops":259}],231:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),kernel_names_1=require("../kernel_names"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function oneHot_(e,n,o,r){if(void 0===o&&(o=1),void 0===r&&(r=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var t=tensor_util_env_1.convertToTensor(e,"indices","oneHot","int32"),i=t.shape.concat([n]),_={indices:t=t.flatten()},u={depth:n,onValue:o,offValue:r};return engine_1.ENGINE.runKernelFunc(function(e,i){return i([t]),e.oneHot(t,n,o,r)},_,null,kernel_names_1.OneHot,u).reshape(i)}exports.oneHot=operation_1.op({oneHot_:oneHot_});

},{"../engine":163,"../kernel_names":188,"../tensor_util_env":290,"./operation":232}],232:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine");function op(e){var n=Object.keys(e);if(1!==n.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var r=n[0],t=e[r];r.endsWith("_")&&(r=r.substring(0,r.length-1));var o=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];engine_1.ENGINE.startScope(r);try{var o=t.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),engine_1.ENGINE.endScope(o),o}catch(e){throw engine_1.ENGINE.endScope(null),e}};return Object.defineProperty(o,"name",{value:r,configurable:!0}),o}exports.op=op;

},{"../engine":163}],233:[function(require,module,exports){
"use strict";function __export(r){for(var e in r)exports.hasOwnProperty(e)||(exports[e]=r[e])}Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_to_1=require("./broadcast_to");exports.broadcastTo=broadcast_to_1.broadcastTo;var clone_1=require("./clone");exports.clone=clone_1.clone;var div_1=require("./div");exports.div=div_1.div;var div_no_nan_1=require("./div_no_nan");exports.divNoNan=div_no_nan_1.divNoNan;var eye_1=require("./eye");exports.eye=eye_1.eye;var multinomial_1=require("./multinomial");exports.multinomial=multinomial_1.multinomial;var one_hot_1=require("./one_hot");exports.oneHot=one_hot_1.oneHot;var rand_1=require("./rand");exports.rand=rand_1.rand;var random_gamma_1=require("./random_gamma");exports.randomGamma=random_gamma_1.randomGamma;var random_normal_1=require("./random_normal");exports.randomNormal=random_normal_1.randomNormal;var random_uniform_1=require("./random_uniform");exports.randomUniform=random_uniform_1.randomUniform;var square_1=require("./square");exports.square=square_1.square;var squared_difference_1=require("./squared_difference");exports.squaredDifference=squared_difference_1.squaredDifference;var tile_1=require("./tile");exports.tile=tile_1.tile;var truncated_normal_1=require("./truncated_normal");exports.truncatedNormal=truncated_normal_1.truncatedNormal,__export(require("./batchnorm")),__export(require("./boolean_mask")),__export(require("./complex_ops")),__export(require("./concat_split"));var conv_1=require("./conv");exports.conv1d=conv_1.conv1d,exports.conv2d=conv_1.conv2d,exports.conv3d=conv_1.conv3d,exports.depthwiseConv2d=conv_1.depthwiseConv2d,exports.separableConv2d=conv_1.separableConv2d,exports.conv2dTranspose=conv_1.conv2dTranspose,exports.conv3dTranspose=conv_1.conv3dTranspose,__export(require("./matmul")),__export(require("./reverse")),__export(require("./pool")),__export(require("./slice")),__export(require("./unary_ops")),__export(require("./reduction_ops")),__export(require("./compare")),__export(require("./binary_ops")),__export(require("./relu_ops")),__export(require("./logical_ops")),__export(require("./array_ops")),__export(require("./tensor_ops")),__export(require("./transpose")),__export(require("./softmax")),__export(require("./lrn")),__export(require("./norm")),__export(require("./segment_ops")),__export(require("./lstm")),__export(require("./moving_average")),__export(require("./strided_slice")),__export(require("./topk")),__export(require("./scatter_nd")),__export(require("./spectral_ops")),__export(require("./sparse_to_dense")),__export(require("./gather_nd")),__export(require("./diag")),__export(require("./dropout")),__export(require("./signal_ops")),__export(require("./in_top_k"));var operation_1=require("./operation");exports.op=operation_1.op;var losses=require("./loss_ops");exports.losses=losses;var linalg=require("./linalg_ops");exports.linalg=linalg;var image=require("./image_ops");exports.image=image;var spectral=require("./spectral_ops");exports.spectral=spectral;var fused=require("./fused_ops");exports.fused=fused;var signal=require("./signal_ops");exports.signal=signal;

},{"./array_ops":192,"./batchnorm":195,"./binary_ops":196,"./boolean_mask":197,"./broadcast_to":198,"./clone":201,"./compare":202,"./complex_ops":203,"./concat_split":204,"./conv":207,"./diag":209,"./div":210,"./div_no_nan":211,"./dropout":212,"./eye":215,"./fused_ops":216,"./gather_nd":218,"./image_ops":220,"./in_top_k":221,"./linalg_ops":222,"./logical_ops":223,"./loss_ops":224,"./lrn":225,"./lstm":226,"./matmul":227,"./moving_average":228,"./multinomial":229,"./norm":230,"./one_hot":231,"./operation":232,"./pool":234,"./rand":235,"./random_gamma":237,"./random_normal":238,"./random_uniform":239,"./reduction_ops":241,"./relu_ops":242,"./reverse":243,"./scatter_nd":244,"./segment_ops":246,"./signal_ops":249,"./slice":250,"./softmax":252,"./sparse_to_dense":253,"./spectral_ops":255,"./square":256,"./squared_difference":257,"./strided_slice":258,"./tensor_ops":259,"./tile":260,"./topk":261,"./transpose":262,"./truncated_normal":263,"./unary_ops":264}],234:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),array_ops_1=require("./array_ops"),conv_util=require("./conv_util"),operation_1=require("./operation");function maxPoolImpl_(n,r,o,t,e,a){var i=tensor_util_env_1.convertToTensor(n,"x","maxPool"),u=i,s=!1;3===i.rank&&(s=!0,u=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==t&&(t=[1,1]),util.assert(4===u.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+u.rank+"."}),util.assert(conv_util.eitherStridesOrDilationsAreOne(o,t),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+t+"'"}),null!=a&&util.assert(util.isInt(e),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+e+"."});var l=conv_util.computePool2DInfo(u.shape,r,o,t,e,a);if(1===l.filterWidth&&1===l.filterHeight&&util.arraysEqual(l.inShape,l.outShape))return i.clone();var p=[u],c=engine_1.ENGINE.runKernelFunc(function(n,r){var o=n.maxPool(u,l);return r([u,o]),o},{x:u},function(n,a){var i=a[0],u=a[1];return{x:function(){return maxPoolBackprop(n,i,u,r,o,t,e)}}},"MaxPool",l,p);return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function maxPool_(n,r,o,t,e){return maxPoolImpl_(n,r,o,1,t,e)}function avgPoolImpl_(n,r,o,t,e,a){var i=tensor_util_env_1.convertToTensor(n,"x","avgPool","float32");null==t&&(t=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(o,t),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+t+"'"});var u=i,s=!1;3===i.rank&&(s=!0,u=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),util.assert(4===u.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+u.rank+"."}),null!=a&&util.assert(util.isInt(e),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+e+"."});var l=conv_util.computePool2DInfo(u.shape,r,o,t,e,a);if(1===l.filterWidth&&1===l.filterHeight&&util.arraysEqual(l.inShape,l.outShape))return i.clone();var p=engine_1.ENGINE.runKernelFunc(function(n){return n.avgPool(u,l)},{x:u},function(n){return{x:function(){return avgPoolBackprop(n,u,r,o,t,e)}}},"AvgPool",l);return p=p.cast(i.dtype),s?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function avgPool_(n,r,o,t,e){return avgPoolImpl_(n,r,o,1,t,e)}function pool_(n,r,o,t,e,a){null==e&&(e=[1,1]),null==a&&(a=1),0===t&&(t="valid");var i=tensor_util_env_1.convertToTensor(n,"x","maxPool"),u=i,s=!1;3===i.rank&&(s=!0,u=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),util.assert(conv_util.eitherStridesOrDilationsAreOne(a,e),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+e+"'"});var l,p=conv_util.computePool2DInfo(u.shape,r,a,e,t),c=[p.dilationHeight,p.dilationWidth];l="same"===t?withSpaceToBatchBasePaddings([p.filterHeight,p.filterWidth],c):[[0,0],[0,0]];var d=1===c[0]&&1===c[1],h=requiredSpaceToBatchPaddings([p.inHeight,p.inWidth],c,l),v=h[0],_=h[1],m=d?t:"valid",k=d?u:array_ops_1.spaceToBatchND(u,c,v),f=("avg"===o?function(){return avgPoolImpl_(k,r,a,1,m)}:function(){return maxPoolImpl_(k,r,a,1,m)})(),g=d?f:array_ops_1.batchToSpaceND(f,c,_);return s?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}function maxPoolBackprop(n,r,o,t,e,a,i,u){var s=tensor_util_env_1.convertToTensor(n,"dy","maxPoolBackprop"),l=tensor_util_env_1.convertToTensor(r,"input","maxPoolBackprop"),p=tensor_util_env_1.convertToTensor(o,"output","maxPoolBackprop");util.assert(l.rank===s.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+s.rank+")"}),null==a&&(a=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(e,a),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),util.assert(4===s.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."}),util.assert(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."}),null!=u&&util.assert(util.isInt(i),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+"."});var c=conv_util.computePool2DInfo(l.shape,t,e,a,i,u);return engine_1.ENGINE.runKernelFunc(function(n){return n.maxPoolBackprop(s,l,p,c)},{$dy:s,$input:l})}function avgPoolBackprop(n,r,o,t,e,a){var i=tensor_util_env_1.convertToTensor(n,"dy","avgPoolBackprop"),u=tensor_util_env_1.convertToTensor(r,"input","avgPoolBackprop");util.assert(u.rank===i.rank,function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+i.rank+")"}),null==e&&(e=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(t,e),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+e+"'"});var s=u,l=i,p=!1;3===u.rank&&(p=!0,s=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),util.assert(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),util.assert(4===s.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+s.rank+"."});var c=conv_util.computePool2DInfo(s.shape,o,t,e,a),d=engine_1.ENGINE.runKernelFunc(function(n){return n.avgPoolBackprop(l,s,c)},{dy4D:l,input4D:s});return p?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function requiredSpaceToBatchPaddings(n,r,o){var t=o.map(function(n){return n[0]}),e=o.map(function(n){return n[1]}),a=n.concat(t,e),i=r.map(function(n,r){return(n-a[r]%n)%n}),u=e.map(function(n,r){return n+i[r]});return[r.map(function(n,r){return[t[r],u[r]]}),r.map(function(n,r){return[0,i[r]]})]}function withSpaceToBatchBasePaddings(n,r){var o=n.map(function(n,o){return n+(n-1)*(r[o]-1)}).map(function(n){return n-1}),t=o.map(function(n){return Math.floor(n/2)}),e=o.map(function(n,r){return n-t[r]});return o.map(function(n,r){return[t[r],e[r]]})}function avgPool3d_(n,r,o,t,e,a,i){void 0===a&&(a="NDHWC");var u=tensor_util_env_1.convertToTensor(n,"x","avgPool3d","float32"),s=u,l=!1;4===u.rank&&(l=!0,s=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),null==i&&(i=[1,1,1]),util.assert(5===s.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+s.rank+"."}),util.assert("NDHWC"===a,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),util.assert(conv_util.eitherStridesOrDilationsAreOne(o,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),null!=e&&util.assert(util.isInt(t),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+e+" but got pad "+t+"."});var p=conv_util.computePool3DInfo(s.shape,r,o,i,t,e,a),c=engine_1.ENGINE.runKernelFunc(function(n){return n.avgPool3d(s,p)},{x:s},function(n){return{x:function(){return avgPool3dBackprop(n,s,r,o,i,t,e)}}});return c=c.cast(s.dtype),l?c.as4D(c.shape[1],c.shape[2],c.shape[3],c.shape[4]):c}function avgPool3dBackprop(n,r,o,t,e,a,i){var u=tensor_util_env_1.convertToTensor(n,"dy","avgPool3dBackprop"),s=tensor_util_env_1.convertToTensor(r,"input","avgPool3dBackprop"),l=u,p=s,c=!1;4===s.rank&&(c=!0,l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),p=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),util.assert(5===l.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."}),util.assert(5===p.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+p.rank+"."}),null==e&&(e=[1,1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(t,e),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+e+"'"}),null!=i&&util.assert(util.isInt(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var d=conv_util.computePool3DInfo(p.shape,o,t,e,a,i),h=engine_1.ENGINE.runKernelFunc(function(n){return n.avgPool3dBackprop(l,p,d)},{dy5D:l,input5D:p});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}function maxPool3d_(n,r,o,t,e,a,i){void 0===a&&(a="NDHWC");var u=tensor_util_env_1.convertToTensor(n,"x","maxPool3d"),s=u,l=!1;4===u.rank&&(l=!0,s=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),null==i&&(i=[1,1,1]),util.assert(5===s.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+s.rank+"."}),util.assert("NDHWC"===a,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),util.assert(conv_util.eitherStridesOrDilationsAreOne(o,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),null!=e&&util.assert(util.isInt(t),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+e+" but got pad "+t+"."});var p=conv_util.computePool3DInfo(s.shape,r,o,i,t,e,a),c=engine_1.ENGINE.runKernelFunc(function(n,r){var o=n.maxPool3d(s,p);return r([s,o]),o},{x:s},function(n,a){var u=a[0],s=a[1];return{x:function(){return maxPool3dBackprop(n,u,s,r,o,i,t,e)}}});return l?c.as4D(c.shape[1],c.shape[2],c.shape[3],c.shape[4]):c}function maxPool3dBackprop(n,r,o,t,e,a,i,u){var s=tensor_util_env_1.convertToTensor(n,"dy","maxPool3dBackprop"),l=tensor_util_env_1.convertToTensor(r,"input","maxPool3dBackprop"),p=tensor_util_env_1.convertToTensor(o,"output","maxPool3dBackprop"),c=s,d=l,h=p,v=!1;4===l.rank&&(v=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),d=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]),h=p.as5D(1,p.shape[0],p.shape[1],p.shape[2],p.shape[3])),util.assert(5===c.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."}),util.assert(5===d.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."}),util.assert(5===h.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."}),null==a&&(a=[1,1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(e,a),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),null!=u&&util.assert(util.isInt(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+"."});var _=conv_util.computePool3DInfo(d.shape,t,e,a,i,u),m=engine_1.ENGINE.runKernelFunc(function(n){return n.maxPool3dBackprop(c,d,h,_)},{dy5D:c,input5D:d});return v?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}exports.maxPool=operation_1.op({maxPool_:maxPool_}),exports.avgPool=operation_1.op({avgPool_:avgPool_}),exports.pool=operation_1.op({pool_:pool_}),exports.maxPool3d=operation_1.op({maxPool3d_:maxPool3d_}),exports.avgPool3d=operation_1.op({avgPool3d_:avgPool3d_});

},{"../engine":163,"../tensor_util_env":290,"../util":294,"./array_ops":192,"./conv_util":208,"./operation":232}],235:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),util_1=require("../util"),operation_1=require("./operation");function rand_(e,r,n){var o=util_1.sizeFromShape(e),t=null;if(null==n||"float32"===n)t=new Float32Array(o);else if("int32"===n)t=new Int32Array(o);else{if("bool"!==n)throw new Error("Unknown data type "+n);t=new Uint8Array(o)}for(var i=0;i<o;i++)t[i]=r();return engine_1.ENGINE.makeTensor(t,e,n)}exports.rand=operation_1.op({rand_:rand_});

},{"../engine":163,"../util":294,"./operation":232}],236:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),test_util_1=require("../test_util"),MPRandGauss=function(){function t(t,e,n,a,r){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=r||Math.random();this.random=seedrandom.alea(i.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,a=!1;!a;){var r=void 0,i=void 0,s=void 0;do{s=(r=2*this.random()-1)*r+(i=2*this.random()-1)*i}while(s>=1||0===s);var o=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*r*o,n=this.mean+this.stdDev*i*o,this.truncated&&!this.isValidTruncated(e)||(a=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}();exports.MPRandGauss=MPRandGauss;var RandGamma=function(){function t(t,e,n,a){this.alpha=t,this.beta=1/e,this.dtype=n;var r=a||Math.random();this.randu=seedrandom.alea(r.toString()),this.randn=new MPRandGauss(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var t,e,n,a,r,i;;){do{a=this.randn.nextValue(),i=1+this.c*a}while(i<=0);if(i*=i*i,e=1-.331*(t=a*a)*t,n=.5*t+this.d*(1-i+Math.log(i)),(r=this.randu())<e||Math.log(r)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},t.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},t}();exports.RandGamma=RandGamma;var UniformRandom=function(){function t(t,e,n,a){var r=this;if(void 0===t&&(t=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==r.dtype||"float32"===r.dtype},this.min=t,this.range=e-t,this.dtype=n,null==a&&(a=Math.random()),"number"==typeof a&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=seedrandom.alea(a)}return t.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function jarqueBeraNormalityTest(t){var e=t.length,n=skewness(t),a=kurtosis(t),r=e/6*(Math.pow(n,2)+.25*Math.pow(a-3,2));if(r>5.991)throw new Error("Invalid p-value for JB: "+r)}function expectArrayInMeanStdRange(t,e,n,a){null==a&&(a=test_util_1.testEpsilon());var r=mean(t);test_util_1.expectNumbersClose(r,e,a),test_util_1.expectNumbersClose(standardDeviation(t,r),n,a)}function mean(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e/t.length}function standardDeviation(t,e){for(var n=0,a=0;a<t.length;a++){var r=t[a]-e;n+=r*r}return Math.sqrt(n/t.length)}function kurtosis(t){for(var e=mean(t),n=t.length,a=0,r=0,i=0;i<n;i++){var s=t[i]-e;a+=Math.pow(s,2),r+=Math.pow(s,4)}return 1/n*r/Math.pow(1/n*a,2)}function skewness(t){for(var e=mean(t),n=t.length,a=0,r=0,i=0;i<n;i++){var s=t[i]-e;a+=Math.pow(s,2),r+=Math.pow(s,3)}return 1/n*r/Math.pow(1/(n-1)*a,1.5)}exports.UniformRandom=UniformRandom,exports.jarqueBeraNormalityTest=jarqueBeraNormalityTest,exports.expectArrayInMeanStdRange=expectArrayInMeanStdRange;

},{"../test_util":291,"seedrandom":323}],237:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var array_ops_1=require("./array_ops"),operation_1=require("./operation"),rand_util_1=require("./rand_util");function randomGamma_(r,a,e,o,t){if(void 0===e&&(e=1),void 0===o&&(o="float32"),null==e&&(e=1),null==o&&(o="float32"),"float32"!==o&&"int32"!==o)throw new Error("Unsupported data type "+o);for(var n=new rand_util_1.RandGamma(a,e,o,t),u=array_ops_1.buffer(r,o),_=0;_<u.values.length;_++)u.values[_]=n.nextValue();return u.toTensor()}exports.randomGamma=operation_1.op({randomGamma_:randomGamma_});

},{"./array_ops":192,"./operation":232,"./rand_util":236}],238:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var array_ops_1=require("./array_ops"),operation_1=require("./operation"),rand_util_1=require("./rand_util");function randomNormal_(r,o,e,a,n){if(void 0===o&&(o=0),void 0===e&&(e=1),null!=a&&"bool"===a)throw new Error("Unsupported data type "+a);for(var t=new rand_util_1.MPRandGauss(o,e,a,!1,n),u=array_ops_1.buffer(r,a),_=0;_<u.values.length;_++)u.values[_]=t.nextValue();return u.toTensor()}exports.randomNormal=operation_1.op({randomNormal_:randomNormal_});

},{"./array_ops":192,"./operation":232,"./rand_util":236}],239:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var array_ops_1=require("./array_ops"),operation_1=require("./operation"),rand_util_1=require("./rand_util");function randomUniform_(r,o,e,n,a){void 0===o&&(o=0),void 0===e&&(e=1),void 0===n&&(n="float32");for(var i=array_ops_1.buffer(r,n),t=new rand_util_1.UniformRandom(o,e,null,a),_=0;_<i.values.length;_++)i.values[_]=t.nextValue();return i.toTensor()}exports.randomUniform=operation_1.op({randomUniform_:randomUniform_});

},{"./array_ops":192,"./operation":232,"./rand_util":236}],240:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");function computeOptimalWindowSize(e){return e<=exports.PARALLELIZE_THRESHOLD?e:util_1.nearestDivisor(e,Math.floor(Math.sqrt(e)))}exports.PARALLELIZE_THRESHOLD=30,exports.computeOptimalWindowSize=computeOptimalWindowSize;

},{"../util":294}],241:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),gradients_1=require("../gradients"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function logSumExp_(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=tensor_util_env_1.convertToTensor(e,"x","logSumExp"),t=util.parseAxisParam(n,a.shape),o=a.max(t,!0),i=a.sub(o).exp().sum(t).log(),s=o.reshape(i.shape).add(i);if(r){var u=axis_util.expandShapeToKeepDim(s.shape,t);return s.reshape(u)}return s}function sum_(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=tensor_util_env_1.convertToTensor(e,"x","sum");"bool"===a.dtype&&(a=a.toInt());var t=util.parseAxisParam(n,a.shape);return gradients_1.customGrad(function(e){var n=axis_util.getAxesPermutation(t,e.rank),a=t,o=e;null!=n&&(o=e.transpose(n),a=axis_util.getInnerMostAxes(a.length,e.rank));var i=function(n){var r=e.shape.slice();return t.forEach(function(e){r[e]=1}),n.reshape(r).mul(tensor_ops_1.ones(e.shape,"float32"))},s={axes:a},u=engine_1.ENGINE.runKernelFunc(function(e){return e.sum(o,a)},{x:o},function(e){return{x:function(){return i(e)}}},"Sum",s);if(r){var p=axis_util.expandShapeToKeepDim(u.shape,t);u=u.reshape(p)}return{value:u,gradFunc:i}})(a)}function prod_(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=tensor_util_env_1.convertToTensor(e,"x","prod");"bool"===a.dtype&&(a=a.toInt());var t=util.parseAxisParam(n,a.shape),o=axis_util.getAxesPermutation(t,a.rank),i=t,s=a;null!=o&&(s=a.transpose(o),i=axis_util.getInnerMostAxes(i.length,a.rank));var u=engine_1.ENGINE.runKernelFunc(function(e){return e.prod(s,i)},{permutedX:s});if(r){var p=axis_util.expandShapeToKeepDim(u.shape,t);u=u.reshape(p)}return u}function mean_(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=tensor_util_env_1.convertToTensor(e,"x","mean"),t=util.parseAxisParam(n,a.shape),o=axis_util.computeOutAndReduceShapes(a.shape,t)[1],i=util.sizeFromShape(o);return gradients_1.customGrad(function(e){var a=tensor_ops_1.scalar(i);return{value:(a.dtype===e.dtype?e:e.cast(a.dtype)).div(a).sum(n,r),gradFunc:function(n){var r=e.shape.slice();return t.forEach(function(e){r[e]=1}),n.reshape(r).mul(tensor_ops_1.ones(e.shape,"float32")).div(i)}}})(a)}function gradForMinAndMax(e,n,r,a,t){return n.rank<r.rank&&(n=n.reshape(axis_util.expandShapeToKeepDim(n.shape,a))),e.rank<r.rank&&(e=e.reshape(axis_util.expandShapeToKeepDim(e.shape,a))),{x:function(){var a=e.mul(r.equal(n).cast(e.dtype));return null==t?a:a.transpose(t)}}}function min_(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=tensor_util_env_1.convertToTensor(e,"x","min"),t=a,o=util.parseAxisParam(n,a.shape),i=o,s=axis_util.getAxesPermutation(i,a.rank);null!=s&&(a=a.transpose(s),i=axis_util.getInnerMostAxes(i.length,a.rank));var u=[a],p=engine_1.ENGINE.runKernelFunc(function(e,n){var r=e.min(a,i);return n([t,r]),r},{x:a},function(e,n){return gradForMinAndMax(e,n[1],n[0],o,s)},"Min",{axes:i},u,[!0]);if(r){var l=axis_util.expandShapeToKeepDim(p.shape,o);p=p.reshape(l)}return p}function max_(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=tensor_util_env_1.convertToTensor(e,"x","max"),t=a,o=util.parseAxisParam(n,a.shape),i=o,s=axis_util.getAxesPermutation(i,a.rank);null!=s&&(a=a.transpose(s),i=axis_util.getInnerMostAxes(i.length,a.rank));var u=[a],p=engine_1.ENGINE.runKernelFunc(function(e,n){var r=e.max(a,i);return n([t,r]),r},{x:a},function(e,n){return gradForMinAndMax(e,n[1],n[0],o,s)},"Max",{axes:i},u,[!0]);if(r){var l=axis_util.expandShapeToKeepDim(p.shape,o);p=p.reshape(l)}return p}function argMin_(e,n){void 0===n&&(n=0);var r=tensor_util_env_1.convertToTensor(e,"x","argMin");null==n&&(n=0);var a=util.parseAxisParam(n,r.shape),t=axis_util.getAxesPermutation(a,r.rank);null!=t&&(r=r.transpose(t),a=axis_util.getInnerMostAxes(a.length,r.rank));return engine_1.ENGINE.runKernelFunc(function(e,n){var t=e.argMin(r,a[0]);return n([r]),t},{$x:r},function(e,n){var r=n[0];return{$x:function(){return tensor_ops_1.zerosLike(r)}}})}function argMax_(e,n){void 0===n&&(n=0);var r=tensor_util_env_1.convertToTensor(e,"x","argMax");null==n&&(n=0);var a=util.parseAxisParam(n,r.shape),t=axis_util.getAxesPermutation(a,r.rank);null!=t&&(r=r.transpose(t),a=axis_util.getInnerMostAxes(a.length,r.rank));var o={axis:a[0]},i=[r];return engine_1.ENGINE.runKernelFunc(function(e,n){var t=e.argMax(r,a[0]);return n([r]),t},{x:r},function(e,n){var r=n[0];return{x:function(){return tensor_ops_1.zerosLike(r)}}},"ArgMax",o,i)}function all_(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=tensor_util_env_1.convertToTensor(e,"x","all","bool"),t=util.parseAxisParam(n,a.shape),o=t,i=axis_util.getAxesPermutation(o,a.rank);null!=i&&(a=a.transpose(i),o=axis_util.getInnerMostAxes(o.length,a.rank));var s=engine_1.ENGINE.runKernelFunc(function(e){return e.all(a,o)},{$x:a});if(r){var u=axis_util.expandShapeToKeepDim(s.shape,t);return s.reshape(u)}return s}function any_(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a=tensor_util_env_1.convertToTensor(e,"x","any","bool"),t=util.parseAxisParam(n,a.shape),o=t,i=axis_util.getAxesPermutation(o,a.rank);null!=i&&(a=a.transpose(i),o=axis_util.getInnerMostAxes(o.length,a.rank));var s=engine_1.ENGINE.runKernelFunc(function(e){return e.any(a,o)},{$x:a});if(r){var u=axis_util.expandShapeToKeepDim(s.shape,t);return s.reshape(u)}return s}function moments_(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1),e=tensor_util_env_1.convertToTensor(e,"x","moments");var a=util.parseAxisParam(n,e.shape),t=e.mean(a,r),o=t.shape;return r||(o=axis_util.expandShapeToKeepDim(t.shape,a)),{mean:t,variance:e.toFloat().sub(t.reshape(o)).square().mean(a,r)}}exports.all=operation_1.op({all_:all_}),exports.any=operation_1.op({any_:any_}),exports.argMax=operation_1.op({argMax_:argMax_}),exports.argMin=operation_1.op({argMin_:argMin_}),exports.logSumExp=operation_1.op({logSumExp_:logSumExp_}),exports.max=operation_1.op({max_:max_}),exports.mean=operation_1.op({mean_:mean_}),exports.min=operation_1.op({min_:min_}),exports.moments=operation_1.op({moments_:moments_}),exports.sum=operation_1.op({sum_:sum_}),exports.prod=operation_1.op({prod_:prod_});

},{"../engine":163,"../gradients":167,"../tensor_util_env":290,"../util":294,"./axis_util":194,"./operation":232,"./tensor_ops":259}],242:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),binary_ops_1=require("./binary_ops"),broadcast_util_1=require("./broadcast_util"),logical_ops_1=require("./logical_ops"),operation_1=require("./operation"),selu_util_1=require("./selu_util"),tensor_ops_1=require("./tensor_ops");function relu_(e){var r=tensor_util_env_1.convertToTensor(e,"x","relu");if("bool"===r.dtype)return r.toInt();return engine_1.ENGINE.runKernelFunc(function(e,n){var u=e.relu(r);return n([r]),u},{x:r},function(e,r){var n=r[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}},"Relu")}function relu6_(e){var r=tensor_util_env_1.convertToTensor(e,"x","relu6");if("bool"===r.dtype)return r.toInt();return engine_1.ENGINE.runKernelFunc(function(e,n){var u=e.relu6(r);return n([r]),u},{x:r},function(e,r){var n=r[0],u=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(u.toFloat())}}},"Relu6")}function elu_(e){var r=tensor_util_env_1.convertToTensor(e,"x","elu");return engine_1.ENGINE.runKernelFunc(function(e,n){var u=e.elu(r);return n([u]),u},{$x:r},function(e,r){var n=r[0];return{$x:function(){return engine_1.ENGINE.runKernelFunc(function(r){return r.eluDer(e,n)},{dy:e,y:n})}}})}function selu_(e){var r=tensor_util_env_1.convertToTensor(e,"x","selu");return engine_1.ENGINE.runKernelFunc(function(e,n){var u=e.selu(r);return n([r]),u},{$x:r},function(e,r){var n=r[0];return{$x:function(){var r=n.greater(tensor_ops_1.scalar(0)),u=tensor_ops_1.scalar(selu_util_1.SELU_SCALEALPHA),t=tensor_ops_1.scalar(selu_util_1.SELU_SCALE),o=e.mul(t),l=e.mul(u).mul(n.toFloat().exp());return logical_ops_1.where(r,o,l)}}})}function leakyRelu_(e,r){void 0===r&&(r=.2);var n=tensor_util_env_1.convertToTensor(e,"x","leakyRelu");return binary_ops_1.maximum(tensor_ops_1.scalar(r).mul(n),n)}function prelu_(e,r){var n=tensor_util_env_1.convertToTensor(e,"x","prelu"),u=tensor_util_env_1.convertToTensor(r,"alpha","prelu");return engine_1.ENGINE.runKernelFunc(function(e,r){var t=e.prelu(n,u);return r([n,u]),t},{x:n,alpha:u},function(e,r){var n=r[0],u=r[1],t=n.greater(0);return{x:function(){return logical_ops_1.where(t,e,e.mul(u))},alpha:function(){var r=logical_ops_1.where(t,tensor_ops_1.zerosLike(e),e.mul(n)),o=broadcast_util_1.getReductionAxes(u.shape,e.shape);return o.length>0&&(r=r.sum(o)),r.reshape(u.shape)}}},"Prelu")}exports.elu=operation_1.op({elu_:elu_}),exports.leakyRelu=operation_1.op({leakyRelu_:leakyRelu_}),exports.prelu=operation_1.op({prelu_:prelu_}),exports.relu=operation_1.op({relu_:relu_}),exports.relu6=operation_1.op({relu6_:relu6_}),exports.selu=operation_1.op({selu_:selu_});

},{"../engine":163,"../tensor_util_env":290,"./binary_ops":196,"./broadcast_util":199,"./logical_ops":223,"./operation":232,"./selu_util":248,"./tensor_ops":259}],243:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function reverse1d_(e){var r=tensor_util_env_1.convertToTensor(e,"x","reverse");return util.assert(1===r.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+r.rank+"."}),exports.reverse(r,0)}function reverse2d_(e,r){var n=tensor_util_env_1.convertToTensor(e,"x","reverse");return util.assert(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),exports.reverse(n,r)}function reverse3d_(e,r){var n=tensor_util_env_1.convertToTensor(e,"x","reverse");return util.assert(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),exports.reverse(n,r)}function reverse4d_(e,r){var n=tensor_util_env_1.convertToTensor(e,"x","reverse");return util.assert(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),exports.reverse(n,r)}function reverse_(e,r){var n=tensor_util_env_1.convertToTensor(e,"x","reverse");if(0===n.rank)return n.clone();var t=util.parseAxisParam(r,n.shape);return engine_1.ENGINE.runKernelFunc(function(e){return e.reverse(n,t)},{$x:n},function(e){return{$x:function(){return e.reverse(t)}}}).reshapeAs(n)}exports.reverse=operation_1.op({reverse_:reverse_}),exports.reverse1d=operation_1.op({reverse1d_:reverse1d_}),exports.reverse2d=operation_1.op({reverse2d_:reverse2d_}),exports.reverse3d=operation_1.op({reverse3d_:reverse3d_}),exports.reverse4d=operation_1.op({reverse4d_:reverse4d_});

},{"../engine":163,"../tensor_util_env":290,"../util":294,"./operation":232}],244:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation"),scatter_nd_util=require("./scatter_nd_util");function scatterND_(e,t,r){var n=tensor_util_env_1.convertToTensor(e,"indices","scatterND","int32"),i=tensor_util_env_1.convertToTensor(t,"updates","scatterND");return scatter_nd_util.validateInput(i,n,r),engine_1.ENGINE.runKernelFunc(function(e){return e.scatterND(n,i,r)},{indices:n,updates:i},null,"ScatterNd",{shape:r})}exports.scatterND=operation_1.op({scatterND_:scatterND_});

},{"../engine":163,"../tensor_util_env":290,"./operation":232,"./scatter_nd_util":245}],245:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");function validateUpdateShape(e,t,a){var r=t.rank>1?t.shape[t.rank-1]:1,s=t.rank>1?t.rank-1:1,p="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+a.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+s+".";if(a.rank<s)throw new Error(p+" update.rank < "+s+". ");if(e.length<r+(a.rank-s))throw new Error(p+" Output shape length < "+(r+(a.rank-s)));if(a.rank!==s+e.length-r)throw new Error(p+" update.rank != "+(s+e.length-r));for(var h=0;h<s;++h)if(a.shape[h]!==t.shape[h])throw new Error(p+" updates.shape["+h+"] ("+a.shape[h]+") != indices.shape["+h+"] ("+t.shape[h]+").");for(h=0;h<a.rank-s;++h)if(a.shape[h+s]!==e[h+r])throw new Error(p+" updates.shape["+(h+s)+"] ("+a.shape[h+s]+") != shape["+(h+s)+"] ("+e[h+s]+")")}function validateInput(e,t,a){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(a.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+a);if(0===a.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}validateUpdateShape(a,t,e)}function calculateShapes(e,t,a){for(var r=t.shape.length,s=r>1?t.shape[r-1]:1,p=a.length,h=1,i=s;i<p;++i)h*=a[i];var n=s<1?1:s;return{sliceRank:s,numUpdates:util_1.sizeFromShape(t.shape)/n,sliceSize:h,strides:util_1.computeStrides(a.slice(0,s)).concat([1]),outputSize:util_1.sizeFromShape(a)}}exports.validateUpdateShape=validateUpdateShape,exports.validateInput=validateInput,exports.calculateShapes=calculateShapes;

},{"../util":294}],246:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),array_ops_1=require("./array_ops"),axis_util_1=require("./axis_util"),binary_ops_1=require("./binary_ops"),compare_1=require("./compare"),logical_ops_1=require("./logical_ops"),operation_1=require("./operation"),segment_util_1=require("./segment_util"),tensor_ops_1=require("./tensor_ops");function unsortedSegmentSum_(e,r,n){var t=tensor_util_env_1.convertToTensor(e,"x","unsortedSegmentSum"),o=tensor_util_env_1.convertToTensor(r,"segmentIds","unsortedSegmentSum","int32");util_1.assert(util_1.isInt(n),function(){return"numSegments must be of dtype int"});return engine_1.ENGINE.runKernelFunc(function(e,r){var a=e.unsortedSegmentSum(t,o,n);return r([o]),a},{$x:t},function(e,r){var n=r[0];return{$x:function(){return gatherDropNegatives(e,n)}}})}function gather_(e,r,n){void 0===n&&(n=0);var t=tensor_util_env_1.convertToTensor(e,"x","gather"),o=tensor_util_env_1.convertToTensor(r,"indices","gather","int32");n=util_1.parseAxisParam(n,t.shape)[0];var a=segment_util_1.collectGatherOpShapeInfo(t,o,n);return engine_1.ENGINE.runKernelFunc(function(e,r){var a=e.gather(t,o.flatten(),n);return r([o]),a},{x:t,indices:o},function(e,r){var o=r[0];return{x:function(){var r=t.shape,a=o.size,s=r.slice(0,n),i=s.length,u=r.slice(n,r.length).slice(1),_=u.length,p=arrayRange(0,i),l=arrayRange(i+1,i+1+_),g=arrayConcat([s,[a],u]),c=e.reshape(g),m=o.reshape([a]),h=arrayConcat([[i],p,l]),v=c.transpose(h),f=exports.unsortedSegmentSum(v,m,t.shape[n]),d=axis_util_1.getUndoAxesPermutation(h);return f=f.transpose(d)},indices:function(){return o}}},"Gather",{axis:n}).reshape(a.outputShape)}function arrayRange(e,r){for(var n=[],t=e;t<r;++t)n.push(t);return n}function arrayConcat(e){for(var r=[],n=0;n<e.length;++n)for(var t=0;t<e[n].length;++t)r.push(e[n][t]);return r}function gatherDropNegatives(e,r){for(var n=binary_ops_1.maximum(r,tensor_ops_1.zerosLike(r)),t=exports.gather(e,n),o=compare_1.greaterEqual(r,tensor_ops_1.scalar(0,"int32")),a=t.rank-o.rank,s=0;s<a;++s)o=array_ops_1.expandDims(o,s+1);o=logical_ops_1.logicalAnd(o,tensor_ops_1.ones(t.shape,"bool"));var i=tensor_ops_1.zerosLike(t);return logical_ops_1.where(o,t,i)}exports.gather=operation_1.op({gather_:gather_}),exports.unsortedSegmentSum=operation_1.op({unsortedSegmentSum_:unsortedSegmentSum_});

},{"../engine":163,"../tensor_util_env":290,"../util":294,"./array_ops":192,"./axis_util":194,"./binary_ops":196,"./compare":202,"./logical_ops":223,"./operation":232,"./segment_util":247,"./tensor_ops":259}],247:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util"),reduce_util_1=require("./reduce_util");function segOpComputeOptimalWindowSize(e,t){var r,p=!1;for(e<=reduce_util_1.PARALLELIZE_THRESHOLD?(r=e,p=!0):r=util_1.nearestDivisor(e,Math.floor(Math.sqrt(e)));!p;)r>t||r===e?p=!0:r=util_1.nearestDivisor(e,r+1);return r}function computeOutShape(e,t,r){for(var p=[],u=e.length,o=0;o<u;o++)o!==t?p.push(e[o]):p.push(r);return p}function collectGatherOpShapeInfo(e,t,r){for(var p=e.shape[r],u=[],o=1,i=1,a=0;a<r;a++)u.push(e.shape[a]),o*=e.shape[a];for(a=0;a<t.rank;a++)u.push(t.shape[a]);for(a=r+1;a<e.rank;a++)u.push(e.shape[a]),i*=e.shape[a];return{batchSize:o,sliceSize:i,dimSize:p,outputShape:u}}exports.segOpComputeOptimalWindowSize=segOpComputeOptimalWindowSize,exports.computeOutShape=computeOutShape,exports.collectGatherOpShapeInfo=collectGatherOpShapeInfo;

},{"../util":294,"./reduce_util":240}],248:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SELU_SCALEALPHA=1.7580993408473768,exports.SELU_SCALE=1.0507009873554805;

},{}],249:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var operation_1=require("../ops/operation"),binary_ops_1=require("./binary_ops"),concat_split_1=require("./concat_split"),slice_1=require("./slice"),spectral_ops_1=require("./spectral_ops"),tensor_ops_1=require("./tensor_ops");function hannWindow_(o){return cosineWindow(o,.5,.5)}function hammingWindow_(o){return cosineWindow(o,.54,.46)}function frame_(o,n,e,r,t){void 0===r&&(r=!1),void 0===t&&(t=0);for(var i=0,s=[];i+n<=o.size;)s.push(slice_1.slice(o,i,n)),i+=e;if(r)for(;i<o.size;){var a=i+n-o.size,_=concat_split_1.concat([slice_1.slice(o,i,n-a),tensor_ops_1.fill([a],t)]);s.push(_),i+=e}return 0===s.length?tensor_ops_1.tensor2d([],[0,n]):concat_split_1.concat(s).as2D(s.length,n)}function stft_(o,n,e,r,t){void 0===t&&(t=exports.hannWindow),null==r&&(r=enclosingPowerOfTwo(n));for(var i=exports.frame(o,n,e),s=binary_ops_1.mul(i,t(n)),a=[],_=0;_<i.shape[0];_++)a.push(spectral_ops_1.rfft(s.slice([_,0],[1,n]),r));return concat_split_1.concat(a)}function enclosingPowerOfTwo(o){return Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2))))}function cosineWindow(o,n,e){for(var r=1-o%2,t=new Float32Array(o),i=0;i<o;++i){var s=2*Math.PI*i/(o+r-1);t[i]=n-e*Math.cos(s)}return tensor_ops_1.tensor1d(t,"float32")}exports.hannWindow=operation_1.op({hannWindow_:hannWindow_}),exports.hammingWindow=operation_1.op({hammingWindow_:hammingWindow_}),exports.frame=operation_1.op({frame_:frame_}),exports.stft=operation_1.op({stft_:stft_});

},{"../ops/operation":232,"./binary_ops":196,"./concat_split":204,"./slice":250,"./spectral_ops":255,"./tensor_ops":259}],250:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation"),slice_util=require("./slice_util");function slice1d_(e,r,n){var t=tensor_util_env_1.convertToTensor(e,"x","slice1d");return util.assert(1===t.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+t.rank+" tensor"}),exports.slice(t,[r],[n])}function slice2d_(e,r,n){var t=tensor_util_env_1.convertToTensor(e,"x","slice2d");return util.assert(2===t.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+t.rank+" tensor"}),exports.slice(t,r,n)}function slice3d_(e,r,n){var t=tensor_util_env_1.convertToTensor(e,"x","slice3d");return util.assert(3===t.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+t.rank+" tensor"}),exports.slice(t,r,n)}function slice4d_(e,r,n){var t=tensor_util_env_1.convertToTensor(e,"x","slice4d");return util.assert(4===t.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+t.rank+" tensor"}),exports.slice(t,r,n)}function slice_(e,r,n){var t,i,s=tensor_util_env_1.convertToTensor(e,"x","slice");if(0===s.rank)throw new Error("Slicing scalar is not possible");(t="number"==typeof r?[r].concat(new Array(s.rank-1).fill(0)):r.length<s.rank?r.concat(new Array(s.rank-r.length).fill(0)):r.slice()).forEach(function(e){util.assert(-1!==e,function(){return"slice() does not support negative begin indexing."})}),i=(i=null==n?new Array(s.rank).fill(-1):"number"==typeof n?[n].concat(new Array(s.rank-1).fill(-1)):n.length<s.rank?n.concat(new Array(s.rank-n.length).fill(-1)):n).map(function(e,r){return e>=0?e:(util.assert(-1===e,function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+r+"."}),s.shape[r]-t[r])}),slice_util.assertParamsValid(s,t,i);var o=s.shape,l={begin:t,size:i};return engine_1.ENGINE.runKernelFunc(function(e){return e.slice(s,t,i)},{x:s},function(e){for(var r=[],n=0;n<e.rank;n++)r.push([t[n],o[n]-t[n]-i[n]]);return{x:function(){return e.pad(r)}}},"Slice",l)}exports.slice=operation_1.op({slice_:slice_}),exports.slice1d=operation_1.op({slice1d_:slice1d_}),exports.slice2d=operation_1.op({slice2d_:slice2d_}),exports.slice3d=operation_1.op({slice3d_:slice3d_}),exports.slice4d=operation_1.op({slice4d_:slice4d_});

},{"../engine":163,"../tensor_util_env":290,"../util":294,"./operation":232,"./slice_util":251}],251:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function assertParamsValid(r,t,e){util.assert(r.rank===t.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+t+" must match the rank of the array ("+r.rank+")."}),util.assert(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of size "+e+" must match the rank of the array ("+r.rank+")."});for(var n=function(n){util.assert(t[n]+e[n]<=r.shape[n],function(){return"Error in slice"+r.rank+"D: begin["+n+"] + size["+n+"] ("+(t[n]+e[n])+") would overflow input.shape["+n+"] ("+r.shape[n]+")"})},s=0;s<r.rank;++s)n(s)}function maskToAxes(r){for(var t=[],e=0;r>0;)1&r&&t.push(e),r/=2,e++;return t}function computeOutShape(r,t,e){for(var n=[],s=0;s<r.length;s++)n[s]=Math.ceil((t[s]-r[s])/e[s]);return n}function startForAxis(r,t,e,n,s){var a=t[s],o=e[s]||1;(r&1<<s||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=n[s];return a<0&&(a+=u),a=util.clamp(0,a,u-1)}function stopForAxis(r,t,e,n,s){var a=t[s],o=e[s]||1;(r&1<<s||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=n[s];return a<0&&(a+=u),a=o>0?util.clamp(0,a,u):util.clamp(-1,a,u-1)}function isSliceContinous(r,t,e){for(var n=e.length,s=0;s<e.length;s++)if(e[s]>1){n=s;break}for(s=n+1;s<e.length;s++)if(t[s]>0||e[s]!==r[s])return!1;return!0}function computeFlatOffset(r,t){for(var e=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)e+=r[n]*t[n];return e}exports.assertParamsValid=assertParamsValid,exports.maskToAxes=maskToAxes,exports.computeOutShape=computeOutShape,exports.startForAxis=startForAxis,exports.stopForAxis=stopForAxis,exports.isSliceContinous=isSliceContinous,exports.computeFlatOffset=computeFlatOffset;

},{"../util":294}],252:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),gradients_1=require("../gradients"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function softmax_(o,n){void 0===n&&(n=-1);var r=tensor_util_env_1.convertToTensor(o,"logits","softmax","float32");if(-1===n&&(n=r.rank-1),n!==r.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+r.rank+" and dim was "+n);return engine_1.ENGINE.runKernelFunc(function(o,t){var e=o.softmax(r,n);return t([e]),e},{logits:r},function(o,r){var t=r[0],e=o.mul(t);return{logits:function(){return e.sub(e.sum([n],!0).mul(t))}}},"Softmax",{dim:n},[],[!0])}function logSoftmax_(o,n){void 0===n&&(n=-1);var r=tensor_util_env_1.convertToTensor(o,"logits","logSoftmax");if(-1===n&&(n=r.rank-1),n!==r.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+r.rank+" and axis was "+n);return gradients_1.customGrad(function(o,r){var t=o.max(n,!0),e=o.sub(t),a=e.toFloat().sub(e.exp().sum(n,!0).log());r([a]);return{value:a,gradFunc:function(o,r){var t=r[0].exp();return o.sub(o.sum(n,!0).mul(t))}}})(r)}exports.softmax=operation_1.op({softmax_:softmax_}),exports.logSoftmax=operation_1.op({logSoftmax_:logSoftmax_});

},{"../engine":163,"../gradients":167,"../tensor_util_env":290,"./operation":232}],253:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),sparse_to_dense=require("../ops/sparse_to_dense_util"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function sparseToDense_(e,s,n,r){void 0===r&&(r=0);var o=tensor_util_env_1.convertToTensor(e,"sparseIndices","sparseToDense","int32"),t=tensor_util_env_1.convertToTensor(s,"sparseValues","sparseToDense"),_=tensor_util_env_1.convertToTensor(r,"defaultValue","sparseToDense",t.dtype);return sparse_to_dense.validateInput(o,t,n,_),engine_1.ENGINE.runKernelFunc(function(e){return e.sparseToDense(o,t,n,_)},{$sparseIndices:o,$sparseValues:t,$defaultValue:_})}exports.sparseToDense=operation_1.op({sparseToDense_:sparseToDense_});

},{"../engine":163,"../ops/sparse_to_dense_util":254,"../tensor_util_env":290,"./operation":232}],254:[function(require,module,exports){
"use strict";function validateInput(e,t,r,a){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var s=e.rank>0?e.shape[0]:1,o=e.rank>1?e.shape[1]:1;if(r.length!==o)throw new Error("outputShape has incorrect number of elements:, "+r.length+", should be: "+o+".");var n=t.size;if(0!==t.rank&&(1!==t.rank||n!==s))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+s+"]");if(t.dtype!==a.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateInput=validateInput;

},{}],255:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),complex_ops_1=require("../ops/complex_ops"),operation_1=require("../ops/operation"),util_1=require("../util"),tensor_ops_1=require("./tensor_ops");function fft_(e){util_1.assert("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],r=e.size/t,p=e.as2D(r,t);return engine_1.ENGINE.runKernelFunc(function(e){return e.fft(p)},{input:e}).reshape(e.shape)}function ifft_(e){util_1.assert("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],r=e.size/t,p=e.as2D(r,t);return engine_1.ENGINE.runKernelFunc(function(e){return e.ifft(p)},{input:e}).reshape(e.shape)}function rfft_(e,t){util_1.assert("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var r,p=e.shape[e.shape.length-1],o=e.size/p;if(null!=t&&t<p){var s=e.shape.map(function(e){return 0}),n=e.shape.map(function(e){return e});n[e.shape.length-1]=t,r=e.slice(s,n),p=t}else if(null!=t&&t>p){var f=e.shape.map(function(e){return e});f[e.shape.length-1]=t-p,r=e.concat(tensor_ops_1.zeros(f),e.shape.length-1),p=t}else r=e;var a=r.zerosLike(),i=complex_ops_1.complex(r,a).as2D(o,p),l=exports.fft(i),u=Math.floor(p/2)+1,_=complex_ops_1.real(l),c=complex_ops_1.imag(l),h=_.split([u,p-u],_.shape.length-1),m=c.split([u,p-u],c.shape.length-1),x=r.shape.slice();return x[r.shape.length-1]=u,complex_ops_1.complex(h[0],m[0]).reshape(x)}function irfft_(e){var t=e.shape[e.shape.length-1],r=e.size/t;if(t<=2){var p=e.as2D(r,t),o=exports.ifft(p);return complex_ops_1.real(o)}var s=[r,2*(t-1)],n=complex_ops_1.real(e).as2D(r,t),f=complex_ops_1.imag(e).as2D(r,t),a=n.slice([0,1],[r,t-2]).reverse(1),i=f.slice([0,1],[r,t-2]).reverse(1).mul(tensor_ops_1.scalar(-1)),l=n.concat(a,1),u=f.concat(i,1);p=complex_ops_1.complex(l,u).as2D(s[0],s[1]),o=exports.ifft(p);return complex_ops_1.real(o)}exports.fft=operation_1.op({fft_:fft_}),exports.ifft=operation_1.op({ifft_:ifft_}),exports.rfft=operation_1.op({rfft_:rfft_}),exports.irfft=operation_1.op({irfft_:irfft_});

},{"../engine":163,"../ops/complex_ops":203,"../ops/operation":232,"../util":294,"./tensor_ops":259}],256:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function square_(e){var r=tensor_util_env_1.convertToTensor(e,"x","square"),n=[r];return engine_1.ENGINE.runKernelFunc(function(e,n){return n([r]),e.square(r)},{x:r},null,"Square",{},n,[])}exports.square=operation_1.op({square_:square_});

},{"../engine":163,"../tensor_util_env":290,"./operation":232}],257:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),kernel_names_1=require("../kernel_names"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),broadcast_util_1=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function squaredDifference_(e,r){var n,t=tensor_util_env_1.convertToTensor(e,"a","squaredDifference"),u=tensor_util_env_1.convertToTensor(r,"b","squaredDifference");n=tensor_util_1.makeTypesMatch(t,u),t=n[0],u=n[1],broadcast_util_1.assertAndGetBroadcastShape(t.shape,u.shape);var s={a:t,b:u},_=[t,u];return engine_1.ENGINE.runKernelFunc(function(e,r){var n=e.squaredDifference(t,u);return r([t,u]),n},s,function(e,r){var n=r[0],t=r[1],u=tensor_ops_1.scalar(2);return{a:function(){return e.mul(n.sub(t).mul(u))},b:function(){return e.mul(t.sub(n).mul(u))}}},kernel_names_1.SquaredDifference,{},_,[])}exports.squaredDifference=operation_1.op({squaredDifference_:squaredDifference_});

},{"../engine":163,"../kernel_names":188,"../tensor_util":289,"../tensor_util_env":290,"./broadcast_util":199,"./operation":232,"./tensor_ops":259}],258:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation"),slice_1=require("./slice"),slice_util_1=require("./slice_util");function stridedSlice_(e,i,r,t,s,n,o,l,u){if(void 0===s&&(s=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===l&&(l=0),void 0===u&&(u=0),null==t&&(t=new Array(i.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var c=tensor_util_env_1.convertToTensor(e,"x","stridedSlice"),_=slice_util_1.maskToAxes(l),a=c.shape.slice();_.forEach(function(e){i[e]=0,r[e]=1,a.splice(e,0,1)}),c=c.reshape(a);for(var d=0;d<c.rank;d++)i[d]=slice_util_1.startForAxis(s,i,t,c.shape,d),r[d]=slice_util_1.stopForAxis(n,r,t,c.shape,d),t[d]=t[d]||1;var p=slice_util_1.maskToAxes(u);p.forEach(function(e){r[e]=i[e]+1,t[e]=1});var v=slice_util_1.computeOutShape(i,r,t),f=v.filter(function(e,i){return-1===p.indexOf(i)});return t.every(function(e){return 1===e})?slice_1.slice(c,i,v).reshape(f):engine_1.ENGINE.runKernelFunc(function(e){return e.stridedSlice(c,i,r,t)},{$x:c}).reshape(f)}exports.stridedSlice=operation_1.op({stridedSlice_:stridedSlice_});

},{"../engine":163,"../tensor_util_env":290,"./operation":232,"./slice":250,"./slice_util":251}],259:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),complex_ops_1=require("./complex_ops"),operation_1=require("./operation");function tensor(e,r,n){return makeTensor(e,r,tensor_util_env_1.inferShape(e,n),n)}function makeTensor(e,r,n,o){if(null==o&&(o=util_1.inferDtype(e)),"complex64"===o)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!util_1.isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=r){util_1.assertNonNegativeIntegerDimensions(r);var t=util_1.sizeFromShape(r),s=util_1.sizeFromShape(n);util_1.assert(t===s,function(){return"Based on the provided shape, ["+r+"], the tensor should have "+t+" values but has "+s});for(var i=0;i<n.length;++i){var a=n[i],l=i!==n.length-1||a!==util_1.sizeFromShape(r.slice(i));util_1.assert(n[i]===r[i]||!l,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+r+"). "})}}return util_1.isTypedArray(e)||Array.isArray(e)||(e=[e]),r=r||n,e="string"!==o?util_1.toTypedArray(e,o,environment_1.env().getBool("DEBUG")):util_1.flatten(e,[],!0),engine_1.ENGINE.makeTensor(e,r,o)}function scalar(e,r){if((util_1.isTypedArray(e)&&"string"!==r||Array.isArray(e))&&"complex64"!==r)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===r&&util_1.isTypedArray(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return makeTensor(e,[],[],r)}function tensor1d(e,r){util_1.assertNonNull(e);var n=tensor_util_env_1.inferShape(e,r);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return makeTensor(e,null,n,r)}function tensor2d(e,r,n){if(util_1.assertNonNull(e),null!=r&&2!==r.length)throw new Error("tensor2d() requires shape to have two numbers");var o=tensor_util_env_1.inferShape(e,n);if(2!==o.length&&1!==o.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===o.length&&null==r)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return makeTensor(e,r,o,n)}function tensor3d(e,r,n){if(util_1.assertNonNull(e),null!=r&&3!==r.length)throw new Error("tensor3d() requires shape to have three numbers");var o=tensor_util_env_1.inferShape(e,n);if(3!==o.length&&1!==o.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===o.length&&null==r)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return makeTensor(e,r,o,n)}function tensor4d(e,r,n){if(util_1.assertNonNull(e),null!=r&&4!==r.length)throw new Error("tensor4d() requires shape to have four numbers");var o=tensor_util_env_1.inferShape(e,n);if(4!==o.length&&1!==o.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===o.length&&null==r)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return makeTensor(e,r,o,n)}function tensor5d(e,r,n){if(util_1.assertNonNull(e),null!=r&&5!==r.length)throw new Error("tensor5d() requires shape to have five numbers");var o=tensor_util_env_1.inferShape(e,n);if(5!==o.length&&1!==o.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===o.length&&null==r)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return makeTensor(e,r,o,n)}function tensor6d(e,r,n){if(util_1.assertNonNull(e),null!=r&&6!==r.length)throw new Error("tensor6d() requires shape to have six numbers");var o=tensor_util_env_1.inferShape(e,n);if(6!==o.length&&1!==o.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===o.length&&null==r)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return makeTensor(e,r=r||o,o,n)}function variable(e,r,n,o){return void 0===r&&(r=!0),engine_1.ENGINE.makeVariable(e,r,n,o)}function ones(e,r){if(void 0===r&&(r="float32"),"complex64"===r){var n=ones(e,"float32"),o=zeros(e,"float32");return complex_ops_1.complex(n,o)}var t=util_1.makeOnesTypedArray(util_1.sizeFromShape(e),r);return engine_1.ENGINE.makeTensor(t,e,r)}function zeros(e,r){if(void 0===r&&(r="float32"),"complex64"===r){var n=zeros(e,"float32"),o=zeros(e,"float32");return complex_ops_1.complex(n,o)}var t=util_1.makeZerosTypedArray(util_1.sizeFromShape(e),r);return engine_1.ENGINE.makeTensor(t,e,r)}function fill(e,r,n){return engine_1.ENGINE.runKernelFunc(function(o){return o.fill(e,r,n)},{})}function onesLike_(e){var r=tensor_util_env_1.convertToTensor(e,"x","onesLike");if("complex64"===r.dtype){var n=exports.onesLike(complex_ops_1.real(r)),o=exports.zerosLike(complex_ops_1.imag(r));return complex_ops_1.complex(n,o)}return engine_1.ENGINE.runKernelFunc(function(e){return e.onesLike(r)},{x:r},function(e,r){return{x:function(){return exports.zerosLike(e)}}},"OnesLike")}function zerosLike_(e){var r=tensor_util_env_1.convertToTensor(e,"x","zerosLike");return engine_1.ENGINE.runKernelFunc(function(e){return e.zerosLike(r)},{x:r},function(e,r){return{x:function(){return exports.zerosLike(e)}}},"ZerosLike")}function linspace(e,r,n){if(n<=0)throw new Error("The number of values should be positive.");return engine_1.ENGINE.runKernelFunc(function(o){return o.linspace(e,r,n)},{})}function range(e,r,n,o){if(void 0===n&&(n=1),void 0===o&&(o="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===r||e<r&&n<0||r<e&&n>1)return zeros([0],o);var t=Math.abs(Math.ceil((r-e)/n)),s=util_1.makeZerosTypedArray(t,o);r<e&&1===n&&(n=-1),s[0]=e;for(var i=1;i<s.length;i++)s[i]=s[i-1]+n;return tensor1d(s,o)}exports.tensor=tensor,exports.scalar=scalar,exports.tensor1d=tensor1d,exports.tensor2d=tensor2d,exports.tensor3d=tensor3d,exports.tensor4d=tensor4d,exports.tensor5d=tensor5d,exports.tensor6d=tensor6d,exports.variable=variable,exports.ones=ones,exports.zeros=zeros,exports.fill=fill,exports.linspace=linspace,exports.range=range,exports.onesLike=operation_1.op({onesLike_:onesLike_}),exports.zerosLike=operation_1.op({zerosLike_:zerosLike_});

},{"../engine":163,"../environment":164,"../tensor_util_env":290,"../util":294,"./complex_ops":203,"./operation":232}],260:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),kernel_names_1=require("../kernel_names"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function tile_(e,r){var n=tensor_util_env_1.convertToTensor(e,"x","tile",null);util.assert(n.rank===r.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+r+"."});var t=[n],i={x:n},u={reps:r};return engine_1.ENGINE.runKernelFunc(function(e,t){var i=e.tile(n,r);return t([n]),i},i,null,kernel_names_1.Tile,u,t)}exports.tile=operation_1.op({tile_:tile_});

},{"../engine":163,"../kernel_names":188,"../tensor_util_env":290,"../util":294,"./operation":232}],261:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function topk_(e,r,t){void 0===r&&(r=1),void 0===t&&(t=!0);var o=tensor_util_env_1.convertToTensor(e,"x","topk");if(0===o.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var n=o.shape[o.shape.length-1];if(r>n)throw new Error("'k' passed to topk() must be <= the last dimension ("+n+") but got "+r);var i=engine_1.ENGINE.runKernelFunc(function(e){return e.topk(o,r,t)},{$x:o});return{values:i[0],indices:i[1]}}exports.topk=operation_1.op({topk_:topk_});

},{"../engine":163,"../tensor_util_env":290,"./operation":232}],262:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation");function transpose_(e,r){var n=tensor_util_env_1.convertToTensor(e,"x","transpose");if(null==r&&(r=n.shape.map(function(e,r){return r}).reverse()),util.assert(n.rank===r.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+r+"."}),r.forEach(function(e){util.assert(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+r})}),n.rank<=1)return n.clone();var t={perm:r};return engine_1.ENGINE.runKernelFunc(function(e){return e.transpose(n,r)},{x:n},function(e){var n=axis_util.getUndoAxesPermutation(r);return{x:function(){return e.transpose(n)}}},"Transpose",t)}exports.transpose=operation_1.op({transpose_:transpose_});

},{"../engine":163,"../tensor_util_env":290,"../util":294,"./axis_util":194,"./operation":232}],263:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var array_ops_1=require("./array_ops"),operation_1=require("./operation"),rand_util_1=require("./rand_util");function truncatedNormal_(r,e,a,t,o){if(void 0===e&&(e=0),void 0===a&&(a=1),null!=t&&"bool"===t)throw new Error("Unsupported data type $ { dtype }");for(var n=new rand_util_1.MPRandGauss(e,a,t,!0,o),u=array_ops_1.buffer(r,t),_=0;_<u.values.length;_++)u.values[_]=n.nextValue();return u.toTensor()}exports.truncatedNormal=operation_1.op({truncatedNormal_:truncatedNormal_});

},{"./array_ops":192,"./operation":232,"./rand_util":236}],264:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function neg_(n){var r=tensor_util_env_1.convertToTensor(n,"x","neg"),e=[r];return engine_1.ENGINE.runKernelFunc(function(n){return n.neg(r)},{x:r},function(n){return{x:function(){return n.neg()}}},"Neg",{},e)}function ceil_(n){var r=tensor_util_env_1.convertToTensor(n,"x","ceil");return engine_1.ENGINE.runKernelFunc(function(n){return n.ceil(r)},{$x:r},function(n){return{$x:function(){return tensor_ops_1.zerosLike(n)}}})}function floor_(n){var r=tensor_util_env_1.convertToTensor(n,"x","floor");return engine_1.ENGINE.runKernelFunc(function(n){return n.floor(r)},{$x:r},function(n){return{$x:function(){return tensor_ops_1.zerosLike(n)}}})}function sign_(n){var r=tensor_util_env_1.convertToTensor(n,"x","sign");return engine_1.ENGINE.runKernelFunc(function(n){return n.sign(r)},{$x:r},function(n){return{$x:function(){return tensor_ops_1.zerosLike(n)}}})}function isNaN_(n){var r=tensor_util_env_1.convertToTensor(n,"x","isNaN");return engine_1.ENGINE.runKernelFunc(function(n){return n.isNaN(r)},{$x:r},function(n){return{$x:function(){return tensor_ops_1.zerosLike(n)}}})}function isInf_(n){var r=tensor_util_env_1.convertToTensor(n,"x","isInf");return engine_1.ENGINE.runKernelFunc(function(n){return n.isInf(r)},{$x:r},function(n){return{$x:function(){return tensor_ops_1.zerosLike(n)}}})}function isFinite_(n){var r=tensor_util_env_1.convertToTensor(n,"x","isFinite");return engine_1.ENGINE.runKernelFunc(function(n){return n.isFinite(r)},{$x:r},function(n){return{$x:function(){return tensor_ops_1.zerosLike(n)}}})}function round_(n){var r=tensor_util_env_1.convertToTensor(n,"x","round");return engine_1.ENGINE.runKernelFunc(function(n){return n.round(r)},{$x:r},function(n){return{$x:function(){return tensor_ops_1.zerosLike(n)}}})}function exp_(n){var r=tensor_util_env_1.convertToTensor(n,"x","exp");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.exp(r);return e([t]),t},{x:r},function(n,r){return{x:function(){return n.mulStrict(r[0])}}},"Exp",{},[],[!0])}function expm1_(n){var r=tensor_util_env_1.convertToTensor(n,"x","expm1");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.expm1(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.mul(e.exp())}}})}function log_(n){var r=tensor_util_env_1.convertToTensor(n,"x","log"),e=[r];return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.log(r);return e([r]),t},{x:r},function(n,r){var e=r[0];return{x:function(){return n.div(e.toFloat())}}},"Log",{},e)}function log1p_(n){var r=tensor_util_env_1.convertToTensor(n,"x","log1p");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.log1p(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.div(e.add(1))}}})}function sqrt_(n){var r=tensor_util_env_1.convertToTensor(n,"x","sqrt");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.sqrt(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.div(e.toFloat().sqrt().mul(2))}}})}function rsqrt_(n){var r=tensor_util_env_1.convertToTensor(n,"x","rsqrt"),e=[r];return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.rsqrt(r);return e([r]),t},{x:r},function(n,r){var e=r[0];return{x:function(){return n.div(e.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},e)}function reciprocal_(n){var r=tensor_util_env_1.convertToTensor(n,"x","reciprocal");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.reciprocal(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.div(e.square().neg())}}})}function abs_(n){var r=tensor_util_env_1.convertToTensor(n,"x","abs");if("complex64"===r.dtype)return engine_1.ENGINE.runKernelFunc(function(n){return n.complexAbs(r)},{$x:r});return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.abs(r);return e([r]),t},{x:r},function(n,r){var e=r[0];return{x:function(){return n.mul(e.toFloat().step(-1))}}},"Abs")}function clipByValue_(n,r,e){var t=tensor_util_env_1.convertToTensor(n,"x","clipByValue");util.assert(r<=e,function(){return"Error in clip: min ("+r+") must be less than or equal to max ("+e+")."});var o=[t],u={min:r,max:e};return engine_1.ENGINE.runKernelFunc(function(n,o){var u=n.clip(t,r,e);return o([t]),u},{x:t},function(n,t){var o=t[0];return{x:function(){return n.where(o.greaterEqual(r).logicalAnd(o.lessEqual(e)),tensor_ops_1.zerosLike(n))}}},"ClipByValue",u,o)}function sigmoid_(n){var r=tensor_util_env_1.convertToTensor(n,"x","sigmoid");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.sigmoid(r);return e([t]),t},{x:r},function(n,r){var e=r[0];return{x:function(){return n.mul(e.mul(tensor_ops_1.scalar(1).sub(e)))}}},"Sigmoid")}function logSigmoid_(n){var r=tensor_util_env_1.convertToTensor(n,"x","logSigmoid");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.softplus(r.neg()).neg();return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.mul(e.neg().sigmoid())}}})}function softplus_(n){var r=tensor_util_env_1.convertToTensor(n,"x","softplus");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.softplus(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.mul(e.sigmoid())}}})}function sin_(n){var r=tensor_util_env_1.convertToTensor(n,"x","sin"),e=[r];return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.sin(r);return e([r]),t},{x:r},function(n,r){var e=r[0];return{x:function(){return e.toFloat().cos().mul(n)}}},"Sin",{},e)}function cos_(n){var r=tensor_util_env_1.convertToTensor(n,"x","cos"),e=[r];return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.cos(r);return e([r]),t},{x:r},function(n,r){var e=r[0];return{x:function(){return e.toFloat().sin().neg().mul(n)}}},"Cos",{},e)}function tan_(n){var r=tensor_util_env_1.convertToTensor(n,"x","tan");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.tan(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.div(e.cos().square())}}})}function asin_(n){var r=tensor_util_env_1.convertToTensor(n,"x","asin");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.asin(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.divStrict(tensor_ops_1.scalar(1).sub(e.toFloat().square()).sqrt())}}})}function acos_(n){var r=tensor_util_env_1.convertToTensor(n,"x","acos");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.acos(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.divStrict(tensor_ops_1.scalar(1).sub(e.toFloat().square()).sqrt()).neg()}}})}function atan_(n){var r=tensor_util_env_1.convertToTensor(n,"x","atan");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.atan(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.div(e.toFloat().square().add(1))}}})}function sinh_(n){var r=tensor_util_env_1.convertToTensor(n,"x","sinh");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.sinh(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return e.toFloat().cosh().mulStrict(n)}}})}function cosh_(n){var r=tensor_util_env_1.convertToTensor(n,"x","cosh");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.cosh(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return e.toFloat().sinh().mulStrict(n)}}})}function tanh_(n){var r=tensor_util_env_1.convertToTensor(n,"x","tanh");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.tanh(r);return e([t]),t},{x:r},function(n,r){var e=r[0];return{x:function(){return tensor_ops_1.scalar(1).sub(e.square()).mulStrict(n)}}},"Tanh",{},null,[!0])}function asinh_(n){var r=tensor_util_env_1.convertToTensor(n,"x","asinh");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.asinh(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.divStrict(tensor_ops_1.scalar(1).add(e.toFloat().square()).sqrt())}}})}function acosh_(n){var r=tensor_util_env_1.convertToTensor(n,"x","acosh");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.acosh(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.divStrict(e.toFloat().square().sub(1).sqrt())}}})}function atanh_(n){var r=tensor_util_env_1.convertToTensor(n,"x","atanh");return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.atanh(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.div(tensor_ops_1.scalar(1).sub(e.toFloat().square()))}}})}function erf_(n){var r=tensor_util_env_1.convertToTensor(n,"x","erf");util.assert("int32"===r.dtype||"float32"===r.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===r.dtype&&(r=r.toFloat());return engine_1.ENGINE.runKernelFunc(function(n,e){var t=n.erf(r);return e([r]),t},{$x:r},function(n,r){var e=r[0];return{$x:function(){return n.mul(e.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}function step_(n,r){void 0===r&&(r=0);var e=tensor_util_env_1.convertToTensor(n,"x","step");return engine_1.ENGINE.runKernelFunc(function(n){return n.step(e,r)},{$x:e},function(n){return{$x:function(){return tensor_ops_1.zerosLike(n)}}})}exports.abs=operation_1.op({abs_:abs_}),exports.acos=operation_1.op({acos_:acos_}),exports.acosh=operation_1.op({acosh_:acosh_}),exports.asin=operation_1.op({asin_:asin_}),exports.asinh=operation_1.op({asinh_:asinh_}),exports.atan=operation_1.op({atan_:atan_}),exports.atanh=operation_1.op({atanh_:atanh_}),exports.ceil=operation_1.op({ceil_:ceil_}),exports.clipByValue=operation_1.op({clipByValue_:clipByValue_}),exports.cos=operation_1.op({cos_:cos_}),exports.cosh=operation_1.op({cosh_:cosh_}),exports.erf=operation_1.op({erf_:erf_}),exports.exp=operation_1.op({exp_:exp_}),exports.expm1=operation_1.op({expm1_:expm1_}),exports.floor=operation_1.op({floor_:floor_}),exports.log=operation_1.op({log_:log_}),exports.log1p=operation_1.op({log1p_:log1p_}),exports.logSigmoid=operation_1.op({logSigmoid_:logSigmoid_}),exports.neg=operation_1.op({neg_:neg_}),exports.reciprocal=operation_1.op({reciprocal_:reciprocal_}),exports.round=operation_1.op({round_:round_}),exports.rsqrt=operation_1.op({rsqrt_:rsqrt_}),exports.sigmoid=operation_1.op({sigmoid_:sigmoid_}),exports.sign=operation_1.op({sign_:sign_}),exports.isNaN=operation_1.op({isNaN_:isNaN_}),exports.isInf=operation_1.op({isInf_:isInf_}),exports.isFinite=operation_1.op({isFinite_:isFinite_}),exports.sin=operation_1.op({sin_:sin_}),exports.sinh=operation_1.op({sinh_:sinh_}),exports.softplus=operation_1.op({softplus_:softplus_}),exports.sqrt=operation_1.op({sqrt_:sqrt_}),exports.step=operation_1.op({step_:step_}),exports.tan=operation_1.op({tan_:tan_}),exports.tanh=operation_1.op({tanh_:tanh_});

},{"../engine":163,"../tensor_util_env":290,"../util":294,"./operation":232,"./tensor_ops":259}],265:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),__awaiter=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))(function(n,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(o,s)}u((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),AdadeltaOptimizer=function(e){function t(t,r,a){void 0===a&&(a=null);var n=e.call(this)||this;return n.learningRate=t,n.rho=r,n.epsilon=a,n.accumulatedGrads=[],n.accumulatedUpdates=[],null==a&&(n.epsilon=engine_1.ENGINE.backend.epsilon()),n}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(r,a){var n=engine_1.ENGINE.registeredVariables[r];null==t.accumulatedGrads[a]&&(t.accumulatedGrads[a]={originalName:r+"/accum_grad",variable:globals_1.tidy(function(){return ops_1.zerosLike(n).variable(!1)})}),null==t.accumulatedUpdates[a]&&(t.accumulatedUpdates[a]={originalName:r+"/accum_var",variable:globals_1.tidy(function(){return ops_1.zerosLike(n).variable(!1)})});var i=Array.isArray(e)?e[a].tensor:e[r];if(null!=i){var o=t.accumulatedGrads[a].variable,s=t.accumulatedUpdates[a].variable;globals_1.tidy(function(){var e=o.mul(t.rho).add(i.square().mul(1-t.rho)),r=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(i),a=s.mul(t.rho).add(r.square().mul(1-t.rho));o.assign(e),s.assign(a);var u=r.mul(-t.learningRate).add(n);n.assign(u)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(globals_1.dispose(this.accumulatedGrads.map(function(e){return e.variable})),globals_1.dispose(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(e)];case 1:return e=a.sent(),t=e.length/2,r=!1,this.accumulatedGrads=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(r)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(r)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(optimizer_1.Optimizer);exports.AdadeltaOptimizer=AdadeltaOptimizer,serialization_1.registerClass(AdadeltaOptimizer);

},{"../engine":163,"../globals":166,"../ops/ops":233,"../serialization":285,"./optimizer":270}],266:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(a,i){function o(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){t.done?a(t.value):new r(function(e){e(t.value)}).then(o,u)}s((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,n,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),AdagradOptimizer=function(t){function e(e,r){void 0===r&&(r=.1);var n=t.call(this)||this;return n.learningRate=e,n.initialAccumulatorValue=r,n.accumulatedGrads=[],n}return __extends(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(r,n){var a=engine_1.ENGINE.registeredVariables[r];if(null==e.accumulatedGrads[n]){e.accumulatedGrads[n]={originalName:r+"/accumulator",variable:globals_1.tidy(function(){return ops_1.fill(a.shape,e.initialAccumulatorValue).variable(!1)})}}var i=Array.isArray(t)?t[n].tensor:t[r];if(null!=i){var o=e.accumulatedGrads[n].variable;globals_1.tidy(function(){var t=o.add(i.square());o.assign(t);var r=i.div(t.add(engine_1.ENGINE.backend.epsilon()).sqrt()).mul(-e.learningRate).add(a);a.assign(r)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&globals_1.dispose(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),e=!1,this.accumulatedGrads=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(e)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="Adagrad",e}(optimizer_1.Optimizer);exports.AdagradOptimizer=AdagradOptimizer,serialization_1.registerClass(AdagradOptimizer);

},{"../engine":163,"../globals":166,"../ops/ops":233,"../serialization":285,"./optimizer":270}],267:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function o(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new a(function(t){t(e.value)}).then(o,s)}c((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var a,n,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),AdamOptimizer=function(e){function t(t,a,n,i){void 0===i&&(i=null);var r=e.call(this)||this;return r.learningRate=t,r.beta1=a,r.beta2=n,r.epsilon=i,r.accumulatedFirstMoment=[],r.accumulatedSecondMoment=[],globals_1.tidy(function(){r.accBeta1=ops_1.scalar(a).variable(),r.accBeta2=ops_1.scalar(n).variable()}),null==i&&(r.epsilon=engine_1.ENGINE.backend.epsilon()),r}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this,a=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);globals_1.tidy(function(){var n=ops_1.sub(1,t.accBeta1),i=ops_1.sub(1,t.accBeta2);a.forEach(function(a,r){var o=engine_1.ENGINE.registeredVariables[a];null==t.accumulatedFirstMoment[r]&&(t.accumulatedFirstMoment[r]={originalName:a+"/m",variable:globals_1.tidy(function(){return ops_1.zerosLike(o).variable(!1)})}),null==t.accumulatedSecondMoment[r]&&(t.accumulatedSecondMoment[r]={originalName:a+"/v",variable:globals_1.tidy(function(){return ops_1.zerosLike(o).variable(!1)})});var s=Array.isArray(e)?e[r].tensor:e[a];if(null!=s){var c=t.accumulatedFirstMoment[r].variable,u=t.accumulatedSecondMoment[r].variable,l=c.mul(t.beta1).add(s.mul(1-t.beta1)),p=u.mul(t.beta2).add(s.square().mul(1-t.beta2)),m=l.div(n),d=p.div(i);c.assign(l),u.assign(p);var b=m.div(d.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(b)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&globals_1.dispose(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&globals_1.dispose(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){var t,a,n=this;return __generator(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),globals_1.tidy(function(){n.accBeta1.assign(ops_1.pow(n.beta1,n.iterations_+1)),n.accBeta2.assign(ops_1.pow(n.beta2,n.iterations_+1))}),t=e.length/2,a=!1,this.accumulatedFirstMoment=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(a)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(a)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(optimizer_1.Optimizer);exports.AdamOptimizer=AdamOptimizer,serialization_1.registerClass(AdamOptimizer);

},{"../engine":163,"../globals":166,"../ops/ops":233,"../serialization":285,"./optimizer":270}],268:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),__awaiter=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))(function(n,r){function o(e){try{u(a.next(e))}catch(e){r(e)}}function s(e){try{u(a.throw(e))}catch(e){r(e)}}function u(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(o,s)}u((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var i,a,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,a&&(n=2&r[0]?a.return:r[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,r[1])).done)return n;switch(a=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],a=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),AdamaxOptimizer=function(e){function t(t,i,a,n,r){void 0===n&&(n=null),void 0===r&&(r=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=i,o.beta2=a,o.epsilon=n,o.decay=r,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],globals_1.tidy(function(){o.iteration=ops_1.scalar(0).variable(),o.accBeta1=ops_1.scalar(i).variable()}),null==n&&(o.epsilon=engine_1.ENGINE.backend.epsilon()),o}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this,i=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);globals_1.tidy(function(){var a=ops_1.sub(1,t.accBeta1),n=ops_1.div(-t.learningRate,t.iteration.mul(t.decay).add(1));i.forEach(function(i,r){var o=engine_1.ENGINE.registeredVariables[i];null==t.accumulatedFirstMoment[r]&&(t.accumulatedFirstMoment[r]={originalName:i+"/m",variable:ops_1.zerosLike(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[r]&&(t.accumulatedWeightedInfNorm[r]={originalName:i+"/v",variable:ops_1.zerosLike(o).variable(!1)});var s=Array.isArray(e)?e[r].tensor:e[i];if(null!=s){var u=t.accumulatedFirstMoment[r].variable,l=t.accumulatedWeightedInfNorm[r].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),p=l.mul(t.beta2),d=s.abs(),f=p.maximum(d);u.assign(c),l.assign(f);var m=n.div(a).mul(c.div(f.add(t.epsilon))).add(o);o.assign(m)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&globals_1.dispose(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&globals_1.dispose(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(optimizer_1.Optimizer);exports.AdamaxOptimizer=AdamaxOptimizer,serialization_1.registerClass(AdamaxOptimizer);

},{"../engine":163,"../globals":166,"../ops/ops":233,"../serialization":285,"./optimizer":270}],269:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),sgd_optimizer_1=require("./sgd_optimizer"),MomentumOptimizer=function(t){function e(e,n,r){void 0===r&&(r=!1);var i=t.call(this,e)||this;return i.learningRate=e,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=ops_1.scalar(i.momentum),i}return __extends(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=engine_1.ENGINE.registeredVariables[n];if(null==e.accumulations[r]){e.accumulations[r]={originalName:n+"/momentum",variable:globals_1.tidy(function(){return ops_1.zerosLike(i).variable(!1)})}}var o=e.accumulations[r].variable,a=Array.isArray(t)?t[r].tensor:t[n];null!=a&&globals_1.tidy(function(){var t,n=e.m.mul(o).add(a);t=e.useNesterov?e.c.mul(a.add(n.mul(e.m))).add(i):e.c.mul(n).add(i),o.assign(n),i.assign(t)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&globals_1.dispose(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=!1,this.accumulations=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(e)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="Momentum",e}(sgd_optimizer_1.SGDOptimizer);exports.MomentumOptimizer=MomentumOptimizer,serialization_1.registerClass(MomentumOptimizer);

},{"../engine":163,"../globals":166,"../ops/ops":233,"../serialization":285,"./sgd_optimizer":273}],270:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../globals"),gradients_1=require("../gradients"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),Optimizer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),i=r.value,o=r.grads;if(null!=n){var s=n.map(function(t){return{name:t.name,tensor:o[t.name]}});this.applyGradients(s)}else this.applyGradients(o);return globals_1.dispose(o),e?i:(i.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,e){return gradients_1.variableGrads(t,e)},e.prototype.dispose=function(){null!=this.iterations_&&globals_1.dispose(this.iterations_)},e.prototype.saveIterations=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:ops_1.scalar(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=n.sent()[0],[2,t.slice(1)]}})})},e}(serialization_1.Serializable);exports.Optimizer=Optimizer,Object.defineProperty(Optimizer,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});

},{"../globals":166,"../gradients":167,"../ops/ops":233,"../serialization":285}],271:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var adadelta_optimizer_1=require("./adadelta_optimizer"),adagrad_optimizer_1=require("./adagrad_optimizer"),adam_optimizer_1=require("./adam_optimizer"),adamax_optimizer_1=require("./adamax_optimizer"),momentum_optimizer_1=require("./momentum_optimizer"),rmsprop_optimizer_1=require("./rmsprop_optimizer"),sgd_optimizer_1=require("./sgd_optimizer"),OptimizerConstructors=function(){function i(){}return i.sgd=function(i){return new sgd_optimizer_1.SGDOptimizer(i)},i.momentum=function(i,r,e){return void 0===e&&(e=!1),new momentum_optimizer_1.MomentumOptimizer(i,r,e)},i.rmsprop=function(i,r,e,t,o){return void 0===r&&(r=.9),void 0===e&&(e=0),void 0===t&&(t=null),void 0===o&&(o=!1),new rmsprop_optimizer_1.RMSPropOptimizer(i,r,e,t,o)},i.adam=function(i,r,e,t){return void 0===i&&(i=.001),void 0===r&&(r=.9),void 0===e&&(e=.999),void 0===t&&(t=null),new adam_optimizer_1.AdamOptimizer(i,r,e,t)},i.adadelta=function(i,r,e){return void 0===i&&(i=.001),void 0===r&&(r=.95),void 0===e&&(e=null),new adadelta_optimizer_1.AdadeltaOptimizer(i,r,e)},i.adamax=function(i,r,e,t,o){return void 0===i&&(i=.002),void 0===r&&(r=.9),void 0===e&&(e=.999),void 0===t&&(t=null),void 0===o&&(o=0),new adamax_optimizer_1.AdamaxOptimizer(i,r,e,t,o)},i.adagrad=function(i,r){return void 0===r&&(r=.1),new adagrad_optimizer_1.AdagradOptimizer(i,r)},i}();exports.OptimizerConstructors=OptimizerConstructors;

},{"./adadelta_optimizer":265,"./adagrad_optimizer":266,"./adam_optimizer":267,"./adamax_optimizer":268,"./momentum_optimizer":269,"./rmsprop_optimizer":272,"./sgd_optimizer":273}],272:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):new a(function(t){t(e.value)}).then(o,u)}s((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var a,n,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),RMSPropOptimizer=function(e){function t(t,a,n,r,i){void 0===a&&(a=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1);var o=e.call(this)||this;if(o.learningRate=t,o.decay=a,o.momentum=n,o.epsilon=r,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=i,null==r&&(o.epsilon=engine_1.ENGINE.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return o}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(a,n){var r=engine_1.ENGINE.registeredVariables[a];null==t.accumulatedMeanSquares[n]&&(t.accumulatedMeanSquares[n]={originalName:a+"/rms",variable:globals_1.tidy(function(){return ops_1.zerosLike(r).variable(!1)})}),null==t.accumulatedMoments[n]&&(t.accumulatedMoments[n]={originalName:a+"/momentum",variable:globals_1.tidy(function(){return ops_1.zerosLike(r).variable(!1)})}),null==t.accumulatedMeanGrads[n]&&t.centered&&(t.accumulatedMeanGrads[n]={originalName:a+"/mg",variable:globals_1.tidy(function(){return ops_1.zerosLike(r).variable(!1)})});var i=Array.isArray(e)?e[n].tensor:e[a];if(null!=i){var o=t.accumulatedMeanSquares[n].variable,u=t.accumulatedMoments[n].variable;globals_1.tidy(function(){var e=o.mul(t.decay).add(i.square().mul(1-t.decay));if(t.centered){var a=t.accumulatedMeanGrads[n].variable,s=a.mul(t.decay).add(i.mul(1-t.decay)),l=u.mul(t.momentum).add(i.mul(t.learningRate).div(e.sub(s.square().add(t.epsilon)).sqrt()));o.assign(e),a.assign(s),u.assign(l);var c=r.sub(l);r.assign(c)}else{var d=o.mul(t.decay).add(i.square().mul(1-t.decay));l=u.mul(t.momentum).add(i.mul(t.learningRate).div(d.add(t.epsilon).sqrt()));o.assign(d),u.assign(l);c=r.sub(l);r.assign(c)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&globals_1.dispose(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&globals_1.dispose(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&globals_1.dispose(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){var t,a;return __generator(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,a=!1,this.accumulatedMeanSquares=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(a)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(a)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(optimizer_1.Optimizer);exports.RMSPropOptimizer=RMSPropOptimizer,serialization_1.registerClass(RMSPropOptimizer);

},{"../engine":163,"../globals":166,"../ops/ops":233,"../serialization":285,"./optimizer":270}],273:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}u((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),SGDOptimizer=function(t){function e(e){var r=t.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return __extends(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(r,n){var i=Array.isArray(t)?t[n].tensor:t[r];if(null!=i){var o=engine_1.ENGINE.registeredVariables[r];globals_1.tidy(function(){var t=e.c.mul(i).add(o);o.assign(t)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=globals_1.keep(ops_1.scalar(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=e.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGD",e}(optimizer_1.Optimizer);exports.SGDOptimizer=SGDOptimizer,serialization_1.registerClass(SGDOptimizer);

},{"../engine":163,"../globals":166,"../ops/ops":233,"../serialization":285,"./optimizer":270}],274:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),PlatformBrowser=function(){function e(){}return e.prototype.fetch=function(e,r){return fetch(e,r)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,r){if("utf-8"!==r&&"utf8"!==r)throw new Error("Browser's encoder only supports utf-8, but got "+r);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,r){return new TextDecoder(r).decode(e)},e}();exports.PlatformBrowser=PlatformBrowser,environment_1.env().get("IS_BROWSER")&&environment_1.env().setPlatform("browser",new PlatformBrowser);

},{"../environment":164}],275:[function(require,module,exports){
(function (process){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var systemFetch,environment_1=require("../environment");function resetSystemFetch(){systemFetch=null}function setSystemFetch(e){systemFetch=e}function getSystemFetch(){return systemFetch}exports.getNodeFetch={importFetch:function(){return require("node-fetch")}},exports.resetSystemFetch=resetSystemFetch,exports.setSystemFetch=setSystemFetch,exports.getSystemFetch=getSystemFetch;var PlatformNode=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=environment_1.env().global.fetch?environment_1.env().global.fetch(e,t):(null==systemFetch&&(systemFetch=exports.getNodeFetch.importFetch()),systemFetch(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();exports.PlatformNode=PlatformNode,environment_1.env().get("IS_NODE")&&environment_1.env().setPlatform("node",new PlatformNode);

}).call(this,require('_process'))
},{"../environment":164,"_process":321,"node-fetch":298,"util":298}],276:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("./util"),Profiler=function(){function r(r,e){this.backendTimer=r,this.logger=e,null==e&&(this.logger=new Logger)}return r.prototype.profileKernel=function(r,e,o){var t,n=this,i=this.backendTimer.time(function(){t=o()});return t.forEach(function(o){o.data().then(function(t){checkComputationForErrors(t,o.dtype,r),i.then(function(i){var l="";null!=i.getExtraProfileInfo&&(l=i.getExtraProfileInfo()),n.logger.logKernelProfile(r,o,t,i.kernelMs,e,l)})})}),t},r}();function checkComputationForErrors(r,e,o){if("float32"!==e)return!1;for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))return console.warn("Found "+n+" in the result of '"+o+"'"),!0}return!1}exports.Profiler=Profiler,exports.checkComputationForErrors=checkComputationForErrors;var Logger=function(){function r(){}return r.prototype.logKernelProfile=function(r,e,o,t,n,i){var l="number"==typeof t?util.rightPad(t+"ms",9):t.error,c=util.rightPad(r,25),u=e.rank,a=e.size,f=util.rightPad(e.shape.toString(),14),g="";for(var s in n){var h=n[s].shape||e.shape,p=h.length;g+=s+": "+p+"D "+(p>0?h:"")+" "}console.log("%c"+c+"\t%c"+l+"\t%c"+u+"D "+f+"\t%c"+a+"\t%c"+g+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();exports.Logger=Logger;

},{"./util":294}],277:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_to_1=require("../../ops/broadcast_to"),tensor_1=require("../../tensor");tensor_1.Tensor.prototype.broadcastTo=function(o){return broadcast_to_1.broadcastTo(this,o)};

},{"../../ops/broadcast_to":198,"../../tensor":287}],278:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var div_1=require("../../ops/div"),tensor_1=require("../../tensor");tensor_1.Tensor.prototype.div=function(e){return div_1.div(this,e)};

},{"../../ops/div":210,"../../tensor":287}],279:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var div_no_nan_1=require("../../ops/div_no_nan"),tensor_1=require("../../tensor");tensor_1.Tensor.prototype.divNoNan=function(e){return div_no_nan_1.divNoNan(this,e)};

},{"../../ops/div_no_nan":211,"../../tensor":287}],280:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var one_hot_1=require("../../ops/one_hot"),tensor_1=require("../../tensor");tensor_1.Tensor.prototype.oneHot=function(e,o,t){return void 0===o&&(o=1),void 0===t&&(t=0),one_hot_1.oneHot(this,e,o,t)};

},{"../../ops/one_hot":231,"../../tensor":287}],281:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("./broadcast_to"),require("./div"),require("./div_no_nan"),require("./squared_difference"),require("./tile"),require("./one_hot");

},{"./broadcast_to":277,"./div":278,"./div_no_nan":279,"./one_hot":280,"./squared_difference":282,"./tile":283}],282:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var squared_difference_1=require("../../ops/squared_difference"),tensor_1=require("../../tensor");tensor_1.Tensor.prototype.squaredDifference=function(e){return squared_difference_1.squaredDifference(this,e)};

},{"../../ops/squared_difference":257,"../../tensor":287}],283:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tile_1=require("../../ops/tile"),tensor_1=require("../../tensor");tensor_1.Tensor.prototype.tile=function(e){return tile_1.tile(this,e)};

},{"../../ops/tile":260,"../../tensor":287}],284:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});for(var BroadcastTo_grad_1=require("./gradients/BroadcastTo_grad"),Div_grad_1=require("./gradients/Div_grad"),Identity_grad_1=require("./gradients/Identity_grad"),OneHot_grad_1=require("./gradients/OneHot_grad"),Square_grad_1=require("./gradients/Square_grad"),SquaredDifference_grad_1=require("./gradients/SquaredDifference_grad"),Tile_grad_1=require("./gradients/Tile_grad"),kernel_registry_1=require("./kernel_registry"),gradConfigs=[Div_grad_1.divGradConfig,Square_grad_1.squareGradConfig,SquaredDifference_grad_1.squaredDifferenceGradConfig,BroadcastTo_grad_1.broadcastToGradConfig,Identity_grad_1.identityGradConfig,Tile_grad_1.tileGradConfig,OneHot_grad_1.oneHotGradConfig],_i=0,gradConfigs_1=gradConfigs;_i<gradConfigs_1.length;_i++){var gradientConfig=gradConfigs_1[_i];kernel_registry_1.registerGradient(gradientConfig)}

},{"./gradients/BroadcastTo_grad":168,"./gradients/Div_grad":169,"./gradients/Identity_grad":170,"./gradients/OneHot_grad":171,"./gradients/Square_grad":172,"./gradients/SquaredDifference_grad":173,"./gradients/Tile_grad":174,"./kernel_registry":189}],285:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("./util"),Serializable=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}();exports.Serializable=Serializable;var SerializationMap=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function registerClass(e){util_1.assert(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),util_1.assert("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),util_1.assert(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),SerializationMap.register(e)}exports.SerializationMap=SerializationMap,exports.registerClass=registerClass;

},{"./util":294}],286:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("./util");function getFilteredNodesXToY(r,t,e){for(var n={},i={},a=0;a<t.length;a++)n[t[a].id]=!0;for(a=0;a<r.length;a++){var o=(v=r[a]).inputs;for(var u in o){for(var s=o[u],d=!1,p=0;p<t.length;p++)if(n[s.id]){v.outputs.forEach(function(r){return n[r.id]=!0}),d=!0,i[v.id]=!0;break}if(d)break}}var f={};f[e.id]=!0;var h={};for(a=r.length-1;a>=0;a--)for(o=(v=r[a]).inputs,p=0;p<v.outputs.length;p++)if(f[v.outputs[p].id]){for(var u in o)f[o[u].id]=!0,h[v.id]=!0;break}var l=[];for(a=0;a<r.length;a++){var v;if(i[(v=r[a]).id]&&h[v.id]){var g={};for(var u in v.inputs){var c=v.inputs[u];n[c.id]&&(g[u]=c)}var b=Object.assign({},v);b.inputs=g,b.outputs=v.outputs,l.push(b)}}return l}function backpropagateGradients(r,t,e){for(var n=function(n){var i=t[n],a=[];if(i.outputs.forEach(function(t){var e=r[t.id];null!=e?a.push(e):a.push(null)}),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.kernelName+".");var o=i.gradient(a),u=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var n=e(function(){return o[t]()});if("float32"!==n.dtype)throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+n.dtype+"'");var a=i.inputs[t];if(!util.arraysEqual(n.shape,a.shape))throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input '"+t+"' has shape '"+n.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==r[a.id])r[a.id]=n;else{var u=r[a.id];r[a.id]=u.add(n),u.dispose()}};for(var s in i.inputs)u(s)},i=t.length-1;i>=0;i--)n(i)}exports.getFilteredNodesXToY=getFilteredNodesXToY,exports.backpropagateGradients=backpropagateGradients;

},{"./util":294}],287:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=function(o,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var r in o)o.hasOwnProperty(r)&&(t[r]=o[r])})(o,r)};return function(o,r){function e(){this.constructor=o}t(o,r),o.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}}(),__awaiter=this&&this.__awaiter||function(t,o,r,e){return new(r||(r=Promise))(function(i,n){function s(t){try{h(e.next(t))}catch(t){n(t)}}function p(t){try{h(e.throw(t))}catch(t){n(t)}}function h(t){t.done?i(t.value):new r(function(o){o(t.value)}).then(s,p)}h((e=e.apply(t,o||[])).next())})},__generator=this&&this.__generator||function(t,o){var r,e,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:p(0),throw:p(1),return:p(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function p(n){return function(p){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,e&&(i=2&n[0]?e.return:n[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,n[1])).done)return i;switch(e=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,e=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=o.call(t,s)}catch(t){n=[6,t],e=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,p])}}};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_format_1=require("./tensor_format"),util=require("./util"),util_1=require("./util"),TensorBuffer=function(){function t(t,o,r){var e=this;if(this.dtype=o,this.shape=t.slice(),this.size=util.sizeFromShape(t),null!=r){var i=r.length;util.assert(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+e.size+"'."})}if("complex64"===o)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||util.getArrayFromDType(o,this.size),this.strides=util_1.computeStrides(t)}return t.prototype.set=function(t){for(var o=this,r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];0===r.length&&(r=[0]),util.assert(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+o.rank+")"});var i=this.locToIndex(r);this.values[i]=t},t.prototype.get=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];0===t.length&&(t=[0]);for(var r=0,e=0,i=t;e<i.length;e++){var n=i[e];if(n<0||n>=this.shape[r]){var s="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var p=t[t.length-1],h=0;h<t.length-1;++h)p+=this.strides[h]*t[h];return this.values[p]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var o=t[t.length-1],r=0;r<t.length-1;++r)o+=this.strides[r]*t[r];return o},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var o=new Array(this.shape.length),r=0;r<o.length-1;++r)o[r]=Math.floor(t/this.strides[r]),t-=o[r]*this.strides[r];return o[o.length-1]=t,o},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return trackerFn().makeTensor(this.values,this.shape,this.dtype)},t}();exports.TensorBuffer=TensorBuffer;var trackerFn=null,opHandler=null,deprecationWarningFn=null;function setTensorTracker(t){trackerFn=t}function setOpHandler(t){opHandler=t}function setDeprecationWarningFn(t){deprecationWarningFn=t}exports.setTensorTracker=setTensorTracker,exports.setOpHandler=setOpHandler,exports.setDeprecationWarningFn=setDeprecationWarningFn;var Tensor=function(){function t(t,o,r,e){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=o||"float32",this.size=util.sizeFromShape(t),this.strides=util_1.computeStrides(t),this.dataId=r,this.id=e,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),util.assert(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,o){return this.throwIfDisposed(),this.reshape([t,o])},t.prototype.as3D=function(t,o,r){return this.throwIfDisposed(),this.reshape([t,o,r])},t.prototype.as4D=function(t,o,r,e){return this.throwIfDisposed(),this.reshape([t,o,r,e])},t.prototype.as5D=function(t,o,r,e,i){return this.throwIfDisposed(),this.reshape([t,o,r,e,i])},t.prototype.asType=function(t){return this.throwIfDisposed(),opHandler.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(o){switch(o.label){case 0:return[4,this.data()];case 1:return t=o.sent(),[2,opHandler.buffer(this.shape,this.dtype,t)]}})})},t.prototype.bufferSync=function(){return opHandler.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(o){switch(o.label){case 0:return[4,this.data()];case 1:return t=o.sent(),[2,util_1.toNestedArray(this.shape,t)]}})})},t.prototype.arraySync=function(){return util_1.toNestedArray(this.shape,this.dataSync())},t.prototype.data=function(){return __awaiter(this,void 0,void 0,function(){var t,o;return __generator(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=trackerFn().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:o=r.sent();try{return[2,o.map(function(t){return util.decodeString(t)})]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var t=trackerFn().readSync(this.dataId);if("string"===this.dtype)try{return t.map(function(t){return util.decodeString(t)})}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(o){switch(o.label){case 0:return this.throwIfDisposed(),[4,trackerFn().read(this.dataId)];case 1:return t=o.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(trackerFn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),opHandler.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),opHandler.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),opHandler.expandDims(this,t)},t.prototype.cumsum=function(t,o,r){return void 0===t&&(t=0),void 0===o&&(o=!1),void 0===r&&(r=!1),opHandler.cumsum(this,t,o,r)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),opHandler.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),opHandler.clone(this)},t.prototype.toString=function(t){void 0===t&&(t=!1);var o=this.dataSync();return tensor_format_1.tensorToString(o,this.shape,this.dtype,t)},t.prototype.gather=function(t,o){return void 0===o&&(o=0),this.throwIfDisposed(),opHandler.gather(this,t,o)},t.prototype.matMul=function(t,o,r){return void 0===o&&(o=!1),void 0===r&&(r=!1),this.throwIfDisposed(),opHandler.matMul(this,t,o,r)},t.prototype.dot=function(t){return this.throwIfDisposed(),opHandler.dot(this,t)},t.prototype.norm=function(t,o,r){return void 0===t&&(t="euclidean"),void 0===o&&(o=null),void 0===r&&(r=!1),this.throwIfDisposed(),opHandler.norm(this,t,o,r)},t.prototype.slice=function(t,o){return this.throwIfDisposed(),opHandler.slice(this,t,o)},t.prototype.reverse=function(t){return this.throwIfDisposed(),opHandler.reverse(this,t)},t.prototype.concat=function(o,r){return void 0===r&&(r=0),this.throwIfDisposed(),o instanceof t&&(o=[o]),opHandler.concat([this].concat(o),r)},t.prototype.split=function(t,o){return void 0===o&&(o=0),this.throwIfDisposed(),opHandler.split(this,t,o)},t.prototype.stack=function(t,o){return void 0===o&&(o=0),opHandler.stack([this,t],o)},t.prototype.unstack=function(t){return void 0===t&&(t=0),opHandler.unstack(this,t)},t.prototype.pad=function(t,o){return void 0===o&&(o=0),opHandler.pad(this,t,o)},t.prototype.batchNormalization=function(t,o,r,e,i){return void 0===r&&(r=.001),deprecationWarningFn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,o,i,e,r)},t.prototype.batchNorm=function(t,o,r,e,i){return void 0===i&&(i=.001),this.throwIfDisposed(),opHandler.batchNorm(this,t,o,r,e,i)},t.prototype.all=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),opHandler.all(this,t,o)},t.prototype.any=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),opHandler.any(this,t,o)},t.prototype.logSumExp=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),opHandler.logSumExp(this,t,o)},t.prototype.sum=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),opHandler.sum(this,t,o)},t.prototype.prod=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),opHandler.prod(this,t,o)},t.prototype.mean=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),opHandler.mean(this,t,o)},t.prototype.min=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),opHandler.min(this,t,o)},t.prototype.max=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),opHandler.max(this,t,o)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),opHandler.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),opHandler.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),opHandler.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),opHandler.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),opHandler.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),opHandler.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),opHandler.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),opHandler.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),opHandler.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),opHandler.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),opHandler.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),opHandler.mulStrict(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),opHandler.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),opHandler.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),opHandler.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),opHandler.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),opHandler.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),opHandler.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),opHandler.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),opHandler.modStrict(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),opHandler.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),opHandler.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),opHandler.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),opHandler.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),opHandler.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),opHandler.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),opHandler.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),opHandler.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),opHandler.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),opHandler.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),opHandler.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),opHandler.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),opHandler.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),opHandler.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),opHandler.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),opHandler.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),opHandler.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),opHandler.logicalXor(this,t)},t.prototype.where=function(t,o){return this.throwIfDisposed(),opHandler.where(t,this,o)},t.prototype.neg=function(){return this.throwIfDisposed(),opHandler.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),opHandler.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),opHandler.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),opHandler.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),opHandler.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),opHandler.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),opHandler.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),opHandler.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),opHandler.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),opHandler.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),opHandler.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),opHandler.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),opHandler.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),opHandler.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),opHandler.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),opHandler.abs(this)},t.prototype.clipByValue=function(t,o){return this.throwIfDisposed(),opHandler.clipByValue(this,t,o)},t.prototype.relu=function(){return this.throwIfDisposed(),opHandler.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),opHandler.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),opHandler.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),opHandler.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),opHandler.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),opHandler.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),opHandler.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),opHandler.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),opHandler.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),opHandler.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),opHandler.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),opHandler.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),opHandler.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),opHandler.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),opHandler.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),opHandler.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),opHandler.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),opHandler.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),opHandler.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),opHandler.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),opHandler.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),opHandler.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),opHandler.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),opHandler.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),opHandler.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),opHandler.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),opHandler.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),opHandler.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,o){return void 0===o&&(o=!1),this.throwIfDisposed(),opHandler.image.resizeBilinear(this,t,o)},t.prototype.resizeNearestNeighbor=function(t,o){return void 0===o&&(o=!1),this.throwIfDisposed(),opHandler.image.resizeNearestNeighbor(this,t,o)},t.prototype.conv1d=function(t,o,r,e,i,n){return void 0===e&&(e="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),opHandler.conv1d(this,t,o,r,e,i,n)},t.prototype.conv2d=function(t,o,r,e,i,n){return void 0===e&&(e="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),opHandler.conv2d(this,t,o,r,e,i,n)},t.prototype.conv2dTranspose=function(t,o,r,e,i){return this.throwIfDisposed(),opHandler.conv2dTranspose(this,t,o,r,e,i)},t.prototype.depthwiseConv2D=function(t,o,r,e,i,n){return void 0===e&&(e="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),opHandler.depthwiseConv2d(this,t,o,r,e,i,n)},t.prototype.separableConv2d=function(t,o,r,e,i,n){return void 0===i&&(i=[1,1]),void 0===n&&(n="NHWC"),this.throwIfDisposed(),opHandler.separableConv2d(this,t,o,r,e,i,n)},t.prototype.avgPool=function(t,o,r,e){return this.throwIfDisposed(),opHandler.avgPool(this,t,o,r,e)},t.prototype.maxPool=function(t,o,r,e){return this.throwIfDisposed(),opHandler.maxPool(this,t,o,r,e)},t.prototype.localResponseNormalization=function(t,o,r,e){return void 0===t&&(t=5),void 0===o&&(o=1),void 0===r&&(r=1),void 0===e&&(e=.5),opHandler.localResponseNormalization(this,t,o,r,e)},t.prototype.pool=function(t,o,r,e,i){return this.throwIfDisposed(),opHandler.pool(this,t,o,r,e,i)},t.prototype.variable=function(t,o,r){return void 0===t&&(t=!0),this.throwIfDisposed(),trackerFn().makeVariable(this,t,o,r)},t.prototype.unsortedSegmentSum=function(t,o){return this.throwIfDisposed(),opHandler.unsortedSegmentSum(this,t,o)},t.prototype.batchToSpaceND=function(t,o){return this.throwIfDisposed(),opHandler.batchToSpaceND(this,t,o)},t.prototype.spaceToBatchND=function(t,o){return this.throwIfDisposed(),opHandler.spaceToBatchND(this,t,o)},t.prototype.topk=function(t,o){return void 0===t&&(t=1),void 0===o&&(o=!0),this.throwIfDisposed(),opHandler.topk(this,t,o)},t.prototype.stridedSlice=function(t,o,r,e,i,n,s,p){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===p&&(p=0),this.throwIfDisposed(),opHandler.stridedSlice(this,t,o,r,e,i,n,s,p)},t.prototype.depthToSpace=function(t,o){return this.throwIfDisposed(),opHandler.depthToSpace(this,t,o)},t.prototype.fft=function(){return this.throwIfDisposed(),opHandler.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),opHandler.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),opHandler.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),opHandler.spectral.irfft(this)},t}();exports.Tensor=Tensor,Object.defineProperty(Tensor,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var Variable=function(t){function o(o,r,e,i){var n=t.call(this,o.shape,o.dtype,o.dataId,i)||this;return n.trainable=r,n.name=e,n}return __extends(o,t),o.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!util.arraysEqual(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");trackerFn().disposeTensor(this),this.dataId=t.dataId,trackerFn().incRef(this,null)},o.prototype.dispose=function(){trackerFn().disposeVariable(this),this.isDisposedInternal=!0},o}(Tensor);exports.Variable=Variable,Object.defineProperty(Variable,Symbol.hasInstance,{value:function(t){return t instanceof Tensor&&null!=t.assign&&t.assign instanceof Function}});

},{"./tensor_format":288,"./util":294}],288:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("./util"),FORMAT_LIMIT_NUM_VALS=20,FORMAT_NUM_FIRST_LAST_VALS=3,FORMAT_NUM_SIG_DIGITS=7;function tensorToString(r,e,o,t){var n=util_1.computeStrides(e),i=computeMaxSizePerColumn(r,e,o,n),l=e.length,u=subTensorToString(r,e,o,n,i),T=["Tensor"];return t&&(T.push("  dtype: "+o),T.push("  rank: "+l),T.push("  shape: ["+e+"]"),T.push("  values:")),T.push(u.map(function(r){return"    "+r}).join("\n")),T.join("\n")}function computeMaxSizePerColumn(r,e,o,t){var n=util_1.sizeFromShape(e),i=t[t.length-1],l=new Array(i).fill(0),u=e.length,T="complex64"===o?createComplexTuples(r):r;if(u>1)for(var a=0;a<n/i;a++)for(var s=a*i,S=0;S<i;S++)l[S]=Math.max(l[S],valToString(T[s+S],0,o).length);return l}function valToString(r,e,o){var t;return t=Array.isArray(r)?parseFloat(r[0].toFixed(FORMAT_NUM_SIG_DIGITS))+" + "+parseFloat(r[1].toFixed(FORMAT_NUM_SIG_DIGITS))+"j":util_1.isString(r)?"'"+r+"'":"bool"===o?boolNumToString(r):parseFloat(r.toFixed(FORMAT_NUM_SIG_DIGITS)).toString(),util_1.rightPad(t,e)}function boolNumToString(r){return 0===r?"false":"true"}function subTensorToString(r,e,o,t,n,i){void 0===i&&(i=!0);var l="complex64"===o?2:1,u=e[0],T=e.length;if(0===T)return"complex64"===o?[valToString(createComplexTuples(r)[0],0,o)]:"bool"===o?[boolNumToString(r[0])]:[r[0].toString()];if(1===T){if(u>FORMAT_LIMIT_NUM_VALS){var a=FORMAT_NUM_FIRST_LAST_VALS*l,s=Array.from(r.slice(0,a)),S=Array.from(r.slice((u-FORMAT_NUM_FIRST_LAST_VALS)*l,u*l));return"complex64"===o&&(s=createComplexTuples(s),S=createComplexTuples(S)),["["+s.map(function(r,e){return valToString(r,n[e],o)}).join(", ")+", ..., "+S.map(function(r,e){return valToString(r,n[u-FORMAT_NUM_FIRST_LAST_VALS+e],o)}).join(", ")+"]"]}return["["+("complex64"===o?createComplexTuples(r):Array.from(r)).map(function(r,e){return valToString(r,n[e],o)}).join(", ")+"]"]}var _=e.slice(1),p=t.slice(1),A=t[0]*l,c=[];if(u>FORMAT_LIMIT_NUM_VALS){for(var M=0;M<FORMAT_NUM_FIRST_LAST_VALS;M++){var g=(f=M*A)+A;c.push.apply(c,subTensorToString(r.slice(f,g),_,o,p,n,!1))}c.push("...");for(M=u-FORMAT_NUM_FIRST_LAST_VALS;M<u;M++){g=(f=M*A)+A;c.push.apply(c,subTensorToString(r.slice(f,g),_,o,p,n,M===u-1))}}else for(M=0;M<u;M++){var f;g=(f=M*A)+A;c.push.apply(c,subTensorToString(r.slice(f,g),_,o,p,n,M===u-1))}var m=2===T?",":"";c[0]="["+c[0]+m;for(M=1;M<c.length-1;M++)c[M]=" "+c[M]+m;var F=",\n";for(M=2;M<T;M++)F+="\n";return c[c.length-1]=" "+c[c.length-1]+"]"+(i?"":F),c}function createComplexTuples(r){for(var e=[],o=0;o<r.length;o+=2)e.push([r[o],r[o+1]]);return e}exports.tensorToString=tensorToString;

},{"./util":294}],289:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("./tensor"),types_1=require("./types"),util_1=require("./util");function makeTypesMatch(e,t){if(e.dtype===t.dtype)return[e,t];var r=types_1.upcastType(e.dtype,t.dtype);return[e.cast(r),t.cast(r)]}function assertTypesMatch(e,t){util_1.assert(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function isTensorInList(e,t){return t.some(function(t){return t.id===e.id})}function getTensorsInContainer(e){var t=[];return walkTensorContainer(e,t,new Set),t}function walkTensorContainer(e,t,r){if(null!=e)if(e instanceof tensor_1.Tensor)t.push(e);else if(isIterable(e)){var n=e;for(var s in n){var a=n[s];r.has(a)||(r.add(a),walkTensorContainer(a,t,r))}}}function isIterable(e){return Array.isArray(e)||"object"==typeof e}exports.makeTypesMatch=makeTypesMatch,exports.assertTypesMatch=assertTypesMatch,exports.isTensorInList=isTensorInList,exports.getTensorsInContainer=getTensorsInContainer;

},{"./tensor":287,"./types":293,"./util":294}],290:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("./engine"),environment_1=require("./environment"),tensor_1=require("./tensor"),util_1=require("./util");function inferShape(r,e){var n=r;if(util_1.isTypedArray(r))return"string"===e?[]:[r.length];if(!Array.isArray(r))return[];for(var t=[];Array.isArray(n)||util_1.isTypedArray(n)&&"string"!==e;)t.push(n.length),n=n[0];return Array.isArray(r)&&environment_1.env().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&deepAssertShapeConsistency(r,t,[]),t}function deepAssertShapeConsistency(r,e,n){if(n=n||[],Array.isArray(r)||util_1.isTypedArray(r)){util_1.assert(e.length>0,function(){return"Element arr["+n.join("][")+"] should be a primitive, but is an array of "+r.length+" elements"}),util_1.assert(r.length===e[0],function(){return"Element arr["+n.join("][")+"] should have "+e[0]+" elements, but has "+r.length+" elements"});for(var t=e.slice(1),o=0;o<r.length;++o)deepAssertShapeConsistency(r[o],t,n.concat(o))}else util_1.assert(0===e.length,function(){return"Element arr["+n.join("][")+"] is a primitive, but should be an array/TypedArray of "+e[0]+" elements"})}function assertDtype(r,e,n,t){if(null!=r&&("numeric"!==r&&r!==e||"numeric"===r&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+t+"' must be "+r+" tensor, but got "+e+" tensor")}function convertToTensor(r,e,n,t){if(void 0===t&&(t="numeric"),r instanceof tensor_1.Tensor)return assertDtype(t,r.dtype,e,n),r;var o=util_1.inferDtype(r);if("string"!==o&&["bool","int32","float32"].indexOf(t)>=0&&(o=t),assertDtype(t,o,e,n),null==r||!util_1.isTypedArray(r)&&!Array.isArray(r)&&"number"!=typeof r&&"boolean"!=typeof r&&"string"!=typeof r){var i=null==r?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+i+"'")}var s=inferShape(r,o);util_1.isTypedArray(r)||Array.isArray(r)||(r=[r]);var a="string"!==o?util_1.toTypedArray(r,o,environment_1.env().getBool("DEBUG")):util_1.flatten(r,[],!0);return engine_1.ENGINE.makeTensor(a,s,o)}function convertToTensorArray(r,e,n,t){if(void 0===t&&(t="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(r,t){return convertToTensor(r,e+"["+t+"]",n)},t)}exports.inferShape=inferShape,exports.convertToTensor=convertToTensor,exports.convertToTensorArray=convertToTensorArray;

},{"./engine":163,"./environment":164,"./tensor":287,"./util":294}],291:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("./engine"),tensor_util_env_1=require("./tensor_util_env"),util_1=require("./util"),TEST_EPSILON_FLOAT32=.001;function expectArraysClose(e,r,t){return null==t&&(t=testEpsilon()),expectArraysPredicate(e,r,function(e,r){return areClose(e,r,t)})}function testEpsilon(){return 32===engine_1.ENGINE.backend.floatPrecision()?TEST_EPSILON_FLOAT32:exports.TEST_EPSILON_FLOAT16}function expectArraysPredicate(e,r,t){var n=!0;if((util_1.isTypedArray(e)||util_1.isTypedArray(r))&&(n=!1),util_1.isTypedArray(e)&&util_1.isTypedArray(r)&&(n=!0),n){var i=e.constructor.name,a=r.constructor.name;if(i!==a)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(r)){var s=tensor_util_env_1.inferShape(e),o=tensor_util_env_1.inferShape(r);if(!util_1.arraysEqual(s,o))throw new Error("Arrays have different shapes. Actual: ["+s+"]. Expected: ["+o+"]")}var u=util_1.isTypedArray(e)?e:util_1.flatten(e),l=util_1.isTypedArray(r)?r:util_1.flatten(r);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var p=u[c],f=l[c];if(!t(p,f))throw new Error("Arrays differ: actual["+c+"] = "+p+", expected["+c+"] = "+f+".\nActual:   "+u+".\nExpected: "+l+".")}}function expectPromiseToFail(e,r){e().then(function(){return r.fail()},function(){return r()})}function expectArraysEqual(e,r){var t="string"==typeof r||"number"==typeof r||"boolean"==typeof r?[r]:r;return util_1.isString(e)||util_1.isString(e[0])||util_1.isString(r)||util_1.isString(r[0])?expectArraysPredicate(e,t,function(e,r){return e==r}):expectArraysPredicate(e,r,function(e,r){return areClose(e,r,0)})}function expectNumbersClose(e,r,t){if(null==t&&(t=testEpsilon()),!areClose(e,r,t))throw new Error("Numbers differ: actual === "+e+", expected === "+r)}function areClose(e,r,t){return!isFinite(e)&&!isFinite(r)||!(isNaN(e)||isNaN(r)||Math.abs(e-r)>t)}function expectValuesInRange(e,r,t){for(var n=0;n<e.length;n++)if(e[n]<r||e[n]>t)throw new Error("Value out of range:"+e[n]+" low: "+r+", high: "+t)}function expectArrayBuffersEqual(e,r){expect(new Float32Array(e)).toEqual(new Float32Array(r))}exports.TEST_EPSILON_FLOAT16=.1,exports.expectArraysClose=expectArraysClose,exports.testEpsilon=testEpsilon,exports.expectPromiseToFail=expectPromiseToFail,exports.expectArraysEqual=expectArraysEqual,exports.expectNumbersClose=expectNumbersClose,exports.expectValuesInRange=expectValuesInRange,exports.expectArrayBuffersEqual=expectArrayBuffersEqual;

},{"./engine":163,"./tensor_util_env":290,"./util":294}],292:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var adadelta_optimizer_1=require("./optimizers/adadelta_optimizer"),adagrad_optimizer_1=require("./optimizers/adagrad_optimizer"),adam_optimizer_1=require("./optimizers/adam_optimizer"),adamax_optimizer_1=require("./optimizers/adamax_optimizer"),momentum_optimizer_1=require("./optimizers/momentum_optimizer"),optimizer_constructors_1=require("./optimizers/optimizer_constructors"),rmsprop_optimizer_1=require("./optimizers/rmsprop_optimizer"),sgd_optimizer_1=require("./optimizers/sgd_optimizer");momentum_optimizer_1.MomentumOptimizer,sgd_optimizer_1.SGDOptimizer,adadelta_optimizer_1.AdadeltaOptimizer,adagrad_optimizer_1.AdagradOptimizer,rmsprop_optimizer_1.RMSPropOptimizer,adamax_optimizer_1.AdamaxOptimizer,adam_optimizer_1.AdamOptimizer,exports.train={sgd:optimizer_constructors_1.OptimizerConstructors.sgd,momentum:optimizer_constructors_1.OptimizerConstructors.momentum,adadelta:optimizer_constructors_1.OptimizerConstructors.adadelta,adagrad:optimizer_constructors_1.OptimizerConstructors.adagrad,rmsprop:optimizer_constructors_1.OptimizerConstructors.rmsprop,adamax:optimizer_constructors_1.OptimizerConstructors.adamax,adam:optimizer_constructors_1.OptimizerConstructors.adam};

},{"./optimizers/adadelta_optimizer":265,"./optimizers/adagrad_optimizer":266,"./optimizers/adam_optimizer":267,"./optimizers/adamax_optimizer":268,"./optimizers/momentum_optimizer":269,"./optimizers/optimizer_constructors":271,"./optimizers/rmsprop_optimizer":272,"./optimizers/sgd_optimizer":273}],293:[function(require,module,exports){
"use strict";var Rank,UpcastInt32AndMap,UpcastBoolAndMap,UpcastFloat32AndMap,UpcastComplex64AndMap;Object.defineProperty(exports,"__esModule",{value:!0}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(Rank=exports.Rank||(exports.Rank={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(UpcastInt32AndMap||(UpcastInt32AndMap={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(UpcastBoolAndMap||(UpcastBoolAndMap={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(UpcastFloat32AndMap||(UpcastFloat32AndMap={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(UpcastComplex64AndMap||(UpcastComplex64AndMap={}));var upcastTypeMap={float32:UpcastFloat32AndMap,int32:UpcastInt32AndMap,bool:UpcastBoolAndMap,complex64:UpcastComplex64AndMap};function upcastType(t,p){if("string"===t||"string"===p){if("string"===t&&"string"===p)return"string";throw new Error("Can not upcast "+t+" with "+p)}return upcastTypeMap[t][p]}function sumOutType(t){return upcastType(t,"int32")}exports.upcastType=upcastType,exports.sumOutType=sumOutType;

},{}],294:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment");function shuffle(r){for(var e=r.length,n=0,t=0;e>0;)t=Math.random()*e|0,n=r[--e],r[e]=r[t],r[t]=n}function clamp(r,e,n){return Math.max(r,Math.min(e,n))}function nearestLargerEven(r){return r%2==0?r:r+1}function sum(r){for(var e=0,n=0;n<r.length;n++)e+=r[n];return e}function randUniform(r,e){var n=Math.random();return e*n+(1-n)*r}function distSquared(r,e){for(var n=0,t=0;t<r.length;t++){var o=Number(r[t])-Number(e[t]);n+=o*o}return n}function assert(r,e){if(!r)throw new Error("string"==typeof e?e:e())}function assertShapesMatch(r,e,n){void 0===n&&(n=""),assert(arraysEqual(r,e),function(){return n+" Shapes "+r+" and "+e+" must match"})}function assertNonNull(r){assert(null!=r,function(){return"The input to the tensor constructor must be a non-null value."})}function flatten(r,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(r)||isTypedArray(r)&&!n)for(var t=0;t<r.length;++t)flatten(r[t],e,n);else e.push(r);return e}function sizeFromShape(r){if(0===r.length)return 1;for(var e=r[0],n=1;n<r.length;n++)e*=r[n];return e}function isScalarShape(r){return 0===r.length}function arraysEqual(r,e){if(r===e)return!0;if(null==r||null==e)return!1;if(r.length!==e.length)return!1;for(var n=0;n<r.length;n++)if(r[n]!==e[n])return!1;return!0}function isInt(r){return r%1==0}function tanh(r){if(null!=Math.tanh)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function sizeToSquarishShape(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function createShuffledIndices(r){for(var e=new Uint32Array(r),n=0;n<r;++n)e[n]=n;return shuffle(e),e}function rightPad(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function repeatedTry(r,e,n){return void 0===e&&(e=function(r){return 0}),new Promise(function(t,o){var a=0,i=function(){if(r())t();else{var s=e(++a);null!=n&&a>=n?o():setTimeout(i,s)}};i()})}function inferFromImplicitShape(r,e){for(var n=1,t=-1,o=0;o<r.length;++o)if(r[o]>=0)n*=r[o];else if(-1===r[o]){if(-1!==t)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+t+" and dim "+o);t=o}else if(r[o]<0)throw Error("Shapes can not be < 0. Found "+r[o]+" at dim "+o);if(-1===t){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+r);return r}if(0===n)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var a=r.slice();return a[t]=e/n,a}function parseAxisParam(r,e){var n=e.length;return assert((r=null==r?e.map(function(r,e){return e}):[].concat(r)).every(function(r){return r>=-n&&r<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+r}),assert(r.every(function(r){return isInt(r)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(r){return r<0?n+r:r})}function squeezeShape(r,e){for(var n=[],t=[],o=null!=e&&Array.isArray(e)&&0===e.length,a=null==e||o?null:parseAxisParam(e,r).sort(),i=0,s=0;s<r.length;++s){if(null!=a){if(a[i]===s&&1!==r[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(null==a[i]||a[i]>s)&&1===r[s]&&(n.push(r[s]),t.push(s)),a[i]<=s&&i++}1!==r[s]&&(n.push(r[s]),t.push(s))}return{newShape:n,keptDims:t}}function getTypedArrayFromDType(r,e){var n=null;if(null==r||"float32"===r)n=new Float32Array(e);else if("int32"===r)n=new Int32Array(e);else{if("bool"!==r)throw new Error("Unknown data type "+r);n=new Uint8Array(e)}return n}function getArrayFromDType(r,e){var n=null;if(null==r||"float32"===r)n=new Float32Array(e);else if("int32"===r)n=new Int32Array(e);else if("bool"===r)n=new Uint8Array(e);else{if("string"!==r)throw new Error("Unknown data type "+r);n=new Array(e)}return n}function checkConversionForErrors(r,e){for(var n=0;n<r.length;n++){var t=r[n];if(isNaN(t)||!isFinite(t))throw Error("A tensor of type "+e+" being uploaded contains "+t+".")}}function isValidDtype(r){return"bool"===r||"complex64"===r||"float32"===r||"int32"===r||"string"===r}function hasEncodingLoss(r,e){return"complex64"!==e&&(("float32"!==e||"complex64"===r)&&(("int32"!==e||"float32"===r||"complex64"===r)&&("bool"!==e||"bool"!==r)))}function isTypedArray(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function bytesPerElement(r){if("float32"===r||"int32"===r)return 4;if("complex64"===r)return 8;if("bool"===r)return 1;throw new Error("Unknown dtype "+r)}function bytesFromStringArray(r){if(null==r)return 0;var e=0;return r.forEach(function(r){return e+=r.length}),e}function isString(r){return"string"==typeof r||r instanceof String}function isBoolean(r){return"boolean"==typeof r}function isNumber(r){return"number"==typeof r}function inferDtype(r){return Array.isArray(r)?inferDtype(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":isNumber(r)?"float32":isString(r)?"string":isBoolean(r)?"bool":"float32"}function isFunction(r){return!!(r&&r.constructor&&r.call&&r.apply)}function nearestDivisor(r,e){for(var n=e;n<r;++n)if(r%n==0)return n;return r}function computeStrides(r){var e=r.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=r[e-1];for(var t=e-3;t>=0;--t)n[t]=n[t+1]*r[t+1];return n}function toTypedArray(r,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=flatten(r)),n&&checkConversionForErrors(r,e),noConversionNeeded(r,e))return r;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(r);if("int32"===e)return new Int32Array(r);if("bool"===e){for(var t=new Uint8Array(r.length),o=0;o<t.length;++o)0!==Math.round(r[o])&&(t[o]=1);return t}throw new Error("Unknown data type "+e)}function createNestedArray(r,e,n){var t=new Array;if(1===e.length)for(var o=e[0],a=0;a<o;a++)t[a]=n[r+a];else{o=e[0];var i=e.slice(1),s=i.reduce(function(r,e){return r*e});for(a=0;a<o;a++)t[a]=createNestedArray(r+a*s,i,n)}return t}function toNestedArray(r,e){if(0===r.length)return e[0];var n=r.reduce(function(r,e){return r*e});if(0===n)return[];if(n!==e.length)throw new Error("["+r+"] does not match the input size.");return createNestedArray(0,r,e)}function noConversionNeeded(r,e){return r instanceof Float32Array&&"float32"===e||r instanceof Int32Array&&"int32"===e||r instanceof Uint8Array&&"bool"===e}function makeOnesTypedArray(r,e){for(var n=makeZerosTypedArray(r,e),t=0;t<n.length;t++)n[t]=1;return n}function makeZerosTypedArray(r,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(r);if("int32"===e)return new Int32Array(r);if("bool"===e)return new Uint8Array(r);throw new Error("Unknown data type "+e)}function now(){return environment_1.env().platform.now()}function assertNonNegativeIntegerDimensions(r){r.forEach(function(e){assert(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function fetch(r,e){return environment_1.env().platform.fetch(r,e)}function encodeString(r,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",environment_1.env().platform.encode(r,e)}function decodeString(r,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",environment_1.env().platform.decode(r,e)}function locToIndex(r,e,n){if(0===e)return 0;if(1===e)return r[0];for(var t=r[r.length-1],o=0;o<r.length-1;++o)t+=n[o]*r[o];return t}function indexToLoc(r,e,n){if(0===e)return[];if(1===e)return[r];for(var t=new Array(e),o=0;o<t.length-1;++o)t[o]=Math.floor(r/n[o]),r-=t[o]*n[o];return t[t.length-1]=r,t}exports.shuffle=shuffle,exports.clamp=clamp,exports.nearestLargerEven=nearestLargerEven,exports.sum=sum,exports.randUniform=randUniform,exports.distSquared=distSquared,exports.assert=assert,exports.assertShapesMatch=assertShapesMatch,exports.assertNonNull=assertNonNull,exports.flatten=flatten,exports.sizeFromShape=sizeFromShape,exports.isScalarShape=isScalarShape,exports.arraysEqual=arraysEqual,exports.isInt=isInt,exports.tanh=tanh,exports.sizeToSquarishShape=sizeToSquarishShape,exports.createShuffledIndices=createShuffledIndices,exports.rightPad=rightPad,exports.repeatedTry=repeatedTry,exports.inferFromImplicitShape=inferFromImplicitShape,exports.parseAxisParam=parseAxisParam,exports.squeezeShape=squeezeShape,exports.getTypedArrayFromDType=getTypedArrayFromDType,exports.getArrayFromDType=getArrayFromDType,exports.checkConversionForErrors=checkConversionForErrors,exports.isValidDtype=isValidDtype,exports.hasEncodingLoss=hasEncodingLoss,exports.isTypedArray=isTypedArray,exports.bytesPerElement=bytesPerElement,exports.bytesFromStringArray=bytesFromStringArray,exports.isString=isString,exports.isBoolean=isBoolean,exports.isNumber=isNumber,exports.inferDtype=inferDtype,exports.isFunction=isFunction,exports.nearestDivisor=nearestDivisor,exports.computeStrides=computeStrides,exports.toTypedArray=toTypedArray,exports.toNestedArray=toNestedArray,exports.makeOnesTypedArray=makeOnesTypedArray,exports.makeZerosTypedArray=makeZerosTypedArray,exports.now=now,exports.assertNonNegativeIntegerDimensions=assertNonNegativeIntegerDimensions,exports.fetch=fetch,exports.encodeString=encodeString,exports.decodeString=decodeString,exports.locToIndex=locToIndex,exports.indexToLoc=indexToLoc;

},{"./environment":164}],295:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var version="1.7.1";exports.version=version;

},{}],296:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var gpgpu_util=require("./backends/webgl/gpgpu_util");exports.gpgpu_util=gpgpu_util;var webgl_util=require("./backends/webgl/webgl_util");exports.webgl_util=webgl_util;var environment_1=require("./environment"),backend_webgl_1=require("./backends/webgl/backend_webgl");exports.MathBackendWebGL=backend_webgl_1.MathBackendWebGL;var canvas_util_1=require("./backends/webgl/canvas_util");exports.setWebGLContext=canvas_util_1.setWebGLContext;var gpgpu_context_1=require("./backends/webgl/gpgpu_context");function forceHalfFloat(){environment_1.env().set("WEBGL_FORCE_F16_TEXTURES",!0)}exports.GPGPUContext=gpgpu_context_1.GPGPUContext,exports.forceHalfFloat=forceHalfFloat;

},{"./backends/webgl/backend_webgl":77,"./backends/webgl/canvas_util":83,"./backends/webgl/gpgpu_context":110,"./backends/webgl/gpgpu_util":112,"./backends/webgl/webgl_util":159,"./environment":164}],297:[function(require,module,exports){
"use strict";exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(o){var r=o.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=o.indexOf("=");return-1===e&&(e=r),[e,e===r?0:4-e%4]}function byteLength(o){var r=getLens(o),e=r[0],t=r[1];return 3*(e+t)/4-t}function _byteLength(o,r,e){return 3*(r+e)/4-e}function toByteArray(o){var r,e,t=getLens(o),n=t[0],u=t[1],p=new Arr(_byteLength(o,n,u)),a=0,h=u>0?n-4:n;for(e=0;e<h;e+=4)r=revLookup[o.charCodeAt(e)]<<18|revLookup[o.charCodeAt(e+1)]<<12|revLookup[o.charCodeAt(e+2)]<<6|revLookup[o.charCodeAt(e+3)],p[a++]=r>>16&255,p[a++]=r>>8&255,p[a++]=255&r;return 2===u&&(r=revLookup[o.charCodeAt(e)]<<2|revLookup[o.charCodeAt(e+1)]>>4,p[a++]=255&r),1===u&&(r=revLookup[o.charCodeAt(e)]<<10|revLookup[o.charCodeAt(e+1)]<<4|revLookup[o.charCodeAt(e+2)]>>2,p[a++]=r>>8&255,p[a++]=255&r),p}function tripletToBase64(o){return lookup[o>>18&63]+lookup[o>>12&63]+lookup[o>>6&63]+lookup[63&o]}function encodeChunk(o,r,e){for(var t,n=[],u=r;u<e;u+=3)t=(o[u]<<16&16711680)+(o[u+1]<<8&65280)+(255&o[u+2]),n.push(tripletToBase64(t));return n.join("")}function fromByteArray(o){for(var r,e=o.length,t=e%3,n=[],u=0,p=e-t;u<p;u+=16383)n.push(encodeChunk(o,u,u+16383>p?p:u+16383));return 1===t?(r=o[e-1],n.push(lookup[r>>2]+lookup[r<<4&63]+"==")):2===t&&(r=(o[e-2]<<8)+o[e-1],n.push(lookup[r>>10]+lookup[r>>4&63]+lookup[r<<2&63]+"=")),n.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63;

},{}],298:[function(require,module,exports){

},{}],299:[function(require,module,exports){
var objectCreate=Object.create||objectCreatePolyfill,objectKeys=Object.keys||objectKeysPolyfill,bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var hasDefineProperty,defaultMaxListeners=10;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(e){hasDefineProperty=!1}function $getMaxListeners(e){return void 0===e._maxListeners?EventEmitter.defaultMaxListeners:e._maxListeners}function emitNone(e,t,n){if(t)e.call(n);else for(var r=e.length,i=arrayClone(e,r),s=0;s<r;++s)i[s].call(n)}function emitOne(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=arrayClone(e,i),o=0;o<i;++o)s[o].call(n,r)}function emitTwo(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,o=arrayClone(e,s),a=0;a<s;++a)o[a].call(n,r,i)}function emitThree(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var o=e.length,a=arrayClone(e,o),l=0;l<o;++l)a[l].call(n,r,i,s)}function emitMany(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=arrayClone(e,i),o=0;o<i;++o)s[o].apply(n,r)}function _addListener(e,t,n,r){var i,s,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]):(s=e._events=objectCreate(null),e._eventsCount=0),o){if("function"==typeof o?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=$getMaxListeners(e))&&i>0&&o.length>i){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",a.name,a.message)}}else o=s[t]=n,++e._eventsCount;return e}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function _onceWrap(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=bind.call(onceWrapper,r);return i.listener=n,r.wrapFn=i,i}function _listeners(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?unwrapListeners(i):arrayClone(i,i.length):[]}function listenerCount(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function spliceOne(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}function arrayClone(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function unwrapListeners(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function objectCreatePolyfill(e){var t=function(){};return t.prototype=e,new t}function objectKeysPolyfill(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n}function functionBindPolyfill(e){var t=this;return function(){return t.apply(e,arguments)}}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=e}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(e){var t,n,r,i,s,o,a="error"===e;if(o=this._events)a=a&&null==o.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled "error" event. ('+t+")");throw l.context=t,l}if(!(n=o[e]))return!1;var u="function"==typeof n;switch(r=arguments.length){case 1:emitNone(n,u,this);break;case 2:emitOne(n,u,this,arguments[1]);break;case 3:emitTwo(n,u,this,arguments[1],arguments[2]);break;case 4:emitThree(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];emitMany(n,u,this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){return _addListener(this,e,t,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(e,t){return _addListener(this,e,t,!0)},EventEmitter.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.removeListener=function(e,t){var n,r,i,s,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=objectCreate(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():spliceOne(n,i),1===n.length&&(r[e]=n[0]),r.removeListener&&this.emit("removeListener",e,o||t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n,r;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=objectCreate(null):delete n[e]),this;if(0===arguments.length){var i,s=objectKeys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},EventEmitter.prototype.listeners=function(e){return _listeners(this,e,!0)},EventEmitter.prototype.rawListeners=function(e){return _listeners(this,e,!1)},EventEmitter.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):listenerCount.call(e,t)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};

},{}],300:[function(require,module,exports){
(function (Buffer){
"use strict";var base64=require("base64-js"),ieee754=require("ieee754"),customInspectSymbol="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;function typedArraySupport(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}function createBuffer(e){if(e>K_MAX_LENGTH)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,Buffer.prototype),t}function Buffer(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(e)}return from(e,t,r)}function from(e,t,r){if("string"==typeof e)return fromString(e,t);if(ArrayBuffer.isView(e))return fromArrayLike(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(isInstance(e,ArrayBuffer)||e&&isInstance(e.buffer,ArrayBuffer))return fromArrayBuffer(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(isInstance(e,SharedArrayBuffer)||e&&isInstance(e.buffer,SharedArrayBuffer)))return fromArrayBuffer(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return Buffer.from(n,t,r);var f=fromObject(e);if(f)return f;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Buffer.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function alloc(e,t,r){return assertSize(e),e<=0?createBuffer(e):void 0!==t?"string"==typeof r?createBuffer(e).fill(t,r):createBuffer(e).fill(t):createBuffer(e)}function allocUnsafe(e){return assertSize(e),createBuffer(e<0?0:0|checked(e))}function fromString(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!Buffer.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|byteLength(e,t),n=createBuffer(r),f=n.write(e,t);return f!==r&&(n=n.slice(0,f)),n}function fromArrayLike(e){for(var t=e.length<0?0:0|checked(e.length),r=createBuffer(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function fromArrayBuffer(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,Buffer.prototype),n}function fromObject(e){if(Buffer.isBuffer(e)){var t=0|checked(e.length),r=createBuffer(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}return void 0!==e.length?"number"!=typeof e.length||numberIsNaN(e.length)?createBuffer(0):fromArrayLike(e):"Buffer"===e.type&&Array.isArray(e.data)?fromArrayLike(e.data):void 0}function checked(e){if(e>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|e}function SlowBuffer(e){return+e!=e&&(e=0),Buffer.alloc(+e)}function byteLength(e,t){if(Buffer.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||isInstance(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var f=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(e).length;default:if(f)return n?-1:utf8ToBytes(e).length;t=(""+t).toLowerCase(),f=!0}}function slowToString(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,r);case"utf8":case"utf-8":return utf8Slice(this,t,r);case"ascii":return asciiSlice(this,t,r);case"latin1":case"binary":return latin1Slice(this,t,r);case"base64":return base64Slice(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function swap(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bidirectionalIndexOf(e,t,r,n,f){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),numberIsNaN(r=+r)&&(r=f?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(f)return-1;r=e.length-1}else if(r<0){if(!f)return-1;r=0}if("string"==typeof t&&(t=Buffer.from(t,n)),Buffer.isBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,r,n,f);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?f?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):arrayIndexOf(e,[t],r,n,f);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,r,n,f){var i,o=1,u=e.length,s=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,u/=2,s/=2,r/=2}function a(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(f){var h=-1;for(i=r;i<u;i++)if(a(e,i)===a(t,-1===h?0:i-h)){if(-1===h&&(h=i),i-h+1===s)return h*o}else-1!==h&&(i-=i-h),h=-1}else for(r+s>u&&(r=u-s),i=r;i>=0;i--){for(var c=!0,l=0;l<s;l++)if(a(e,i+l)!==a(t,l)){c=!1;break}if(c)return i}return-1}function hexWrite(e,t,r,n){r=Number(r)||0;var f=e.length-r;n?(n=Number(n))>f&&(n=f):n=f;var i=t.length;n>i/2&&(n=i/2);for(var o=0;o<n;++o){var u=parseInt(t.substr(2*o,2),16);if(numberIsNaN(u))return o;e[r+o]=u}return o}function utf8Write(e,t,r,n){return blitBuffer(utf8ToBytes(t,e.length-r),e,r,n)}function asciiWrite(e,t,r,n){return blitBuffer(asciiToBytes(t),e,r,n)}function latin1Write(e,t,r,n){return asciiWrite(e,t,r,n)}function base64Write(e,t,r,n){return blitBuffer(base64ToBytes(t),e,r,n)}function ucs2Write(e,t,r,n){return blitBuffer(utf16leToBytes(t,e.length-r),e,r,n)}function base64Slice(e,t,r){return 0===t&&r===e.length?base64.fromByteArray(e):base64.fromByteArray(e.slice(t,r))}function utf8Slice(e,t,r){r=Math.min(e.length,r);for(var n=[],f=t;f<r;){var i,o,u,s,a=e[f],h=null,c=a>239?4:a>223?3:a>191?2:1;if(f+c<=r)switch(c){case 1:a<128&&(h=a);break;case 2:128==(192&(i=e[f+1]))&&(s=(31&a)<<6|63&i)>127&&(h=s);break;case 3:i=e[f+1],o=e[f+2],128==(192&i)&&128==(192&o)&&(s=(15&a)<<12|(63&i)<<6|63&o)>2047&&(s<55296||s>57343)&&(h=s);break;case 4:i=e[f+1],o=e[f+2],u=e[f+3],128==(192&i)&&128==(192&o)&&128==(192&u)&&(s=(15&a)<<18|(63&i)<<12|(63&o)<<6|63&u)>65535&&s<1114112&&(h=s)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),f+=c}return decodeCodePointsArray(n)}exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(e,t,r){return from(e,t,r)},Object.setPrototypeOf(Buffer.prototype,Uint8Array.prototype),Object.setPrototypeOf(Buffer,Uint8Array),Buffer.alloc=function(e,t,r){return alloc(e,t,r)},Buffer.allocUnsafe=function(e){return allocUnsafe(e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(e)},Buffer.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==Buffer.prototype},Buffer.compare=function(e,t){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),isInstance(t,Uint8Array)&&(t=Buffer.from(t,t.offset,t.byteLength)),!Buffer.isBuffer(e)||!Buffer.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,f=0,i=Math.min(r,n);f<i;++f)if(e[f]!==t[f]){r=e[f],n=t[f];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Buffer.allocUnsafe(t),f=0;for(r=0;r<e.length;++r){var i=e[r];if(isInstance(i,Uint8Array)&&(i=Buffer.from(i)),!Buffer.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,f),f+=i.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(e){if(!Buffer.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function(){var e="",t=exports.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},customInspectSymbol&&(Buffer.prototype[customInspectSymbol]=Buffer.prototype.inspect),Buffer.prototype.compare=function(e,t,r,n,f){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),!Buffer.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===f&&(f=this.length),t<0||r>e.length||n<0||f>this.length)throw new RangeError("out of range index");if(n>=f&&t>=r)return 0;if(n>=f)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,f>>>=0,this===e)return 0;for(var i=f-n,o=r-t,u=Math.min(i,o),s=this.slice(n,f),a=e.slice(t,r),h=0;h<u;++h)if(s[h]!==a[h]){i=s[h],o=a[h];break}return i<o?-1:o<i?1:0},Buffer.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer.prototype.indexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!0)},Buffer.prototype.lastIndexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!1)},Buffer.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var f=this.length-t;if((void 0===r||r>f)&&(r=f),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return hexWrite(this,e,t,r);case"utf8":case"utf-8":return utf8Write(this,e,t,r);case"ascii":return asciiWrite(this,e,t,r);case"latin1":case"binary":return latin1Write(this,e,t,r);case"base64":return base64Write(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(e,t,r){var n="";r=Math.min(e.length,r);for(var f=t;f<r;++f)n+=String.fromCharCode(127&e[f]);return n}function latin1Slice(e,t,r){var n="";r=Math.min(e.length,r);for(var f=t;f<r;++f)n+=String.fromCharCode(e[f]);return n}function hexSlice(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var f="",i=t;i<r;++i)f+=hexSliceLookupTable[e[i]];return f}function utf16leSlice(e,t,r){for(var n=e.slice(t,r),f="",i=0;i<n.length;i+=2)f+=String.fromCharCode(n[i]+256*n[i+1]);return f}function checkOffset(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,r,n,f,i){if(!Buffer.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>f||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function checkIEEE754(e,t,r,n,f,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(e,t,r,n,f){return t=+t,r>>>=0,f||checkIEEE754(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(e,t,r,n,23,4),r+4}function writeDouble(e,t,r,n,f){return t=+t,r>>>=0,f||checkIEEE754(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(e,t,r,n,52,8),r+8}Buffer.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,Buffer.prototype),n},Buffer.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e],f=1,i=0;++i<t&&(f*=256);)n+=this[e+i]*f;return n},Buffer.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e+--t],f=1;t>0&&(f*=256);)n+=this[e+--t]*f;return n},Buffer.prototype.readUInt8=function(e,t){return e>>>=0,t||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e],f=1,i=0;++i<t&&(f*=256);)n+=this[e+i]*f;return n>=(f*=128)&&(n-=Math.pow(2,8*t)),n},Buffer.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=t,f=1,i=this[e+--n];n>0&&(f*=256);)i+=this[e+--n]*f;return i>=(f*=128)&&(i-=Math.pow(2,8*t)),i},Buffer.prototype.readInt8=function(e,t){return e>>>=0,t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function(e,t){e>>>=0,t||checkOffset(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(e,t){e>>>=0,t||checkOffset(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),ieee754.read(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),ieee754.read(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function(e,t){return e>>>=0,t||checkOffset(e,8,this.length),ieee754.read(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function(e,t){return e>>>=0,t||checkOffset(e,8,this.length),ieee754.read(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var f=1,i=0;for(this[t]=255&e;++i<r&&(f*=256);)this[t+i]=e/f&255;return t+r},Buffer.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var f=r-1,i=1;for(this[t+f]=255&e;--f>=0&&(i*=256);)this[t+f]=e/i&255;return t+r},Buffer.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,1,255,0),this[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},Buffer.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var f=Math.pow(2,8*r-1);checkInt(this,e,t,r,f-1,-f)}var i=0,o=1,u=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===u&&0!==this[t+i-1]&&(u=1),this[t+i]=(e/o>>0)-u&255;return t+r},Buffer.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var f=Math.pow(2,8*r-1);checkInt(this,e,t,r,f-1,-f)}var i=r-1,o=1,u=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===u&&0!==this[t+i+1]&&(u=1),this[t+i]=(e/o>>0)-u&255;return t+r},Buffer.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},Buffer.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeFloatLE=function(e,t,r){return writeFloat(this,e,t,!0,r)},Buffer.prototype.writeFloatBE=function(e,t,r){return writeFloat(this,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function(e,t,r){return writeDouble(this,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function(e,t,r){return writeDouble(this,e,t,!1,r)},Buffer.prototype.copy=function(e,t,r,n){if(!Buffer.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var f=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var i=f-1;i>=0;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return f},Buffer.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var f=e.charCodeAt(0);("utf8"===n&&f<128||"latin1"===n)&&(e=f)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var o=Buffer.isBuffer(e)?e:Buffer.from(e,n),u=o.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=o[i%u]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(e){if((e=(e=e.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function utf8ToBytes(e,t){var r;t=t||1/0;for(var n=e.length,f=null,i=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!f){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}f=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),f=r;continue}r=65536+(f-55296<<10|r-56320)}else f&&(t-=3)>-1&&i.push(239,191,189);if(f=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function asciiToBytes(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function utf16leToBytes(e,t){for(var r,n,f,i=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,f=r%256,i.push(f),i.push(n);return i}function base64ToBytes(e){return base64.toByteArray(base64clean(e))}function blitBuffer(e,t,r,n){for(var f=0;f<n&&!(f+r>=t.length||f>=e.length);++f)t[f+r]=e[f];return f}function isInstance(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function numberIsNaN(e){return e!=e}var hexSliceLookupTable=function(){for(var e=new Array(256),t=0;t<16;++t)for(var r=16*t,n=0;n<16;++n)e[r+n]="0123456789abcdef"[t]+"0123456789abcdef"[n];return e}();

}).call(this,require("buffer").Buffer)
},{"base64-js":297,"buffer":300,"ieee754":319}],301:[function(require,module,exports){
!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var n={},t=/[^\s\u00a0]/,i=e.Pos;function l(e){var n=e.search(t);return-1==n?0:n}function o(e,n){var t=e.getMode();return!1!==t.useInnerComments&&t.innerMode?e.getModeAt(n):t}e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",function(e){e||(e=n);for(var t=1/0,l=this.listSelections(),o=null,r=l.length-1;r>=0;r--){var a=l[r].from(),m=l[r].to();a.line>=t||(m.line>=t&&(m=i(t,0)),t=a.line,null==o?this.uncomment(a,m,e)?o="un":(this.lineComment(a,m,e),o="line"):"un"==o?this.uncomment(a,m,e):this.lineComment(a,m,e))}}),e.defineExtension("lineComment",function(e,r,a){a||(a=n);var m=this,c=o(m,e),f=m.getLine(e.line);if(null!=f&&(g=e,s=f,!/\bstring\b/.test(m.getTokenTypeAt(i(g.line,0)))||/^[\'\"\`]/.test(s))){var g,s,d=a.lineComment||c.lineComment;if(d){var u=Math.min(0!=r.ch||r.line==e.line?r.line+1:r.line,m.lastLine()+1),h=null==a.padding?" ":a.padding,p=a.commentBlankLines||e.line==r.line;m.operation(function(){if(a.indent){for(var n=null,o=e.line;o<u;++o){var r=(c=m.getLine(o)).slice(0,l(c));(null==n||n.length>r.length)&&(n=r)}for(o=e.line;o<u;++o){var c=m.getLine(o),f=n.length;(p||t.test(c))&&(c.slice(0,f)!=n&&(f=l(c)),m.replaceRange(n+d+h,i(o,0),i(o,f)))}}else for(o=e.line;o<u;++o)(p||t.test(m.getLine(o)))&&m.replaceRange(d+h,i(o,0))})}else(a.blockCommentStart||c.blockCommentStart)&&(a.fullLines=!0,m.blockComment(e,r,a))}}),e.defineExtension("blockComment",function(e,l,r){r||(r=n);var a=this,m=o(a,e),c=r.blockCommentStart||m.blockCommentStart,f=r.blockCommentEnd||m.blockCommentEnd;if(c&&f){if(!/\bcomment\b/.test(a.getTokenTypeAt(i(e.line,0)))){var g=Math.min(l.line,a.lastLine());g!=e.line&&0==l.ch&&t.test(a.getLine(g))&&--g;var s=null==r.padding?" ":r.padding;e.line>g||a.operation(function(){if(0!=r.fullLines){var n=t.test(a.getLine(g));a.replaceRange(s+f,i(g)),a.replaceRange(c+s,i(e.line,0));var o=r.blockCommentLead||m.blockCommentLead;if(null!=o)for(var d=e.line+1;d<=g;++d)(d!=g||n)&&a.replaceRange(o+s,i(d,0))}else a.replaceRange(f,l),a.replaceRange(c,e)})}}else(r.lineComment||m.lineComment)&&0!=r.fullLines&&a.lineComment(e,l,r)}),e.defineExtension("uncomment",function(e,l,r){r||(r=n);var a,m=this,c=o(m,e),f=Math.min(0!=l.ch||l.line==e.line?l.line:l.line-1,m.lastLine()),g=Math.min(e.line,f),s=r.lineComment||c.lineComment,d=[],u=null==r.padding?" ":r.padding;e:if(s){for(var h=g;h<=f;++h){var p=m.getLine(h),v=p.indexOf(s);if(v>-1&&!/comment/.test(m.getTokenTypeAt(i(h,v+1)))&&(v=-1),-1==v&&t.test(p))break e;if(v>-1&&t.test(p.slice(0,v)))break e;d.push(p)}if(m.operation(function(){for(var e=g;e<=f;++e){var n=d[e-g],t=n.indexOf(s),l=t+s.length;t<0||(n.slice(l,l+u.length)==u&&(l+=u.length),a=!0,m.replaceRange("",i(e,t),i(e,l)))}}),a)return!0}var C=r.blockCommentStart||c.blockCommentStart,b=r.blockCommentEnd||c.blockCommentEnd;if(!C||!b)return!1;var k=r.blockCommentLead||c.blockCommentLead,L=m.getLine(g),x=L.indexOf(C);if(-1==x)return!1;var R=f==g?L:m.getLine(f),O=R.indexOf(b,f==g?x+C.length:0),T=i(g,x+1),y=i(f,O+1);if(-1==O||!/comment/.test(m.getTokenTypeAt(T))||!/comment/.test(m.getTokenTypeAt(y))||m.getRange(T,y,"\n").indexOf(b)>-1)return!1;var E=L.lastIndexOf(C,e.ch),M=-1==E?-1:L.slice(0,e.ch).indexOf(b,E+C.length);if(-1!=E&&-1!=M&&M+b.length!=e.ch)return!1;M=R.indexOf(b,l.ch);var S=R.slice(l.ch).lastIndexOf(C,M-l.ch);return E=-1==M||-1==S?-1:l.ch+S,(-1==M||-1==E||E==l.ch)&&(m.operation(function(){m.replaceRange("",i(f,O-(u&&R.slice(O-u.length,O)==u?u.length:0)),i(f,O+b.length));var e=x+C.length;if(u&&L.slice(e,e+u.length)==u&&(e+=u.length),m.replaceRange("",i(g,x),i(g,e)),k)for(var n=g+1;n<=f;++n){var l=m.getLine(n),o=l.indexOf(k);if(-1!=o&&!t.test(l.slice(0,o))){var r=o+k.length;u&&l.slice(r,r+u.length)==u&&(r+=u.length),m.replaceRange("",i(n,o),i(n,r))}}}),!0)})});

},{"../../lib/codemirror":311}],302:[function(require,module,exports){
!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){var r={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},t=e.Pos;function n(e,t){return"pairs"==t&&"string"==typeof e?e:"object"==typeof e&&null!=e[t]?e[t]:r[t]}e.defineOption("autoCloseBrackets",!1,function(r,t,o){o&&o!=e.Init&&(r.removeKeyMap(i),r.state.closeBrackets=null),t&&(a(n(t,"pairs")),r.state.closeBrackets=t,r.addKeyMap(i))});var i={Backspace:function(r){var i=s(r);if(!i||r.getOption("disableInput"))return e.Pass;for(var a=n(i,"pairs"),o=r.listSelections(),c=0;c<o.length;c++){if(!o[c].empty())return e.Pass;var f=l(r,o[c].head);if(!f||a.indexOf(f)%2!=0)return e.Pass}for(var c=o.length-1;c>=0;c--){var h=o[c].head;r.replaceRange("",t(h.line,h.ch-1),t(h.line,h.ch+1),"+delete")}},Enter:function(r){var t=s(r),i=t&&n(t,"explode");if(!i||r.getOption("disableInput"))return e.Pass;for(var a=r.listSelections(),o=0;o<a.length;o++){if(!a[o].empty())return e.Pass;var c=l(r,a[o].head);if(!c||i.indexOf(c)%2!=0)return e.Pass}r.operation(function(){var e=r.lineSeparator()||"\n";r.replaceSelection(e+e,null),r.execCommand("goCharLeft"),a=r.listSelections();for(var t=0;t<a.length;t++){var n=a[t].head.line;r.indentLine(n,null,!0),r.indentLine(n+1,null,!0)}})}};function a(e){for(var r=0;r<e.length;r++){var t=e.charAt(r),n="'"+t+"'";i[n]||(i[n]=o(t))}}function o(r){return function(i){return function(r,i){var a=s(r);if(!a||r.getOption("disableInput"))return e.Pass;var o=n(a,"pairs"),l=o.indexOf(i);if(-1==l)return e.Pass;for(var f,h=n(a,"closeBefore"),u=n(a,"triples"),d=o.charAt(l+1)==i,p=r.listSelections(),g=l%2==0,v=0;v<p.length;v++){var m,b=p[v],C=b.head,x=r.getRange(C,t(C.line,C.ch+1));if(g&&!b.empty())m="surround";else if(!d&&g||x!=i)if(d&&C.ch>1&&u.indexOf(i)>=0&&r.getRange(t(C.line,C.ch-2),C)==i+i){if(C.ch>2&&/\bstring/.test(r.getTokenTypeAt(t(C.line,C.ch-2))))return e.Pass;m="addFour"}else if(d){var P=0==C.ch?" ":r.getRange(t(C.line,C.ch-1),C);if(e.isWordChar(x)||P==i||e.isWordChar(P))return e.Pass;m="both"}else{if(!g||!(0===x.length||/\s/.test(x)||h.indexOf(x)>-1))return e.Pass;m="both"}else m=d&&c(r,C)?"both":u.indexOf(i)>=0&&r.getRange(C,t(C.line,C.ch+3))==i+i+i?"skipThree":"skip";if(f){if(f!=m)return e.Pass}else f=m}var k=l%2?o.charAt(l-1):i,y=l%2?i:o.charAt(l+1);r.operation(function(){if("skip"==f)r.execCommand("goCharRight");else if("skipThree"==f)for(var n=0;n<3;n++)r.execCommand("goCharRight");else if("surround"==f){for(var i=r.getSelections(),n=0;n<i.length;n++)i[n]=k+i[n]+y;r.replaceSelections(i,"around"),i=r.listSelections().slice();for(var n=0;n<i.length;n++)i[n]=(a=i[n],void 0,o=e.cmpPos(a.anchor,a.head)>0,{anchor:new t(a.anchor.line,a.anchor.ch+(o?-1:1)),head:new t(a.head.line,a.head.ch+(o?1:-1))});r.setSelections(i)}else"both"==f?(r.replaceSelection(k+y,null),r.triggerElectric(k+y),r.execCommand("goCharLeft")):"addFour"==f&&(r.replaceSelection(k+k+k+k,"before"),r.execCommand("goCharRight"));var a,o})}(i,r)}}function s(e){var r=e.state.closeBrackets;return!r||r.override?r:e.getModeAt(e.getCursor()).closeBrackets||r}function l(e,r){var n=e.getRange(t(r.line,r.ch-1),t(r.line,r.ch+1));return 2==n.length?n:null}function c(e,r){var n=e.getTokenAt(t(r.line,r.ch+1));return/\bstring/.test(n.type)&&n.start==r.ch&&(0==r.ch||!/\bstring/.test(e.getTokenTypeAt(r)))}a(r.pairs+"`")});

},{"../../lib/codemirror":311}],303:[function(require,module,exports){
!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";var i="CodeMirror-hint",e="CodeMirror-hint-active";function n(t,i){this.cm=t,this.options=i,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var e=this;t.on("cursorActivity",this.activityFunc=function(){e.cursorActivity()})}t.showHint=function(t,i,e){if(!i)return t.showHint(e);e&&e.async&&(i.async=!0);var n={hint:i};if(e)for(var o in e)n[o]=e[o];return t.showHint(n)},t.defineExtension("showHint",function(i){i=function(t,i,e){var n=t.options.hintOptions,o={};for(var s in a)o[s]=a[s];if(n)for(var s in n)void 0!==n[s]&&(o[s]=n[s]);if(e)for(var s in e)void 0!==e[s]&&(o[s]=e[s]);o.hint.resolve&&(o.hint=o.hint.resolve(t,i));return o}(this,this.getCursor("start"),i);var e=this.listSelections();if(!(e.length>1)){if(this.somethingSelected()){if(!i.hint.supportsSelection)return;for(var o=0;o<e.length;o++)if(e[o].head.line!=e[o].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();var s=this.state.completionActive=new n(this,i);s.options.hint&&(t.signal(this,"startCompletion",this),s.update(!0))}}),t.defineExtension("closeHint",function(){this.state.completionActive&&this.state.completionActive.close()});var o=window.requestAnimationFrame||function(t){return setTimeout(t,1e3/60)},s=window.cancelAnimationFrame||clearTimeout;function c(t){return"string"==typeof t?t:t.text}function r(t,i){for(;i&&i!=t;){if("LI"===i.nodeName.toUpperCase()&&i.parentNode==t)return i;i=i.parentNode}}function l(n,o){this.completion=n,this.data=o,this.picked=!1;var s=this,l=n.cm,h=l.getInputField().ownerDocument,a=h.defaultView||h.parentWindow,f=this.hints=h.createElement("ul"),u=n.cm.options.theme;f.className="CodeMirror-hints "+u,this.selectedHint=o.selectedHint||0;for(var p=o.list,d=0;d<p.length;++d){var m=f.appendChild(h.createElement("li")),g=p[d],v=i+(d!=this.selectedHint?"":" "+e);null!=g.className&&(v=g.className+" "+v),m.className=v,g.render?g.render(m,o,g):m.appendChild(h.createTextNode(g.displayText||c(g))),m.hintId=d}var y=n.options.container||h.body,w=l.cursorCoords(n.options.alignWithWord?o.from:null),H=w.left,C=w.bottom,b=!0,k=0,A=0;if(y!==h.body){var x=-1!==["absolute","relative","fixed"].indexOf(a.getComputedStyle(y).position)?y:y.offsetParent,T=x.getBoundingClientRect(),S=h.body.getBoundingClientRect();k=T.left-S.left-x.scrollLeft,A=T.top-S.top-x.scrollTop}f.style.left=H-k+"px",f.style.top=C-A+"px";var F=a.innerWidth||Math.max(h.body.offsetWidth,h.documentElement.offsetWidth),M=a.innerHeight||Math.max(h.body.offsetHeight,h.documentElement.offsetHeight);y.appendChild(f);var N=f.getBoundingClientRect(),E=N.bottom-M,O=f.scrollHeight>f.clientHeight+1,P=l.getScrollInfo();if(E>0){var W=N.bottom-N.top;if(w.top-(w.bottom-N.top)-W>0)f.style.top=(C=w.top-W-A)+"px",b=!1;else if(W>M){f.style.height=M-5+"px",f.style.top=(C=w.bottom-N.top-A)+"px";var I=l.getCursor();o.from.ch!=I.ch&&(w=l.cursorCoords(I),f.style.left=(H=w.left-k)+"px",N=f.getBoundingClientRect())}}var B,K=N.right-F;if(K>0&&(N.right-N.left>F&&(f.style.width=F-5+"px",K-=N.right-N.left-F),f.style.left=(H=w.left-K-k)+"px"),O)for(var L=f.firstChild;L;L=L.nextSibling)L.style.paddingRight=l.display.nativeBarWidth+"px";(l.addKeyMap(this.keyMap=function(t,i){var e={Up:function(){i.moveFocus(-1)},Down:function(){i.moveFocus(1)},PageUp:function(){i.moveFocus(1-i.menuSize(),!0)},PageDown:function(){i.moveFocus(i.menuSize()-1,!0)},Home:function(){i.setFocus(0)},End:function(){i.setFocus(i.length-1)},Enter:i.pick,Tab:i.pick,Esc:i.close};/Mac/.test(navigator.platform)&&(e["Ctrl-P"]=function(){i.moveFocus(-1)},e["Ctrl-N"]=function(){i.moveFocus(1)});var n=t.options.customKeys,o=n?{}:e;function s(t,n){var s;s="string"!=typeof n?function(t){return n(t,i)}:e.hasOwnProperty(n)?e[n]:n,o[t]=s}if(n)for(var c in n)n.hasOwnProperty(c)&&s(c,n[c]);var r=t.options.extraKeys;if(r)for(var c in r)r.hasOwnProperty(c)&&s(c,r[c]);return o}(n,{moveFocus:function(t,i){s.changeActive(s.selectedHint+t,i)},setFocus:function(t){s.changeActive(t)},menuSize:function(){return s.screenAmount()},length:p.length,close:function(){n.close()},pick:function(){s.pick()},data:o})),n.options.closeOnUnfocus)&&(l.on("blur",this.onBlur=function(){B=setTimeout(function(){n.close()},100)}),l.on("focus",this.onFocus=function(){clearTimeout(B)}));return l.on("scroll",this.onScroll=function(){var t=l.getScrollInfo(),i=l.getWrapperElement().getBoundingClientRect(),e=C+P.top-t.top,o=e-(a.pageYOffset||(h.documentElement||h.body).scrollTop);if(b||(o+=f.offsetHeight),o<=i.top||o>=i.bottom)return n.close();f.style.top=e+"px",f.style.left=H+P.left-t.left+"px"}),t.on(f,"dblclick",function(t){var i=r(f,t.target||t.srcElement);i&&null!=i.hintId&&(s.changeActive(i.hintId),s.pick())}),t.on(f,"click",function(t){var i=r(f,t.target||t.srcElement);i&&null!=i.hintId&&(s.changeActive(i.hintId),n.options.completeOnSingleClick&&s.pick())}),t.on(f,"mousedown",function(){setTimeout(function(){l.focus()},20)}),this.scrollToActive(),t.signal(o,"select",p[this.selectedHint],f.childNodes[this.selectedHint]),!0}function h(t,i,e,n){if(t.async)t(i,n,e);else{var o=t(i,e);o&&o.then?o.then(n):n(o)}}n.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&t.signal(this.data,"close"),this.widget&&this.widget.close(),t.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(i,e){var n=i.list[e];n.hint?n.hint(this.cm,i,n):this.cm.replaceRange(c(n),n.from||i.from,n.to||i.to,"complete"),t.signal(i,"pick",n),this.close()},cursorActivity:function(){this.debounce&&(s(this.debounce),this.debounce=0);var t=this.cm.getCursor(),i=this.cm.getLine(t.line);if(t.line!=this.startPos.line||i.length-t.ch!=this.startLen-this.startPos.ch||t.ch<this.startPos.ch||this.cm.somethingSelected()||!t.ch||this.options.closeCharacters.test(i.charAt(t.ch-1)))this.close();else{var e=this;this.debounce=o(function(){e.update()}),this.widget&&this.widget.disable()}},update:function(t){if(null!=this.tick){var i=this,e=++this.tick;h(this.options.hint,this.cm,this.options,function(n){i.tick==e&&i.finishUpdate(n,t)})}},finishUpdate:function(i,e){this.data&&t.signal(this.data,"update");var n=this.widget&&this.widget.picked||e&&this.options.completeSingle;this.widget&&this.widget.close(),this.data=i,i&&i.list.length&&(n&&1==i.list.length?this.pick(i,0):(this.widget=new l(this,i),t.signal(i,"shown")))}},l.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var t=this.completion.cm;this.completion.options.closeOnUnfocus&&(t.off("blur",this.onBlur),t.off("focus",this.onFocus)),t.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var t=this;this.keyMap={Enter:function(){t.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(i,n){if(i>=this.data.list.length?i=n?this.data.list.length-1:0:i<0&&(i=n?0:this.data.list.length-1),this.selectedHint!=i){var o=this.hints.childNodes[this.selectedHint];o&&(o.className=o.className.replace(" "+e,"")),(o=this.hints.childNodes[this.selectedHint=i]).className+=" "+e,this.scrollToActive(),t.signal(this.data,"select",this.data.list[this.selectedHint],o)}},scrollToActive:function(){var t=this.hints.childNodes[this.selectedHint];t.offsetTop<this.hints.scrollTop?this.hints.scrollTop=t.offsetTop-3:t.offsetTop+t.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=t.offsetTop+t.offsetHeight-this.hints.clientHeight+3)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},t.registerHelper("hint","auto",{resolve:function(i,e){var n,o=i.getHelpers(e,"hint");if(o.length){var s=function(t,i,e){var n=function(t,i){if(!t.somethingSelected())return i;for(var e=[],n=0;n<i.length;n++)i[n].supportsSelection&&e.push(i[n]);return e}(t,o);!function o(s){if(s==n.length)return i(null);h(n[s],t,e,function(t){t&&t.list.length>0?i(t):o(s+1)})}(0)};return s.async=!0,s.supportsSelection=!0,s}return(n=i.getHelper(i.getCursor(),"hintWords"))?function(i){return t.hint.fromList(i,{words:n})}:t.hint.anyword?function(i,e){return t.hint.anyword(i,e)}:function(){}}}),t.registerHelper("hint","fromList",function(i,e){var n,o=i.getCursor(),s=i.getTokenAt(o),c=t.Pos(o.line,s.start),r=o;s.start<o.ch&&/\w/.test(s.string.charAt(o.ch-s.start-1))?n=s.string.substr(0,o.ch-s.start):(n="",c=o);for(var l=[],h=0;h<e.words.length;h++){var a=e.words[h];a.slice(0,n.length)==n&&l.push(a)}if(l.length)return{list:l,from:c,to:r}}),t.commands.autocomplete=t.showHint;var a={hint:t.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};t.defineOption("hintOptions",null)});

},{"../../lib/codemirror":311}],304:[function(require,module,exports){
!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("./runmode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./runmode"],e):e(CodeMirror)}(function(e){"use strict";var o=/^(p|li|div|h\\d|pre|blockquote|td)$/;function r(e,n){if(3==e.nodeType)return n.push(e.nodeValue);for(var t=e.firstChild;t;t=t.nextSibling)r(t,n),o.test(e.nodeType)&&n.push("\n")}e.colorize=function(o,n){o||(o=document.body.getElementsByTagName("pre"));for(var t=0;t<o.length;++t){var i=o[t],d=i.getAttribute("data-lang")||n;if(d){var u=[];r(i,u),i.innerHTML="",e.runMode(u.join(""),d,i),i.className+=" cm-s-default"}}}});

},{"../../lib/codemirror":311,"./runmode":305}],305:[function(require,module,exports){
!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.runMode=function(t,n,r,o){var a=e.getMode(e.defaults,n),d=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<9);if(r.appendChild){var i=o&&o.tabSize||e.defaults.tabSize,c=r,l=0;c.innerHTML="",r=function(e,t){if("\n"==e)return c.appendChild(document.createTextNode(d?"\r":e)),void(l=0);for(var n="",r=0;;){var o=e.indexOf("\t",r);if(-1==o){n+=e.slice(r),l+=e.length-r;break}l+=o-r,n+=e.slice(r,o);var a=i-l%i;l+=a;for(var u=0;u<a;++u)n+=" ";r=o+1}if(t){var f=c.appendChild(document.createElement("span"));f.className="cm-"+t.replace(/ +/g," cm-"),f.appendChild(document.createTextNode(n))}else c.appendChild(document.createTextNode(n))}}for(var u=e.splitLines(t),f=o&&o.state||e.startState(a),s=0,p=u.length;s<p;++s){s&&r("\n");var m=new e.StringStream(u[s]);for(!m.string&&a.blankLine&&a.blankLine(f);!m.eol();){var v=a.token(m,f);r(m.current(),v,s,m.start,f),m.start=m.pos}}}});

},{"../../lib/codemirror":311}],306:[function(require,module,exports){
!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t,e){function i(t){clearTimeout(n.doRedraw),n.doRedraw=setTimeout(function(){n.redraw()},t)}this.cm=t,this.options=e,this.buttonHeight=e.scrollButtonHeight||t.getOption("scrollButtonHeight"),this.annotations=[],this.doRedraw=this.doUpdate=null,this.div=t.getWrapperElement().appendChild(document.createElement("div")),this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none",this.computeScale();var n=this;t.on("refresh",this.resizeHandler=function(){clearTimeout(n.doUpdate),n.doUpdate=setTimeout(function(){n.computeScale()&&i(20)},100)}),t.on("markerAdded",this.resizeHandler),t.on("markerCleared",this.resizeHandler),!1!==e.listenForChanges&&t.on("changes",this.changeHandler=function(){i(250)})}t.defineExtension("annotateScrollbar",function(t){return"string"==typeof t&&(t={className:t}),new e(this,t)}),t.defineOption("scrollButtonHeight",0),e.prototype.computeScale=function(){var t=this.cm,e=(t.getWrapperElement().clientHeight-t.display.barHeight-2*this.buttonHeight)/t.getScrollerElement().scrollHeight;if(e!=this.hScale)return this.hScale=e,!0},e.prototype.update=function(t){this.annotations=t,this.redraw()},e.prototype.redraw=function(t){!1!==t&&this.computeScale();var e=this.cm,i=this.hScale,n=document.createDocumentFragment(),o=this.annotations,r=e.getOption("lineWrapping"),a=r&&1.5*e.defaultTextHeight(),s=null,h=null;function l(t,i){return s!=t.line&&(s=t.line,h=e.getLineHandle(s)),h.widgets&&h.widgets.length||r&&h.height>a?e.charCoords(t,"local")[i?"top":"bottom"]:e.heightAtLine(h,"local")+(i?0:h.height)}var d=e.lastLine();if(e.display.barWidth)for(var c,p=0;p<o.length;p++){var u=o[p];if(!(u.to.line>d)){for(var f=c||l(u.from,!0)*i,m=l(u.to,!1)*i;p<o.length-1&&!(o[p+1].to.line>d)&&!((c=l(o[p+1].from,!0)*i)>m+.9);)m=l((u=o[++p]).to,!1)*i;if(m!=f){var g=Math.max(m-f,3),H=n.appendChild(document.createElement("div"));H.style.cssText="position: absolute; right: 0px; width: "+Math.max(e.display.barWidth-1,2)+"px; top: "+(f+this.buttonHeight)+"px; height: "+g+"px",H.className=this.options.className,u.id&&H.setAttribute("annotation-id",u.id)}}}this.div.textContent="",this.div.appendChild(n)},e.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler),this.cm.off("markerAdded",this.resizeHandler),this.cm.off("markerCleared",this.resizeHandler),this.changeHandler&&this.cm.off("changes",this.changeHandler),this.div.parentNode.removeChild(this.div)}});

},{"../../lib/codemirror":311}],307:[function(require,module,exports){
!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./matchesonscrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./matchesonscrollbar"],t):t(CodeMirror)}(function(t){"use strict";var e={style:"matchhighlight",minChars:2,delay:100,wordsOnly:!1,annotateScrollbar:!1,showToken:!1,trim:!0};function o(t){var e=t.state.matchHighlighter;(e.active||t.hasFocus())&&n(t,e)}function i(t){var e=t.state.matchHighlighter;e.active||(e.active=!0,n(t,e))}function n(t,e){clearTimeout(e.timeout),e.timeout=setTimeout(function(){s(t)},e.options.delay)}function r(t,e,o,i){var n=t.state.matchHighlighter;if(t.addOverlay(n.overlay=function(t,e,o){return{token:function(i){if(i.match(t)&&(!e||function(t,e){return!(t.start&&e.test(t.string.charAt(t.start-1))||t.pos!=t.string.length&&e.test(t.string.charAt(t.pos)))}(i,e)))return o;i.next(),i.skipTo(t.charAt(0))||i.skipToEnd()}}}(e,o,i)),n.options.annotateScrollbar&&t.showMatchesOnScrollbar){var r=o?new RegExp("\\b"+e.replace(/[\\\[.+*?(){|^$]/g,"\\$&")+"\\b"):e;n.matchesonscroll=t.showMatchesOnScrollbar(r,!1,{className:"CodeMirror-selection-highlight-scrollbar"})}}function a(t){var e=t.state.matchHighlighter;e.overlay&&(t.removeOverlay(e.overlay),e.overlay=null,e.matchesonscroll&&(e.matchesonscroll.clear(),e.matchesonscroll=null))}function s(t){t.operation(function(){var e=t.state.matchHighlighter;if(a(t),t.somethingSelected()||!e.options.showToken){var o=t.getCursor("from"),i=t.getCursor("to");if(o.line==i.line&&(!e.options.wordsOnly||function(t,e,o){if(null!==t.getRange(e,o).match(/^\w+$/)){if(e.ch>0){var i={line:e.line,ch:e.ch-1},n=t.getRange(i,e);if(null===n.match(/\W/))return!1}if(o.ch<t.getLine(e.line).length){var i={line:o.line,ch:o.ch+1},n=t.getRange(o,i);if(null===n.match(/\W/))return!1}return!0}return!1}(t,o,i))){var n=t.getRange(o,i);e.options.trim&&(n=n.replace(/^\s+|\s+$/g,"")),n.length>=e.options.minChars&&r(t,n,!1,e.options.style)}}else{for(var s=!0===e.options.showToken?/[\w$]/:e.options.showToken,c=t.getCursor(),l=t.getLine(c.line),h=c.ch,u=h;h&&s.test(l.charAt(h-1));)--h;for(;u<l.length&&s.test(l.charAt(u));)++u;h<u&&r(t,l.slice(h,u),s,e.options.style)}})}t.defineOption("highlightSelectionMatches",!1,function(n,r,c){if(c&&c!=t.Init&&(a(n),clearTimeout(n.state.matchHighlighter.timeout),n.state.matchHighlighter=null,n.off("cursorActivity",o),n.off("focus",i)),r){var l=n.state.matchHighlighter=new function(t){for(var o in this.options={},e)this.options[o]=(t&&t.hasOwnProperty(o)?t:e)[o];this.overlay=this.timeout=null,this.matchesonscroll=null,this.active=!1}(r);n.hasFocus()?(l.active=!0,s(n)):n.on("focus",i),n.on("cursorActivity",o)}})});

},{"../../lib/codemirror":311,"./matchesonscrollbar":308}],308:[function(require,module,exports){
!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./searchcursor"),require("../scroll/annotatescrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../scroll/annotatescrollbar"],t):t(CodeMirror)}(function(t){"use strict";function e(t,e,i,o){this.cm=t,this.options=o;var a={listenForChanges:!1};for(var n in o)a[n]=o[n];a.className||(a.className="CodeMirror-search-match"),this.annotation=t.annotateScrollbar(a),this.query=e,this.caseFold=i,this.gap={from:t.firstLine(),to:t.lastLine()+1},this.matches=[],this.update=null,this.findMatches(),this.annotation.update(this.matches);var s=this;t.on("change",this.changeHandler=function(t,e){s.onChange(e)})}t.defineExtension("showMatchesOnScrollbar",function(t,i,o){return"string"==typeof o&&(o={className:o}),o||(o={}),new e(this,t,i,o)});function i(t,e,i){return t<=e?t:Math.max(e,t+i)}e.prototype.findMatches=function(){if(this.gap){for(var e=0;e<this.matches.length;e++){if((a=this.matches[e]).from.line>=this.gap.to)break;a.to.line>=this.gap.from&&this.matches.splice(e--,1)}for(var i=this.cm.getSearchCursor(this.query,t.Pos(this.gap.from,0),{caseFold:this.caseFold,multiline:this.options.multiline}),o=this.options&&this.options.maxMatches||1e3;i.findNext();){var a;if((a={from:i.from(),to:i.to()}).from.line>=this.gap.to)break;if(this.matches.splice(e++,0,a),this.matches.length>o)break}this.gap=null}},e.prototype.onChange=function(e){var o=e.from.line,a=t.changeEnd(e).line,n=a-e.to.line;if(this.gap?(this.gap.from=Math.min(i(this.gap.from,o,n),e.from.line),this.gap.to=Math.max(i(this.gap.to,o,n),e.from.line)):this.gap={from:e.from.line,to:a+1},n)for(var s=0;s<this.matches.length;s++){var r=this.matches[s],h=i(r.from.line,o,n);h!=r.from.line&&(r.from=t.Pos(h,r.from.ch));var c=i(r.to.line,o,n);c!=r.to.line&&(r.to=t.Pos(c,r.to.ch))}clearTimeout(this.update);var f=this;this.update=setTimeout(function(){f.updateAfterChange()},250)},e.prototype.updateAfterChange=function(){this.findMatches(),this.annotation.update(this.matches)},e.prototype.clear=function(){this.cm.off("change",this.changeHandler),this.annotation.clear()}});

},{"../../lib/codemirror":311,"../scroll/annotatescrollbar":306,"./searchcursor":309}],309:[function(require,module,exports){
!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";var n,e,r=t.Pos;function i(t,n){for(var e=function(t){var n=t.flags;return null!=n?n:(t.ignoreCase?"i":"")+(t.global?"g":"")+(t.multiline?"m":"")}(t),r=e,i=0;i<n.length;i++)-1==r.indexOf(n.charAt(i))&&(r+=n.charAt(i));return e==r?t:new RegExp(t.source,r)}function o(t){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(t.source)}function l(t,n,e){n=i(n,"g");for(var o=e.line,l=e.ch,h=t.lastLine();o<=h;o++,l=0){n.lastIndex=l;var s=t.getLine(o),f=n.exec(s);if(f)return{from:r(o,f.index),to:r(o,f.index+f[0].length),match:f}}}function h(t,n,e){for(var r,i=0;i<=t.length;){n.lastIndex=i;var o=n.exec(t);if(!o)break;var l=o.index+o[0].length;if(l>t.length-e)break;(!r||l>r.index+r[0].length)&&(r=o),i=o.index+1}return r}function s(t,n,e){n=i(n,"g");for(var o=e.line,l=e.ch,s=t.firstLine();o>=s;o--,l=-1){var f=t.getLine(o),c=h(f,n,l<0?0:f.length-l);if(c)return{from:r(o,c.index),to:r(o,c.index+c[0].length),match:c}}}function f(t,n,e,r){if(t.length==n.length)return e;for(var i=0,o=e+Math.max(0,t.length-n.length);;){if(i==o)return i;var l=i+o>>1,h=r(t.slice(0,l)).length;if(h==e)return l;h>e?o=l:i=l+1}}function c(t,c,u,a){var g;this.atOccurrence=!1,this.doc=t,u=u?t.clipPos(u):r(0,0),this.pos={from:u,to:u},"object"==typeof a?g=a.caseFold:(g=a,a=null),"string"==typeof c?(null==g&&(g=!1),this.matches=function(i,o){return(i?function(t,i,o,l){if(!i.length)return null;var h=l?n:e,s=h(i).split(/\r|\n\r?/);t:for(var c=o.line,u=o.ch,a=t.firstLine()-1+s.length;c>=a;c--,u=-1){var g=t.getLine(c);u>-1&&(g=g.slice(0,u));var m=h(g);if(1==s.length){var d=m.lastIndexOf(s[0]);if(-1==d)continue t;return{from:r(c,f(g,m,d,h)),to:r(c,f(g,m,d+s[0].length,h))}}var v=s[s.length-1];if(m.slice(0,v.length)==v){var p=1;for(o=c-s.length+1;p<s.length-1;p++)if(h(t.getLine(o+p))!=s[p])continue t;var x=t.getLine(c+1-s.length),L=h(x);if(L.slice(L.length-s[0].length)==s[0])return{from:r(c+1-s.length,f(x,L,x.length-s[0].length,h)),to:r(c,f(g,m,v.length,h))}}}}:function(t,i,o,l){if(!i.length)return null;var h=l?n:e,s=h(i).split(/\r|\n\r?/);t:for(var c=o.line,u=o.ch,a=t.lastLine()+1-s.length;c<=a;c++,u=0){var g=t.getLine(c).slice(u),m=h(g);if(1==s.length){var d=m.indexOf(s[0]);if(-1==d)continue t;return o=f(g,m,d,h)+u,{from:r(c,f(g,m,d,h)+u),to:r(c,f(g,m,d+s[0].length,h)+u)}}var v=m.length-s[0].length;if(m.slice(v)==s[0]){for(var p=1;p<s.length-1;p++)if(h(t.getLine(c+p))!=s[p])continue t;var x=t.getLine(c+s.length-1),L=h(x),C=s[s.length-1];if(L.slice(0,C.length)==C)return{from:r(c,f(g,m,v,h)+u),to:r(c+s.length-1,f(x,L,C.length,h))}}}})(t,c,o,g)}):(c=i(c,"gm"),a&&!1===a.multiline?this.matches=function(n,e){return(n?s:l)(t,c,e)}:this.matches=function(n,e){return(n?function(t,n,e){if(!o(n))return s(t,n,e);n=i(n,"gm");for(var l,f=1,c=t.getLine(e.line).length-e.ch,u=e.line,a=t.firstLine();u>=a;){for(var g=0;g<f&&u>=a;g++){var m=t.getLine(u--);l=null==l?m:m+"\n"+l}f*=2;var d=h(l,n,c);if(d){var v=l.slice(0,d.index).split("\n"),p=d[0].split("\n"),x=u+v.length,L=v[v.length-1].length;return{from:r(x,L),to:r(x+p.length-1,1==p.length?L+p[0].length:p[p.length-1].length),match:d}}}}:function(t,n,e){if(!o(n))return l(t,n,e);n=i(n,"gm");for(var h,s=1,f=e.line,c=t.lastLine();f<=c;){for(var u=0;u<s&&!(f>c);u++){var a=t.getLine(f++);h=null==h?a:h+"\n"+a}s*=2,n.lastIndex=e.ch;var g=n.exec(h);if(g){var m=h.slice(0,g.index).split("\n"),d=g[0].split("\n"),v=e.line+m.length-1,p=m[m.length-1].length;return{from:r(v,p),to:r(v+d.length-1,1==d.length?p+d[0].length:d[d.length-1].length),match:g}}}})(t,c,e)})}String.prototype.normalize?(n=function(t){return t.normalize("NFD").toLowerCase()},e=function(t){return t.normalize("NFD")}):(n=function(t){return t.toLowerCase()},e=function(t){return t}),c.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(n){for(var e=this.matches(n,this.doc.clipPos(n?this.pos.from:this.pos.to));e&&0==t.cmpPos(e.from,e.to);)n?e.from.ch?e.from=r(e.from.line,e.from.ch-1):e=e.from.line==this.doc.firstLine()?null:this.matches(n,this.doc.clipPos(r(e.from.line-1))):e.to.ch<this.doc.getLine(e.to.line).length?e.to=r(e.to.line,e.to.ch+1):e=e.to.line==this.doc.lastLine()?null:this.matches(n,r(e.to.line+1,0));if(e)return this.pos=e,this.atOccurrence=!0,this.pos.match||!0;var i=r(n?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:i,to:i},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(n,e){if(this.atOccurrence){var i=t.splitLines(n);this.doc.replaceRange(i,this.pos.from,this.pos.to,e),this.pos.to=r(this.pos.from.line+i.length-1,i[i.length-1].length+(1==i.length?this.pos.from.ch:0))}}},t.defineExtension("getSearchCursor",function(t,n,e){return new c(this.doc,t,n,e)}),t.defineDocExtension("getSearchCursor",function(t,n,e){return new c(this,t,n,e)}),t.defineExtension("selectMatches",function(n,e){for(var r=[],i=this.getSearchCursor(n,this.getCursor("from"),e);i.findNext()&&!(t.cmpPos(i.to(),this.getCursor("to"))>0);)r.push({anchor:i.from(),head:i.to()});r.length&&this.setSelections(r,0)})});

},{"../../lib/codemirror":311}],310:[function(require,module,exports){
!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e){e.state.markedSelection&&e.operation(function(){!function(e){if(!e.somethingSelected())return f(e);if(e.listSelections().length>1)return c(e);var t=e.getCursor("start"),n=e.getCursor("end"),r=e.state.markedSelection;if(!r.length)return l(e,t,n);var a=r[0].find(),s=r[r.length-1].find();if(!a||!s||n.line-t.line<=o||i(t,s.to)>=0||i(n,a.from)<=0)return c(e);for(;i(t,a.from)>0;)r.shift().clear(),a=r[0].find();i(t,a.from)<0&&(a.to.line-t.line<o?(r.shift().clear(),l(e,t,a.to,0)):l(e,t,a.from,0));for(;i(n,s.to)<0;)r.pop().clear(),s=r[r.length-1].find();i(n,s.to)>0&&(n.line-s.from.line<o?(r.pop().clear(),l(e,s.from,n)):l(e,s.to,n))}(e)})}function n(e){e.state.markedSelection&&e.state.markedSelection.length&&e.operation(function(){f(e)})}e.defineOption("styleSelectedText",!1,function(o,r,i){var l=i&&i!=e.Init;r&&!l?(o.state.markedSelection=[],o.state.markedSelectionStyle="string"==typeof r?r:"CodeMirror-selectedtext",c(o),o.on("cursorActivity",t),o.on("change",n)):!r&&l&&(o.off("cursorActivity",t),o.off("change",n),f(o),o.state.markedSelection=o.state.markedSelectionStyle=null)});var o=8,r=e.Pos,i=e.cmpPos;function l(e,t,n,l){if(0!=i(t,n))for(var f=e.state.markedSelection,c=e.state.markedSelectionStyle,a=t.line;;){var s=a==t.line?t:r(a,0),d=a+o,m=d>=n.line,u=m?n:r(d,0),S=e.markText(s,u,{className:c});if(null==l?f.push(S):f.splice(l++,0,S),m)break;a=d}}function f(e){for(var t=e.state.markedSelection,n=0;n<t.length;++n)t[n].clear();t.length=0}function c(e){f(e);for(var t=e.listSelections(),n=0;n<t.length;n++)l(e,t[n].from(),t[n].to())}});

},{"../../lib/codemirror":311}],311:[function(require,module,exports){
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).CodeMirror=t()}(this,function(){"use strict";var e=navigator.userAgent,t=navigator.platform,r=/gecko\/\d/i.test(e),n=/MSIE \d/.test(e),i=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e),o=/Edge\/(\d+)/.exec(e),l=n||i||o,s=l&&(n?document.documentMode||6:+(o||i)[1]),a=!o&&/WebKit\//.test(e),u=a&&/Qt\/\d+\.\d+/.test(e),c=!o&&/Chrome\//.test(e),h=/Opera\//.test(e),f=/Apple Computer/.test(navigator.vendor),d=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),p=/PhantomJS/.test(e),g=!o&&/AppleWebKit/.test(e)&&/Mobile\/\w+/.test(e),v=/Android/.test(e),m=g||v||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),y=g||/Mac/.test(t),b=/\bCrOS\b/.test(e),w=/win/i.test(t),x=h&&e.match(/Version\/(\d*\.\d*)/);x&&(x=Number(x[1])),x&&x>=15&&(h=!1,a=!0);var C=y&&(u||h&&(null==x||x<12.11)),S=r||l&&s>=9;function L(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var k,T=function(e,t){var r=e.className,n=L(t).exec(r);if(n){var i=r.slice(n.index+n[0].length);e.className=r.slice(0,n.index)+(i?n[1]+i:"")}};function M(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function N(e,t){return M(e).appendChild(t)}function O(e,t,r,n){var i=document.createElement(e);if(r&&(i.className=r),n&&(i.style.cssText=n),"string"==typeof t)i.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)i.appendChild(t[o]);return i}function A(e,t,r,n){var i=O(e,t,r,n);return i.setAttribute("role","presentation"),i}function D(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function W(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function H(e,t){var r=e.className;L(t).test(r)||(e.className+=(r?" ":"")+t)}function F(e,t){for(var r=e.split(" "),n=0;n<r.length;n++)r[n]&&!L(r[n]).test(t)&&(t+=" "+r[n]);return t}k=document.createRange?function(e,t,r,n){var i=document.createRange();return i.setEnd(n||e,r),i.setStart(e,t),i}:function(e,t,r){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(e){return n}return n.collapse(!0),n.moveEnd("character",r),n.moveStart("character",t),n};var P=function(e){e.select()};function E(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function I(e,t,r){for(var n in t||(t={}),e)!e.hasOwnProperty(n)||!1===r&&t.hasOwnProperty(n)||(t[n]=e[n]);return t}function z(e,t,r,n,i){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=n||0,l=i||0;;){var s=e.indexOf("\t",o);if(s<0||s>=t)return l+(t-o);l+=s-o,l+=r-l%r,o=s+1}}g?P=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:l&&(P=function(e){try{e.select()}catch(e){}});var R=function(){this.id=null,this.f=null,this.time=0,this.handler=E(this.onTimeout,this)};function B(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}R.prototype.onTimeout=function(e){e.id=0,e.time<=+new Date?e.f():setTimeout(e.handler,e.time-+new Date)},R.prototype.set=function(e,t){this.f=t;var r=+new Date+e;(!this.id||r<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,e),this.time=r)};var G=30,U={toString:function(){return"CodeMirror.Pass"}},V={scroll:!1},K={origin:"*mouse"},j={origin:"+move"};function X(e,t,r){for(var n=0,i=0;;){var o=e.indexOf("\t",n);-1==o&&(o=e.length);var l=o-n;if(o==e.length||i+l>=t)return n+Math.min(l,t-i);if(i+=o-n,n=o+1,(i+=r-i%r)>=t)return n}}var Y=[""];function _(e){for(;Y.length<=e;)Y.push($(Y)+" ");return Y[e]}function $(e){return e[e.length-1]}function q(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=t(e[n],n);return r}function Z(){}function Q(e,t){var r;return Object.create?r=Object.create(e):(Z.prototype=e,r=new Z),t&&I(t,r),r}var J=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function ee(e){return/\w/.test(e)||e>"Â"&&(e.toUpperCase()!=e.toLowerCase()||J.test(e))}function te(e,t){return t?!!(t.source.indexOf("\\w")>-1&&ee(e))||t.test(e):ee(e)}function re(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}var ne=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function ie(e){return e.charCodeAt(0)>=768&&ne.test(e)}function oe(e,t,r){for(;(r<0?t>0:t<e.length)&&ie(e.charAt(t));)t+=r;return t}function le(e,t,r){for(var n=t>r?-1:1;;){if(t==r)return t;var i=(t+r)/2,o=n<0?Math.ceil(i):Math.floor(i);if(o==t)return e(o)?t:r;e(o)?r=o:t=o+n}}var se=null;function ae(e,t,r){var n;se=null;for(var i=0;i<e.length;++i){var o=e[i];if(o.from<t&&o.to>t)return i;o.to==t&&(o.from!=o.to&&"before"==r?n=i:se=i),o.from==t&&(o.from!=o.to&&"before"!=r?n=i:se=i)}return null!=n?n:se}var ue=function(){var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",t="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";var r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,n=/[stwN]/,i=/[LRr]/,o=/[Lb1n]/,l=/[1n]/;function s(e,t,r){this.level=e,this.from=t,this.to=r}return function(a,u){var c="ltr"==u?"L":"R";if(0==a.length||"ltr"==u&&!r.test(a))return!1;for(var h,f=a.length,d=[],p=0;p<f;++p)d.push((h=a.charCodeAt(p))<=247?e.charAt(h):1424<=h&&h<=1524?"R":1536<=h&&h<=1785?t.charAt(h-1536):1774<=h&&h<=2220?"r":8192<=h&&h<=8203?"w":8204==h?"b":"L");for(var g=0,v=c;g<f;++g){var m=d[g];"m"==m?d[g]=v:v=m}for(var y=0,b=c;y<f;++y){var w=d[y];"1"==w&&"r"==b?d[y]="n":i.test(w)&&(b=w,"r"==w&&(d[y]="R"))}for(var x=1,C=d[0];x<f-1;++x){var S=d[x];"+"==S&&"1"==C&&"1"==d[x+1]?d[x]="1":","!=S||C!=d[x+1]||"1"!=C&&"n"!=C||(d[x]=C),C=S}for(var L=0;L<f;++L){var k=d[L];if(","==k)d[L]="N";else if("%"==k){var T=void 0;for(T=L+1;T<f&&"%"==d[T];++T);for(var M=L&&"!"==d[L-1]||T<f&&"1"==d[T]?"1":"N",N=L;N<T;++N)d[N]=M;L=T-1}}for(var O=0,A=c;O<f;++O){var D=d[O];"L"==A&&"1"==D?d[O]="L":i.test(D)&&(A=D)}for(var W=0;W<f;++W)if(n.test(d[W])){var H=void 0;for(H=W+1;H<f&&n.test(d[H]);++H);for(var F="L"==(W?d[W-1]:c),P=F==("L"==(H<f?d[H]:c))?F?"L":"R":c,E=W;E<H;++E)d[E]=P;W=H-1}for(var I,z=[],R=0;R<f;)if(o.test(d[R])){var B=R;for(++R;R<f&&o.test(d[R]);++R);z.push(new s(0,B,R))}else{var G=R,U=z.length,V="rtl"==u?1:0;for(++R;R<f&&"L"!=d[R];++R);for(var K=G;K<R;)if(l.test(d[K])){G<K&&(z.splice(U,0,new s(1,G,K)),U+=V);var j=K;for(++K;K<R&&l.test(d[K]);++K);z.splice(U,0,new s(2,j,K)),U+=V,G=K}else++K;G<R&&z.splice(U,0,new s(1,G,R))}return"ltr"==u&&(1==z[0].level&&(I=a.match(/^\s+/))&&(z[0].from=I[0].length,z.unshift(new s(0,0,I[0].length))),1==$(z).level&&(I=a.match(/\s+$/))&&($(z).to-=I[0].length,z.push(new s(0,f-I[0].length,f)))),"rtl"==u?z.reverse():z}}();function ce(e,t){var r=e.order;return null==r&&(r=e.order=ue(e.text,t)),r}var he=[],fe=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||he).concat(r)}};function de(e,t){return e._handlers&&e._handlers[t]||he}function pe(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var n=e._handlers,i=n&&n[t];if(i){var o=B(i,r);o>-1&&(n[t]=i.slice(0,o).concat(i.slice(o+1)))}}}function ge(e,t){var r=de(e,t);if(r.length)for(var n=Array.prototype.slice.call(arguments,2),i=0;i<r.length;++i)r[i].apply(null,n)}function ve(e,t,r){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),ge(e,r||t.type,e,t),Ce(t)||t.codemirrorIgnore}function me(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)-1==B(r,t[n])&&r.push(t[n])}function ye(e,t){return de(e,t).length>0}function be(e){e.prototype.on=function(e,t){fe(this,e,t)},e.prototype.off=function(e,t){pe(this,e,t)}}function we(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function xe(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function Ce(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Se(e){we(e),xe(e)}function Le(e){return e.target||e.srcElement}function ke(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),y&&e.ctrlKey&&1==t&&(t=3),t}var Te,Me,Ne=function(){if(l&&s<9)return!1;var e=O("div");return"draggable"in e||"dragDrop"in e}();function Oe(e){if(null==Te){var t=O("span","â");N(e,O("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Te=t.offsetWidth<=1&&t.offsetHeight>2&&!(l&&s<8))}var r=Te?O("span","â"):O("span","Â ",null,"display: inline-block; width: 1px; margin-right: -1px");return r.setAttribute("cm-text",""),r}function Ae(e){if(null!=Me)return Me;var t=N(e,document.createTextNode("AØ®A")),r=k(t,0,1).getBoundingClientRect(),n=k(t,1,2).getBoundingClientRect();return M(e),!(!r||r.left==r.right)&&(Me=n.right-r.right<3)}var De,We=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,r=[],n=e.length;t<=n;){var i=e.indexOf("\n",t);-1==i&&(i=e.length);var o=e.slice(t,"\r"==e.charAt(i-1)?i-1:i),l=o.indexOf("\r");-1!=l?(r.push(o.slice(0,l)),t+=l+1):(r.push(o),t=i+1)}return r}:function(e){return e.split(/\r\n?|\n/)},He=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},Fe="oncopy"in(De=O("div"))||(De.setAttribute("oncopy","return;"),"function"==typeof De.oncopy),Pe=null;var Ee={},Ie={};function ze(e){if("string"==typeof e&&Ie.hasOwnProperty(e))e=Ie[e];else if(e&&"string"==typeof e.name&&Ie.hasOwnProperty(e.name)){var t=Ie[e.name];"string"==typeof t&&(t={name:t}),(e=Q(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return ze("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return ze("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Re(e,t){t=ze(t);var r=Ee[t.name];if(!r)return Re(e,"text/plain");var n=r(e,t);if(Be.hasOwnProperty(t.name)){var i=Be[t.name];for(var o in i)i.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=i[o])}if(n.name=t.name,t.helperType&&(n.helperType=t.helperType),t.modeProps)for(var l in t.modeProps)n[l]=t.modeProps[l];return n}var Be={};function Ge(e,t){I(t,Be.hasOwnProperty(e)?Be[e]:Be[e]={})}function Ue(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var r={};for(var n in t){var i=t[n];i instanceof Array&&(i=i.concat([])),r[n]=i}return r}function Ve(e,t){for(var r;e.innerMode&&(r=e.innerMode(t))&&r.mode!=e;)t=r.state,e=r.mode;return r||{mode:e,state:t}}function Ke(e,t,r){return!e.startState||e.startState(t,r)}var je=function(e,t,r){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=r};function Xe(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var r=e;!r.lines;)for(var n=0;;++n){var i=r.children[n],o=i.chunkSize();if(t<o){r=i;break}t-=o}return r.lines[t]}function Ye(e,t,r){var n=[],i=t.line;return e.iter(t.line,r.line+1,function(e){var o=e.text;i==r.line&&(o=o.slice(0,r.ch)),i==t.line&&(o=o.slice(t.ch)),n.push(o),++i}),n}function _e(e,t,r){var n=[];return e.iter(t,r,function(e){n.push(e.text)}),n}function $e(e,t){var r=t-e.height;if(r)for(var n=e;n;n=n.parent)n.height+=r}function qe(e){if(null==e.parent)return null;for(var t=e.parent,r=B(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var i=0;n.children[i]!=t;++i)r+=n.children[i].chunkSize();return r+t.first}function Ze(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var i=e.children[n],o=i.height;if(t<o){e=i;continue e}t-=o,r+=i.chunkSize()}return r}while(!e.lines);for(var l=0;l<e.lines.length;++l){var s=e.lines[l].height;if(t<s)break;t-=s}return r+l}function Qe(e,t){return t>=e.first&&t<e.first+e.size}function Je(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function et(e,t,r){if(void 0===r&&(r=null),!(this instanceof et))return new et(e,t,r);this.line=e,this.ch=t,this.sticky=r}function tt(e,t){return e.line-t.line||e.ch-t.ch}function rt(e,t){return e.sticky==t.sticky&&0==tt(e,t)}function nt(e){return et(e.line,e.ch)}function it(e,t){return tt(e,t)<0?t:e}function ot(e,t){return tt(e,t)<0?e:t}function lt(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function st(e,t){if(t.line<e.first)return et(e.first,0);var r=e.first+e.size-1;return t.line>r?et(r,Xe(e,r).text.length):function(e,t){var r=e.ch;return null==r||r>t?et(e.line,t):r<0?et(e.line,0):e}(t,Xe(e,t.line).text.length)}function at(e,t){for(var r=[],n=0;n<t.length;n++)r[n]=st(e,t[n]);return r}je.prototype.eol=function(){return this.pos>=this.string.length},je.prototype.sol=function(){return this.pos==this.lineStart},je.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},je.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},je.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},je.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},je.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},je.prototype.skipToEnd=function(){this.pos=this.string.length},je.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},je.prototype.backUp=function(e){this.pos-=e},je.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=z(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?z(this.string,this.lineStart,this.tabSize):0)},je.prototype.indentation=function(){return z(this.string,null,this.tabSize)-(this.lineStart?z(this.string,this.lineStart,this.tabSize):0)},je.prototype.match=function(e,t,r){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&n.index>0?null:(n&&!1!==t&&(this.pos+=n[0].length),n)}var i=function(e){return r?e.toLowerCase():e};if(i(this.string.substr(this.pos,e.length))==i(e))return!1!==t&&(this.pos+=e.length),!0},je.prototype.current=function(){return this.string.slice(this.start,this.pos)},je.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},je.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},je.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};var ut=function(e,t){this.state=e,this.lookAhead=t},ct=function(e,t,r,n){this.state=t,this.doc=e,this.line=r,this.maxLookAhead=n||0,this.baseTokens=null,this.baseTokenPos=1};function ht(e,t,r,n){var i=[e.state.modeGen],o={};wt(e,t.text,e.doc.mode,r,function(e,t){return i.push(e,t)},o,n);for(var l=r.state,s=function(n){r.baseTokens=i;var s=e.state.overlays[n],a=1,u=0;r.state=!0,wt(e,t.text,s.mode,r,function(e,t){for(var r=a;u<e;){var n=i[a];n>e&&i.splice(a,1,e,i[a+1],n),a+=2,u=Math.min(e,n)}if(t)if(s.opaque)i.splice(r,a-r,e,"overlay "+t),a=r+2;else for(;r<a;r+=2){var o=i[r+1];i[r+1]=(o?o+" ":"")+"overlay "+t}},o),r.state=l,r.baseTokens=null,r.baseTokenPos=1},a=0;a<e.state.overlays.length;++a)s(a);return{styles:i,classes:o.bgClass||o.textClass?o:null}}function ft(e,t,r){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=dt(e,qe(t)),i=t.text.length>e.options.maxHighlightLength&&Ue(e.doc.mode,n.state),o=ht(e,t,n);i&&(n.state=i),t.stateAfter=n.save(!i),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),r===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function dt(e,t,r){var n=e.doc,i=e.display;if(!n.mode.startState)return new ct(n,!0,t);var o=function(e,t,r){for(var n,i,o=e.doc,l=r?-1:t-(e.doc.mode.innerMode?1e3:100),s=t;s>l;--s){if(s<=o.first)return o.first;var a=Xe(o,s-1),u=a.stateAfter;if(u&&(!r||s+(u instanceof ut?u.lookAhead:0)<=o.modeFrontier))return s;var c=z(a.text,null,e.options.tabSize);(null==i||n>c)&&(i=s-1,n=c)}return i}(e,t,r),l=o>n.first&&Xe(n,o-1).stateAfter,s=l?ct.fromSaved(n,l,o):new ct(n,Ke(n.mode),o);return n.iter(o,t,function(r){pt(e,r.text,s);var n=s.line;r.stateAfter=n==t-1||n%5==0||n>=i.viewFrom&&n<i.viewTo?s.save():null,s.nextLine()}),r&&(n.modeFrontier=s.line),s}function pt(e,t,r,n){var i=e.doc.mode,o=new je(t,e.options.tabSize,r);for(o.start=o.pos=n||0,""==t&&gt(i,r.state);!o.eol();)vt(i,o,r.state),o.start=o.pos}function gt(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var r=Ve(e,t);return r.mode.blankLine?r.mode.blankLine(r.state):void 0}}function vt(e,t,r,n){for(var i=0;i<10;i++){n&&(n[0]=Ve(e,r).mode);var o=e.token(t,r);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}ct.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},ct.prototype.baseToken=function(e){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=e;)this.baseTokenPos+=2;var t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}},ct.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},ct.fromSaved=function(e,t,r){return t instanceof ut?new ct(e,Ue(e.mode,t.state),r,t.lookAhead):new ct(e,Ue(e.mode,t),r)},ct.prototype.save=function(e){var t=!1!==e?Ue(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new ut(t,this.maxLookAhead):t};var mt=function(e,t,r){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=r};function yt(e,t,r,n){var i,o,l=e.doc,s=l.mode,a=Xe(l,(t=st(l,t)).line),u=dt(e,t.line,r),c=new je(a.text,e.options.tabSize,u);for(n&&(o=[]);(n||c.pos<t.ch)&&!c.eol();)c.start=c.pos,i=vt(s,c,u.state),n&&o.push(new mt(c,i,Ue(l.mode,u.state)));return n?o:new mt(c,i,u.state)}function bt(e,t){if(e)for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";null==t[n]?t[n]=r[2]:new RegExp("(?:^|s)"+r[2]+"(?:$|s)").test(t[n])||(t[n]+=" "+r[2])}return e}function wt(e,t,r,n,i,o,l){var s=r.flattenSpans;null==s&&(s=e.options.flattenSpans);var a,u=0,c=null,h=new je(t,e.options.tabSize,n),f=e.options.addModeClass&&[null];for(""==t&&bt(gt(r,n.state),o);!h.eol();){if(h.pos>e.options.maxHighlightLength?(s=!1,l&&pt(e,t,n,h.pos),h.pos=t.length,a=null):a=bt(vt(r,h,n.state,f),o),f){var d=f[0].name;d&&(a="m-"+(a?d+" "+a:d))}if(!s||c!=a){for(;u<h.start;)i(u=Math.min(h.start,u+5e3),c);c=a}h.start=h.pos}for(;u<h.pos;){var p=Math.min(h.pos,u+5e3);i(p,c),u=p}}var xt=!1,Ct=!1;function St(e,t,r){this.marker=e,this.from=t,this.to=r}function Lt(e,t){if(e)for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t)return n}}function kt(e,t){for(var r,n=0;n<e.length;++n)e[n]!=t&&(r||(r=[])).push(e[n]);return r}function Tt(e,t){if(t.full)return null;var r=Qe(e,t.from.line)&&Xe(e,t.from.line).markedSpans,n=Qe(e,t.to.line)&&Xe(e,t.to.line).markedSpans;if(!r&&!n)return null;var i=t.from.ch,o=t.to.ch,l=0==tt(t.from,t.to),s=function(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],l=o.marker;if(null==o.from||(l.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==l.type&&(!r||!o.marker.insertLeft)){var s=null==o.to||(l.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new St(l,o.from,s?null:o.to))}}return n}(r,i,l),a=function(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],l=o.marker;if(null==o.to||(l.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==l.type&&(!r||o.marker.insertLeft)){var s=null==o.from||(l.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new St(l,s?null:o.from-t,null==o.to?null:o.to-t))}}return n}(n,o,l),u=1==t.text.length,c=$(t.text).length+(u?i:0);if(s)for(var h=0;h<s.length;++h){var f=s[h];if(null==f.to){var d=Lt(a,f.marker);d?u&&(f.to=null==d.to?null:d.to+c):f.to=i}}if(a)for(var p=0;p<a.length;++p){var g=a[p];if(null!=g.to&&(g.to+=c),null==g.from)Lt(s,g.marker)||(g.from=c,u&&(s||(s=[])).push(g));else g.from+=c,u&&(s||(s=[])).push(g)}s&&(s=Mt(s)),a&&a!=s&&(a=Mt(a));var v=[s];if(!u){var m,y=t.text.length-2;if(y>0&&s)for(var b=0;b<s.length;++b)null==s[b].to&&(m||(m=[])).push(new St(s[b].marker,null,null));for(var w=0;w<y;++w)v.push(m);v.push(a)}return v}function Mt(e){for(var t=0;t<e.length;++t){var r=e[t];null!=r.from&&r.from==r.to&&!1!==r.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function Nt(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}}function Ot(e,t){if(t){for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}}function At(e){return e.inclusiveLeft?-1:0}function Dt(e){return e.inclusiveRight?1:0}function Wt(e,t){var r=e.lines.length-t.lines.length;if(0!=r)return r;var n=e.find(),i=t.find(),o=tt(n.from,i.from)||At(e)-At(t);if(o)return-o;var l=tt(n.to,i.to)||Dt(e)-Dt(t);return l||t.id-e.id}function Ht(e,t){var r,n=Ct&&e.markedSpans;if(n)for(var i=void 0,o=0;o<n.length;++o)(i=n[o]).marker.collapsed&&null==(t?i.from:i.to)&&(!r||Wt(r,i.marker)<0)&&(r=i.marker);return r}function Ft(e){return Ht(e,!0)}function Pt(e){return Ht(e,!1)}function Et(e,t){var r,n=Ct&&e.markedSpans;if(n)for(var i=0;i<n.length;++i){var o=n[i];o.marker.collapsed&&(null==o.from||o.from<t)&&(null==o.to||o.to>t)&&(!r||Wt(r,o.marker)<0)&&(r=o.marker)}return r}function It(e,t,r,n,i){var o=Xe(e,t),l=Ct&&o.markedSpans;if(l)for(var s=0;s<l.length;++s){var a=l[s];if(a.marker.collapsed){var u=a.marker.find(0),c=tt(u.from,r)||At(a.marker)-At(i),h=tt(u.to,n)||Dt(a.marker)-Dt(i);if(!(c>=0&&h<=0||c<=0&&h>=0)&&(c<=0&&(a.marker.inclusiveRight&&i.inclusiveLeft?tt(u.to,r)>=0:tt(u.to,r)>0)||c>=0&&(a.marker.inclusiveRight&&i.inclusiveLeft?tt(u.from,n)<=0:tt(u.from,n)<0)))return!0}}}function zt(e){for(var t;t=Ft(e);)e=t.find(-1,!0).line;return e}function Rt(e,t){var r=Xe(e,t),n=zt(r);return r==n?t:qe(n)}function Bt(e,t){if(t>e.lastLine())return t;var r,n=Xe(e,t);if(!Gt(e,n))return t;for(;r=Pt(n);)n=r.find(1,!0).line;return qe(n)+1}function Gt(e,t){var r=Ct&&t.markedSpans;if(r)for(var n=void 0,i=0;i<r.length;++i)if((n=r[i]).marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&Ut(e,t,n))return!0}}function Ut(e,t,r){if(null==r.to){var n=r.marker.find(1,!0);return Ut(e,n.line,Lt(n.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length)return!0;for(var i=void 0,o=0;o<t.markedSpans.length;++o)if((i=t.markedSpans[o]).marker.collapsed&&!i.marker.widgetNode&&i.from==r.to&&(null==i.to||i.to!=r.from)&&(i.marker.inclusiveLeft||r.marker.inclusiveRight)&&Ut(e,t,i))return!0}function Vt(e){for(var t=0,r=(e=zt(e)).parent,n=0;n<r.lines.length;++n){var i=r.lines[n];if(i==e)break;t+=i.height}for(var o=r.parent;o;o=(r=o).parent)for(var l=0;l<o.children.length;++l){var s=o.children[l];if(s==r)break;t+=s.height}return t}function Kt(e){if(0==e.height)return 0;for(var t,r=e.text.length,n=e;t=Ft(n);){var i=t.find(0,!0);n=i.from.line,r+=i.from.ch-i.to.ch}for(n=e;t=Pt(n);){var o=t.find(0,!0);r-=n.text.length-o.from.ch,r+=(n=o.to.line).text.length-o.to.ch}return r}function jt(e){var t=e.display,r=e.doc;t.maxLine=Xe(r,r.first),t.maxLineLength=Kt(t.maxLine),t.maxLineChanged=!0,r.iter(function(e){var r=Kt(e);r>t.maxLineLength&&(t.maxLineLength=r,t.maxLine=e)})}var Xt=function(e,t,r){this.text=e,Ot(this,t),this.height=r?r(this):1};function Yt(e){e.parent=null,Nt(e)}Xt.prototype.lineNo=function(){return qe(this)},be(Xt);var _t={},$t={};function qt(e,t){if(!e||/^\s*$/.test(e))return null;var r=t.addModeClass?$t:_t;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function Zt(e,t){var r=A("span",null,null,a?"padding-right: .1px":null),n={pre:A("pre",[r],"CodeMirror-line"),content:r,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(var i=0;i<=(t.rest?t.rest.length:0);i++){var o=i?t.rest[i-1]:t.line,l=void 0;n.pos=0,n.addToken=Jt,Ae(e.display.measure)&&(l=ce(o,e.doc.direction))&&(n.addToken=er(n.addToken,l)),n.map=[],rr(o,n,ft(e,o,t!=e.display.externalMeasured&&qe(o))),o.styleClasses&&(o.styleClasses.bgClass&&(n.bgClass=F(o.styleClasses.bgClass,n.bgClass||"")),o.styleClasses.textClass&&(n.textClass=F(o.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(Oe(e.display.measure))),0==i?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(a){var s=n.content.lastChild;(/\bcm-tab\b/.test(s.className)||s.querySelector&&s.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return ge(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=F(n.pre.className,n.textClass||"")),n}function Qt(e){var t=O("span","â¢","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function Jt(e,t,r,n,i,o,a){if(t){var u,c=e.splitSpaces?function(e,t){if(e.length>1&&!/  /.test(e))return e;for(var r=t,n="",i=0;i<e.length;i++){var o=e.charAt(i);" "!=o||!r||i!=e.length-1&&32!=e.charCodeAt(i+1)||(o="Â "),n+=o,r=" "==o}return n}(t,e.trailingSpace):t,h=e.cm.state.specialChars,f=!1;if(h.test(t)){u=document.createDocumentFragment();for(var d=0;;){h.lastIndex=d;var p=h.exec(t),g=p?p.index-d:t.length-d;if(g){var v=document.createTextNode(c.slice(d,d+g));l&&s<9?u.appendChild(O("span",[v])):u.appendChild(v),e.map.push(e.pos,e.pos+g,v),e.col+=g,e.pos+=g}if(!p)break;d+=g+1;var m=void 0;if("\t"==p[0]){var y=e.cm.options.tabSize,b=y-e.col%y;(m=u.appendChild(O("span",_(b),"cm-tab"))).setAttribute("role","presentation"),m.setAttribute("cm-text","\t"),e.col+=b}else"\r"==p[0]||"\n"==p[0]?((m=u.appendChild(O("span","\r"==p[0]?"â":"â¤","cm-invalidchar"))).setAttribute("cm-text",p[0]),e.col+=1):((m=e.cm.options.specialCharPlaceholder(p[0])).setAttribute("cm-text",p[0]),l&&s<9?u.appendChild(O("span",[m])):u.appendChild(m),e.col+=1);e.map.push(e.pos,e.pos+1,m),e.pos++}}else e.col+=t.length,u=document.createTextNode(c),e.map.push(e.pos,e.pos+t.length,u),l&&s<9&&(f=!0),e.pos+=t.length;if(e.trailingSpace=32==c.charCodeAt(t.length-1),r||n||i||f||o){var w=r||"";n&&(w+=n),i&&(w+=i);var x=O("span",[u],w,o);if(a)for(var C in a)a.hasOwnProperty(C)&&"style"!=C&&"class"!=C&&x.setAttribute(C,a[C]);return e.content.appendChild(x)}e.content.appendChild(u)}}function er(e,t){return function(r,n,i,o,l,s,a){i=i?i+" cm-force-border":"cm-force-border";for(var u=r.pos,c=u+n.length;;){for(var h=void 0,f=0;f<t.length&&!((h=t[f]).to>u&&h.from<=u);f++);if(h.to>=c)return e(r,n,i,o,l,s,a);e(r,n.slice(0,h.to-u),i,o,null,s,a),o=null,n=n.slice(h.to-u),u=h.to}}}function tr(e,t,r,n){var i=!n&&r.widgetNode;i&&e.map.push(e.pos,e.pos+t,i),!n&&e.cm.display.input.needsContentAttribute&&(i||(i=e.content.appendChild(document.createElement("span"))),i.setAttribute("cm-marker",r.id)),i&&(e.cm.display.input.setUneditable(i),e.content.appendChild(i)),e.pos+=t,e.trailingSpace=!1}function rr(e,t,r){var n=e.markedSpans,i=e.text,o=0;if(n)for(var l,s,a,u,c,h,f,d=i.length,p=0,g=1,v="",m=0;;){if(m==p){a=u=c=s="",f=null,h=null,m=1/0;for(var y=[],b=void 0,w=0;w<n.length;++w){var x=n[w],C=x.marker;if("bookmark"==C.type&&x.from==p&&C.widgetNode)y.push(C);else if(x.from<=p&&(null==x.to||x.to>p||C.collapsed&&x.to==p&&x.from==p)){if(null!=x.to&&x.to!=p&&m>x.to&&(m=x.to,u=""),C.className&&(a+=" "+C.className),C.css&&(s=(s?s+";":"")+C.css),C.startStyle&&x.from==p&&(c+=" "+C.startStyle),C.endStyle&&x.to==m&&(b||(b=[])).push(C.endStyle,x.to),C.title&&((f||(f={})).title=C.title),C.attributes)for(var S in C.attributes)(f||(f={}))[S]=C.attributes[S];C.collapsed&&(!h||Wt(h.marker,C)<0)&&(h=x)}else x.from>p&&m>x.from&&(m=x.from)}if(b)for(var L=0;L<b.length;L+=2)b[L+1]==m&&(u+=" "+b[L]);if(!h||h.from==p)for(var k=0;k<y.length;++k)tr(t,0,y[k]);if(h&&(h.from||0)==p){if(tr(t,(null==h.to?d+1:h.to)-p,h.marker,null==h.from),null==h.to)return;h.to==p&&(h=!1)}}if(p>=d)break;for(var T=Math.min(d,m);;){if(v){var M=p+v.length;if(!h){var N=M>T?v.slice(0,T-p):v;t.addToken(t,N,l?l+a:a,c,p+N.length==m?u:"",s,f)}if(M>=T){v=v.slice(T-p),p=T;break}p=M,c=""}v=i.slice(o,o=r[g++]),l=qt(r[g++],t.cm.options)}}else for(var O=1;O<r.length;O+=2)t.addToken(t,i.slice(o,o=r[O]),qt(r[O+1],t.cm.options))}function nr(e,t,r){this.line=t,this.rest=function(e){for(var t,r;t=Pt(e);)e=t.find(1,!0).line,(r||(r=[])).push(e);return r}(t),this.size=this.rest?qe($(this.rest))-r+1:1,this.node=this.text=null,this.hidden=Gt(e,t)}function ir(e,t,r){for(var n,i=[],o=t;o<r;o=n){var l=new nr(e.doc,Xe(e.doc,o),o);n=o+l.size,i.push(l)}return i}var or=null;var lr=null;function sr(e,t){var r=de(e,t);if(r.length){var n,i=Array.prototype.slice.call(arguments,2);or?n=or.delayedCallbacks:lr?n=lr:(n=lr=[],setTimeout(ar,0));for(var o=function(e){n.push(function(){return r[e].apply(null,i)})},l=0;l<r.length;++l)o(l)}}function ar(){var e=lr;lr=null;for(var t=0;t<e.length;++t)e[t]()}function ur(e,t,r,n){for(var i=0;i<t.changes.length;i++){var o=t.changes[i];"text"==o?fr(e,t):"gutter"==o?pr(e,t,r,n):"class"==o?dr(e,t):"widget"==o&&gr(e,t,n)}t.changes=null}function cr(e){return e.node==e.text&&(e.node=O("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),l&&s<8&&(e.node.style.zIndex=2)),e.node}function hr(e,t){var r=e.display.externalMeasured;return r&&r.line==t.line?(e.display.externalMeasured=null,t.measure=r.measure,r.built):Zt(e,t)}function fr(e,t){var r=t.text.className,n=hr(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,dr(e,t)):r&&(t.text.className=r)}function dr(e,t){!function(e,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(r&&(r+=" CodeMirror-linebackground"),t.background)r?t.background.className=r:(t.background.parentNode.removeChild(t.background),t.background=null);else if(r){var n=cr(t);t.background=n.insertBefore(O("div",null,r),n.firstChild),e.display.input.setUneditable(t.background)}}(e,t),t.line.wrapClass?cr(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function pr(e,t,r,n){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var i=cr(t);t.gutterBackground=O("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px; width: "+n.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),i.insertBefore(t.gutterBackground,t.text)}var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var l=cr(t),s=t.gutter=O("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px");if(e.display.input.setUneditable(s),l.insertBefore(s,t.text),t.line.gutterClass&&(s.className+=" "+t.line.gutterClass),!e.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(t.lineNumber=s.appendChild(O("div",Je(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),o)for(var a=0;a<e.display.gutterSpecs.length;++a){var u=e.display.gutterSpecs[a].className,c=o.hasOwnProperty(u)&&o[u];c&&s.appendChild(O("div",[c],"CodeMirror-gutter-elt","left: "+n.gutterLeft[u]+"px; width: "+n.gutterWidth[u]+"px"))}}}function gr(e,t,r){t.alignable&&(t.alignable=null);for(var n=L("CodeMirror-linewidget"),i=t.node.firstChild,o=void 0;i;i=o)o=i.nextSibling,n.test(i.className)&&t.node.removeChild(i);mr(e,t,r)}function vr(e,t,r,n){var i=hr(e,t);return t.text=t.node=i.pre,i.bgClass&&(t.bgClass=i.bgClass),i.textClass&&(t.textClass=i.textClass),dr(e,t),pr(e,t,r,n),mr(e,t,n),t.node}function mr(e,t,r){if(yr(e,t.line,t,r,!0),t.rest)for(var n=0;n<t.rest.length;n++)yr(e,t.rest[n],t,r,!1)}function yr(e,t,r,n,i){if(t.widgets)for(var o=cr(r),l=0,s=t.widgets;l<s.length;++l){var a=s[l],u=O("div",[a.node],"CodeMirror-linewidget"+(a.className?" "+a.className:""));a.handleMouseEvents||u.setAttribute("cm-ignore-events","true"),br(a,u,r,n),e.display.input.setUneditable(u),i&&a.above?o.insertBefore(u,r.gutter||r.text):o.appendChild(u),sr(a,"redraw")}}function br(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var i=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(i-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=i+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function wr(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!D(document.body,e.node)){var r="position: relative;";e.coverGutter&&(r+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(r+="width: "+t.display.wrapper.clientWidth+"px;"),N(t.display.measure,O("div",[e.node],null,r))}return e.height=e.node.parentNode.offsetHeight}function xr(e,t){for(var r=Le(t);r!=e.wrapper;r=r.parentNode)if(!r||1==r.nodeType&&"true"==r.getAttribute("cm-ignore-events")||r.parentNode==e.sizer&&r!=e.mover)return!0}function Cr(e){return e.lineSpace.offsetTop}function Sr(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Lr(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=N(e.measure,O("pre","x","CodeMirror-line-like")),r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,n={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};return isNaN(n.left)||isNaN(n.right)||(e.cachedPaddingH=n),n}function kr(e){return G-e.display.nativeBarWidth}function Tr(e){return e.display.scroller.clientWidth-kr(e)-e.display.barWidth}function Mr(e){return e.display.scroller.clientHeight-kr(e)-e.display.barHeight}function Nr(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var i=0;i<e.rest.length;i++)if(qe(e.rest[i])>r)return{map:e.measure.maps[i],cache:e.measure.caches[i],before:!0}}function Or(e,t,r,n){return Wr(e,Dr(e,t),r,n)}function Ar(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[an(e,t)];var r=e.display.externalMeasured;return r&&t>=r.lineN&&t<r.lineN+r.size?r:void 0}function Dr(e,t){var r=qe(t),n=Ar(e,r);n&&!n.text?n=null:n&&n.changes&&(ur(e,n,r,rn(e)),e.curOp.forceUpdate=!0),n||(n=function(e,t){var r=qe(t=zt(t)),n=e.display.externalMeasured=new nr(e.doc,t,r);n.lineN=r;var i=n.built=Zt(e,n);return n.text=i.pre,N(e.display.lineMeasure,i.pre),n}(e,t));var i=Nr(n,t,r);return{line:t,view:n,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:!1}}function Wr(e,t,r,n,i){t.before&&(r=-1);var o,a=r+(n||"");return t.cache.hasOwnProperty(a)?o=t.cache[a]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(!function(e,t,r){var n=e.options.lineWrapping,i=n&&Tr(e);if(!t.measure.heights||n&&t.measure.width!=i){var o=t.measure.heights=[];if(n){t.measure.width=i;for(var l=t.text.firstChild.getClientRects(),s=0;s<l.length-1;s++){var a=l[s],u=l[s+1];Math.abs(a.bottom-u.bottom)>2&&o.push((a.bottom+u.top)/2-r.top)}}o.push(r.bottom-r.top)}}(e,t.view,t.rect),t.hasHeights=!0),(o=function(e,t,r,n){var i,o=Pr(t.map,r,n),a=o.node,u=o.start,c=o.end,h=o.collapse;if(3==a.nodeType){for(var f=0;f<4;f++){for(;u&&ie(t.line.text.charAt(o.coverStart+u));)--u;for(;o.coverStart+c<o.coverEnd&&ie(t.line.text.charAt(o.coverStart+c));)++c;if((i=l&&s<9&&0==u&&c==o.coverEnd-o.coverStart?a.parentNode.getBoundingClientRect():Er(k(a,u,c).getClientRects(),n)).left||i.right||0==u)break;c=u,u-=1,h="right"}l&&s<11&&(i=function(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!function(e){if(null!=Pe)return Pe;var t=N(e,O("span","x")),r=t.getBoundingClientRect(),n=k(t,0,1).getBoundingClientRect();return Pe=Math.abs(r.left-n.left)>1}(e))return t;var r=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*r,right:t.right*r,top:t.top*n,bottom:t.bottom*n}}(e.display.measure,i))}else{var d;u>0&&(h=n="right"),i=e.options.lineWrapping&&(d=a.getClientRects()).length>1?d["right"==n?d.length-1:0]:a.getBoundingClientRect()}if(l&&s<9&&!u&&(!i||!i.left&&!i.right)){var p=a.parentNode.getClientRects()[0];i=p?{left:p.left,right:p.left+tn(e.display),top:p.top,bottom:p.bottom}:Fr}for(var g=i.top-t.rect.top,v=i.bottom-t.rect.top,m=(g+v)/2,y=t.view.measure.heights,b=0;b<y.length-1&&!(m<y[b]);b++);var w=b?y[b-1]:0,x=y[b],C={left:("right"==h?i.right:i.left)-t.rect.left,right:("left"==h?i.left:i.right)-t.rect.left,top:w,bottom:x};i.left||i.right||(C.bogus=!0);e.options.singleCursorHeightPerLine||(C.rtop=g,C.rbottom=v);return C}(e,t,r,n)).bogus||(t.cache[a]=o)),{left:o.left,right:o.right,top:i?o.rtop:o.top,bottom:i?o.rbottom:o.bottom}}var Hr,Fr={left:0,right:0,top:0,bottom:0};function Pr(e,t,r){for(var n,i,o,l,s,a,u=0;u<e.length;u+=3)if(s=e[u],a=e[u+1],t<s?(i=0,o=1,l="left"):t<a?o=(i=t-s)+1:(u==e.length-3||t==a&&e[u+3]>t)&&(i=(o=a-s)-1,t>=a&&(l="right")),null!=i){if(n=e[u+2],s==a&&r==(n.insertLeft?"left":"right")&&(l=r),"left"==r&&0==i)for(;u&&e[u-2]==e[u-3]&&e[u-1].insertLeft;)n=e[2+(u-=3)],l="left";if("right"==r&&i==a-s)for(;u<e.length-3&&e[u+3]==e[u+4]&&!e[u+5].insertLeft;)n=e[(u+=3)+2],l="right";break}return{node:n,start:i,end:o,collapse:l,coverStart:s,coverEnd:a}}function Er(e,t){var r=Fr;if("left"==t)for(var n=0;n<e.length&&(r=e[n]).left==r.right;n++);else for(var i=e.length-1;i>=0&&(r=e[i]).left==r.right;i--);return r}function Ir(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function zr(e){e.display.externalMeasure=null,M(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)Ir(e.display.view[t])}function Rr(e){zr(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function Br(){return c&&v?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Gr(){return c&&v?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function Ur(e){var t=0;if(e.widgets)for(var r=0;r<e.widgets.length;++r)e.widgets[r].above&&(t+=wr(e.widgets[r]));return t}function Vr(e,t,r,n,i){if(!i){var o=Ur(t);r.top+=o,r.bottom+=o}if("line"==n)return r;n||(n="local");var l=Vt(t);if("local"==n?l+=Cr(e.display):l-=e.display.viewOffset,"page"==n||"window"==n){var s=e.display.lineSpace.getBoundingClientRect();l+=s.top+("window"==n?0:Gr());var a=s.left+("window"==n?0:Br());r.left+=a,r.right+=a}return r.top+=l,r.bottom+=l,r}function Kr(e,t,r){if("div"==r)return t;var n=t.left,i=t.top;if("page"==r)n-=Br(),i-=Gr();else if("local"==r||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left,i+=o.top}var l=e.display.lineSpace.getBoundingClientRect();return{left:n-l.left,top:i-l.top}}function jr(e,t,r,n,i){return n||(n=Xe(e.doc,t.line)),Vr(e,n,Or(e,n,t.ch,i),r)}function Xr(e,t,r,n,i,o){function l(t,l){var s=Wr(e,i,t,l?"right":"left",o);return l?s.left=s.right:s.right=s.left,Vr(e,n,s,r)}n=n||Xe(e.doc,t.line),i||(i=Dr(e,n));var s=ce(n,e.doc.direction),a=t.ch,u=t.sticky;if(a>=n.text.length?(a=n.text.length,u="before"):a<=0&&(a=0,u="after"),!s)return l("before"==u?a-1:a,"before"==u);function c(e,t,r){var n=1==s[t].level;return l(r?e-1:e,n!=r)}var h=ae(s,a,u),f=se,d=c(a,h,"before"==u);return null!=f&&(d.other=c(a,f,"before"!=u)),d}function Yr(e,t){var r=0;t=st(e.doc,t),e.options.lineWrapping||(r=tn(e.display)*t.ch);var n=Xe(e.doc,t.line),i=Vt(n)+Cr(e.display);return{left:r,right:r,top:i,bottom:i+n.height}}function _r(e,t,r,n,i){var o=et(e,t,r);return o.xRel=i,n&&(o.outside=n),o}function $r(e,t,r){var n=e.doc;if((r+=e.display.viewOffset)<0)return _r(n.first,0,null,-1,-1);var i=Ze(n,r),o=n.first+n.size-1;if(i>o)return _r(n.first+n.size-1,Xe(n,o).text.length,null,1,1);t<0&&(t=0);for(var l=Xe(n,i);;){var s=Jr(e,l,i,t,r),a=Et(l,s.ch+(s.xRel>0||s.outside>0?1:0));if(!a)return s;var u=a.find(1);if(u.line==i)return u;l=Xe(n,i=u.line)}}function qr(e,t,r,n){n-=Ur(t);var i=t.text.length,o=le(function(t){return Wr(e,r,t-1).bottom<=n},i,0);return{begin:o,end:i=le(function(t){return Wr(e,r,t).top>n},o,i)}}function Zr(e,t,r,n){return r||(r=Dr(e,t)),qr(e,t,r,Vr(e,t,Wr(e,r,n),"line").top)}function Qr(e,t,r,n){return!(e.bottom<=r)&&(e.top>r||(n?e.left:e.right)>t)}function Jr(e,t,r,n,i){i-=Vt(t);var o=Dr(e,t),l=Ur(t),s=0,a=t.text.length,u=!0,c=ce(t,e.doc.direction);if(c){var h=(e.options.lineWrapping?function(e,t,r,n,i,o,l){var s=qr(e,t,n,l),a=s.begin,u=s.end;/\s/.test(t.text.charAt(u-1))&&u--;for(var c=null,h=null,f=0;f<i.length;f++){var d=i[f];if(!(d.from>=u||d.to<=a)){var p=1!=d.level,g=Wr(e,n,p?Math.min(u,d.to)-1:Math.max(a,d.from)).right,v=g<o?o-g+1e9:g-o;(!c||h>v)&&(c=d,h=v)}}c||(c=i[i.length-1]);c.from<a&&(c={from:a,to:c.to,level:c.level});c.to>u&&(c={from:c.from,to:u,level:c.level});return c}:function(e,t,r,n,i,o,l){var s=le(function(s){var a=i[s],u=1!=a.level;return Qr(Xr(e,et(r,u?a.to:a.from,u?"before":"after"),"line",t,n),o,l,!0)},0,i.length-1),a=i[s];if(s>0){var u=1!=a.level,c=Xr(e,et(r,u?a.from:a.to,u?"after":"before"),"line",t,n);Qr(c,o,l,!0)&&c.top>l&&(a=i[s-1])}return a})(e,t,r,o,c,n,i);s=(u=1!=h.level)?h.from:h.to-1,a=u?h.to:h.from-1}var f,d,p=null,g=null,v=le(function(t){var r=Wr(e,o,t);return r.top+=l,r.bottom+=l,!!Qr(r,n,i,!1)&&(r.top<=i&&r.left<=n&&(p=t,g=r),!0)},s,a),m=!1;if(g){var y=n-g.left<g.right-n,b=y==u;v=p+(b?0:1),d=b?"after":"before",f=y?g.left:g.right}else{u||v!=a&&v!=s||v++,d=0==v?"after":v==t.text.length?"before":Wr(e,o,v-(u?1:0)).bottom+l<=i==u?"after":"before";var w=Xr(e,et(r,v,d),"line",t,o);f=w.left,m=i<w.top?-1:i>=w.bottom?1:0}return _r(r,v=oe(t.text,v,1),d,m,n-f)}function en(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==Hr){Hr=O("pre",null,"CodeMirror-line-like");for(var t=0;t<49;++t)Hr.appendChild(document.createTextNode("x")),Hr.appendChild(O("br"));Hr.appendChild(document.createTextNode("x"))}N(e.measure,Hr);var r=Hr.offsetHeight/50;return r>3&&(e.cachedTextHeight=r),M(e.measure),r||1}function tn(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=O("span","xxxxxxxxxx"),r=O("pre",[t],"CodeMirror-line-like");N(e.measure,r);var n=t.getBoundingClientRect(),i=(n.right-n.left)/10;return i>2&&(e.cachedCharWidth=i),i||10}function rn(e){for(var t=e.display,r={},n={},i=t.gutters.clientLeft,o=t.gutters.firstChild,l=0;o;o=o.nextSibling,++l){var s=e.display.gutterSpecs[l].className;r[s]=o.offsetLeft+o.clientLeft+i,n[s]=o.clientWidth}return{fixedPos:nn(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function nn(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function on(e){var t=en(e.display),r=e.options.lineWrapping,n=r&&Math.max(5,e.display.scroller.clientWidth/tn(e.display)-3);return function(i){if(Gt(e.doc,i))return 0;var o=0;if(i.widgets)for(var l=0;l<i.widgets.length;l++)i.widgets[l].height&&(o+=i.widgets[l].height);return r?o+(Math.ceil(i.text.length/n)||1)*t:o+t}}function ln(e){var t=e.doc,r=on(e);t.iter(function(e){var t=r(e);t!=e.height&&$e(e,t)})}function sn(e,t,r,n){var i=e.display;if(!r&&"true"==Le(t).getAttribute("cm-not-content"))return null;var o,l,s=i.lineSpace.getBoundingClientRect();try{o=t.clientX-s.left,l=t.clientY-s.top}catch(t){return null}var a,u=$r(e,o,l);if(n&&u.xRel>0&&(a=Xe(e.doc,u.line).text).length==u.ch){var c=z(a,a.length,e.options.tabSize)-a.length;u=et(u.line,Math.max(0,Math.round((o-Lr(e.display).left)/tn(e.display))-c))}return u}function an(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var r=e.display.view,n=0;n<r.length;n++)if((t-=r[n].size)<0)return n}function un(e,t,r,n){null==t&&(t=e.doc.first),null==r&&(r=e.doc.first+e.doc.size),n||(n=0);var i=e.display;if(n&&r<i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>t)&&(i.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=i.viewTo)Ct&&Rt(e.doc,t)<i.viewTo&&hn(e);else if(r<=i.viewFrom)Ct&&Bt(e.doc,r+n)>i.viewFrom?hn(e):(i.viewFrom+=n,i.viewTo+=n);else if(t<=i.viewFrom&&r>=i.viewTo)hn(e);else if(t<=i.viewFrom){var o=fn(e,r,r+n,1);o?(i.view=i.view.slice(o.index),i.viewFrom=o.lineN,i.viewTo+=n):hn(e)}else if(r>=i.viewTo){var l=fn(e,t,t,-1);l?(i.view=i.view.slice(0,l.index),i.viewTo=l.lineN):hn(e)}else{var s=fn(e,t,t,-1),a=fn(e,r,r+n,1);s&&a?(i.view=i.view.slice(0,s.index).concat(ir(e,s.lineN,a.lineN)).concat(i.view.slice(a.index)),i.viewTo+=n):hn(e)}var u=i.externalMeasured;u&&(r<u.lineN?u.lineN+=n:t<u.lineN+u.size&&(i.externalMeasured=null))}function cn(e,t,r){e.curOp.viewChanged=!0;var n=e.display,i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[an(e,t)];if(null!=o.node){var l=o.changes||(o.changes=[]);-1==B(l,r)&&l.push(r)}}}function hn(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function fn(e,t,r,n){var i,o=an(e,t),l=e.display.view;if(!Ct||r==e.doc.first+e.doc.size)return{index:o,lineN:r};for(var s=e.display.viewFrom,a=0;a<o;a++)s+=l[a].size;if(s!=t){if(n>0){if(o==l.length-1)return null;i=s+l[o].size-t,o++}else i=s-t;t+=i,r+=i}for(;Rt(e.doc,r)!=r;){if(o==(n<0?0:l.length-1))return null;r+=n*l[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:r}}function dn(e){for(var t=e.display.view,r=0,n=0;n<t.length;n++){var i=t[n];i.hidden||i.node&&!i.changes||++r}return r}function pn(e){e.display.input.showSelection(e.display.input.prepareSelection())}function gn(e,t){void 0===t&&(t=!0);for(var r=e.doc,n={},i=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),l=0;l<r.sel.ranges.length;l++)if(t||l!=r.sel.primIndex){var s=r.sel.ranges[l];if(!(s.from().line>=e.display.viewTo||s.to().line<e.display.viewFrom)){var a=s.empty();(a||e.options.showCursorWhenSelecting)&&vn(e,s.head,i),a||yn(e,s,o)}}return n}function vn(e,t,r){var n=Xr(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),i=r.appendChild(O("div","Â ","CodeMirror-cursor"));if(i.style.left=n.left+"px",i.style.top=n.top+"px",i.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",n.other){var o=r.appendChild(O("div","Â ","CodeMirror-cursor CodeMirror-secondarycursor"));o.style.display="",o.style.left=n.other.left+"px",o.style.top=n.other.top+"px",o.style.height=.85*(n.other.bottom-n.other.top)+"px"}}function mn(e,t){return e.top-t.top||e.left-t.left}function yn(e,t,r){var n=e.display,i=e.doc,o=document.createDocumentFragment(),l=Lr(e.display),s=l.left,a=Math.max(n.sizerWidth,Tr(e)-n.sizer.offsetLeft)-l.right,u="ltr"==i.direction;function c(e,t,r,n){t<0&&(t=0),t=Math.round(t),n=Math.round(n),o.appendChild(O("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==r?a-e:r)+"px;\n                             height: "+(n-t)+"px"))}function h(t,r,n){var o,l,h=Xe(i,t),f=h.text.length;function d(r,n){return jr(e,et(t,r),"div",h,n)}function p(t,r,n){var i=Zr(e,h,null,t),o="ltr"==r==("after"==n)?"left":"right";return d("after"==n?i.begin:i.end-(/\s/.test(h.text.charAt(i.end-1))?2:1),o)[o]}var g=ce(h,i.direction);return function(e,t,r,n){if(!e)return n(t,r,"ltr",0);for(var i=!1,o=0;o<e.length;++o){var l=e[o];(l.from<r&&l.to>t||t==r&&l.to==t)&&(n(Math.max(l.from,t),Math.min(l.to,r),1==l.level?"rtl":"ltr",o),i=!0)}i||n(t,r,"ltr")}(g,r||0,null==n?f:n,function(e,t,i,h){var v="ltr"==i,m=d(e,v?"left":"right"),y=d(t-1,v?"right":"left"),b=null==r&&0==e,w=null==n&&t==f,x=0==h,C=!g||h==g.length-1;if(y.top-m.top<=3){var S=(u?w:b)&&C,L=(u?b:w)&&x?s:(v?m:y).left,k=S?a:(v?y:m).right;c(L,m.top,k-L,m.bottom)}else{var T,M,N,O;v?(T=u&&b&&x?s:m.left,M=u?a:p(e,i,"before"),N=u?s:p(t,i,"after"),O=u&&w&&C?a:y.right):(T=u?p(e,i,"before"):s,M=!u&&b&&x?a:m.right,N=!u&&w&&C?s:y.left,O=u?p(t,i,"after"):a),c(T,m.top,M-T,m.bottom),m.bottom<y.top&&c(s,m.bottom,null,y.top),c(N,y.top,O-N,y.bottom)}(!o||mn(m,o)<0)&&(o=m),mn(y,o)<0&&(o=y),(!l||mn(m,l)<0)&&(l=m),mn(y,l)<0&&(l=y)}),{start:o,end:l}}var f=t.from(),d=t.to();if(f.line==d.line)h(f.line,f.ch,d.ch);else{var p=Xe(i,f.line),g=Xe(i,d.line),v=zt(p)==zt(g),m=h(f.line,f.ch,v?p.text.length+1:null).end,y=h(d.line,v?0:null,d.ch).start;v&&(m.top<y.top-2?(c(m.right,m.top,null,m.bottom),c(s,y.top,y.left,y.bottom)):c(m.right,m.top,y.left-m.right,m.bottom)),m.bottom<y.top&&c(s,m.bottom,null,y.top)}r.appendChild(o)}function bn(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var r=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function wn(e){e.state.focused||(e.display.input.focus(),Cn(e))}function xn(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,Sn(e))},100)}function Cn(e,t){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(ge(e,"focus",e,t),e.state.focused=!0,H(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),a&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),bn(e))}function Sn(e,t){e.state.delayingBlurEvent||(e.state.focused&&(ge(e,"blur",e,t),e.state.focused=!1,T(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function Ln(e){for(var t=e.display,r=t.lineDiv.offsetTop,n=0;n<t.view.length;n++){var i=t.view[n],o=e.options.lineWrapping,a=void 0,u=0;if(!i.hidden){if(l&&s<8){var c=i.node.offsetTop+i.node.offsetHeight;a=c-r,r=c}else{var h=i.node.getBoundingClientRect();a=h.bottom-h.top,!o&&i.text.firstChild&&(u=i.text.firstChild.getBoundingClientRect().right-h.left-1)}var f=i.line.height-a;if((f>.005||f<-.005)&&($e(i.line,a),kn(i.line),i.rest))for(var d=0;d<i.rest.length;d++)kn(i.rest[d]);if(u>e.display.sizerWidth){var p=Math.ceil(u/tn(e.display));p>e.display.maxLineLength&&(e.display.maxLineLength=p,e.display.maxLine=i.line,e.display.maxLineChanged=!0)}}}}function kn(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t){var r=e.widgets[t],n=r.node.parentNode;n&&(r.height=n.offsetHeight)}}function Tn(e,t,r){var n=r&&null!=r.top?Math.max(0,r.top):e.scroller.scrollTop;n=Math.floor(n-Cr(e));var i=r&&null!=r.bottom?r.bottom:n+e.wrapper.clientHeight,o=Ze(t,n),l=Ze(t,i);if(r&&r.ensure){var s=r.ensure.from.line,a=r.ensure.to.line;s<o?(o=s,l=Ze(t,Vt(Xe(t,s))+e.wrapper.clientHeight)):Math.min(a,t.lastLine())>=l&&(o=Ze(t,Vt(Xe(t,a))-e.wrapper.clientHeight),l=a)}return{from:o,to:Math.max(l,o+1)}}function Mn(e,t){var r=e.display,n=en(e.display);t.top<0&&(t.top=0);var i=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:r.scroller.scrollTop,o=Mr(e),l={};t.bottom-t.top>o&&(t.bottom=t.top+o);var s=e.doc.height+Sr(r),a=t.top<n,u=t.bottom>s-n;if(t.top<i)l.scrollTop=a?0:t.top;else if(t.bottom>i+o){var c=Math.min(t.top,(u?s:t.bottom)-o);c!=i&&(l.scrollTop=c)}var h=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:r.scroller.scrollLeft,f=Tr(e)-(e.options.fixedGutter?r.gutters.offsetWidth:0),d=t.right-t.left>f;return d&&(t.right=t.left+f),t.left<10?l.scrollLeft=0:t.left<h?l.scrollLeft=Math.max(0,t.left-(d?0:10)):t.right>f+h-3&&(l.scrollLeft=t.right+(d?0:10)-f),l}function Nn(e,t){null!=t&&(Dn(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function On(e){Dn(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function An(e,t,r){null==t&&null==r||Dn(e),null!=t&&(e.curOp.scrollLeft=t),null!=r&&(e.curOp.scrollTop=r)}function Dn(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,Wn(e,Yr(e,t.from),Yr(e,t.to),t.margin))}function Wn(e,t,r,n){var i=Mn(e,{left:Math.min(t.left,r.left),top:Math.min(t.top,r.top)-n,right:Math.max(t.right,r.right),bottom:Math.max(t.bottom,r.bottom)+n});An(e,i.scrollLeft,i.scrollTop)}function Hn(e,t){Math.abs(e.doc.scrollTop-t)<2||(r||oi(e,{top:t}),Fn(e,t,!0),r&&oi(e),ei(e,100))}function Fn(e,t,r){t=Math.max(0,Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t)),(e.display.scroller.scrollTop!=t||r)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Pn(e,t,r,n){t=Math.max(0,Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth)),(r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n||(e.doc.scrollLeft=t,ai(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function En(e){var t=e.display,r=t.gutters.offsetWidth,n=Math.round(e.doc.height+Sr(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?r:0,docHeight:n,scrollHeight:n+kr(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:r}}var In=function(e,t,r){this.cm=r;var n=this.vert=O("div",[O("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),i=this.horiz=O("div",[O("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");n.tabIndex=i.tabIndex=-1,e(n),e(i),fe(n,"scroll",function(){n.clientHeight&&t(n.scrollTop,"vertical")}),fe(i,"scroll",function(){i.clientWidth&&t(i.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,l&&s<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};In.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,r=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(r){this.vert.style.display="block",this.vert.style.bottom=t?n+"px":"0";var i=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=r?n+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(r?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:r?n:0,bottom:t?n:0}},In.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},In.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},In.prototype.zeroWidthHack=function(){var e=y&&!d?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new R,this.disableVert=new R},In.prototype.enableZeroWidthBar=function(e,t,r){e.style.pointerEvents="auto",t.set(1e3,function n(){var i=e.getBoundingClientRect();("vert"==r?document.elementFromPoint(i.right-1,(i.top+i.bottom)/2):document.elementFromPoint((i.right+i.left)/2,i.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,n)})},In.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var zn=function(){};function Rn(e,t){t||(t=En(e));var r=e.display.barWidth,n=e.display.barHeight;Bn(e,t);for(var i=0;i<4&&r!=e.display.barWidth||n!=e.display.barHeight;i++)r!=e.display.barWidth&&e.options.lineWrapping&&Ln(e),Bn(e,En(e)),r=e.display.barWidth,n=e.display.barHeight}function Bn(e,t){var r=e.display,n=r.scrollbars.update(t);r.sizer.style.paddingRight=(r.barWidth=n.right)+"px",r.sizer.style.paddingBottom=(r.barHeight=n.bottom)+"px",r.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(r.scrollbarFiller.style.display="block",r.scrollbarFiller.style.height=n.bottom+"px",r.scrollbarFiller.style.width=n.right+"px"):r.scrollbarFiller.style.display="",n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(r.gutterFiller.style.display="block",r.gutterFiller.style.height=n.bottom+"px",r.gutterFiller.style.width=t.gutterWidth+"px"):r.gutterFiller.style.display=""}zn.prototype.update=function(){return{bottom:0,right:0}},zn.prototype.setScrollLeft=function(){},zn.prototype.setScrollTop=function(){},zn.prototype.clear=function(){};var Gn={native:In,null:zn};function Un(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&T(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new Gn[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),fe(t,"mousedown",function(){e.state.focused&&setTimeout(function(){return e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,r){"horizontal"==r?Pn(e,t):Hn(e,t)},e),e.display.scrollbars.addClass&&H(e.display.wrapper,e.display.scrollbars.addClass)}var Vn=0;function Kn(e){var t;e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Vn},t=e.curOp,or?or.ops.push(t):t.ownsGroup=or={ops:[t],delayedCallbacks:[]}}function jn(e){var t=e.curOp;t&&function(e,t){var r=e.ownsGroup;if(r)try{!function(e){var t=e.delayedCallbacks,r=0;do{for(;r<t.length;r++)t[r].call(null);for(var n=0;n<e.ops.length;n++){var i=e.ops[n];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(r<t.length)}(r)}finally{or=null,t(r)}}(t,function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;!function(e){for(var t=e.ops,r=0;r<t.length;r++)Xn(t[r]);for(var n=0;n<t.length;n++)(i=t[n]).updatedDisplay=i.mustUpdate&&ni(i.cm,i.update);var i;for(var o=0;o<t.length;o++)Yn(t[o]);for(var l=0;l<t.length;l++)_n(t[l]);for(var s=0;s<t.length;s++)$n(t[s])}(e)})}function Xn(e){var t=e.cm,r=t.display;!function(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=kr(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=kr(e)+"px",t.scrollbarsClipped=!0)}(t),e.updateMaxLine&&jt(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<r.viewFrom||e.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new ri(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function Yn(e){var t=e.cm,r=t.display;e.updatedDisplay&&Ln(t),e.barMeasure=En(t),r.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=Or(t,r.maxLine,r.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(r.scroller.clientWidth,r.sizer.offsetLeft+e.adjustWidthTo+kr(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,r.sizer.offsetLeft+e.adjustWidthTo-Tr(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=r.input.prepareSelection())}function _n(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Pn(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var r=e.focus&&e.focus==W();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,r),(e.updatedDisplay||e.startHeight!=t.doc.height)&&Rn(t,e.barMeasure),e.updatedDisplay&&si(t,e.barMeasure),e.selectionChanged&&bn(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),r&&wn(e.cm)}function $n(e){var t=e.cm,r=t.display,n=t.doc;(e.updatedDisplay&&ii(t,e.update),null==r.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(r.wheelStartX=r.wheelStartY=null),null!=e.scrollTop&&Fn(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Pn(t,e.scrollLeft,!0,!0),e.scrollToPos)&&function(e,t){if(!ve(e,"scrollCursorIntoView")){var r=e.display,n=r.sizer.getBoundingClientRect(),i=null;if(t.top+n.top<0?i=!0:t.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)&&(i=!1),null!=i&&!p){var o=O("div","â",null,"position: absolute;\n                         top: "+(t.top-r.viewOffset-Cr(e.display))+"px;\n                         height: "+(t.bottom-t.top+kr(e)+r.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(o),o.scrollIntoView(i),e.display.lineSpace.removeChild(o)}}}(t,function(e,t,r,n){var i;null==n&&(n=0),e.options.lineWrapping||t!=r||(r="before"==(t=t.ch?et(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t).sticky?et(t.line,t.ch+1,"before"):t);for(var o=0;o<5;o++){var l=!1,s=Xr(e,t),a=r&&r!=t?Xr(e,r):s,u=Mn(e,i={left:Math.min(s.left,a.left),top:Math.min(s.top,a.top)-n,right:Math.max(s.left,a.left),bottom:Math.max(s.bottom,a.bottom)+n}),c=e.doc.scrollTop,h=e.doc.scrollLeft;if(null!=u.scrollTop&&(Hn(e,u.scrollTop),Math.abs(e.doc.scrollTop-c)>1&&(l=!0)),null!=u.scrollLeft&&(Pn(e,u.scrollLeft),Math.abs(e.doc.scrollLeft-h)>1&&(l=!0)),!l)break}return i}(t,st(n,e.scrollToPos.from),st(n,e.scrollToPos.to),e.scrollToPos.margin));var i=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(i)for(var l=0;l<i.length;++l)i[l].lines.length||ge(i[l],"hide");if(o)for(var s=0;s<o.length;++s)o[s].lines.length&&ge(o[s],"unhide");r.wrapper.offsetHeight&&(n.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&ge(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function qn(e,t){if(e.curOp)return t();Kn(e);try{return t()}finally{jn(e)}}function Zn(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Kn(e);try{return t.apply(e,arguments)}finally{jn(e)}}}function Qn(e){return function(){if(this.curOp)return e.apply(this,arguments);Kn(this);try{return e.apply(this,arguments)}finally{jn(this)}}}function Jn(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);Kn(t);try{return e.apply(this,arguments)}finally{jn(t)}}}function ei(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,E(ti,e))}function ti(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var r=+new Date+e.options.workTime,n=dt(e,t.highlightFrontier),i=[];t.iter(n.line,Math.min(t.first+t.size,e.display.viewTo+500),function(o){if(n.line>=e.display.viewFrom){var l=o.styles,s=o.text.length>e.options.maxHighlightLength?Ue(t.mode,n.state):null,a=ht(e,o,n,!0);s&&(n.state=s),o.styles=a.styles;var u=o.styleClasses,c=a.classes;c?o.styleClasses=c:u&&(o.styleClasses=null);for(var h=!l||l.length!=o.styles.length||u!=c&&(!u||!c||u.bgClass!=c.bgClass||u.textClass!=c.textClass),f=0;!h&&f<l.length;++f)h=l[f]!=o.styles[f];h&&i.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=e.options.maxHighlightLength&&pt(e,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>r)return ei(e,e.options.workDelay),!0}),t.highlightFrontier=n.line,t.modeFrontier=Math.max(t.modeFrontier,n.line),i.length&&qn(e,function(){for(var t=0;t<i.length;t++)cn(e,i[t],"text")})}}var ri=function(e,t,r){var n=e.display;this.viewport=t,this.visible=Tn(n,e.doc,t),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=Tr(e),this.force=r,this.dims=rn(e),this.events=[]};function ni(e,t){var r=e.display,n=e.doc;if(t.editorIsHidden)return hn(e),!1;if(!t.force&&t.visible.from>=r.viewFrom&&t.visible.to<=r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>=r.viewTo)&&r.renderedView==r.view&&0==dn(e))return!1;ui(e)&&(hn(e),t.dims=rn(e));var i=n.first+n.size,o=Math.max(t.visible.from-e.options.viewportMargin,n.first),l=Math.min(i,t.visible.to+e.options.viewportMargin);r.viewFrom<o&&o-r.viewFrom<20&&(o=Math.max(n.first,r.viewFrom)),r.viewTo>l&&r.viewTo-l<20&&(l=Math.min(i,r.viewTo)),Ct&&(o=Rt(e.doc,o),l=Bt(e.doc,l));var s=o!=r.viewFrom||l!=r.viewTo||r.lastWrapHeight!=t.wrapperHeight||r.lastWrapWidth!=t.wrapperWidth;!function(e,t,r){var n=e.display;0==n.view.length||t>=n.viewTo||r<=n.viewFrom?(n.view=ir(e,t,r),n.viewFrom=t):(n.viewFrom>t?n.view=ir(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(an(e,t))),n.viewFrom=t,n.viewTo<r?n.view=n.view.concat(ir(e,n.viewTo,r)):n.viewTo>r&&(n.view=n.view.slice(0,an(e,r)))),n.viewTo=r}(e,o,l),r.viewOffset=Vt(Xe(e.doc,r.viewFrom)),e.display.mover.style.top=r.viewOffset+"px";var u=dn(e);if(!s&&0==u&&!t.force&&r.renderedView==r.view&&(null==r.updateLineNumbers||r.updateLineNumbers>=r.viewTo))return!1;var c=function(e){if(e.hasFocus())return null;var t=W();if(!t||!D(e.display.lineDiv,t))return null;var r={activeElt:t};if(window.getSelection){var n=window.getSelection();n.anchorNode&&n.extend&&D(e.display.lineDiv,n.anchorNode)&&(r.anchorNode=n.anchorNode,r.anchorOffset=n.anchorOffset,r.focusNode=n.focusNode,r.focusOffset=n.focusOffset)}return r}(e);return u>4&&(r.lineDiv.style.display="none"),function(e,t,r){var n=e.display,i=e.options.lineNumbers,o=n.lineDiv,l=o.firstChild;function s(t){var r=t.nextSibling;return a&&y&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),r}for(var u=n.view,c=n.viewFrom,h=0;h<u.length;h++){var f=u[h];if(f.hidden);else if(f.node&&f.node.parentNode==o){for(;l!=f.node;)l=s(l);var d=i&&null!=t&&t<=c&&f.lineNumber;f.changes&&(B(f.changes,"gutter")>-1&&(d=!1),ur(e,f,c,r)),d&&(M(f.lineNumber),f.lineNumber.appendChild(document.createTextNode(Je(e.options,c)))),l=f.node.nextSibling}else{var p=vr(e,f,c,r);o.insertBefore(p,l)}c+=f.size}for(;l;)l=s(l)}(e,r.updateLineNumbers,t.dims),u>4&&(r.lineDiv.style.display=""),r.renderedView=r.view,function(e){if(e&&e.activeElt&&e.activeElt!=W()&&(e.activeElt.focus(),e.anchorNode&&D(document.body,e.anchorNode)&&D(document.body,e.focusNode))){var t=window.getSelection(),r=document.createRange();r.setEnd(e.anchorNode,e.anchorOffset),r.collapse(!1),t.removeAllRanges(),t.addRange(r),t.extend(e.focusNode,e.focusOffset)}}(c),M(r.cursorDiv),M(r.selectionDiv),r.gutters.style.height=r.sizer.style.minHeight=0,s&&(r.lastWrapHeight=t.wrapperHeight,r.lastWrapWidth=t.wrapperWidth,ei(e,400)),r.updateLineNumbers=null,!0}function ii(e,t){for(var r=t.viewport,n=!0;;n=!1){if(n&&e.options.lineWrapping&&t.oldDisplayWidth!=Tr(e))n&&(t.visible=Tn(e.display,e.doc,r));else if(r&&null!=r.top&&(r={top:Math.min(e.doc.height+Sr(e.display)-Mr(e),r.top)}),t.visible=Tn(e.display,e.doc,r),t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)break;if(!ni(e,t))break;Ln(e);var i=En(e);pn(e),Rn(e,i),si(e,i),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function oi(e,t){var r=new ri(e,t);if(ni(e,r)){Ln(e),ii(e,r);var n=En(e);pn(e),Rn(e,n),si(e,n),r.finish()}}function li(e){var t=e.gutters.offsetWidth;e.sizer.style.marginLeft=t+"px"}function si(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+kr(e)+"px"}function ai(e){var t=e.display,r=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=nn(t)-t.scroller.scrollLeft+e.doc.scrollLeft,i=t.gutters.offsetWidth,o=n+"px",l=0;l<r.length;l++)if(!r[l].hidden){e.options.fixedGutter&&(r[l].gutter&&(r[l].gutter.style.left=o),r[l].gutterBackground&&(r[l].gutterBackground.style.left=o));var s=r[l].alignable;if(s)for(var a=0;a<s.length;a++)s[a].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+i+"px")}}function ui(e){if(!e.options.lineNumbers)return!1;var t=e.doc,r=Je(e.options,t.first+t.size-1),n=e.display;if(r.length!=n.lineNumChars){var i=n.measure.appendChild(O("div",[O("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=i.firstChild.offsetWidth,l=i.offsetWidth-o;return n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-l)+1,n.lineNumWidth=n.lineNumInnerWidth+l,n.lineNumChars=n.lineNumInnerWidth?r.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",li(e.display),!0}return!1}function ci(e,t){for(var r=[],n=!1,i=0;i<e.length;i++){var o=e[i],l=null;if("string"!=typeof o&&(l=o.style,o=o.className),"CodeMirror-linenumbers"==o){if(!t)continue;n=!0}r.push({className:o,style:l})}return t&&!n&&r.push({className:"CodeMirror-linenumbers",style:null}),r}function hi(e){var t=e.gutters,r=e.gutterSpecs;M(t),e.lineGutter=null;for(var n=0;n<r.length;++n){var i=r[n],o=i.className,l=i.style,s=t.appendChild(O("div",null,"CodeMirror-gutter "+o));l&&(s.style.cssText=l),"CodeMirror-linenumbers"==o&&(e.lineGutter=s,s.style.width=(e.lineNumWidth||1)+"px")}t.style.display=r.length?"":"none",li(e)}function fi(e){hi(e.display),un(e),ai(e)}ri.prototype.signal=function(e,t){ye(e,t)&&this.events.push(arguments)},ri.prototype.finish=function(){for(var e=0;e<this.events.length;e++)ge.apply(null,this.events[e])};var di=0,pi=null;function gi(e){var t=e.wheelDeltaX,r=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==r&&e.detail&&e.axis==e.VERTICAL_AXIS?r=e.detail:null==r&&(r=e.wheelDelta),{x:t,y:r}}function vi(e){var t=gi(e);return t.x*=pi,t.y*=pi,t}function mi(e,t){var n=gi(t),i=n.x,o=n.y,l=e.display,s=l.scroller,u=s.scrollWidth>s.clientWidth,c=s.scrollHeight>s.clientHeight;if(i&&u||o&&c){if(o&&y&&a)e:for(var f=t.target,d=l.view;f!=s;f=f.parentNode)for(var p=0;p<d.length;p++)if(d[p].node==f){e.display.currentWheelTarget=f;break e}if(i&&!r&&!h&&null!=pi)return o&&c&&Hn(e,Math.max(0,s.scrollTop+o*pi)),Pn(e,Math.max(0,s.scrollLeft+i*pi)),(!o||o&&c)&&we(t),void(l.wheelStartX=null);if(o&&null!=pi){var g=o*pi,v=e.doc.scrollTop,m=v+l.wrapper.clientHeight;g<0?v=Math.max(0,v+g-50):m=Math.min(e.doc.height,m+g+50),oi(e,{top:v,bottom:m})}di<20&&(null==l.wheelStartX?(l.wheelStartX=s.scrollLeft,l.wheelStartY=s.scrollTop,l.wheelDX=i,l.wheelDY=o,setTimeout(function(){if(null!=l.wheelStartX){var e=s.scrollLeft-l.wheelStartX,t=s.scrollTop-l.wheelStartY,r=t&&l.wheelDY&&t/l.wheelDY||e&&l.wheelDX&&e/l.wheelDX;l.wheelStartX=l.wheelStartY=null,r&&(pi=(pi*di+r)/(di+1),++di)}},200)):(l.wheelDX+=i,l.wheelDY+=o))}}l?pi=-.53:r?pi=15:c?pi=-.7:f&&(pi=-1/3);var yi=function(e,t){this.ranges=e,this.primIndex=t};yi.prototype.primary=function(){return this.ranges[this.primIndex]},yi.prototype.equals=function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var r=this.ranges[t],n=e.ranges[t];if(!rt(r.anchor,n.anchor)||!rt(r.head,n.head))return!1}return!0},yi.prototype.deepCopy=function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new bi(nt(this.ranges[t].anchor),nt(this.ranges[t].head));return new yi(e,this.primIndex)},yi.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},yi.prototype.contains=function(e,t){t||(t=e);for(var r=0;r<this.ranges.length;r++){var n=this.ranges[r];if(tt(t,n.from())>=0&&tt(e,n.to())<=0)return r}return-1};var bi=function(e,t){this.anchor=e,this.head=t};function wi(e,t,r){var n=e&&e.options.selectionsMayTouch,i=t[r];t.sort(function(e,t){return tt(e.from(),t.from())}),r=B(t,i);for(var o=1;o<t.length;o++){var l=t[o],s=t[o-1],a=tt(s.to(),l.from());if(n&&!l.empty()?a>0:a>=0){var u=ot(s.from(),l.from()),c=it(s.to(),l.to()),h=s.empty()?l.from()==l.head:s.from()==s.head;o<=r&&--r,t.splice(--o,2,new bi(h?c:u,h?u:c))}}return new yi(t,r)}function xi(e,t){return new yi([new bi(e,t||e)],0)}function Ci(e){return e.text?et(e.from.line+e.text.length-1,$(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function Si(e,t){if(tt(e,t.from)<0)return e;if(tt(e,t.to)<=0)return Ci(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=Ci(t).ch-t.to.ch),et(r,n)}function Li(e,t){for(var r=[],n=0;n<e.sel.ranges.length;n++){var i=e.sel.ranges[n];r.push(new bi(Si(i.anchor,t),Si(i.head,t)))}return wi(e.cm,r,e.sel.primIndex)}function ki(e,t,r){return e.line==t.line?et(r.line,e.ch-t.ch+r.ch):et(r.line+(e.line-t.line),e.ch)}function Ti(e){e.doc.mode=Re(e.options,e.doc.modeOption),Mi(e)}function Mi(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,ei(e,100),e.state.modeGen++,e.curOp&&un(e)}function Ni(e,t){return 0==t.from.ch&&0==t.to.ch&&""==$(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function Oi(e,t,r,n){function i(e){return r?r[e]:null}function o(e,r,i){!function(e,t,r,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Nt(e),Ot(e,r);var i=n?n(e):1;i!=e.height&&$e(e,i)}(e,r,i,n),sr(e,"change",e,t)}function l(e,t){for(var r=[],o=e;o<t;++o)r.push(new Xt(u[o],i(o),n));return r}var s=t.from,a=t.to,u=t.text,c=Xe(e,s.line),h=Xe(e,a.line),f=$(u),d=i(u.length-1),p=a.line-s.line;if(t.full)e.insert(0,l(0,u.length)),e.remove(u.length,e.size-u.length);else if(Ni(e,t)){var g=l(0,u.length-1);o(h,h.text,d),p&&e.remove(s.line,p),g.length&&e.insert(s.line,g)}else if(c==h)if(1==u.length)o(c,c.text.slice(0,s.ch)+f+c.text.slice(a.ch),d);else{var v=l(1,u.length-1);v.push(new Xt(f+c.text.slice(a.ch),d,n)),o(c,c.text.slice(0,s.ch)+u[0],i(0)),e.insert(s.line+1,v)}else if(1==u.length)o(c,c.text.slice(0,s.ch)+u[0]+h.text.slice(a.ch),i(0)),e.remove(s.line+1,p);else{o(c,c.text.slice(0,s.ch)+u[0],i(0)),o(h,f+h.text.slice(a.ch),d);var m=l(1,u.length-1);p>1&&e.remove(s.line+1,p-1),e.insert(s.line+1,m)}sr(e,"change",e,t)}function Ai(e,t,r){!function e(n,i,o){if(n.linked)for(var l=0;l<n.linked.length;++l){var s=n.linked[l];if(s.doc!=i){var a=o&&s.sharedHist;r&&!a||(t(s.doc,a),e(s.doc,n,a))}}}(e,null,!0)}function Di(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,ln(e),Ti(e),Wi(e),e.options.lineWrapping||jt(e),e.options.mode=t.modeOption,un(e)}function Wi(e){("rtl"==e.doc.direction?H:T)(e.display.lineDiv,"CodeMirror-rtl")}function Hi(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function Fi(e,t){var r={from:nt(t.from),to:Ci(t),text:Ye(e,t.from,t.to)};return Ri(e,r,t.from.line,t.to.line+1),Ai(e,function(e){return Ri(e,r,t.from.line,t.to.line+1)},!0),r}function Pi(e){for(;e.length;){if(!$(e).ranges)break;e.pop()}}function Ei(e,t,r,n){var i=e.history;i.undone.length=0;var o,l,s=+new Date;if((i.lastOp==n||i.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&i.lastModTime>s-(e.cm?e.cm.options.historyEventDelay:500)||"*"==t.origin.charAt(0)))&&(o=function(e,t){return t?(Pi(e.done),$(e.done)):e.done.length&&!$(e.done).ranges?$(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),$(e.done)):void 0}(i,i.lastOp==n)))l=$(o.changes),0==tt(t.from,t.to)&&0==tt(t.from,l.to)?l.to=Ci(t):o.changes.push(Fi(e,t));else{var a=$(i.done);for(a&&a.ranges||zi(e.sel,i.done),o={changes:[Fi(e,t)],generation:i.generation},i.done.push(o);i.done.length>i.undoDepth;)i.done.shift(),i.done[0].ranges||i.done.shift()}i.done.push(r),i.generation=++i.maxGeneration,i.lastModTime=i.lastSelTime=s,i.lastOp=i.lastSelOp=n,i.lastOrigin=i.lastSelOrigin=t.origin,l||ge(e,"historyAdded")}function Ii(e,t,r,n){var i=e.history,o=n&&n.origin;r==i.lastSelOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||function(e,t,r,n){var i=t.charAt(0);return"*"==i||"+"==i&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}(e,o,$(i.done),t))?i.done[i.done.length-1]=t:zi(t,i.done),i.lastSelTime=+new Date,i.lastSelOrigin=o,i.lastSelOp=r,n&&!1!==n.clearRedo&&Pi(i.undone)}function zi(e,t){var r=$(t);r&&r.ranges&&r.equals(e)||t.push(e)}function Ri(e,t,r,n){var i=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,r),Math.min(e.first+e.size,n),function(r){r.markedSpans&&((i||(i=t["spans_"+e.id]={}))[o]=r.markedSpans),++o})}function Bi(e){if(!e)return null;for(var t,r=0;r<e.length;++r)e[r].marker.explicitlyCleared?t||(t=e.slice(0,r)):t&&t.push(e[r]);return t?t.length?t:null:e}function Gi(e,t){var r=function(e,t){var r=t["spans_"+e.id];if(!r)return null;for(var n=[],i=0;i<t.text.length;++i)n.push(Bi(r[i]));return n}(e,t),n=Tt(e,t);if(!r)return n;if(!n)return r;for(var i=0;i<r.length;++i){var o=r[i],l=n[i];if(o&&l)e:for(var s=0;s<l.length;++s){for(var a=l[s],u=0;u<o.length;++u)if(o[u].marker==a.marker)continue e;o.push(a)}else l&&(r[i]=l)}return r}function Ui(e,t,r){for(var n=[],i=0;i<e.length;++i){var o=e[i];if(o.ranges)n.push(r?yi.prototype.deepCopy.call(o):o);else{var l=o.changes,s=[];n.push({changes:s});for(var a=0;a<l.length;++a){var u=l[a],c=void 0;if(s.push({from:u.from,to:u.to,text:u.text}),t)for(var h in u)(c=h.match(/^spans_(\d+)$/))&&B(t,Number(c[1]))>-1&&($(s)[h]=u[h],delete u[h])}}}return n}function Vi(e,t,r,n){if(n){var i=e.anchor;if(r){var o=tt(t,i)<0;o!=tt(r,i)<0?(i=t,t=r):o!=tt(t,r)<0&&(t=r)}return new bi(i,t)}return new bi(r||t,t)}function Ki(e,t,r,n,i){null==i&&(i=e.cm&&(e.cm.display.shift||e.extend)),$i(e,new yi([Vi(e.sel.primary(),t,r,i)],0),n)}function ji(e,t,r){for(var n=[],i=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)n[o]=Vi(e.sel.ranges[o],t[o],null,i);$i(e,wi(e.cm,n,e.sel.primIndex),r)}function Xi(e,t,r,n){var i=e.sel.ranges.slice(0);i[t]=r,$i(e,wi(e.cm,i,e.sel.primIndex),n)}function Yi(e,t,r,n){$i(e,xi(t,r),n)}function _i(e,t,r){var n=e.history.done,i=$(n);i&&i.ranges?(n[n.length-1]=t,qi(e,t,r)):$i(e,t,r)}function $i(e,t,r){qi(e,t,r),Ii(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function qi(e,t,r){(ye(e,"beforeSelectionChange")||e.cm&&ye(e.cm,"beforeSelectionChange"))&&(t=function(e,t,r){var n={ranges:t.ranges,update:function(t){this.ranges=[];for(var r=0;r<t.length;r++)this.ranges[r]=new bi(st(e,t[r].anchor),st(e,t[r].head))},origin:r&&r.origin};return ge(e,"beforeSelectionChange",e,n),e.cm&&ge(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?wi(e.cm,n.ranges,n.ranges.length-1):t}(e,t,r)),Zi(e,Ji(e,t,r&&r.bias||(tt(t.primary().head,e.sel.primary().head)<0?-1:1),!0)),r&&!1===r.scroll||!e.cm||On(e.cm)}function Zi(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=1,e.cm.curOp.selectionChanged=!0,me(e.cm)),sr(e,"cursorActivity",e))}function Qi(e){Zi(e,Ji(e,e.sel,null,!1))}function Ji(e,t,r,n){for(var i,o=0;o<t.ranges.length;o++){var l=t.ranges[o],s=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],a=to(e,l.anchor,s&&s.anchor,r,n),u=to(e,l.head,s&&s.head,r,n);(i||a!=l.anchor||u!=l.head)&&(i||(i=t.ranges.slice(0,o)),i[o]=new bi(a,u))}return i?wi(e.cm,i,t.primIndex):t}function eo(e,t,r,n,i){var o=Xe(e,t.line);if(o.markedSpans)for(var l=0;l<o.markedSpans.length;++l){var s=o.markedSpans[l],a=s.marker,u="selectLeft"in a?!a.selectLeft:a.inclusiveLeft,c="selectRight"in a?!a.selectRight:a.inclusiveRight;if((null==s.from||(u?s.from<=t.ch:s.from<t.ch))&&(null==s.to||(c?s.to>=t.ch:s.to>t.ch))){if(i&&(ge(a,"beforeCursorEnter"),a.explicitlyCleared)){if(o.markedSpans){--l;continue}break}if(!a.atomic)continue;if(r){var h=a.find(n<0?1:-1),f=void 0;if((n<0?c:u)&&(h=ro(e,h,-n,h&&h.line==t.line?o:null)),h&&h.line==t.line&&(f=tt(h,r))&&(n<0?f<0:f>0))return eo(e,h,t,n,i)}var d=a.find(n<0?-1:1);return(n<0?u:c)&&(d=ro(e,d,n,d.line==t.line?o:null)),d?eo(e,d,t,n,i):null}}return t}function to(e,t,r,n,i){var o=n||1,l=eo(e,t,r,o,i)||!i&&eo(e,t,r,o,!0)||eo(e,t,r,-o,i)||!i&&eo(e,t,r,-o,!0);return l||(e.cantEdit=!0,et(e.first,0))}function ro(e,t,r,n){return r<0&&0==t.ch?t.line>e.first?st(e,et(t.line-1)):null:r>0&&t.ch==(n||Xe(e,t.line)).text.length?t.line<e.first+e.size-1?et(t.line+1,0):null:new et(t.line,t.ch+r)}function no(e){e.setSelection(et(e.firstLine(),0),et(e.lastLine()),V)}function io(e,t,r){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return n.canceled=!0}};return r&&(n.update=function(t,r,i,o){t&&(n.from=st(e,t)),r&&(n.to=st(e,r)),i&&(n.text=i),void 0!==o&&(n.origin=o)}),ge(e,"beforeChange",e,n),e.cm&&ge(e.cm,"beforeChange",e.cm,n),n.canceled?(e.cm&&(e.cm.curOp.updateInput=2),null):{from:n.from,to:n.to,text:n.text,origin:n.origin}}function oo(e,t,r){if(e.cm){if(!e.cm.curOp)return Zn(e.cm,oo)(e,t,r);if(e.cm.state.suppressEdits)return}if(!(ye(e,"beforeChange")||e.cm&&ye(e.cm,"beforeChange"))||(t=io(e,t,!0))){var n=xt&&!r&&function(e,t,r){var n=null;if(e.iter(t.line,r.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var r=e.markedSpans[t].marker;!r.readOnly||n&&-1!=B(n,r)||(n||(n=[])).push(r)}}),!n)return null;for(var i=[{from:t,to:r}],o=0;o<n.length;++o)for(var l=n[o],s=l.find(0),a=0;a<i.length;++a){var u=i[a];if(!(tt(u.to,s.from)<0||tt(u.from,s.to)>0)){var c=[a,1],h=tt(u.from,s.from),f=tt(u.to,s.to);(h<0||!l.inclusiveLeft&&!h)&&c.push({from:u.from,to:s.from}),(f>0||!l.inclusiveRight&&!f)&&c.push({from:s.to,to:u.to}),i.splice.apply(i,c),a+=c.length-3}}return i}(e,t.from,t.to);if(n)for(var i=n.length-1;i>=0;--i)lo(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text,origin:t.origin});else lo(e,t)}}function lo(e,t){if(1!=t.text.length||""!=t.text[0]||0!=tt(t.from,t.to)){var r=Li(e,t);Ei(e,t,r,e.cm?e.cm.curOp.id:NaN),uo(e,t,r,Tt(e,t));var n=[];Ai(e,function(e,r){r||-1!=B(n,e.history)||(po(e.history,t),n.push(e.history)),uo(e,t,null,Tt(e,t))})}}function so(e,t,r){var n=e.cm&&e.cm.state.suppressEdits;if(!n||r){for(var i,o=e.history,l=e.sel,s="undo"==t?o.done:o.undone,a="undo"==t?o.undone:o.done,u=0;u<s.length&&(i=s[u],r?!i.ranges||i.equals(e.sel):i.ranges);u++);if(u!=s.length){for(o.lastOrigin=o.lastSelOrigin=null;;){if(!(i=s.pop()).ranges){if(n)return void s.push(i);break}if(zi(i,a),r&&!i.equals(e.sel))return void $i(e,i,{clearRedo:!1});l=i}var c=[];zi(l,a),a.push({changes:c,generation:o.generation}),o.generation=i.generation||++o.maxGeneration;for(var h=ye(e,"beforeChange")||e.cm&&ye(e.cm,"beforeChange"),f=function(r){var n=i.changes[r];if(n.origin=t,h&&!io(e,n,!1))return s.length=0,{};c.push(Fi(e,n));var o=r?Li(e,n):$(s);uo(e,n,o,Gi(e,n)),!r&&e.cm&&e.cm.scrollIntoView({from:n.from,to:Ci(n)});var l=[];Ai(e,function(e,t){t||-1!=B(l,e.history)||(po(e.history,n),l.push(e.history)),uo(e,n,null,Gi(e,n))})},d=i.changes.length-1;d>=0;--d){var p=f(d);if(p)return p.v}}}}function ao(e,t){if(0!=t&&(e.first+=t,e.sel=new yi(q(e.sel.ranges,function(e){return new bi(et(e.anchor.line+t,e.anchor.ch),et(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){un(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,n=r.viewFrom;n<r.viewTo;n++)cn(e.cm,n,"gutter")}}function uo(e,t,r,n){if(e.cm&&!e.cm.curOp)return Zn(e.cm,uo)(e,t,r,n);if(t.to.line<e.first)ao(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);ao(e,i),t={from:et(e.first,0),to:et(t.to.line+i,t.to.ch),text:[$(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:et(o,Xe(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=Ye(e,t.from,t.to),r||(r=Li(e,t)),e.cm?function(e,t,r){var n=e.doc,i=e.display,o=t.from,l=t.to,s=!1,a=o.line;e.options.lineWrapping||(a=qe(zt(Xe(n,o.line))),n.iter(a,l.line+1,function(e){if(e==i.maxLine)return s=!0,!0}));n.sel.contains(t.from,t.to)>-1&&me(e);Oi(n,t,r,on(e)),e.options.lineWrapping||(n.iter(a,o.line+t.text.length,function(e){var t=Kt(e);t>i.maxLineLength&&(i.maxLine=e,i.maxLineLength=t,i.maxLineChanged=!0,s=!1)}),s&&(e.curOp.updateMaxLine=!0));(function(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var r=e.first,n=t-1;n>r;n--){var i=Xe(e,n).stateAfter;if(i&&(!(i instanceof ut)||n+i.lookAhead<t)){r=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,r)}})(n,o.line),ei(e,400);var u=t.text.length-(l.line-o.line)-1;t.full?un(e):o.line!=l.line||1!=t.text.length||Ni(e.doc,t)?un(e,o.line,l.line+1,u):cn(e,o.line,"text");var c=ye(e,"changes"),h=ye(e,"change");if(h||c){var f={from:o,to:l,text:t.text,removed:t.removed,origin:t.origin};h&&sr(e,"change",e,f),c&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(f)}e.display.selForContextMenu=null}(e.cm,t,n):Oi(e,t,n),qi(e,r,V),e.cantEdit&&to(e,et(e.firstLine(),0))&&(e.cantEdit=!1)}}function co(e,t,r,n,i){var o;n||(n=r),tt(n,r)<0&&(r=(o=[n,r])[0],n=o[1]),"string"==typeof t&&(t=e.splitLines(t)),oo(e,{from:r,to:n,text:t,origin:i})}function ho(e,t,r,n){r<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function fo(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i],l=!0;if(o.ranges){o.copied||((o=e[i]=o.deepCopy()).copied=!0);for(var s=0;s<o.ranges.length;s++)ho(o.ranges[s].anchor,t,r,n),ho(o.ranges[s].head,t,r,n)}else{for(var a=0;a<o.changes.length;++a){var u=o.changes[a];if(r<u.from.line)u.from=et(u.from.line+n,u.from.ch),u.to=et(u.to.line+n,u.to.ch);else if(t<=u.to.line){l=!1;break}}l||(e.splice(0,i+1),i=0)}}}function po(e,t){var r=t.from.line,n=t.to.line,i=t.text.length-(n-r)-1;fo(e.done,r,n,i),fo(e.undone,r,n,i)}function go(e,t,r,n){var i=t,o=t;return"number"==typeof t?o=Xe(e,lt(e,t)):i=qe(t),null==i?null:(n(o,i)&&e.cm&&cn(e.cm,i,r),o)}function vo(e){this.lines=e,this.parent=null;for(var t=0,r=0;r<e.length;++r)e[r].parent=this,t+=e[r].height;this.height=t}function mo(e){this.children=e;for(var t=0,r=0,n=0;n<e.length;++n){var i=e[n];t+=i.chunkSize(),r+=i.height,i.parent=this}this.size=t,this.height=r,this.parent=null}bi.prototype.from=function(){return ot(this.anchor,this.head)},bi.prototype.to=function(){return it(this.anchor,this.head)},bi.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},vo.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=e,n=e+t;r<n;++r){var i=this.lines[r];this.height-=i.height,Yt(i),sr(i,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){this.height+=r,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var n=0;n<t.length;++n)t[n].parent=this},iterN:function(e,t,r){for(var n=e+t;e<n;++e)if(r(this.lines[e]))return!0}},mo.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var r=0;r<this.children.length;++r){var n=this.children[r],i=n.chunkSize();if(e<i){var o=Math.min(t,i-e),l=n.height;if(n.removeInner(e,o),this.height-=l-n.height,i==o&&(this.children.splice(r--,1),n.parent=null),0==(t-=o))break;e=0}else e-=i}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof vo))){var s=[];this.collapse(s),this.children=[new vo(s)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,r){this.size+=t.length,this.height+=r;for(var n=0;n<this.children.length;++n){var i=this.children[n],o=i.chunkSize();if(e<=o){if(i.insertInner(e,t,r),i.lines&&i.lines.length>50){for(var l=i.lines.length%25+25,s=l;s<i.lines.length;){var a=new vo(i.lines.slice(s,s+=25));i.height-=a.height,this.children.splice(++n,0,a),a.parent=this}i.lines=i.lines.slice(0,l),this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new mo(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var r=B(e.parent.children,e);e.parent.children.splice(r+1,0,t)}else{var n=new mo(e.children);n.parent=e,e.children=[n,t],e=n}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,r){for(var n=0;n<this.children.length;++n){var i=this.children[n],o=i.chunkSize();if(e<o){var l=Math.min(t,o-e);if(i.iterN(e,l,r))return!0;if(0==(t-=l))break;e=0}else e-=o}}};var yo=function(e,t,r){if(r)for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);this.doc=e,this.node=t};function bo(e,t,r){Vt(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&Nn(e,r)}yo.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,r=this.line,n=qe(r);if(null!=n&&t){for(var i=0;i<t.length;++i)t[i]==this&&t.splice(i--,1);t.length||(r.widgets=null);var o=wr(this);$e(r,Math.max(0,r.height-o)),e&&(qn(e,function(){bo(e,r,-o),cn(e,n,"widget")}),sr(e,"lineWidgetCleared",e,this,n))}},yo.prototype.changed=function(){var e=this,t=this.height,r=this.doc.cm,n=this.line;this.height=null;var i=wr(this)-t;i&&(Gt(this.doc,n)||$e(n,n.height+i),r&&qn(r,function(){r.curOp.forceUpdate=!0,bo(r,n,i),sr(r,"lineWidgetChanged",r,e,qe(n))}))},be(yo);var wo=0,xo=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++wo};function Co(e,t,r,n,i){if(n&&n.shared)return function(e,t,r,n,i){(n=I(n)).shared=!1;var o=[Co(e,t,r,n,i)],l=o[0],s=n.widgetNode;return Ai(e,function(e){s&&(n.widgetNode=s.cloneNode(!0)),o.push(Co(e,st(e,t),st(e,r),n,i));for(var a=0;a<e.linked.length;++a)if(e.linked[a].isParent)return;l=$(o)}),new So(o,l)}(e,t,r,n,i);if(e.cm&&!e.cm.curOp)return Zn(e.cm,Co)(e,t,r,n,i);var o=new xo(e,i),l=tt(t,r);if(n&&I(n,o,!1),l>0||0==l&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=A("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(It(e,t.line,t,r,o)||t.line!=r.line&&It(e,r.line,t,r,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");Ct=!0}o.addToHistory&&Ei(e,{from:t,to:r,origin:"markText"},e.sel,NaN);var s,a=t.line,u=e.cm;if(e.iter(a,r.line+1,function(e){u&&o.collapsed&&!u.options.lineWrapping&&zt(e)==u.display.maxLine&&(s=!0),o.collapsed&&a!=t.line&&$e(e,0),function(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}(e,new St(o,a==t.line?t.ch:null,a==r.line?r.ch:null)),++a}),o.collapsed&&e.iter(t.line,r.line+1,function(t){Gt(e,t)&&$e(t,0)}),o.clearOnEnter&&fe(o,"beforeCursorEnter",function(){return o.clear()}),o.readOnly&&(xt=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++wo,o.atomic=!0),u){if(s&&(u.curOp.updateMaxLine=!0),o.collapsed)un(u,t.line,r.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(var c=t.line;c<=r.line;c++)cn(u,c,"text");o.atomic&&Qi(u.doc),sr(u,"markerAdded",u,o)}return o}xo.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&Kn(e),ye(this,"clear")){var r=this.find();r&&sr(this,"clear",r.from,r.to)}for(var n=null,i=null,o=0;o<this.lines.length;++o){var l=this.lines[o],s=Lt(l.markedSpans,this);e&&!this.collapsed?cn(e,qe(l),"text"):e&&(null!=s.to&&(i=qe(l)),null!=s.from&&(n=qe(l))),l.markedSpans=kt(l.markedSpans,s),null==s.from&&this.collapsed&&!Gt(this.doc,l)&&e&&$e(l,en(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var a=0;a<this.lines.length;++a){var u=zt(this.lines[a]),c=Kt(u);c>e.display.maxLineLength&&(e.display.maxLine=u,e.display.maxLineLength=c,e.display.maxLineChanged=!0)}null!=n&&e&&this.collapsed&&un(e,n,i+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&Qi(e.doc)),e&&sr(e,"markerCleared",e,this,n,i),t&&jn(e),this.parent&&this.parent.clear()}},xo.prototype.find=function(e,t){var r,n;null==e&&"bookmark"==this.type&&(e=1);for(var i=0;i<this.lines.length;++i){var o=this.lines[i],l=Lt(o.markedSpans,this);if(null!=l.from&&(r=et(t?o:qe(o),l.from),-1==e))return r;if(null!=l.to&&(n=et(t?o:qe(o),l.to),1==e))return n}return r&&{from:r,to:n}},xo.prototype.changed=function(){var e=this,t=this.find(-1,!0),r=this,n=this.doc.cm;t&&n&&qn(n,function(){var i=t.line,o=qe(t.line),l=Ar(n,o);if(l&&(Ir(l),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!Gt(r.doc,i)&&null!=r.height){var s=r.height;r.height=null;var a=wr(r)-s;a&&$e(i,i.height+a)}sr(n,"markerChanged",n,e)})},xo.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=B(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},xo.prototype.detachLine=function(e){if(this.lines.splice(B(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},be(xo);var So=function(e,t){this.markers=e,this.primary=t;for(var r=0;r<e.length;++r)e[r].parent=this};function Lo(e){return e.findMarks(et(e.first,0),e.clipPos(et(e.lastLine())),function(e){return e.parent})}function ko(e){for(var t=function(t){var r=e[t],n=[r.primary.doc];Ai(r.primary.doc,function(e){return n.push(e)});for(var i=0;i<r.markers.length;i++){var o=r.markers[i];-1==B(n,o.doc)&&(o.parent=null,r.markers.splice(i--,1))}},r=0;r<e.length;r++)t(r)}So.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();sr(this,"clear")}},So.prototype.find=function(e,t){return this.primary.find(e,t)},be(So);var To=0,Mo=function(e,t,r,n,i){if(!(this instanceof Mo))return new Mo(e,t,r,n,i);null==r&&(r=0),mo.call(this,[new vo([new Xt("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=r;var o=et(r,0);this.sel=xi(o),this.history=new Hi(null),this.id=++To,this.modeOption=t,this.lineSep=n,this.direction="rtl"==i?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),Oi(this,{from:o,to:o,text:e}),$i(this,xi(o),V)};Mo.prototype=Q(mo.prototype,{constructor:Mo,iter:function(e,t,r){r?this.iterN(e-this.first,t-e,r):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var r=0,n=0;n<t.length;++n)r+=t[n].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=_e(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:Jn(function(e){var t=et(this.first,0),r=this.first+this.size-1;oo(this,{from:t,to:et(r,Xe(this,r).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&An(this.cm,0,0),$i(this,xi(t),V)}),replaceRange:function(e,t,r,n){co(this,e,t=st(this,t),r=r?st(this,r):t,n)},getRange:function(e,t,r){var n=Ye(this,st(this,e),st(this,t));return!1===r?n:n.join(r||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(Qe(this,e))return Xe(this,e)},getLineNumber:function(e){return qe(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=Xe(this,e)),zt(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return st(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Jn(function(e,t,r){Yi(this,st(this,"number"==typeof e?et(e,t||0):e),null,r)}),setSelection:Jn(function(e,t,r){Yi(this,st(this,e),st(this,t||e),r)}),extendSelection:Jn(function(e,t,r){Ki(this,st(this,e),t&&st(this,t),r)}),extendSelections:Jn(function(e,t){ji(this,at(this,e),t)}),extendSelectionsBy:Jn(function(e,t){ji(this,at(this,q(this.sel.ranges,e)),t)}),setSelections:Jn(function(e,t,r){if(e.length){for(var n=[],i=0;i<e.length;i++)n[i]=new bi(st(this,e[i].anchor),st(this,e[i].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),$i(this,wi(this.cm,n,t),r)}}),addSelection:Jn(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new bi(st(this,e),st(this,t||e))),$i(this,wi(this.cm,n,n.length-1),r)}),getSelection:function(e){for(var t,r=this.sel.ranges,n=0;n<r.length;n++){var i=Ye(this,r[n].from(),r[n].to());t=t?t.concat(i):i}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=[],r=this.sel.ranges,n=0;n<r.length;n++){var i=Ye(this,r[n].from(),r[n].to());!1!==e&&(i=i.join(e||this.lineSeparator())),t[n]=i}return t},replaceSelection:function(e,t,r){for(var n=[],i=0;i<this.sel.ranges.length;i++)n[i]=e;this.replaceSelections(n,t,r||"+input")},replaceSelections:Jn(function(e,t,r){for(var n=[],i=this.sel,o=0;o<i.ranges.length;o++){var l=i.ranges[o];n[o]={from:l.from(),to:l.to(),text:this.splitLines(e[o]),origin:r}}for(var s=t&&"end"!=t&&function(e,t,r){for(var n=[],i=et(e.first,0),o=i,l=0;l<t.length;l++){var s=t[l],a=ki(s.from,i,o),u=ki(Ci(s),i,o);if(i=s.to,o=u,"around"==r){var c=e.sel.ranges[l],h=tt(c.head,c.anchor)<0;n[l]=new bi(h?u:a,h?a:u)}else n[l]=new bi(a,a)}return new yi(n,e.sel.primIndex)}(this,n,t),a=n.length-1;a>=0;a--)oo(this,n[a]);s?_i(this,s):this.cm&&On(this.cm)}),undo:Jn(function(){so(this,"undo")}),redo:Jn(function(){so(this,"redo")}),undoSelection:Jn(function(){so(this,"undo",!0)}),redoSelection:Jn(function(){so(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,r=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var i=0;i<e.undone.length;i++)e.undone[i].ranges||++r;return{undo:t,redo:r}},clearHistory:function(){var e=this;this.history=new Hi(this.history.maxGeneration),Ai(this,function(t){return t.history=e.history},!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Ui(this.history.done),undone:Ui(this.history.undone)}},setHistory:function(e){var t=this.history=new Hi(this.history.maxGeneration);t.done=Ui(e.done.slice(0),null,!0),t.undone=Ui(e.undone.slice(0),null,!0)},setGutterMarker:Jn(function(e,t,r){return go(this,e,"gutter",function(e){var n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=r,!r&&re(n)&&(e.gutterMarkers=null),!0})}),clearGutter:Jn(function(e){var t=this;this.iter(function(r){r.gutterMarkers&&r.gutterMarkers[e]&&go(t,r,"gutter",function(){return r.gutterMarkers[e]=null,re(r.gutterMarkers)&&(r.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if("number"==typeof e){if(!Qe(this,e))return null;if(t=e,!(e=Xe(this,e)))return null}else if(null==(t=qe(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:Jn(function(e,t,r){return go(this,e,"gutter"==t?"gutter":"class",function(e){var n="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass";if(e[n]){if(L(r).test(e[n]))return!1;e[n]+=" "+r}else e[n]=r;return!0})}),removeLineClass:Jn(function(e,t,r){return go(this,e,"gutter"==t?"gutter":"class",function(e){var n="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass",i=e[n];if(!i)return!1;if(null==r)e[n]=null;else{var o=i.match(L(r));if(!o)return!1;var l=o.index+o[0].length;e[n]=i.slice(0,o.index)+(o.index&&l!=i.length?" ":"")+i.slice(l)||null}return!0})}),addLineWidget:Jn(function(e,t,r){return function(e,t,r,n){var i=new yo(e,r,n),o=e.cm;return o&&i.noHScroll&&(o.display.alignWidgets=!0),go(e,t,"widget",function(t){var r=t.widgets||(t.widgets=[]);if(null==i.insertAt?r.push(i):r.splice(Math.min(r.length-1,Math.max(0,i.insertAt)),0,i),i.line=t,o&&!Gt(e,t)){var n=Vt(t)<e.scrollTop;$e(t,t.height+wr(i)),n&&Nn(o,i.height),o.curOp.forceUpdate=!0}return!0}),o&&sr(o,"lineWidgetAdded",o,i,"number"==typeof t?t:qe(t)),i}(this,e,t,r)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,r){return Co(this,st(this,e),st(this,t),r,r&&r.type||"range")},setBookmark:function(e,t){var r={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return Co(this,e=st(this,e),e,r,"bookmark")},findMarksAt:function(e){var t=[],r=Xe(this,(e=st(this,e)).line).markedSpans;if(r)for(var n=0;n<r.length;++n){var i=r[n];(null==i.from||i.from<=e.ch)&&(null==i.to||i.to>=e.ch)&&t.push(i.marker.parent||i.marker)}return t},findMarks:function(e,t,r){e=st(this,e),t=st(this,t);var n=[],i=e.line;return this.iter(e.line,t.line+1,function(o){var l=o.markedSpans;if(l)for(var s=0;s<l.length;s++){var a=l[s];null!=a.to&&i==e.line&&e.ch>=a.to||null==a.from&&i!=e.line||null!=a.from&&i==t.line&&a.from>=t.ch||r&&!r(a.marker)||n.push(a.marker.parent||a.marker)}++i}),n},getAllMarks:function(){var e=[];return this.iter(function(t){var r=t.markedSpans;if(r)for(var n=0;n<r.length;++n)null!=r[n].from&&e.push(r[n].marker)}),e},posFromIndex:function(e){var t,r=this.first,n=this.lineSeparator().length;return this.iter(function(i){var o=i.text.length+n;if(o>e)return t=e,!0;e-=o,++r}),st(this,et(r,t))},indexFromPos:function(e){var t=(e=st(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var r=this.lineSeparator().length;return this.iter(this.first,e.line,function(e){t+=e.text.length+r}),t},copy:function(e){var t=new Mo(_e(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,r=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<r&&(r=e.to);var n=new Mo(_e(this,t,r),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.find(),o=e.clipPos(i.from),l=e.clipPos(i.to);if(tt(o,l)){var s=Co(e,o,l,n.primary,n.primary.type);n.markers.push(s),s.parent=n}}}(n,Lo(this)),n},unlinkDoc:function(e){if(e instanceof Sl&&(e=e.doc),this.linked)for(var t=0;t<this.linked.length;++t){if(this.linked[t].doc==e){this.linked.splice(t,1),e.unlinkDoc(this),ko(Lo(this));break}}if(e.history==this.history){var r=[e.id];Ai(e,function(e){return r.push(e.id)},!0),e.history=new Hi(null),e.history.done=Ui(this.history.done,r),e.history.undone=Ui(this.history.undone,r)}},iterLinkedDocs:function(e){Ai(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):We(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Jn(function(e){var t;("rtl"!=e&&(e="ltr"),e!=this.direction)&&(this.direction=e,this.iter(function(e){return e.order=null}),this.cm&&qn(t=this.cm,function(){Wi(t),un(t)}))})}),Mo.prototype.eachLine=Mo.prototype.iter;var No=0;function Oo(e){var t=this;if(Ao(t),!ve(t,e)&&!xr(t.display,e)){we(e),l&&(No=+new Date);var r=sn(t,e,!0),n=e.dataTransfer.files;if(r&&!t.isReadOnly())if(n&&n.length&&window.FileReader&&window.File)for(var i=n.length,o=Array(i),s=0,a=function(){++s==i&&Zn(t,function(){var e={from:r=st(t.doc,r),to:r,text:t.doc.splitLines(o.filter(function(e){return null!=e}).join(t.doc.lineSeparator())),origin:"paste"};oo(t.doc,e),_i(t.doc,xi(st(t.doc,r),st(t.doc,Ci(e))))})()},u=function(e,r){if(t.options.allowDropFileTypes&&-1==B(t.options.allowDropFileTypes,e.type))a();else{var n=new FileReader;n.onerror=function(){return a()},n.onload=function(){var e=n.result;/[\x00-\x08\x0e-\x1f]{2}/.test(e)?a():(o[r]=e,a())},n.readAsText(e)}},c=0;c<n.length;c++)u(n[c],c);else{if(t.state.draggingText&&t.doc.sel.contains(r)>-1)return t.state.draggingText(e),void setTimeout(function(){return t.display.input.focus()},20);try{var h=e.dataTransfer.getData("Text");if(h){var f;if(t.state.draggingText&&!t.state.draggingText.copy&&(f=t.listSelections()),qi(t.doc,xi(r,r)),f)for(var d=0;d<f.length;++d)co(t.doc,"",f[d].anchor,f[d].head,"drag");t.replaceSelection(h,"around","paste"),t.display.input.focus()}}catch(e){}}}}function Ao(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Do(e){if(document.getElementsByClassName){for(var t=document.getElementsByClassName("CodeMirror"),r=[],n=0;n<t.length;n++){var i=t[n].CodeMirror;i&&r.push(i)}r.length&&r[0].operation(function(){for(var t=0;t<r.length;t++)e(r[t])})}}var Wo=!1;function Ho(){var e;Wo||(fe(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,Do(Fo)},100))}),fe(window,"blur",function(){return Do(Sn)}),Wo=!0)}function Fo(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize()}for(var Po={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Eo=0;Eo<10;Eo++)Po[Eo+48]=Po[Eo+96]=String(Eo);for(var Io=65;Io<=90;Io++)Po[Io]=String.fromCharCode(Io);for(var zo=1;zo<=12;zo++)Po[zo+111]=Po[zo+63235]="F"+zo;var Ro={};function Bo(e){var t,r,n,i,o=e.split(/-(?!$)/);e=o[o.length-1];for(var l=0;l<o.length-1;l++){var s=o[l];if(/^(cmd|meta|m)$/i.test(s))i=!0;else if(/^a(lt)?$/i.test(s))t=!0;else if(/^(c|ctrl|control)$/i.test(s))r=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);n=!0}}return t&&(e="Alt-"+e),r&&(e="Ctrl-"+e),i&&(e="Cmd-"+e),n&&(e="Shift-"+e),e}function Go(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if(/^(name|fallthrough|(de|at)tach)$/.test(r))continue;if("..."==n){delete e[r];continue}for(var i=q(r.split(" "),Bo),o=0;o<i.length;o++){var l=void 0,s=void 0;o==i.length-1?(s=i.join(" "),l=n):(s=i.slice(0,o+1).join(" "),l="...");var a=t[s];if(a){if(a!=l)throw new Error("Inconsistent bindings for "+s)}else t[s]=l}delete e[r]}for(var u in t)e[u]=t[u];return e}function Uo(e,t,r,n){var i=(t=Xo(t)).call?t.call(e,n):t[e];if(!1===i)return"nothing";if("..."===i)return"multi";if(null!=i&&r(i))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return Uo(e,t.fallthrough,r,n);for(var o=0;o<t.fallthrough.length;o++){var l=Uo(e,t.fallthrough[o],r,n);if(l)return l}}}function Vo(e){var t="string"==typeof e?e:Po[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function Ko(e,t,r){var n=e;return t.altKey&&"Alt"!=n&&(e="Alt-"+e),(C?t.metaKey:t.ctrlKey)&&"Ctrl"!=n&&(e="Ctrl-"+e),(C?t.ctrlKey:t.metaKey)&&"Cmd"!=n&&(e="Cmd-"+e),!r&&t.shiftKey&&"Shift"!=n&&(e="Shift-"+e),e}function jo(e,t){if(h&&34==e.keyCode&&e.char)return!1;var r=Po[e.keyCode];return null!=r&&!e.altGraphKey&&(3==e.keyCode&&e.code&&(r=e.code),Ko(r,e,t))}function Xo(e){return"string"==typeof e?Ro[e]:e}function Yo(e,t){for(var r=e.doc.sel.ranges,n=[],i=0;i<r.length;i++){for(var o=t(r[i]);n.length&&tt(o.from,$(n).to)<=0;){var l=n.pop();if(tt(l.from,o.from)<0){o.from=l.from;break}}n.push(o)}qn(e,function(){for(var t=n.length-1;t>=0;t--)co(e.doc,"",n[t].from,n[t].to,"+delete");On(e)})}function _o(e,t,r){var n=oe(e.text,t+r,r);return n<0||n>e.text.length?null:n}function $o(e,t,r){var n=_o(e,t.ch,r);return null==n?null:new et(t.line,n,r<0?"after":"before")}function qo(e,t,r,n,i){if(e){"rtl"==t.doc.direction&&(i=-i);var o=ce(r,t.doc.direction);if(o){var l,s=i<0?$(o):o[0],a=i<0==(1==s.level)?"after":"before";if(s.level>0||"rtl"==t.doc.direction){var u=Dr(t,r);l=i<0?r.text.length-1:0;var c=Wr(t,u,l).top;l=le(function(e){return Wr(t,u,e).top==c},i<0==(1==s.level)?s.from:s.to-1,l),"before"==a&&(l=_o(r,l,1))}else l=i<0?s.to:s.from;return new et(n,l,a)}}return new et(n,i<0?r.text.length:0,i<0?"before":"after")}Ro.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Ro.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Ro.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Ro.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Ro.default=y?Ro.macDefault:Ro.pcDefault;var Zo={selectAll:no,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),V)},killLine:function(e){return Yo(e,function(t){if(t.empty()){var r=Xe(e.doc,t.head.line).text.length;return t.head.ch==r&&t.head.line<e.lastLine()?{from:t.head,to:et(t.head.line+1,0)}:{from:t.head,to:et(t.head.line,r)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){return Yo(e,function(t){return{from:et(t.from().line,0),to:st(e.doc,et(t.to().line+1,0))}})},delLineLeft:function(e){return Yo(e,function(e){return{from:et(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(e){return Yo(e,function(t){var r=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:r},"div"),to:t.from()}})},delWrappedLineRight:function(e){return Yo(e,function(t){var r=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div");return{from:t.from(),to:n}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(et(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(et(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy(function(t){return Qo(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy(function(t){return Jo(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy(function(t){return function(e,t){var r=Xe(e.doc,t),n=function(e){for(var t;t=Pt(e);)e=t.find(1,!0).line;return e}(r);n!=r&&(t=qe(n));return qo(!0,e,r,t,-1)}(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div")},j)},goLineLeft:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:r},"div")},j)},goLineLeftSmart:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:r},"div");return n.ch<e.getLine(n.line).search(/\S/)?Jo(e,t.head):n},j)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],r=e.listSelections(),n=e.options.tabSize,i=0;i<r.length;i++){var o=r[i].from(),l=z(e.getLine(o.line),o.ch,n);t.push(_(n-l%n))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return qn(e,function(){for(var t=e.listSelections(),r=[],n=0;n<t.length;n++)if(t[n].empty()){var i=t[n].head,o=Xe(e.doc,i.line).text;if(o)if(i.ch==o.length&&(i=new et(i.line,i.ch-1)),i.ch>0)i=new et(i.line,i.ch+1),e.replaceRange(o.charAt(i.ch-1)+o.charAt(i.ch-2),et(i.line,i.ch-2),i,"+transpose");else if(i.line>e.doc.first){var l=Xe(e.doc,i.line-1).text;l&&(i=new et(i.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+l.charAt(l.length-1),et(i.line-1,l.length-1),i,"+transpose"))}r.push(new bi(i,i))}e.setSelections(r)})},newlineAndIndent:function(e){return qn(e,function(){for(var t=e.listSelections(),r=t.length-1;r>=0;r--)e.replaceRange(e.doc.lineSeparator(),t[r].anchor,t[r].head,"+input");t=e.listSelections();for(var n=0;n<t.length;n++)e.indentLine(t[n].from().line,null,!0);On(e)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function Qo(e,t){var r=Xe(e.doc,t),n=zt(r);return n!=r&&(t=qe(n)),qo(!0,e,n,t,1)}function Jo(e,t){var r=Qo(e,t.line),n=Xe(e.doc,r.line),i=ce(n,e.doc.direction);if(!i||0==i[0].level){var o=Math.max(r.ch,n.text.search(/\S/)),l=t.line==r.line&&t.ch<=o&&t.ch;return et(r.line,l?0:o,r.sticky)}return r}function el(e,t,r){if("string"==typeof t&&!(t=Zo[t]))return!1;e.display.input.ensurePolled();var n=e.display.shift,i=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),r&&(e.display.shift=!1),i=t(e)!=U}finally{e.display.shift=n,e.state.suppressEdits=!1}return i}var tl=new R;function rl(e,t,r,n){var i=e.state.keySeq;if(i){if(Vo(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:tl.set(50,function(){e.state.keySeq==i&&(e.state.keySeq=null,e.display.input.reset())}),nl(e,i+" "+t,r,n))return!0}return nl(e,t,r,n)}function nl(e,t,r,n){var i=function(e,t,r){for(var n=0;n<e.state.keyMaps.length;n++){var i=Uo(t,e.state.keyMaps[n],r,e);if(i)return i}return e.options.extraKeys&&Uo(t,e.options.extraKeys,r,e)||Uo(t,e.options.keyMap,r,e)}(e,t,n);return"multi"==i&&(e.state.keySeq=t),"handled"==i&&sr(e,"keyHandled",e,t,r),"handled"!=i&&"multi"!=i||(we(r),bn(e)),!!i}function il(e,t){var r=jo(t,!0);return!!r&&(t.shiftKey&&!e.state.keySeq?rl(e,"Shift-"+r,t,function(t){return el(e,t,!0)})||rl(e,r,t,function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return el(e,t)}):rl(e,r,t,function(t){return el(e,t)}))}var ol=null;function ll(e){var t=this;if(t.curOp.focus=W(),!ve(t,e)){l&&s<11&&27==e.keyCode&&(e.returnValue=!1);var n=e.keyCode;t.display.shift=16==n||e.shiftKey;var i=il(t,e);h&&(ol=i?n:null,!i&&88==n&&!Fe&&(y?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),r&&!y&&!i&&46==n&&e.shiftKey&&!e.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=n||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||function(e){var t=e.display.lineDiv;function r(e){18!=e.keyCode&&e.altKey||(T(t,"CodeMirror-crosshair"),pe(document,"keyup",r),pe(document,"mouseover",r))}H(t,"CodeMirror-crosshair"),fe(document,"keyup",r),fe(document,"mouseover",r)}(t)}}function sl(e){16==e.keyCode&&(this.doc.sel.shift=!1),ve(this,e)}function al(e){var t=this;if(!(xr(t.display,e)||ve(t,e)||e.ctrlKey&&!e.altKey||y&&e.metaKey)){var r=e.keyCode,n=e.charCode;if(h&&r==ol)return ol=null,void we(e);if(!h||e.which&&!(e.which<10)||!il(t,e)){var i=String.fromCharCode(null==n?r:n);"\b"!=i&&(function(e,t,r){return rl(e,"'"+r+"'",t,function(t){return el(e,t,!0)})}(t,e,i)||t.display.input.onKeyPress(e))}}}var ul,cl,hl=function(e,t,r){this.time=e,this.pos=t,this.button=r};function fl(e){var t=this,r=t.display;if(!(ve(t,e)||r.activeTouch&&r.input.supportsTouch()))if(r.input.ensurePolled(),r.shift=e.shiftKey,xr(r,e))a||(r.scroller.draggable=!1,setTimeout(function(){return r.scroller.draggable=!0},100));else if(!gl(t,e)){var n=sn(t,e),i=ke(e),o=n?function(e,t){var r=+new Date;return cl&&cl.compare(r,e,t)?(ul=cl=null,"triple"):ul&&ul.compare(r,e,t)?(cl=new hl(r,e,t),ul=null,"double"):(ul=new hl(r,e,t),cl=null,"single")}(n,i):"single";window.focus(),1==i&&t.state.selectingText&&t.state.selectingText(e),n&&function(e,t,r,n,i){var o="Click";"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o);return rl(e,Ko(o=(1==t?"Left":2==t?"Middle":"Right")+o,i),i,function(t){if("string"==typeof t&&(t=Zo[t]),!t)return!1;var n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n=t(e,r)!=U}finally{e.state.suppressEdits=!1}return n})}(t,i,n,o,e)||(1==i?n?function(e,t,r,n){l?setTimeout(E(wn,e),0):e.curOp.focus=W();var i,o=function(e,t,r){var n=e.getOption("configureMouse"),i=n?n(e,t,r):{};if(null==i.unit){var o=b?r.shiftKey&&r.metaKey:r.altKey;i.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}(null==i.extend||e.doc.extend)&&(i.extend=e.doc.extend||r.shiftKey);null==i.addNew&&(i.addNew=y?r.metaKey:r.ctrlKey);null==i.moveOnDrag&&(i.moveOnDrag=!(y?r.altKey:r.ctrlKey));return i}(e,r,n),u=e.doc.sel;e.options.dragDrop&&Ne&&!e.isReadOnly()&&"single"==r&&(i=u.contains(t))>-1&&(tt((i=u.ranges[i]).from(),t)<0||t.xRel>0)&&(tt(i.to(),t)>0||t.xRel<0)?function(e,t,r,n){var i=e.display,o=!1,u=Zn(e,function(t){a&&(i.scroller.draggable=!1),e.state.draggingText=!1,pe(i.wrapper.ownerDocument,"mouseup",u),pe(i.wrapper.ownerDocument,"mousemove",c),pe(i.scroller,"dragstart",h),pe(i.scroller,"drop",u),o||(we(t),n.addNew||Ki(e.doc,r,null,null,n.extend),a||l&&9==s?setTimeout(function(){i.wrapper.ownerDocument.body.focus(),i.input.focus()},20):i.input.focus())}),c=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},h=function(){return o=!0};a&&(i.scroller.draggable=!0);e.state.draggingText=u,u.copy=!n.moveOnDrag,i.scroller.dragDrop&&i.scroller.dragDrop();fe(i.wrapper.ownerDocument,"mouseup",u),fe(i.wrapper.ownerDocument,"mousemove",c),fe(i.scroller,"dragstart",h),fe(i.scroller,"drop",u),xn(e),setTimeout(function(){return i.input.focus()},20)}(e,n,t,o):function(e,t,r,n){var i=e.display,o=e.doc;we(t);var l,s,a=o.sel,u=a.ranges;n.addNew&&!n.extend?(s=o.sel.contains(r),l=s>-1?u[s]:new bi(r,r)):(l=o.sel.primary(),s=o.sel.primIndex);if("rectangle"==n.unit)n.addNew||(l=new bi(r,r)),r=sn(e,t,!0,!0),s=-1;else{var c=dl(e,r,n.unit);l=n.extend?Vi(l,c.anchor,c.head,n.extend):c}n.addNew?-1==s?(s=u.length,$i(o,wi(e,u.concat([l]),s),{scroll:!1,origin:"*mouse"})):u.length>1&&u[s].empty()&&"char"==n.unit&&!n.extend?($i(o,wi(e,u.slice(0,s).concat(u.slice(s+1)),0),{scroll:!1,origin:"*mouse"}),a=o.sel):Xi(o,s,l,K):(s=0,$i(o,new yi([l],0),K),a=o.sel);var h=r;function f(t){if(0!=tt(h,t))if(h=t,"rectangle"==n.unit){for(var i=[],u=e.options.tabSize,c=z(Xe(o,r.line).text,r.ch,u),f=z(Xe(o,t.line).text,t.ch,u),d=Math.min(c,f),p=Math.max(c,f),g=Math.min(r.line,t.line),v=Math.min(e.lastLine(),Math.max(r.line,t.line));g<=v;g++){var m=Xe(o,g).text,y=X(m,d,u);d==p?i.push(new bi(et(g,y),et(g,y))):m.length>y&&i.push(new bi(et(g,y),et(g,X(m,p,u))))}i.length||i.push(new bi(r,r)),$i(o,wi(e,a.ranges.slice(0,s).concat(i),s),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var b,w=l,x=dl(e,t,n.unit),C=w.anchor;tt(x.anchor,C)>0?(b=x.head,C=ot(w.from(),x.anchor)):(b=x.anchor,C=it(w.to(),x.head));var S=a.ranges.slice(0);S[s]=function(e,t){var r=t.anchor,n=t.head,i=Xe(e.doc,r.line);if(0==tt(r,n)&&r.sticky==n.sticky)return t;var o=ce(i);if(!o)return t;var l=ae(o,r.ch,r.sticky),s=o[l];if(s.from!=r.ch&&s.to!=r.ch)return t;var a,u=l+(s.from==r.ch==(1!=s.level)?0:1);if(0==u||u==o.length)return t;if(n.line!=r.line)a=(n.line-r.line)*("ltr"==e.doc.direction?1:-1)>0;else{var c=ae(o,n.ch,n.sticky),h=c-l||(n.ch-r.ch)*(1==s.level?-1:1);a=c==u-1||c==u?h<0:h>0}var f=o[u+(a?-1:0)],d=a==(1==f.level),p=d?f.from:f.to,g=d?"after":"before";return r.ch==p&&r.sticky==g?t:new bi(new et(r.line,p,g),n)}(e,new bi(st(o,C),b)),$i(o,wi(e,S,s),K)}}var d=i.wrapper.getBoundingClientRect(),p=0;function g(t){e.state.selectingText=!1,p=1/0,t&&(we(t),i.input.focus()),pe(i.wrapper.ownerDocument,"mousemove",v),pe(i.wrapper.ownerDocument,"mouseup",m),o.history.lastSelOrigin=null}var v=Zn(e,function(t){0!==t.buttons&&ke(t)?function t(r){var l=++p;var s=sn(e,r,!0,"rectangle"==n.unit);if(!s)return;if(0!=tt(s,h)){e.curOp.focus=W(),f(s);var a=Tn(i,o);(s.line>=a.to||s.line<a.from)&&setTimeout(Zn(e,function(){p==l&&t(r)}),150)}else{var u=r.clientY<d.top?-20:r.clientY>d.bottom?20:0;u&&setTimeout(Zn(e,function(){p==l&&(i.scroller.scrollTop+=u,t(r))}),50)}}(t):g(t)}),m=Zn(e,g);e.state.selectingText=m,fe(i.wrapper.ownerDocument,"mousemove",v),fe(i.wrapper.ownerDocument,"mouseup",m)}(e,n,t,o)}(t,n,o,e):Le(e)==r.scroller&&we(e):2==i?(n&&Ki(t.doc,n),setTimeout(function(){return r.input.focus()},20)):3==i&&(S?t.display.input.onContextMenu(e):xn(t)))}}function dl(e,t,r){if("char"==r)return new bi(t,t);if("word"==r)return e.findWordAt(t);if("line"==r)return new bi(et(t.line,0),st(e.doc,et(t.line+1,0)));var n=r(e,t);return new bi(n.from,n.to)}function pl(e,t,r,n){var i,o;if(t.touches)i=t.touches[0].clientX,o=t.touches[0].clientY;else try{i=t.clientX,o=t.clientY}catch(t){return!1}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&we(t);var l=e.display,s=l.lineDiv.getBoundingClientRect();if(o>s.bottom||!ye(e,r))return Ce(t);o-=s.top-l.viewOffset;for(var a=0;a<e.display.gutterSpecs.length;++a){var u=l.gutters.childNodes[a];if(u&&u.getBoundingClientRect().right>=i)return ge(e,r,e,Ze(e.doc,o),e.display.gutterSpecs[a].className,t),Ce(t)}}function gl(e,t){return pl(e,t,"gutterClick",!0)}function vl(e,t){xr(e.display,t)||function(e,t){if(!ye(e,"gutterContextMenu"))return!1;return pl(e,t,"gutterContextMenu",!1)}(e,t)||ve(e,t,"contextmenu")||S||e.display.input.onContextMenu(t)}function ml(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Rr(e)}hl.prototype.compare=function(e,t,r){return this.time+400>e&&0==tt(t,this.pos)&&r==this.button};var yl={toString:function(){return"CodeMirror.Init"}},bl={},wl={};function xl(e,t,r){if(!t!=!(r&&r!=yl)){var n=e.display.dragFunctions,i=t?fe:pe;i(e.display.scroller,"dragstart",n.start),i(e.display.scroller,"dragenter",n.enter),i(e.display.scroller,"dragover",n.over),i(e.display.scroller,"dragleave",n.leave),i(e.display.scroller,"drop",n.drop)}}function Cl(e){e.options.lineWrapping?(H(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(T(e.display.wrapper,"CodeMirror-wrap"),jt(e)),ln(e),un(e),Rr(e),setTimeout(function(){return Rn(e)},100)}function Sl(e,t){var n=this;if(!(this instanceof Sl))return new Sl(e,t);this.options=t=t?I(t):{},I(bl,t,!1);var i=t.value;"string"==typeof i?i=new Mo(i,t.mode,null,t.lineSeparator,t.direction):t.mode&&(i.modeOption=t.mode),this.doc=i;var o=new Sl.inputStyles[t.inputStyle](this),u=this.display=new function(e,t,n,i){var o=this;this.input=n,o.scrollbarFiller=O("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=O("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=A("div",null,"CodeMirror-code"),o.selectionDiv=O("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=O("div",null,"CodeMirror-cursors"),o.measure=O("div",null,"CodeMirror-measure"),o.lineMeasure=O("div",null,"CodeMirror-measure"),o.lineSpace=A("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var u=A("div",[o.lineSpace],"CodeMirror-lines");o.mover=O("div",[u],null,"position: relative"),o.sizer=O("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=O("div",null,null,"position: absolute; height: "+G+"px; width: 1px;"),o.gutters=O("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=O("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=O("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),l&&s<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),a||r&&m||(o.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(o.wrapper):e(o.wrapper)),o.viewFrom=o.viewTo=t.first,o.reportedViewFrom=o.reportedViewTo=t.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,o.gutterSpecs=ci(i.gutters,i.lineNumbers),hi(o),n.init(o)}(e,i,o,t);for(var c in u.wrapper.CodeMirror=this,ml(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),Un(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new R,keySeq:null,specialChars:null},t.autofocus&&!m&&u.input.focus(),l&&s<11&&setTimeout(function(){return n.display.input.reset(!0)},20),function(e){var t=e.display;fe(t.scroller,"mousedown",Zn(e,fl)),fe(t.scroller,"dblclick",l&&s<11?Zn(e,function(t){if(!ve(e,t)){var r=sn(e,t);if(r&&!gl(e,t)&&!xr(e.display,t)){we(t);var n=e.findWordAt(r);Ki(e.doc,n.anchor,n.head)}}}):function(t){return ve(e,t)||we(t)});fe(t.scroller,"contextmenu",function(t){return vl(e,t)}),fe(t.input.getField(),"contextmenu",function(r){t.scroller.contains(r.target)||vl(e,r)});var r,n={end:0};function i(){t.activeTouch&&(r=setTimeout(function(){return t.activeTouch=null},1e3),(n=t.activeTouch).end=+new Date)}function o(e,t){if(null==t.left)return!0;var r=t.left-e.left,n=t.top-e.top;return r*r+n*n>400}fe(t.scroller,"touchstart",function(i){if(!ve(e,i)&&!function(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}(i)&&!gl(e,i)){t.input.ensurePolled(),clearTimeout(r);var o=+new Date;t.activeTouch={start:o,moved:!1,prev:o-n.end<=300?n:null},1==i.touches.length&&(t.activeTouch.left=i.touches[0].pageX,t.activeTouch.top=i.touches[0].pageY)}}),fe(t.scroller,"touchmove",function(){t.activeTouch&&(t.activeTouch.moved=!0)}),fe(t.scroller,"touchend",function(r){var n=t.activeTouch;if(n&&!xr(t,r)&&null!=n.left&&!n.moved&&new Date-n.start<300){var l,s=e.coordsChar(t.activeTouch,"page");l=!n.prev||o(n,n.prev)?new bi(s,s):!n.prev.prev||o(n,n.prev.prev)?e.findWordAt(s):new bi(et(s.line,0),st(e.doc,et(s.line+1,0))),e.setSelection(l.anchor,l.head),e.focus(),we(r)}i()}),fe(t.scroller,"touchcancel",i),fe(t.scroller,"scroll",function(){t.scroller.clientHeight&&(Hn(e,t.scroller.scrollTop),Pn(e,t.scroller.scrollLeft,!0),ge(e,"scroll",e))}),fe(t.scroller,"mousewheel",function(t){return mi(e,t)}),fe(t.scroller,"DOMMouseScroll",function(t){return mi(e,t)}),fe(t.wrapper,"scroll",function(){return t.wrapper.scrollTop=t.wrapper.scrollLeft=0}),t.dragFunctions={enter:function(t){ve(e,t)||Se(t)},over:function(t){ve(e,t)||(!function(e,t){var r=sn(e,t);if(r){var n=document.createDocumentFragment();vn(e,r,n),e.display.dragCursor||(e.display.dragCursor=O("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),N(e.display.dragCursor,n)}}(e,t),Se(t))},start:function(t){return function(e,t){if(l&&(!e.state.draggingText||+new Date-No<100))Se(t);else if(!ve(e,t)&&!xr(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!f)){var r=O("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",h&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),h&&r.parentNode.removeChild(r)}}(e,t)},drop:Zn(e,Oo),leave:function(t){ve(e,t)||Ao(e)}};var a=t.input.getField();fe(a,"keyup",function(t){return sl.call(e,t)}),fe(a,"keydown",Zn(e,ll)),fe(a,"keypress",Zn(e,al)),fe(a,"focus",function(t){return Cn(e,t)}),fe(a,"blur",function(t){return Sn(e,t)})}(this),Ho(),Kn(this),this.curOp.forceUpdate=!0,Di(this,i),t.autofocus&&!m||this.hasFocus()?setTimeout(E(Cn,this),20):Sn(this),wl)wl.hasOwnProperty(c)&&wl[c](this,t[c],yl);ui(this),t.finishInit&&t.finishInit(this);for(var d=0;d<Ll.length;++d)Ll[d](this);jn(this),a&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(u.lineDiv).textRendering&&(u.lineDiv.style.textRendering="auto")}Sl.defaults=bl,Sl.optionHandlers=wl;var Ll=[];function kl(e,t,r,n){var i,o=e.doc;null==r&&(r="add"),"smart"==r&&(o.mode.indent?i=dt(e,t).state:r="prev");var l=e.options.tabSize,s=Xe(o,t),a=z(s.text,null,l);s.stateAfter&&(s.stateAfter=null);var u,c=s.text.match(/^\s*/)[0];if(n||/\S/.test(s.text)){if("smart"==r&&((u=o.mode.indent(i,s.text.slice(c.length),s.text))==U||u>150)){if(!n)return;r="prev"}}else u=0,r="not";"prev"==r?u=t>o.first?z(Xe(o,t-1).text,null,l):0:"add"==r?u=a+e.options.indentUnit:"subtract"==r?u=a-e.options.indentUnit:"number"==typeof r&&(u=a+r),u=Math.max(0,u);var h="",f=0;if(e.options.indentWithTabs)for(var d=Math.floor(u/l);d;--d)f+=l,h+="\t";if(f<u&&(h+=_(u-f)),h!=c)return co(o,h,et(t,0),et(t,c.length),"+input"),s.stateAfter=null,!0;for(var p=0;p<o.sel.ranges.length;p++){var g=o.sel.ranges[p];if(g.head.line==t&&g.head.ch<c.length){var v=et(t,c.length);Xi(o,p,new bi(v,v));break}}}Sl.defineInitHook=function(e){return Ll.push(e)};var Tl=null;function Ml(e){Tl=e}function Nl(e,t,r,n,i){var o=e.doc;e.display.shift=!1,n||(n=o.sel);var l=+new Date-200,s="paste"==i||e.state.pasteIncoming>l,a=We(t),u=null;if(s&&n.ranges.length>1)if(Tl&&Tl.text.join("\n")==t){if(n.ranges.length%Tl.text.length==0){u=[];for(var c=0;c<Tl.text.length;c++)u.push(o.splitLines(Tl.text[c]))}}else a.length==n.ranges.length&&e.options.pasteLinesPerSelection&&(u=q(a,function(e){return[e]}));for(var h=e.curOp.updateInput,f=n.ranges.length-1;f>=0;f--){var d=n.ranges[f],p=d.from(),g=d.to();d.empty()&&(r&&r>0?p=et(p.line,p.ch-r):e.state.overwrite&&!s?g=et(g.line,Math.min(Xe(o,g.line).text.length,g.ch+$(a).length)):s&&Tl&&Tl.lineWise&&Tl.text.join("\n")==t&&(p=g=et(p.line,0)));var v={from:p,to:g,text:u?u[f%u.length]:a,origin:i||(s?"paste":e.state.cutIncoming>l?"cut":"+input")};oo(e.doc,v),sr(e,"inputRead",e,v)}t&&!s&&Al(e,t),On(e),e.curOp.updateInput<2&&(e.curOp.updateInput=h),e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=-1}function Ol(e,t){var r=e.clipboardData&&e.clipboardData.getData("Text");if(r)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||qn(t,function(){return Nl(t,r,0,null,"paste")}),!0}function Al(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var r=e.doc.sel,n=r.ranges.length-1;n>=0;n--){var i=r.ranges[n];if(!(i.head.ch>100||n&&r.ranges[n-1].head.line==i.head.line)){var o=e.getModeAt(i.head),l=!1;if(o.electricChars){for(var s=0;s<o.electricChars.length;s++)if(t.indexOf(o.electricChars.charAt(s))>-1){l=kl(e,i.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(Xe(e.doc,i.head.line).text.slice(0,i.head.ch))&&(l=kl(e,i.head.line,"smart"));l&&sr(e,"electricInput",e,i.head.line)}}}function Dl(e){for(var t=[],r=[],n=0;n<e.doc.sel.ranges.length;n++){var i=e.doc.sel.ranges[n].head.line,o={anchor:et(i,0),head:et(i+1,0)};r.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:r}}function Wl(e,t,r,n){e.setAttribute("autocorrect",r?"":"off"),e.setAttribute("autocapitalize",n?"":"off"),e.setAttribute("spellcheck",!!t)}function Hl(){var e=O("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=O("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return a?e.style.width="1000px":e.setAttribute("wrap","off"),g&&(e.style.border="1px solid black"),Wl(e),t}function Fl(e,t,r,n,i){var o=t,l=r,s=Xe(e,t.line),a=i&&"rtl"==e.direction?-r:r;function u(n){var o,l;if(null==(o=i?function(e,t,r,n){var i=ce(t,e.doc.direction);if(!i)return $o(t,r,n);r.ch>=t.text.length?(r.ch=t.text.length,r.sticky="before"):r.ch<=0&&(r.ch=0,r.sticky="after");var o=ae(i,r.ch,r.sticky),l=i[o];if("ltr"==e.doc.direction&&l.level%2==0&&(n>0?l.to>r.ch:l.from<r.ch))return $o(t,r,n);var s,a=function(e,r){return _o(t,e instanceof et?e.ch:e,r)},u=function(r){return e.options.lineWrapping?(s=s||Dr(e,t),Zr(e,t,s,r)):{begin:0,end:t.text.length}},c=u("before"==r.sticky?a(r,-1):r.ch);if("rtl"==e.doc.direction||1==l.level){var h=1==l.level==n<0,f=a(r,h?1:-1);if(null!=f&&(h?f<=l.to&&f<=c.end:f>=l.from&&f>=c.begin)){var d=h?"before":"after";return new et(r.line,f,d)}}var p=function(e,t,n){for(var o=function(e,t){return t?new et(r.line,a(e,1),"before"):new et(r.line,e,"after")};e>=0&&e<i.length;e+=t){var l=i[e],s=t>0==(1!=l.level),u=s?n.begin:a(n.end,-1);if(l.from<=u&&u<l.to)return o(u,s);if(u=s?l.from:a(l.to,-1),n.begin<=u&&u<n.end)return o(u,s)}},g=p(o+n,n,c);if(g)return g;var v=n>0?c.end:a(c.begin,-1);return null==v||n>0&&v==t.text.length||!(g=p(n>0?0:i.length-1,n,u(v)))?null:g}(e.cm,s,t,r):$o(s,t,r))){if(n||(l=t.line+a)<e.first||l>=e.first+e.size||(t=new et(l,t.ch,t.sticky),!(s=Xe(e,l))))return!1;t=qo(i,e.cm,s,t.line,a)}else t=o;return!0}if("char"==n)u();else if("column"==n)u(!0);else if("word"==n||"group"==n)for(var c=null,h="group"==n,f=e.cm&&e.cm.getHelper(t,"wordChars"),d=!0;!(r<0)||u(!d);d=!1){var p=s.text.charAt(t.ch)||"\n",g=te(p,f)?"w":h&&"\n"==p?"n":!h||/\s/.test(p)?null:"p";if(!h||d||g||(g="s"),c&&c!=g){r<0&&(r=1,u(),t.sticky="after");break}if(g&&(c=g),r>0&&!u(!d))break}var v=to(e,t,o,l,!0);return rt(o,v)&&(v.hitSide=!0),v}function Pl(e,t,r,n){var i,o,l=e.doc,s=t.left;if("page"==n){var a=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),u=Math.max(a-.5*en(e.display),3);i=(r>0?t.bottom:t.top)+r*u}else"line"==n&&(i=r>0?t.bottom+3:t.top-3);for(;(o=$r(e,s,i)).outside;){if(r<0?i<=0:i>=l.height){o.hitSide=!0;break}i+=5*r}return o}var El=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new R,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};function Il(e,t){var r=Ar(e,t.line);if(!r||r.hidden)return null;var n=Xe(e.doc,t.line),i=Nr(r,n,t.line),o=ce(n,e.doc.direction),l="left";o&&(l=ae(o,t.ch)%2?"right":"left");var s=Pr(i.map,t.ch,l);return s.offset="right"==s.collapse?s.end:s.start,s}function zl(e,t){return t&&(e.bad=!0),e}function Rl(e,t,r){var n;if(t==e.display.lineDiv){if(!(n=e.display.lineDiv.childNodes[r]))return zl(e.clipPos(et(e.display.viewTo-1)),!0);t=null,r=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(var i=0;i<e.display.view.length;i++){var o=e.display.view[i];if(o.node==n)return Bl(o,t,r)}}function Bl(e,t,r){var n=e.text.firstChild,i=!1;if(!t||!D(n,t))return zl(et(qe(e.line),0),!0);if(t==n&&(i=!0,t=n.childNodes[r],r=0,!t)){var o=e.rest?$(e.rest):e.line;return zl(et(qe(o),o.text.length),i)}var l=3==t.nodeType?t:null,s=t;for(l||1!=t.childNodes.length||3!=t.firstChild.nodeType||(l=t.firstChild,r&&(r=l.nodeValue.length));s.parentNode!=n;)s=s.parentNode;var a=e.measure,u=a.maps;function c(t,r,n){for(var i=-1;i<(u?u.length:0);i++)for(var o=i<0?a.map:u[i],l=0;l<o.length;l+=3){var s=o[l+2];if(s==t||s==r){var c=qe(i<0?e.line:e.rest[i]),h=o[l]+n;return(n<0||s!=t)&&(h=o[l+(n?1:0)]),et(c,h)}}}var h=c(l,s,r);if(h)return zl(h,i);for(var f=s.nextSibling,d=l?l.nodeValue.length-r:0;f;f=f.nextSibling){if(h=c(f,f.firstChild,0))return zl(et(h.line,h.ch-d),i);d+=f.textContent.length}for(var p=s.previousSibling,g=r;p;p=p.previousSibling){if(h=c(p,p.firstChild,-1))return zl(et(h.line,h.ch+g),i);g+=p.textContent.length}}El.prototype.init=function(e){var t=this,r=this,n=r.cm,i=r.div=e.lineDiv;function o(e){if(!ve(n,e)){if(n.somethingSelected())Ml({lineWise:!1,text:n.getSelections()}),"cut"==e.type&&n.replaceSelection("",null,"cut");else{if(!n.options.lineWiseCopyCut)return;var t=Dl(n);Ml({lineWise:!0,text:t.text}),"cut"==e.type&&n.operation(function(){n.setSelections(t.ranges,0,V),n.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var o=Tl.text.join("\n");if(e.clipboardData.setData("Text",o),e.clipboardData.getData("Text")==o)return void e.preventDefault()}var l=Hl(),s=l.firstChild;n.display.lineSpace.insertBefore(l,n.display.lineSpace.firstChild),s.value=Tl.text.join("\n");var a=document.activeElement;P(s),setTimeout(function(){n.display.lineSpace.removeChild(l),a.focus(),a==i&&r.showPrimarySelection()},50)}}Wl(i,n.options.spellcheck,n.options.autocorrect,n.options.autocapitalize),fe(i,"paste",function(e){ve(n,e)||Ol(e,n)||s<=11&&setTimeout(Zn(n,function(){return t.updateFromDOM()}),20)}),fe(i,"compositionstart",function(e){t.composing={data:e.data,done:!1}}),fe(i,"compositionupdate",function(e){t.composing||(t.composing={data:e.data,done:!1})}),fe(i,"compositionend",function(e){t.composing&&(e.data!=t.composing.data&&t.readFromDOMSoon(),t.composing.done=!0)}),fe(i,"touchstart",function(){return r.forceCompositionEnd()}),fe(i,"input",function(){t.composing||t.readFromDOMSoon()}),fe(i,"copy",o),fe(i,"cut",o)},El.prototype.prepareSelection=function(){var e=gn(this.cm,!1);return e.focus=document.activeElement==this.div,e},El.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},El.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},El.prototype.showPrimarySelection=function(){var e=this.getSelection(),t=this.cm,n=t.doc.sel.primary(),i=n.from(),o=n.to();if(t.display.viewTo==t.display.viewFrom||i.line>=t.display.viewTo||o.line<t.display.viewFrom)e.removeAllRanges();else{var l=Rl(t,e.anchorNode,e.anchorOffset),s=Rl(t,e.focusNode,e.focusOffset);if(!l||l.bad||!s||s.bad||0!=tt(ot(l,s),i)||0!=tt(it(l,s),o)){var a=t.display.view,u=i.line>=t.display.viewFrom&&Il(t,i)||{node:a[0].measure.map[2],offset:0},c=o.line<t.display.viewTo&&Il(t,o);if(!c){var h=a[a.length-1].measure,f=h.maps?h.maps[h.maps.length-1]:h.map;c={node:f[f.length-1],offset:f[f.length-2]-f[f.length-3]}}if(u&&c){var d,p=e.rangeCount&&e.getRangeAt(0);try{d=k(u.node,u.offset,c.offset,c.node)}catch(e){}d&&(!r&&t.state.focused?(e.collapse(u.node,u.offset),d.collapsed||(e.removeAllRanges(),e.addRange(d))):(e.removeAllRanges(),e.addRange(d)),p&&null==e.anchorNode?e.addRange(p):r&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},El.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},El.prototype.showMultipleSelections=function(e){N(this.cm.display.cursorDiv,e.cursors),N(this.cm.display.selectionDiv,e.selection)},El.prototype.rememberSelection=function(){var e=this.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},El.prototype.selectionInEditor=function(){var e=this.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return D(this.div,t)},El.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&document.activeElement==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())},El.prototype.blur=function(){this.div.blur()},El.prototype.getField=function(){return this.div},El.prototype.supportsTouch=function(){return!0},El.prototype.receivedFocus=function(){var e=this;this.selectionInEditor()?this.pollSelection():qn(this.cm,function(){return e.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,function t(){e.cm.state.focused&&(e.pollSelection(),e.polling.set(e.cm.options.pollInterval,t))})},El.prototype.selectionChanged=function(){var e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},El.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=this.getSelection(),t=this.cm;if(v&&c&&this.cm.display.gutterSpecs.length&&function(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var r=Rl(t,e.anchorNode,e.anchorOffset),n=Rl(t,e.focusNode,e.focusOffset);r&&n&&qn(t,function(){$i(t.doc,xi(r,n),V),(r.bad||n.bad)&&(t.curOp.selectionChanged=!0)})}}},El.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e,t,r,n=this.cm,i=n.display,o=n.doc.sel.primary(),l=o.from(),s=o.to();if(0==l.ch&&l.line>n.firstLine()&&(l=et(l.line-1,Xe(n.doc,l.line-1).length)),s.ch==Xe(n.doc,s.line).text.length&&s.line<n.lastLine()&&(s=et(s.line+1,0)),l.line<i.viewFrom||s.line>i.viewTo-1)return!1;l.line==i.viewFrom||0==(e=an(n,l.line))?(t=qe(i.view[0].line),r=i.view[0].node):(t=qe(i.view[e].line),r=i.view[e-1].node.nextSibling);var a,u,c=an(n,s.line);if(c==i.view.length-1?(a=i.viewTo-1,u=i.lineDiv.lastChild):(a=qe(i.view[c+1].line)-1,u=i.view[c+1].node.previousSibling),!r)return!1;for(var h=n.doc.splitLines(function(e,t,r,n,i){var o="",l=!1,s=e.doc.lineSeparator(),a=!1;function u(){l&&(o+=s,a&&(o+=s),l=a=!1)}function c(e){e&&(u(),o+=e)}function h(t){if(1==t.nodeType){var r=t.getAttribute("cm-text");if(r)return void c(r);var o,f=t.getAttribute("cm-marker");if(f){var d=e.findMarks(et(n,0),et(i+1,0),(v=+f,function(e){return e.id==v}));return void(d.length&&(o=d[0].find(0))&&c(Ye(e.doc,o.from,o.to).join(s)))}if("false"==t.getAttribute("contenteditable"))return;var p=/^(pre|div|p|li|table|br)$/i.test(t.nodeName);if(!/^br$/i.test(t.nodeName)&&0==t.textContent.length)return;p&&u();for(var g=0;g<t.childNodes.length;g++)h(t.childNodes[g]);/^(pre|p)$/i.test(t.nodeName)&&(a=!0),p&&(l=!0)}else 3==t.nodeType&&c(t.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "));var v}for(;h(t),t!=r;)t=t.nextSibling,a=!1;return o}(n,r,u,t,a)),f=Ye(n.doc,et(t,0),et(a,Xe(n.doc,a).text.length));h.length>1&&f.length>1;)if($(h)==$(f))h.pop(),f.pop(),a--;else{if(h[0]!=f[0])break;h.shift(),f.shift(),t++}for(var d=0,p=0,g=h[0],v=f[0],m=Math.min(g.length,v.length);d<m&&g.charCodeAt(d)==v.charCodeAt(d);)++d;for(var y=$(h),b=$(f),w=Math.min(y.length-(1==h.length?d:0),b.length-(1==f.length?d:0));p<w&&y.charCodeAt(y.length-p-1)==b.charCodeAt(b.length-p-1);)++p;if(1==h.length&&1==f.length&&t==l.line)for(;d&&d>l.ch&&y.charCodeAt(y.length-p-1)==b.charCodeAt(b.length-p-1);)d--,p++;h[h.length-1]=y.slice(0,y.length-p).replace(/^\u200b+/,""),h[0]=h[0].slice(d).replace(/\u200b+$/,"");var x=et(t,d),C=et(a,f.length?$(f).length-p:0);return h.length>1||h[0]||tt(x,C)?(co(n.doc,h,x,C,"+input"),!0):void 0},El.prototype.ensurePolled=function(){this.forceCompositionEnd()},El.prototype.reset=function(){this.forceCompositionEnd()},El.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},El.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()},80))},El.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||qn(this.cm,function(){return un(e.cm)})},El.prototype.setUneditable=function(e){e.contentEditable="false"},El.prototype.onKeyPress=function(e){0==e.charCode||this.composing||(e.preventDefault(),this.cm.isReadOnly()||Zn(this.cm,Nl)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},El.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},El.prototype.onContextMenu=function(){},El.prototype.resetPosition=function(){},El.prototype.needsContentAttribute=!0;var Gl=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new R,this.hasSelection=!1,this.composing=null};Gl.prototype.init=function(e){var t=this,r=this,n=this.cm;this.createField(e);var i=this.textarea;function o(e){if(!ve(n,e)){if(n.somethingSelected())Ml({lineWise:!1,text:n.getSelections()});else{if(!n.options.lineWiseCopyCut)return;var t=Dl(n);Ml({lineWise:!0,text:t.text}),"cut"==e.type?n.setSelections(t.ranges,null,V):(r.prevInput="",i.value=t.text.join("\n"),P(i))}"cut"==e.type&&(n.state.cutIncoming=+new Date)}}e.wrapper.insertBefore(this.wrapper,e.wrapper.firstChild),g&&(i.style.width="0px"),fe(i,"input",function(){l&&s>=9&&t.hasSelection&&(t.hasSelection=null),r.poll()}),fe(i,"paste",function(e){ve(n,e)||Ol(e,n)||(n.state.pasteIncoming=+new Date,r.fastPoll())}),fe(i,"cut",o),fe(i,"copy",o),fe(e.scroller,"paste",function(t){if(!xr(e,t)&&!ve(n,t)){if(!i.dispatchEvent)return n.state.pasteIncoming=+new Date,void r.focus();var o=new Event("paste");o.clipboardData=t.clipboardData,i.dispatchEvent(o)}}),fe(e.lineSpace,"selectstart",function(t){xr(e,t)||we(t)}),fe(i,"compositionstart",function(){var e=n.getCursor("from");r.composing&&r.composing.range.clear(),r.composing={start:e,range:n.markText(e,n.getCursor("to"),{className:"CodeMirror-composing"})}}),fe(i,"compositionend",function(){r.composing&&(r.poll(),r.composing.range.clear(),r.composing=null)})},Gl.prototype.createField=function(e){this.wrapper=Hl(),this.textarea=this.wrapper.firstChild},Gl.prototype.prepareSelection=function(){var e=this.cm,t=e.display,r=e.doc,n=gn(e);if(e.options.moveInputWithCursor){var i=Xr(e,r.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),l=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,i.top+l.top-o.top)),n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,i.left+l.left-o.left))}return n},Gl.prototype.showSelection=function(e){var t=this.cm.display;N(t.cursorDiv,e.cursors),N(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Gl.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var r=t.getSelection();this.textarea.value=r,t.state.focused&&P(this.textarea),l&&s>=9&&(this.hasSelection=r)}else e||(this.prevInput=this.textarea.value="",l&&s>=9&&(this.hasSelection=null))}},Gl.prototype.getField=function(){return this.textarea},Gl.prototype.supportsTouch=function(){return!1},Gl.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!m||W()!=this.textarea))try{this.textarea.focus()}catch(e){}},Gl.prototype.blur=function(){this.textarea.blur()},Gl.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Gl.prototype.receivedFocus=function(){this.slowPoll()},Gl.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Gl.prototype.fastPoll=function(){var e=!1,t=this;t.pollingFast=!0,t.polling.set(20,function r(){t.poll()||e?(t.pollingFast=!1,t.slowPoll()):(e=!0,t.polling.set(60,r))})},Gl.prototype.poll=function(){var e=this,t=this.cm,r=this.textarea,n=this.prevInput;if(this.contextMenuPending||!t.state.focused||He(r)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var i=r.value;if(i==n&&!t.somethingSelected())return!1;if(l&&s>=9&&this.hasSelection===i||y&&/[\uf700-\uf7ff]/.test(i))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=i.charCodeAt(0);if(8203!=o||n||(n="â"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var a=0,u=Math.min(n.length,i.length);a<u&&n.charCodeAt(a)==i.charCodeAt(a);)++a;return qn(t,function(){Nl(t,i.slice(a),n.length-a,null,e.composing?"*compose":null),i.length>1e3||i.indexOf("\n")>-1?r.value=e.prevInput="":e.prevInput=i,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Gl.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Gl.prototype.onKeyPress=function(){l&&s>=9&&(this.hasSelection=null),this.fastPoll()},Gl.prototype.onContextMenu=function(e){var t=this,r=t.cm,n=r.display,i=t.textarea;t.contextMenuPending&&t.contextMenuPending();var o=sn(r,e),u=n.scroller.scrollTop;if(o&&!h){r.options.resetSelectionOnContextMenu&&-1==r.doc.sel.contains(o)&&Zn(r,$i)(r.doc,xi(o),V);var c,f=i.style.cssText,d=t.wrapper.style.cssText,p=t.wrapper.offsetParent.getBoundingClientRect();if(t.wrapper.style.cssText="position: static",i.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-p.top-5)+"px; left: "+(e.clientX-p.left-5)+"px;\n      z-index: 1000; background: "+(l?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",a&&(c=window.scrollY),n.input.focus(),a&&window.scrollTo(null,c),n.input.reset(),r.somethingSelected()||(i.value=t.prevInput=" "),t.contextMenuPending=m,n.selForContextMenu=r.doc.sel,clearTimeout(n.detectingSelectAll),l&&s>=9&&v(),S){Se(e);var g=function(){pe(window,"mouseup",g),setTimeout(m,20)};fe(window,"mouseup",g)}else setTimeout(m,50)}function v(){if(null!=i.selectionStart){var e=r.somethingSelected(),o="â"+(e?i.value:"");i.value="â",i.value=o,t.prevInput=e?"":"â",i.selectionStart=1,i.selectionEnd=o.length,n.selForContextMenu=r.doc.sel}}function m(){if(t.contextMenuPending==m&&(t.contextMenuPending=!1,t.wrapper.style.cssText=d,i.style.cssText=f,l&&s<9&&n.scrollbars.setScrollTop(n.scroller.scrollTop=u),null!=i.selectionStart)){(!l||l&&s<9)&&v();var e=0,o=function(){n.selForContextMenu==r.doc.sel&&0==i.selectionStart&&i.selectionEnd>0&&"â"==t.prevInput?Zn(r,no)(r):e++<10?n.detectingSelectAll=setTimeout(o,500):(n.selForContextMenu=null,n.input.reset())};n.detectingSelectAll=setTimeout(o,200)}}},Gl.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e},Gl.prototype.setUneditable=function(){},Gl.prototype.needsContentAttribute=!1,function(e){var t=e.optionHandlers;function r(r,n,i,o){e.defaults[r]=n,i&&(t[r]=o?function(e,t,r){r!=yl&&i(e,t,r)}:i)}e.defineOption=r,e.Init=yl,r("value","",function(e,t){return e.setValue(t)},!0),r("mode",null,function(e,t){e.doc.modeOption=t,Ti(e)},!0),r("indentUnit",2,Ti,!0),r("indentWithTabs",!1),r("smartIndent",!0),r("tabSize",4,function(e){Mi(e),Rr(e),un(e)},!0),r("lineSeparator",null,function(e,t){if(e.doc.lineSep=t,t){var r=[],n=e.doc.first;e.doc.iter(function(e){for(var i=0;;){var o=e.text.indexOf(t,i);if(-1==o)break;i=o+t.length,r.push(et(n,o))}n++});for(var i=r.length-1;i>=0;i--)co(e.doc,t,r[i],et(r[i].line,r[i].ch+t.length))}}),r("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,function(e,t,r){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),r!=yl&&e.refresh()}),r("specialCharPlaceholder",Qt,function(e){return e.refresh()},!0),r("electricChars",!0),r("inputStyle",m?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),r("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0),r("autocorrect",!1,function(e,t){return e.getInputField().autocorrect=t},!0),r("autocapitalize",!1,function(e,t){return e.getInputField().autocapitalize=t},!0),r("rtlMoveVisually",!w),r("wholeLineUpdateBefore",!0),r("theme","default",function(e){ml(e),fi(e)},!0),r("keyMap","default",function(e,t,r){var n=Xo(t),i=r!=yl&&Xo(r);i&&i.detach&&i.detach(e,n),n.attach&&n.attach(e,i||null)}),r("extraKeys",null),r("configureMouse",null),r("lineWrapping",!1,Cl,!0),r("gutters",[],function(e,t){e.display.gutterSpecs=ci(t,e.options.lineNumbers),fi(e)},!0),r("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?nn(e.display)+"px":"0",e.refresh()},!0),r("coverGutterNextToScrollbar",!1,function(e){return Rn(e)},!0),r("scrollbarStyle","native",function(e){Un(e),Rn(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0),r("lineNumbers",!1,function(e,t){e.display.gutterSpecs=ci(e.options.gutters,t),fi(e)},!0),r("firstLineNumber",1,fi,!0),r("lineNumberFormatter",function(e){return e},fi,!0),r("showCursorWhenSelecting",!1,pn,!0),r("resetSelectionOnContextMenu",!0),r("lineWiseCopyCut",!0),r("pasteLinesPerSelection",!0),r("selectionsMayTouch",!1),r("readOnly",!1,function(e,t){"nocursor"==t&&(Sn(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)}),r("disableInput",!1,function(e,t){t||e.display.input.reset()},!0),r("dragDrop",!0,xl),r("allowDropFileTypes",null),r("cursorBlinkRate",530),r("cursorScrollMargin",0),r("cursorHeight",1,pn,!0),r("singleCursorHeightPerLine",!0,pn,!0),r("workTime",100),r("workDelay",100),r("flattenSpans",!0,Mi,!0),r("addModeClass",!1,Mi,!0),r("pollInterval",100),r("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t}),r("historyEventDelay",1250),r("viewportMargin",10,function(e){return e.refresh()},!0),r("maxHighlightLength",1e4,Mi,!0),r("moveInputWithCursor",!0,function(e,t){t||e.display.input.resetPosition()}),r("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""}),r("autofocus",null),r("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0),r("phrases",null)}(Sl),function(e){var t=e.optionHandlers,r=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,r){var n=this.options,i=n[e];n[e]==r&&"mode"!=e||(n[e]=r,t.hasOwnProperty(e)&&Zn(this,t[e])(this,r,i),ge(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](Xo(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,r=0;r<t.length;++r)if(t[r]==e||t[r].name==e)return t.splice(r,1),!0},addOverlay:Qn(function(t,r){var n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");!function(e,t,r){for(var n=0,i=r(t);n<e.length&&r(e[n])<=i;)n++;e.splice(n,0,t)}(this.state.overlays,{mode:n,modeSpec:t,opaque:r&&r.opaque,priority:r&&r.priority||0},function(e){return e.priority}),this.state.modeGen++,un(this)}),removeOverlay:Qn(function(e){for(var t=this.state.overlays,r=0;r<t.length;++r){var n=t[r].modeSpec;if(n==e||"string"==typeof e&&n.name==e)return t.splice(r,1),this.state.modeGen++,void un(this)}}),indentLine:Qn(function(e,t,r){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),Qe(this.doc,e)&&kl(this,e,t,r)}),indentSelection:Qn(function(e){for(var t=this.doc.sel.ranges,r=-1,n=0;n<t.length;n++){var i=t[n];if(i.empty())i.head.line>r&&(kl(this,i.head.line,e,!0),r=i.head.line,n==this.doc.sel.primIndex&&On(this));else{var o=i.from(),l=i.to(),s=Math.max(r,o.line);r=Math.min(this.lastLine(),l.line-(l.ch?0:1))+1;for(var a=s;a<r;++a)kl(this,a,e);var u=this.doc.sel.ranges;0==o.ch&&t.length==u.length&&u[n].from().ch>0&&Xi(this.doc,n,new bi(o,u[n].to()),V)}}}),getTokenAt:function(e,t){return yt(this,e,t)},getLineTokens:function(e,t){return yt(this,et(e),t,!0)},getTokenTypeAt:function(e){e=st(this.doc,e);var t,r=ft(this,Xe(this.doc,e.line)),n=0,i=(r.length-1)/2,o=e.ch;if(0==o)t=r[2];else for(;;){var l=n+i>>1;if((l?r[2*l-1]:0)>=o)i=l;else{if(!(r[2*l+1]<o)){t=r[2*l+2];break}n=l+1}}var s=t?t.indexOf("overlay "):-1;return s<0?t:0==s?null:t.slice(0,s-1)},getModeAt:function(t){var r=this.doc.mode;return r.innerMode?e.innerMode(r,this.getTokenAt(t).state).mode:r},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var n=[];if(!r.hasOwnProperty(t))return n;var i=r[t],o=this.getModeAt(e);if("string"==typeof o[t])i[o[t]]&&n.push(i[o[t]]);else if(o[t])for(var l=0;l<o[t].length;l++){var s=i[o[t][l]];s&&n.push(s)}else o.helperType&&i[o.helperType]?n.push(i[o.helperType]):i[o.name]&&n.push(i[o.name]);for(var a=0;a<i._global.length;a++){var u=i._global[a];u.pred(o,this)&&-1==B(n,u.val)&&n.push(u.val)}return n},getStateAfter:function(e,t){var r=this.doc;return dt(this,(e=lt(r,null==e?r.first+r.size-1:e))+1,t).state},cursorCoords:function(e,t){var r=this.doc.sel.primary();return Xr(this,null==e?r.head:"object"==typeof e?st(this.doc,e):e?r.from():r.to(),t||"page")},charCoords:function(e,t){return jr(this,st(this.doc,e),t||"page")},coordsChar:function(e,t){return $r(this,(e=Kr(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=Kr(this,{top:e,left:0},t||"page").top,Ze(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,r){var n,i=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>o&&(e=o,i=!0),n=Xe(this.doc,e)}else n=e;return Vr(this,n,{top:0,left:0},t||"page",r||i).top+(i?this.doc.height-Vt(n):0)},defaultTextHeight:function(){return en(this.display)},defaultCharWidth:function(){return tn(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,r,n,i){var o,l,s,a=this.display,u=(e=Xr(this,st(this.doc,e))).bottom,c=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),a.sizer.appendChild(t),"over"==n)u=e.top;else if("above"==n||"near"==n){var h=Math.max(a.wrapper.clientHeight,this.doc.height),f=Math.max(a.sizer.clientWidth,a.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>h)&&e.top>t.offsetHeight?u=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=h&&(u=e.bottom),c+t.offsetWidth>f&&(c=f-t.offsetWidth)}t.style.top=u+"px",t.style.left=t.style.right="","right"==i?(c=a.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==i?c=0:"middle"==i&&(c=(a.sizer.clientWidth-t.offsetWidth)/2),t.style.left=c+"px"),r&&(o=this,l={left:c,top:u,right:c+t.offsetWidth,bottom:u+t.offsetHeight},null!=(s=Mn(o,l)).scrollTop&&Hn(o,s.scrollTop),null!=s.scrollLeft&&Pn(o,s.scrollLeft))},triggerOnKeyDown:Qn(ll),triggerOnKeyPress:Qn(al),triggerOnKeyUp:sl,triggerOnMouseDown:Qn(fl),execCommand:function(e){if(Zo.hasOwnProperty(e))return Zo[e].call(null,this)},triggerElectric:Qn(function(e){Al(this,e)}),findPosH:function(e,t,r,n){var i=1;t<0&&(i=-1,t=-t);for(var o=st(this.doc,e),l=0;l<t&&!(o=Fl(this.doc,o,i,r,n)).hitSide;++l);return o},moveH:Qn(function(e,t){var r=this;this.extendSelectionsBy(function(n){return r.display.shift||r.doc.extend||n.empty()?Fl(r.doc,n.head,e,t,r.options.rtlMoveVisually):e<0?n.from():n.to()},j)}),deleteH:Qn(function(e,t){var r=this.doc.sel,n=this.doc;r.somethingSelected()?n.replaceSelection("",null,"+delete"):Yo(this,function(r){var i=Fl(n,r.head,e,t,!1);return e<0?{from:i,to:r.head}:{from:r.head,to:i}})}),findPosV:function(e,t,r,n){var i=1,o=n;t<0&&(i=-1,t=-t);for(var l=st(this.doc,e),s=0;s<t;++s){var a=Xr(this,l,"div");if(null==o?o=a.left:a.left=o,(l=Pl(this,a,i,r)).hitSide)break}return l},moveV:Qn(function(e,t){var r=this,n=this.doc,i=[],o=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(l){if(o)return e<0?l.from():l.to();var s=Xr(r,l.head,"div");null!=l.goalColumn&&(s.left=l.goalColumn),i.push(s.left);var a=Pl(r,s,e,t);return"page"==t&&l==n.sel.primary()&&Nn(r,jr(r,a,"div").top-s.top),a},j),i.length)for(var l=0;l<n.sel.ranges.length;l++)n.sel.ranges[l].goalColumn=i[l]}),findWordAt:function(e){var t=Xe(this.doc,e.line).text,r=e.ch,n=e.ch;if(t){var i=this.getHelper(e,"wordChars");"before"!=e.sticky&&n!=t.length||!r?++n:--r;for(var o=t.charAt(r),l=te(o,i)?function(e){return te(e,i)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!te(e)};r>0&&l(t.charAt(r-1));)--r;for(;n<t.length&&l(t.charAt(n));)++n}return new bi(et(e.line,r),et(e.line,n))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?H(this.display.cursorDiv,"CodeMirror-overwrite"):T(this.display.cursorDiv,"CodeMirror-overwrite"),ge(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==W()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Qn(function(e,t){An(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-kr(this)-this.display.barHeight,width:e.scrollWidth-kr(this)-this.display.barWidth,clientHeight:Mr(this),clientWidth:Tr(this)}},scrollIntoView:Qn(function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:et(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?function(e,t){Dn(e),e.curOp.scrollToPos=t}(this,e):Wn(this,e.from,e.to,e.margin)}),setSize:Qn(function(e,t){var r=this,n=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&zr(this);var i=this.display.viewFrom;this.doc.iter(i,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){cn(r,i,"widget");break}++i}),this.curOp.forceUpdate=!0,ge(this,"refresh",this)}),operation:function(e){return qn(this,e)},startOperation:function(){return Kn(this)},endOperation:function(){return jn(this)},refresh:Qn(function(){var e=this.display.cachedTextHeight;un(this),this.curOp.forceUpdate=!0,Rr(this),An(this,this.doc.scrollLeft,this.doc.scrollTop),li(this.display),(null==e||Math.abs(e-en(this.display))>.5)&&ln(this),ge(this,"refresh",this)}),swapDoc:Qn(function(e){var t=this.doc;return t.cm=null,this.state.selectingText&&this.state.selectingText(),Di(this,e),Rr(this),this.display.input.reset(),An(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,sr(this,"swapDoc",this,t),t}),phrase:function(e){var t=this.options.phrases;return t&&Object.prototype.hasOwnProperty.call(t,e)?t[e]:e},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},be(e),e.registerHelper=function(t,n,i){r.hasOwnProperty(t)||(r[t]=e[t]={_global:[]}),r[t][n]=i},e.registerGlobalHelper=function(t,n,i,o){e.registerHelper(t,n,o),r[t]._global.push({pred:i,val:o})}}(Sl);var Ul="iter insert remove copy getEditor constructor".split(" ");for(var Vl in Mo.prototype)Mo.prototype.hasOwnProperty(Vl)&&B(Ul,Vl)<0&&(Sl.prototype[Vl]=function(e){return function(){return e.apply(this.doc,arguments)}}(Mo.prototype[Vl]));return be(Mo),Sl.inputStyles={textarea:Gl,contenteditable:El},Sl.defineMode=function(e){Sl.defaults.mode||"null"==e||(Sl.defaults.mode=e),function(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),Ee[e]=t}.apply(this,arguments)},Sl.defineMIME=function(e,t){Ie[e]=t},Sl.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),Sl.defineMIME("text/plain","null"),Sl.defineExtension=function(e,t){Sl.prototype[e]=t},Sl.defineDocExtension=function(e,t){Mo.prototype[e]=t},Sl.fromTextArea=function(e,t){if((t=t?I(t):{}).value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var r=W();t.autofocus=r==e||null!=e.getAttribute("autofocus")&&r==document.body}function n(){e.value=s.getValue()}var i;if(e.form&&(fe(e.form,"submit",n),!t.leaveSubmitMethodAlone)){var o=e.form;i=o.submit;try{var l=o.submit=function(){n(),o.submit=i,o.submit(),o.submit=l}}catch(e){}}t.finishInit=function(r){r.save=n,r.getTextArea=function(){return e},r.toTextArea=function(){r.toTextArea=isNaN,n(),e.parentNode.removeChild(r.getWrapperElement()),e.style.display="",e.form&&(pe(e.form,"submit",n),t.leaveSubmitMethodAlone||"function"!=typeof e.form.submit||(e.form.submit=i))}},e.style.display="none";var s=Sl(function(t){return e.parentNode.insertBefore(t,e.nextSibling)},t);return s},function(e){e.off=pe,e.on=fe,e.wheelEventPixels=vi,e.Doc=Mo,e.splitLines=We,e.countColumn=z,e.findColumn=X,e.isWordChar=ee,e.Pass=U,e.signal=ge,e.Line=Xt,e.changeEnd=Ci,e.scrollbarModel=Gn,e.Pos=et,e.cmpPos=tt,e.modes=Ee,e.mimeModes=Ie,e.resolveMode=ze,e.getMode=Re,e.modeExtensions=Be,e.extendMode=Ge,e.copyState=Ue,e.startState=Ke,e.innerMode=Ve,e.commands=Zo,e.keyMap=Ro,e.keyName=jo,e.isModifierKey=Vo,e.lookupKey=Uo,e.normalizeKeyMap=Go,e.StringStream=je,e.SharedTextMarker=So,e.TextMarker=xo,e.LineWidget=yo,e.e_preventDefault=we,e.e_stopPropagation=xe,e.e_stop=Se,e.addClass=H,e.contains=D,e.rmClass=T,e.keyNames=Po}(Sl),Sl.version="5.52.2",Sl});

},{}],312:[function(require,module,exports){
!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e,t,n,r,o,a){this.indented=e,this.column=t,this.type=n,this.info=r,this.align=o,this.prev=a}function n(e,n,r,o){var a=e.indented;return e.context&&"statement"==e.context.type&&"statement"!=r&&(a=e.context.indented),e.context=new t(a,n,r,o,null,e.context)}function r(e){var t=e.context.type;return")"!=t&&"]"!=t&&"}"!=t||(e.indented=e.context.indented),e.context=e.context.prev}function o(e,t,n){return"variable"==t.prevToken||"type"==t.prevToken||(!!/\S(?:[^- ]>|[*\]])\s*$|\*$/.test(e.string.slice(0,n))||(!(!t.typeAtEndOfLine||e.column()!=e.indentation())||void 0))}function a(e){for(;;){if(!e||"top"==e.type)return!0;if("}"==e.type&&"namespace"!=e.prev.info)return!1;e=e.prev}}function i(e){for(var t={},n=e.split(" "),r=0;r<n.length;++r)t[n[r]]=!0;return t}function l(e,t){return"function"==typeof e?e(t):e.propertyIsEnumerable(t)}e.defineMode("clike",function(i,s){var c,u,d=i.indentUnit,f=s.statementIndentUnit||d,p=s.dontAlignCalls,m=s.keywords||{},h=s.types||{},y=s.builtin||{},g=s.blockKeywords||{},k=s.defKeywords||{},b=s.atoms||{},x=s.hooks||{},v=s.multiLineStrings,w=!1!==s.indentStatements,_=!1!==s.indentSwitch,S=s.namespaceSeparator,T=s.isPunctuationChar||/[\[\]{}\(\),;\:\.]/,C=s.numberStart||/[\d\.]/,I=s.number||/^(?:0x[a-f\d]+|0b[01]+|(?:\d+\.?\d*|\.\d+)(?:e[-+]?\d+)?)(u|ll?|l|f)?/i,N=s.isOperatorChar||/[+\-*&%=<>!?|\/]/,M=s.isIdentifierChar||/[\w\$_\xa1-\uffff]/,L=s.isReservedIdentifier||!1;function D(e,t){var n,r=e.next();if(x[r]){var o=x[r](e,t);if(!1!==o)return o}if('"'==r||"'"==r)return t.tokenize=(n=r,function(e,t){for(var r,o=!1,a=!1;null!=(r=e.next());){if(r==n&&!o){a=!0;break}o=!o&&"\\"==r}return(a||!o&&!v)&&(t.tokenize=null),"string"}),t.tokenize(e,t);if(T.test(r))return c=r,null;if(C.test(r)){if(e.backUp(1),e.match(I))return"number";e.next()}if("/"==r){if(e.eat("*"))return t.tokenize=P,P(e,t);if(e.eat("/"))return e.skipToEnd(),"comment"}if(N.test(r)){for(;!e.match(/^\/[\/*]/,!1)&&e.eat(N););return"operator"}if(e.eatWhile(M),S)for(;e.match(S);)e.eatWhile(M);var a=e.current();return l(m,a)?(l(g,a)&&(c="newstatement"),l(k,a)&&(u=!0),"keyword"):l(h,a)?"type":l(y,a)||L&&L(a)?(l(g,a)&&(c="newstatement"),"builtin"):l(b,a)?"atom":"variable"}function P(e,t){for(var n,r=!1;n=e.next();){if("/"==n&&r){t.tokenize=null;break}r="*"==n}return"comment"}function E(e,t){s.typeFirstDefinitions&&e.eol()&&a(t.context)&&(t.typeAtEndOfLine=o(e,t,e.pos))}return{startState:function(e){return{tokenize:null,context:new t((e||0)-d,0,"top",null,!1),indented:0,startOfLine:!0,prevToken:null}},token:function(e,t){var i=t.context;if(e.sol()&&(null==i.align&&(i.align=!1),t.indented=e.indentation(),t.startOfLine=!0),e.eatSpace())return E(e,t),null;c=u=null;var l=(t.tokenize||D)(e,t);if("comment"==l||"meta"==l)return l;if(null==i.align&&(i.align=!0),";"==c||":"==c||","==c&&e.match(/^\s*(?:\/\/.*)?$/,!1))for(;"statement"==t.context.type;)r(t);else if("{"==c)n(t,e.column(),"}");else if("["==c)n(t,e.column(),"]");else if("("==c)n(t,e.column(),")");else if("}"==c){for(;"statement"==i.type;)i=r(t);for("}"==i.type&&(i=r(t));"statement"==i.type;)i=r(t)}else c==i.type?r(t):w&&(("}"==i.type||"top"==i.type)&&";"!=c||"statement"==i.type&&"newstatement"==c)&&n(t,e.column(),"statement",e.current());if("variable"==l&&("def"==t.prevToken||s.typeFirstDefinitions&&o(e,t,e.start)&&a(t.context)&&e.match(/^\s*\(/,!1))&&(l="def"),x.token){var d=x.token(e,t,l);void 0!==d&&(l=d)}return"def"==l&&!1===s.styleDefs&&(l="variable"),t.startOfLine=!1,t.prevToken=u?"def":l||c,E(e,t),l},indent:function(t,n){if(t.tokenize!=D&&null!=t.tokenize||t.typeAtEndOfLine)return e.Pass;var r=t.context,o=n&&n.charAt(0),a=o==r.type;if("statement"==r.type&&"}"==o&&(r=r.prev),s.dontIndentStatements)for(;"statement"==r.type&&s.dontIndentStatements.test(r.info);)r=r.prev;if(x.indent){var i=x.indent(t,r,n,d);if("number"==typeof i)return i}var l=r.prev&&"switch"==r.prev.info;if(s.allmanIndentation&&/[{(]/.test(o)){for(;"top"!=r.type&&"}"!=r.type;)r=r.prev;return r.indented}return"statement"==r.type?r.indented+("{"==o?0:f):!r.align||p&&")"==r.type?")"!=r.type||a?r.indented+(a?0:d)+(a||!l||/^(?:case|default)\b/.test(n)?0:d):r.indented+f:r.column+(a?0:1)},electricInput:_?/^\s*(?:case .*?:|default:|\{\}?|\})$/:/^\s*[{}]$/,blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",lineComment:"//",fold:"brace"}});var s="auto if break case register continue return default do sizeof static else struct switch extern typedef union for goto while enum const volatile inline restrict asm fortran",c="alignas alignof and and_eq audit axiom bitand bitor catch class compl concept constexpr const_cast decltype delete dynamic_cast explicit export final friend import module mutable namespace new noexcept not not_eq operator or or_eq override private protected public reinterpret_cast requires static_assert static_cast template this thread_local throw try typeid typename using virtual xor xor_eq",u="bycopy byref in inout oneway out self super atomic nonatomic retain copy readwrite readonly strong weak assign typeof nullable nonnull null_resettable _cmd @interface @implementation @end @protocol @encode @property @synthesize @dynamic @class @public @package @private @protected @required @optional @try @catch @finally @import @selector @encode @defs @synchronized @autoreleasepool @compatibility_alias @available",d="FOUNDATION_EXPORT FOUNDATION_EXTERN NS_INLINE NS_FORMAT_FUNCTION  NS_RETURNS_RETAINEDNS_ERROR_ENUM NS_RETURNS_NOT_RETAINED NS_RETURNS_INNER_POINTER NS_DESIGNATED_INITIALIZER NS_ENUM NS_OPTIONS NS_REQUIRES_NIL_TERMINATION NS_ASSUME_NONNULL_BEGIN NS_ASSUME_NONNULL_END NS_SWIFT_NAME NS_REFINED_FOR_SWIFT",f=i("int long char short double float unsigned signed void bool"),p=i("SEL instancetype id Class Protocol BOOL");function m(e){return l(f,e)||/.+_t$/.test(e)}function h(e){return m(e)||l(p,e)}var y="case do else for if switch while struct enum union";function g(e,t){if(!t.startOfLine)return!1;for(var n,r=null;n=e.peek();){if("\\"==n&&e.match(/^.$/)){r=g;break}if("/"==n&&e.match(/^\/[\/\*]/,!1))break;e.next()}return t.tokenize=r,"meta"}function k(e,t){return"type"==t.prevToken&&"type"}function b(e){return!(!e||e.length<2)&&("_"==e[0]&&("_"==e[1]||e[1]!==e[1].toLowerCase()))}function x(e){return e.eatWhile(/[\w\.']/),"number"}function v(e,t){if(e.backUp(1),e.match(/(R|u8R|uR|UR|LR)/)){var n=e.match(/"([^\s\\()]{0,16})\(/);return!!n&&(t.cpp11RawStringDelim=n[1],t.tokenize=S,S(e,t))}return e.match(/(u8|u|U|L)/)?!!e.match(/["']/,!1)&&"string":(e.next(),!1)}function w(e){var t=/(\w+)::~?(\w+)$/.exec(e);return t&&t[1]==t[2]}function _(e,t){for(var n;null!=(n=e.next());)if('"'==n&&!e.eat('"')){t.tokenize=null;break}return"string"}function S(e,t){var n=t.cpp11RawStringDelim.replace(/[^\w\s]/g,"\\$&");return e.match(new RegExp(".*?\\)"+n+'"'))?t.tokenize=null:e.skipToEnd(),"string"}function T(t,n){"string"==typeof t&&(t=[t]);var r=[];function o(e){if(e)for(var t in e)e.hasOwnProperty(t)&&r.push(t)}o(n.keywords),o(n.types),o(n.builtin),o(n.atoms),r.length&&(n.helperType=t[0],e.registerHelper("hintWords",t[0],r));for(var a=0;a<t.length;++a)e.defineMIME(t[a],n)}function C(e,t){for(var n=!1;!e.eol();){if(!n&&e.match('"""')){t.tokenize=null;break}n="\\"==e.next()&&!n}return"string"}function I(e){return function(t,n){for(var r;r=t.next();){if("*"==r&&t.eat("/")){if(1==e){n.tokenize=null;break}return n.tokenize=I(e-1),n.tokenize(t,n)}if("/"==r&&t.eat("*"))return n.tokenize=I(e+1),n.tokenize(t,n)}return"comment"}}T(["text/x-csrc","text/x-c","text/x-chdr"],{name:"clike",keywords:i(s),types:m,blockKeywords:i(y),defKeywords:i("struct enum union"),typeFirstDefinitions:!0,atoms:i("NULL true false"),isReservedIdentifier:b,hooks:{"#":g,"*":k},modeProps:{fold:["brace","include"]}}),T(["text/x-c++src","text/x-c++hdr"],{name:"clike",keywords:i(s+" "+c),types:m,blockKeywords:i(y+" class try catch"),defKeywords:i("struct enum union class namespace"),typeFirstDefinitions:!0,atoms:i("true false NULL nullptr"),dontIndentStatements:/^template$/,isIdentifierChar:/[\w\$_~\xa1-\uffff]/,isReservedIdentifier:b,hooks:{"#":g,"*":k,u:v,U:v,L:v,R:v,0:x,1:x,2:x,3:x,4:x,5:x,6:x,7:x,8:x,9:x,token:function(e,t,n){if("variable"==n&&"("==e.peek()&&(";"==t.prevToken||null==t.prevToken||"}"==t.prevToken)&&w(e.current()))return"def"}},namespaceSeparator:"::",modeProps:{fold:["brace","include"]}}),T("text/x-java",{name:"clike",keywords:i("abstract assert break case catch class const continue default do else enum extends final finally for goto if implements import instanceof interface native new package private protected public return static strictfp super switch synchronized this throw throws transient try volatile while @interface"),types:i("byte short int long float double boolean char void Boolean Byte Character Double Float Integer Long Number Object Short String StringBuffer StringBuilder Void"),blockKeywords:i("catch class do else finally for if switch try while"),defKeywords:i("class interface enum @interface"),typeFirstDefinitions:!0,atoms:i("true false null"),number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+\.?\d*|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,hooks:{"@":function(e){return!e.match("interface",!1)&&(e.eatWhile(/[\w\$_]/),"meta")}},modeProps:{fold:["brace","import"]}}),T("text/x-csharp",{name:"clike",keywords:i("abstract as async await base break case catch checked class const continue default delegate do else enum event explicit extern finally fixed for foreach goto if implicit in interface internal is lock namespace new operator out override params private protected public readonly ref return sealed sizeof stackalloc static struct switch this throw try typeof unchecked unsafe using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),types:i("Action Boolean Byte Char DateTime DateTimeOffset Decimal Double Func Guid Int16 Int32 Int64 Object SByte Single String Task TimeSpan UInt16 UInt32 UInt64 bool byte char decimal double short int long object sbyte float string ushort uint ulong"),blockKeywords:i("catch class do else finally for foreach if struct switch try while"),defKeywords:i("class interface namespace struct var"),typeFirstDefinitions:!0,atoms:i("true false null"),hooks:{"@":function(e,t){return e.eat('"')?(t.tokenize=_,_(e,t)):(e.eatWhile(/[\w\$_]/),"meta")}}}),T("text/x-scala",{name:"clike",keywords:i("abstract case catch class def do else extends final finally for forSome if implicit import lazy match new null object override package private protected return sealed super this throw trait try type val var while with yield _ assert assume require print println printf readLine readBoolean readByte readShort readChar readInt readLong readFloat readDouble"),types:i("AnyVal App Application Array BufferedIterator BigDecimal BigInt Char Console Either Enumeration Equiv Error Exception Fractional Function IndexedSeq Int Integral Iterable Iterator List Map Numeric Nil NotNull Option Ordered Ordering PartialFunction PartialOrdering Product Proxy Range Responder Seq Serializable Set Specializable Stream StringBuilder StringContext Symbol Throwable Traversable TraversableOnce Tuple Unit Vector Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),multiLineStrings:!0,blockKeywords:i("catch class enum do else finally for forSome if match switch try while"),defKeywords:i("class enum def object package trait type val var"),atoms:i("true false null"),indentStatements:!1,indentSwitch:!1,isOperatorChar:/[+\-*&%=<>!?|\/#:@]/,hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},'"':function(e,t){return!!e.match('""')&&(t.tokenize=C,t.tokenize(e,t))},"'":function(e){return e.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},"=":function(e,n){var r=n.context;return!("}"!=r.type||!r.align||!e.eat(">"))&&(n.context=new t(r.indented,r.column,r.type,r.info,null,r.prev),"operator")},"/":function(e,t){return!!e.eat("*")&&(t.tokenize=I(1),t.tokenize(e,t))}},modeProps:{closeBrackets:{pairs:'()[]{}""',triples:'"'}}}),T("text/x-kotlin",{name:"clike",keywords:i("package as typealias class interface this super val operator var fun for is in This throw return annotation break continue object if else while do try when !in !is as? file import where by get set abstract enum open inner override private public internal protected catch finally out final vararg reified dynamic companion constructor init sealed field property receiver param sparam lateinit data inline noinline tailrec external annotation crossinline const operator infix suspend actual expect setparam"),types:i("Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void Annotation Any BooleanArray ByteArray Char CharArray DeprecationLevel DoubleArray Enum FloatArray Function Int IntArray Lazy LazyThreadSafetyMode LongArray Nothing ShortArray Unit"),intendSwitch:!1,indentStatements:!1,multiLineStrings:!0,number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+(\.\d+)?|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,blockKeywords:i("catch class do else finally for if where try while enum"),defKeywords:i("class val var object interface fun"),atoms:i("true false null this"),hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},"*":function(e,t){return"."==t.prevToken?"variable":"operator"},'"':function(e,t){var n;return t.tokenize=(n=e.match('""'),function(e,t){for(var r,o=!1,a=!1;!e.eol();){if(!n&&!o&&e.match('"')){a=!0;break}if(n&&e.match('"""')){a=!0;break}r=e.next(),!o&&"$"==r&&e.match("{")&&e.skipTo("}"),o=!o&&"\\"==r&&!n}return!a&&n||(t.tokenize=null),"string"}),t.tokenize(e,t)},"/":function(e,t){return!!e.eat("*")&&(t.tokenize=I(1),t.tokenize(e,t))},indent:function(e,t,n,r){var o=n&&n.charAt(0);return"}"!=e.prevToken&&")"!=e.prevToken||""!=n?"operator"==e.prevToken&&"}"!=n&&"}"!=e.context.type||"variable"==e.prevToken&&"."==o||("}"==e.prevToken||")"==e.prevToken)&&"."==o?2*r+t.indented:t.align&&"}"==t.type?t.indented+(e.context.type==(n||"").charAt(0)?0:r):void 0:e.indented}},modeProps:{closeBrackets:{triples:'"'}}}),T(["x-shader/x-vertex","x-shader/x-fragment"],{name:"clike",keywords:i("sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow const attribute uniform varying break continue discard return for while do if else struct in out inout"),types:i("float int bool void vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 mat2 mat3 mat4"),blockKeywords:i("for while do if else struct"),builtin:i("radians degrees sin cos tan asin acos atan pow exp log exp2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize ftransform faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not texture1D texture1DProj texture1DLod texture1DProjLod texture2D texture2DProj texture2DLod texture2DProjLod texture3D texture3DProj texture3DLod texture3DProjLod textureCube textureCubeLod shadow1D shadow2D shadow1DProj shadow2DProj shadow1DLod shadow2DLod shadow1DProjLod shadow2DProjLod dFdx dFdy fwidth noise1 noise2 noise3 noise4"),atoms:i("true false gl_FragColor gl_SecondaryColor gl_Normal gl_Vertex gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_FogCoord gl_PointCoord gl_Position gl_PointSize gl_ClipVertex gl_FrontColor gl_BackColor gl_FrontSecondaryColor gl_BackSecondaryColor gl_TexCoord gl_FogFragCoord gl_FragCoord gl_FrontFacing gl_FragData gl_FragDepth gl_ModelViewMatrix gl_ProjectionMatrix gl_ModelViewProjectionMatrix gl_TextureMatrix gl_NormalMatrix gl_ModelViewMatrixInverse gl_ProjectionMatrixInverse gl_ModelViewProjectionMatrixInverse gl_TexureMatrixTranspose gl_ModelViewMatrixInverseTranspose gl_ProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixInverseTranspose gl_TextureMatrixInverseTranspose gl_NormalScale gl_DepthRange gl_ClipPlane gl_Point gl_FrontMaterial gl_BackMaterial gl_LightSource gl_LightModel gl_FrontLightModelProduct gl_BackLightModelProduct gl_TextureColor gl_EyePlaneS gl_EyePlaneT gl_EyePlaneR gl_EyePlaneQ gl_FogParameters gl_MaxLights gl_MaxClipPlanes gl_MaxTextureUnits gl_MaxTextureCoords gl_MaxVertexAttribs gl_MaxVertexUniformComponents gl_MaxVaryingFloats gl_MaxVertexTextureImageUnits gl_MaxTextureImageUnits gl_MaxFragmentUniformComponents gl_MaxCombineTextureImageUnits gl_MaxDrawBuffers"),indentSwitch:!1,hooks:{"#":g},modeProps:{fold:["brace","include"]}}),T("text/x-nesc",{name:"clike",keywords:i(s+" as atomic async call command component components configuration event generic implementation includes interface module new norace nx_struct nx_union post provides signal task uses abstract extends"),types:m,blockKeywords:i(y),atoms:i("null true false"),hooks:{"#":g},modeProps:{fold:["brace","include"]}}),T("text/x-objectivec",{name:"clike",keywords:i(s+" "+u),types:h,builtin:i(d),blockKeywords:i(y+" @synthesize @try @catch @finally @autoreleasepool @synchronized"),defKeywords:i("struct enum union @interface @implementation @protocol @class"),dontIndentStatements:/^@.*$/,typeFirstDefinitions:!0,atoms:i("YES NO NULL Nil nil true false nullptr"),isReservedIdentifier:b,hooks:{"#":g,"*":k},modeProps:{fold:["brace","include"]}}),T("text/x-objectivec++",{name:"clike",keywords:i(s+" "+u+" "+c),types:h,builtin:i(d),blockKeywords:i(y+" @synthesize @try @catch @finally @autoreleasepool @synchronized class try catch"),defKeywords:i("struct enum union @interface @implementation @protocol @class class namespace"),dontIndentStatements:/^@.*$|^template$/,typeFirstDefinitions:!0,atoms:i("YES NO NULL Nil nil true false nullptr"),isReservedIdentifier:b,hooks:{"#":g,"*":k,u:v,U:v,L:v,R:v,0:x,1:x,2:x,3:x,4:x,5:x,6:x,7:x,8:x,9:x,token:function(e,t,n){if("variable"==n&&"("==e.peek()&&(";"==t.prevToken||null==t.prevToken||"}"==t.prevToken)&&w(e.current()))return"def"}},namespaceSeparator:"::",modeProps:{fold:["brace","include"]}}),T("text/x-squirrel",{name:"clike",keywords:i("base break clone continue const default delete enum extends function in class foreach local resume return this throw typeof yield constructor instanceof static"),types:m,blockKeywords:i("case catch class else for foreach if switch try while"),defKeywords:i("function local class"),typeFirstDefinitions:!0,atoms:i("true false null"),hooks:{"#":g},modeProps:{fold:["brace","include"]}});var N=null;T("text/x-ceylon",{name:"clike",keywords:i("abstracts alias assembly assert assign break case catch class continue dynamic else exists extends finally for function given if import in interface is let module new nonempty object of out outer package return satisfies super switch then this throw try value void while"),types:function(e){var t=e.charAt(0);return t===t.toUpperCase()&&t!==t.toLowerCase()},blockKeywords:i("case catch class dynamic else finally for function if interface module new object switch try while"),defKeywords:i("class dynamic function interface module object package value"),builtin:i("abstract actual aliased annotation by default deprecated doc final formal late license native optional sealed see serializable shared suppressWarnings tagged throws variable"),isPunctuationChar:/[\[\]{}\(\),;\:\.`]/,isOperatorChar:/[+\-*&%=<>!?|^~:\/]/,numberStart:/[\d#$]/,number:/^(?:#[\da-fA-F_]+|\$[01_]+|[\d_]+[kMGTPmunpf]?|[\d_]+\.[\d_]+(?:[eE][-+]?\d+|[kMGTPmunpf]|)|)/i,multiLineStrings:!0,typeFirstDefinitions:!0,atoms:i("true false null larger smaller equal empty finished"),indentSwitch:!1,styleDefs:!1,hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},'"':function(e,t){return t.tokenize=function e(t){return function(n,r){for(var o,a=!1,i=!1;!n.eol();){if(!a&&n.match('"')&&("single"==t||n.match('""'))){i=!0;break}if(!a&&n.match("``")){N=e(t),i=!0;break}o=n.next(),a="single"==t&&!a&&"\\"==o}return i&&(r.tokenize=null),"string"}}(e.match('""')?"triple":"single"),t.tokenize(e,t)},"`":function(e,t){return!(!N||!e.match("`"))&&(t.tokenize=N,N=null,t.tokenize(e,t))},"'":function(e){return e.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},token:function(e,t,n){if(("variable"==n||"type"==n)&&"."==t.prevToken)return"variable-2"}},modeProps:{fold:["brace","import"],closeBrackets:{triples:'"'}}})});

},{"../../lib/codemirror":311}],313:[function(require,module,exports){
module.exports=function(e){"string"==typeof e&&(e=[e]);for(var n=[].slice.call(arguments,1),o=[],r=0;r<e.length-1;r++)o.push(e[r],n[r]||"");return o.push(e[r]),o.join("")};

},{}],314:[function(require,module,exports){
function _cross(n,e,t){return(e[0]-n[0])*(t[1]-n[1])-(e[1]-n[1])*(t[0]-n[0])}function _upperTangent(n){const e=[];for(let t=0;t<n.length;t++){for(;e.length>=2&&_cross(e[e.length-2],e[e.length-1],n[t])<=0;)e.pop();e.push(n[t])}return e.pop(),e}function _lowerTangent(n){const e=n.reverse(),t=[];for(let n=0;n<e.length;n++){for(;t.length>=2&&_cross(t[t.length-2],t[t.length-1],e[n])<=0;)t.pop();t.push(e[n])}return t.pop(),t}function convex(n){const e=_upperTangent(n),t=_lowerTangent(n).concat(e);return t.push(n[0]),t}module.exports=convex;

},{}],315:[function(require,module,exports){
module.exports={toXy:function(n,t){return void 0===t?n.slice():n.map(function(n){return new Function("pt","return [pt"+t[0]+",pt"+t[1]+"];")(n)})},fromXy:function(n,t){return void 0===t?n.slice():n.map(function(n){return new Function("pt","const o = {}; o"+t[0]+"= pt[0]; o"+t[1]+"= pt[1]; return o;")(n)})}};

},{}],316:[function(require,module,exports){
function Grid(e,l){this._cells=[],this._cellSize=l,this._reverseCellSize=1/l;for(let l=0;l<e.length;l++){const t=e[l],o=this.coordToCellNum(t[0]),i=this.coordToCellNum(t[1]);if(this._cells[o])this._cells[o][i]?this._cells[o][i].push(t):this._cells[o][i]=[t];else{const e=[];e[i]=[t],this._cells[o]=e}}}function grid(e,l){return new Grid(e,l)}Grid.prototype={cellPoints:function(e,l){return void 0!==this._cells[e]&&void 0!==this._cells[e][l]?this._cells[e][l]:[]},rangePoints:function(e){const l=this.coordToCellNum(e[0]),t=this.coordToCellNum(e[1]),o=this.coordToCellNum(e[2]),i=this.coordToCellNum(e[3]),s=[];for(let e=l;e<=o;e++)for(let l=t;l<=i;l++)Array.prototype.push.apply(s,this.cellPoints(e,l));return s},removePoint:function(e){const l=this.coordToCellNum(e[0]),t=this.coordToCellNum(e[1]),o=this._cells[l][t];let i;for(let l=0;l<o.length;l++)if(o[l][0]===e[0]&&o[l][1]===e[1]){i=l;break}return o.splice(i,1),o},trunc:Math.trunc||function(e){return e-e%1},coordToCellNum:function(e){return this.trunc(e*this._reverseCellSize)},extendBbox:function(e,l){return[e[0]-l*this._cellSize,e[1]-l*this._cellSize,e[2]+l*this._cellSize,e[3]+l*this._cellSize]}},module.exports=grid;

},{}],317:[function(require,module,exports){
"use strict";const intersect=require("./intersect.js"),grid=require("./grid.js"),formatUtil=require("./format.js"),convexHull=require("./convex.js");function _filterDuplicates(t){const n=[t[0]];let e=t[0];for(let r=1;r<t.length;r++){const o=t[r];e[0]===o[0]&&e[1]===o[1]||n.push(o),e=o}return n}function _sortByX(t){return t.sort(function(t,n){return t[0]-n[0]||t[1]-n[1]})}function _sqLength(t,n){return Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)}function _cos(t,n,e){const r=[n[0]-t[0],n[1]-t[1]],o=[e[0]-t[0],e[1]-t[1]],c=_sqLength(t,n),i=_sqLength(t,e);return(r[0]*o[0]+r[1]*o[1])/Math.sqrt(c*i)}function _intersect(t,n){for(let e=0;e<n.length-1;e++){const r=[n[e],n[e+1]];if(!(t[0][0]===r[0][0]&&t[0][1]===r[0][1]||t[0][0]===r[1][0]&&t[0][1]===r[1][1])&&intersect(t,r))return!0}return!1}function _occupiedArea(t){let n=1/0,e=1/0,r=-1/0,o=-1/0;for(let c=t.length-1;c>=0;c--)t[c][0]<n&&(n=t[c][0]),t[c][1]<e&&(e=t[c][1]),t[c][0]>r&&(r=t[c][0]),t[c][1]>o&&(o=t[c][1]);return[r-n,o-e]}function _bBoxAround(t){return[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])]}function _midPoint(t,n,e){let r,o,c=null,i=MAX_CONCAVE_ANGLE_COS,u=MAX_CONCAVE_ANGLE_COS;for(let l=0;l<n.length;l++)r=_cos(t[0],t[1],n[l]),o=_cos(t[1],t[0],n[l]),r>i&&o>u&&!_intersect([t[0],n[l]],e)&&!_intersect([t[1],n[l]],e)&&(i=r,u=o,c=n[l]);return c}function _concave(t,n,e,r,o){let c=!1;for(let i=0;i<t.length-1;i++){const u=[t[i],t[i+1]],l=u[0][0]+","+u[0][1]+","+u[1][0]+","+u[1][1];if(_sqLength(u[0],u[1])<n||o.has(l))continue;let _,s,f,a=0,h=_bBoxAround(u);do{_=(h=r.extendBbox(h,a))[2]-h[0],s=h[3]-h[1],f=_midPoint(u,r.rangePoints(h),t),a++}while(null===f&&(e[0]>_||e[1]>s));_>=e[0]&&s>=e[1]&&o.add(l),null!==f&&(t.splice(i+1,0,f),r.removePoint(f),c=!0)}return c?_concave(t,n,e,r,o):t}function hull(t,n,e){let r=n||20;const o=_filterDuplicates(_sortByX(formatUtil.toXy(t,e)));if(o.length<4)return o.concat([o[0]]);const c=_occupiedArea(o),i=[c[0]*MAX_SEARCH_BBOX_SIZE_PERCENT,c[1]*MAX_SEARCH_BBOX_SIZE_PERCENT],u=convexHull(o),l=o.filter(function(t){return u.indexOf(t)<0}),_=Math.ceil(1/(o.length/(c[0]*c[1]))),s=_concave(u,Math.pow(r,2),i,grid(l,_),new Set);return e?formatUtil.fromXy(s,e):s}const MAX_CONCAVE_ANGLE_COS=Math.cos(90/(180/Math.PI)),MAX_SEARCH_BBOX_SIZE_PERCENT=.6;module.exports=hull;

},{"./convex.js":314,"./format.js":315,"./grid.js":316,"./intersect.js":318}],318:[function(require,module,exports){
function ccw(c,t,n,e,r,o){const s=(o-t)*(n-c)-(e-t)*(r-c);return s>0||!(s<0)}function intersect(c,t){const n=c[0][0],e=c[0][1],r=c[1][0],o=c[1][1],s=t[0][0],u=t[0][1],w=t[1][0],i=t[1][1];return ccw(n,e,s,u,w,i)!==ccw(r,o,s,u,w,i)&&ccw(n,e,r,o,s,u)!==ccw(n,e,r,o,w,i)}module.exports=intersect;

},{}],319:[function(require,module,exports){
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),(o+=p+N>=1?n/f:n*Math.pow(2,1-N))*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};

},{}],320:[function(require,module,exports){
(function (process){
function normalizeArray(r,t){for(var e=0,n=r.length-1;n>=0;n--){var o=r[n];"."===o?r.splice(n,1):".."===o?(r.splice(n,1),e++):e&&(r.splice(n,1),e--)}if(t)for(;e--;e)r.unshift("..");return r}function basename(r){"string"!=typeof r&&(r+="");var t,e=0,n=-1,o=!0;for(t=r.length-1;t>=0;--t)if(47===r.charCodeAt(t)){if(!o){e=t+1;break}}else-1===n&&(o=!1,n=t+1);return-1===n?"":r.slice(e,n)}function filter(r,t){if(r.filter)return r.filter(t);for(var e=[],n=0;n<r.length;n++)t(r[n],n,r)&&e.push(r[n]);return e}exports.resolve=function(){for(var r="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var n=e>=0?arguments[e]:process.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(r=n+"/"+r,t="/"===n.charAt(0))}return r=normalizeArray(filter(r.split("/"),function(r){return!!r}),!t).join("/"),(t?"/":"")+r||"."},exports.normalize=function(r){var t=exports.isAbsolute(r),e="/"===substr(r,-1);return(r=normalizeArray(filter(r.split("/"),function(r){return!!r}),!t).join("/"))||t||(r="."),r&&e&&(r+="/"),(t?"/":"")+r},exports.isAbsolute=function(r){return"/"===r.charAt(0)},exports.join=function(){var r=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(r,function(r,t){if("string"!=typeof r)throw new TypeError("Arguments to path.join must be strings");return r}).join("/"))},exports.relative=function(r,t){function e(r){for(var t=0;t<r.length&&""===r[t];t++);for(var e=r.length-1;e>=0&&""===r[e];e--);return t>e?[]:r.slice(t,e-t+1)}r=exports.resolve(r).substr(1),t=exports.resolve(t).substr(1);for(var n=e(r.split("/")),o=e(t.split("/")),s=Math.min(n.length,o.length),i=s,u=0;u<s;u++)if(n[u]!==o[u]){i=u;break}var l=[];for(u=i;u<n.length;u++)l.push("..");return(l=l.concat(o.slice(i))).join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(r){if("string"!=typeof r&&(r+=""),0===r.length)return".";for(var t=r.charCodeAt(0),e=47===t,n=-1,o=!0,s=r.length-1;s>=1;--s)if(47===(t=r.charCodeAt(s))){if(!o){n=s;break}}else o=!1;return-1===n?e?"/":".":e&&1===n?"/":r.slice(0,n)},exports.basename=function(r,t){var e=basename(r);return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e},exports.extname=function(r){"string"!=typeof r&&(r+="");for(var t=-1,e=0,n=-1,o=!0,s=0,i=r.length-1;i>=0;--i){var u=r.charCodeAt(i);if(47!==u)-1===n&&(o=!1,n=i+1),46===u?-1===t?t=i:1!==s&&(s=1):-1!==t&&(s=-1);else if(!o){e=i+1;break}}return-1===t||-1===n||0===s||1===s&&t===n-1&&t===e+1?"":r.slice(t,n)};var substr="b"==="ab".substr(-1)?function(r,t,e){return r.substr(t,e)}:function(r,t,e){return t<0&&(t=r.length+t),r.substr(t,e)};

}).call(this,require('_process'))
},{"_process":321}],321:[function(require,module,exports){
var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(e){return[]},process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};

},{}],322:[function(require,module,exports){
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.createREGL=t()}(this,function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e},r="\n";function n(e){var t=new Error("(regl) "+e);throw console.error(t),t}function a(e,t){e||n(t)}function i(e){return e?": "+e:""}function o(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function f(e,t,r){t.indexOf(e)<0&&n("invalid value"+i(r)+". must be one of: "+t)}var u=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function s(e,t){for(e+="";e.length<t;)e=" "+e;return e}function c(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function l(e,t){this.number=e,this.line=t,this.errors=[]}function d(e,t,r){this.file=e,this.line=t,this.message=r}function m(){var e=new Error,t=(e.stack||e).toString(),r=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return n?n[1]:"unknown"}function p(){var e=new Error,t=(e.stack||e).toString(),r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return n?n[1]:"unknown"}function h(e,t){var r,n=e.split("\n"),a=1,i=0,o={unknown:new c,0:new c};o.unknown.name=o[0].name=t||m(),o.unknown.lines.push(new l(0,""));for(var f=0;f<n.length;++f){var u=n[f],s=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(s)switch(s[1]){case"line":var d=/(\d+)(\s+\d+)?/.exec(s[2]);d&&(a=0|d[1],d[2]&&((i=0|d[2])in o||(o[i]=new c)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(s[2]);p&&(o[i].name=p[1]?(r=p[2],"undefined"!=typeof atob?atob(r):"base64:"+r):p[2])}o[i].lines.push(new l(a++,u))}return Object.keys(o).forEach(function(e){var t=o[e];t.lines.forEach(function(e){t.index[e.number]=e})}),o}function b(e){e._commandRef=m()}function v(e,t){var r=p();n(e+" in command "+(t||m())+("unknown"===r?"":" called from "+r))}function g(e,t,r,n){o(e,t)||v("invalid parameter type"+i(r)+". expected "+t+", got "+typeof e,n||m())}var y=33071,x=9728,w=9984,A=9985,_=9986,k=9987,S=5126,E=32819,O=32820,T=33635,j=34042,D={};function C(e,t){return e===O||e===E||e===T?2:e===j?4:D[e]*t}function z(e){return!(e&e-1||!e)}D[5120]=D[5121]=1,D[5122]=D[5123]=D[36193]=D[T]=D[E]=D[O]=2,D[5124]=D[5125]=D[S]=D[j]=4;var F=t(a,{optional:function(e){e()},raise:n,commandRaise:v,command:function(e,t,r){e||v(t,r||m())},parameter:function(e,t,r){e in t||n("unknown parameter ("+e+")"+i(r)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,r,n){e in t||v("unknown parameter ("+e+")"+i(r)+". possible values: "+Object.keys(t).join(),n||m())},constructor:function(e){Object.keys(e).forEach(function(e){u.indexOf(e)<0&&n('invalid regl constructor argument "'+e+'". must be one of '+u)})},type:function(e,t,r){o(e,t)||n("invalid parameter type"+i(r)+". expected "+t+", got "+typeof e)},commandType:g,isTypedArray:function(t,r){e(t)||n("invalid parameter type"+i(r)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||n("invalid parameter type, ("+e+")"+i(t)+". must be a nonnegative integer")},oneOf:f,shaderError:function(e,t,n,i,o){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var f=e.getShaderInfoLog(t),u=i===e.FRAGMENT_SHADER?"fragment":"vertex";g(n,"string",u+" shader source must be a string",o);var c=h(n,o),l=function(e){var t=[];return e.split("\n").forEach(function(e){if(!(e.length<5)){var r=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);r?t.push(new d(0|r[1],0|r[2],r[3].trim())):e.length>0&&t.push(new d("unknown",0,e))}}),t}(f);!function(e,t){t.forEach(function(t){var r=e[t.file];if(r){var n=r.index[t.line];if(n)return n.errors.push(t),void(r.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}(c,l),Object.keys(c).forEach(function(e){var t=c[e];if(t.hasErrors){var n=[""],a=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach(function(e){if(e.errors.length>0){i(s(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+r,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach(function(n){var a=n.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(a);if(o){var f=o[1];switch(a=o[2],f){case"assign":f="="}t=Math.max(e.line.indexOf(f,t),0)}else t=0;i(s("| ",6)),i(s("^^^",t+3)+r,"font-weight:bold"),i(s("| ",6)),i(a+r,"font-weight:bold"),window.shader_error_hook(e.number,t,a,f||"")}),i(s("| ",6)+r)}else i(s(e.number,4)+"|  "),i(e.line+r,"color:red")}),"undefined"==typeof document||window.chrome?console.log(n.join("")):(a[0]=n.join("%c"),console.log.apply(console,a))}function i(e,t){n.push(e),a.push(t||"")}}),a.raise("Error compiling "+u+" shader, "+c[0].name)}},linkError:function(e,t,n,i,o){if(!e.getProgramParameter(t,e.LINK_STATUS)){var f=e.getProgramInfoLog(t),u=h(n,o),s='Error linking program with vertex shader, "'+h(i,o)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+s+r+"%c"+f,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(s+r+f),a.raise(s)}},callSite:p,saveCommandRef:b,saveDrawInfo:function(e,t,r,n){function a(e){return e?n.id(e):0}function i(e,t){Object.keys(t).forEach(function(t){e[n.id(t)]=!0})}b(e),e._fragId=a(e.static.frag),e._vertId=a(e.static.vert);var o=e._uniformSet={};i(o,t.static),i(o,t.dynamic);var f=e._attributeSet={};i(f,r.static),i(f,r.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,r){e.texture?f(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):f(e.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")},guessCommand:m,texture2D:function(e,t,r){var n,i=t.width,o=t.height,f=t.channels;a(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),e.wrapS===y&&e.wrapT===y||a(z(i)&&z(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==o&&a(e.minFilter!==w&&e.minFilter!==_&&e.minFilter!==A&&e.minFilter!==k,"min filter requires mipmap"):(a(z(i)&&z(o),"texture must be a square power of 2 to support mipmapping"),a(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),t.type===S&&(r.extensions.indexOf("oes_texture_float_linear")<0&&a(e.minFilter===x&&e.magFilter===x,"filter not supported, must enable oes_texture_float_linear"),a(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(n=0;n<16;++n)if(u[n]){var s=i>>n,c=o>>n;a(t.mipmask&1<<n,"missing mipmap data");var l=u[n];if(a(l.width===s&&l.height===c,"invalid shape for mip images"),a(l.format===t.format&&l.internalformat===t.internalformat&&l.type===t.type,"incompatible type for mip image"),l.compressed);else if(l.data){var d=Math.ceil(C(l.type,f)*s/l.unpackAlignment)*l.unpackAlignment;a(l.data.byteLength===d*c,"invalid data for image, buffer size is inconsistent with image format")}else l.element||l.copy}else e.genMipmaps||a(0==(t.mipmask&1<<n),"extra mipmap data");t.compressed&&a(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,r,n){var i=e.width,o=e.height,f=e.channels;a(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),a(i===o,"cube map must be square"),a(t.wrapS===y&&t.wrapT===y,"wrap mode not supported by cube map");for(var u=0;u<r.length;++u){var s=r[u];a(s.width===i&&s.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(a(!s.compressed,"can not generate mipmap for compressed textures"),a(1===s.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=s.images,l=0;l<16;++l){var d=c[l];if(d){var m=i>>l,p=o>>l;a(s.mipmask&1<<l,"missing mipmap data"),a(d.width===m&&d.height===p,"invalid shape for mip images"),a(d.format===e.format&&d.internalformat===e.internalformat&&d.type===e.type,"incompatible type for mip image"),d.compressed||(d.data?a(d.data.byteLength===m*p*Math.max(C(d.type,f),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):d.element||d.copy)}}}}}),B=0,V=0;function P(e,t){this.id=B++,this.type=e,this.data=t}function L(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function I(e){return"["+function e(t){if(0===t.length)return[];var r=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&r===n&&('"'===r||"'"===r))return['"'+L(t.substr(1,t.length-2))+'"'];var a=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(a)return e(t.substr(0,a.index)).concat(e(a[1])).concat(e(t.substr(a.index+a[0].length)));var i=t.split(".");if(1===i.length)return['"'+L(t)+'"'];for(var o=[],f=0;f<i.length;++f)o=o.concat(e(i[f]));return o}(e).join("][")+"]"}var R={DynamicVariable:P,define:function(e,t){return new P(e,I(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof P},unbox:function(e,t){return"function"==typeof e?new P(V,e):e},accessor:I},M={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},W="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function U(e){return"string"==typeof e?e.split():(F(Array.isArray(e),"invalid extension array"),e)}function G(e){return"string"==typeof e?(F("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function H(e){var r,n,a,i,o,f=e||{},u={},s=[],c=[],l="undefined"==typeof window?1:window.devicePixelRatio,d=!1,m=function(e){e&&F.raise(e)},p=function(){};if("string"==typeof f?(F("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),r=document.querySelector(f),F(r,"invalid query string for element")):"object"==typeof f?"string"==typeof(o=f).nodeName&&"function"==typeof o.appendChild&&"function"==typeof o.getBoundingClientRect?r=f:!function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(f)?(F.constructor(f),"gl"in f?i=f.gl:"canvas"in f?a=G(f.canvas):"container"in f&&(n=G(f.container)),"attributes"in f&&(u=f.attributes,F.type(u,"object","invalid context attributes")),"extensions"in f&&(s=U(f.extensions)),"optionalExtensions"in f&&(c=U(f.optionalExtensions)),"onDone"in f&&(F.type(f.onDone,"function","invalid or missing onDone callback"),m=f.onDone),"profile"in f&&(d=!!f.profile),"pixelRatio"in f&&(l=+f.pixelRatio,F(l>0,"invalid pixel ratio"))):a=(i=f).canvas:F.raise("invalid arguments to regl"),r&&("canvas"===r.nodeName.toLowerCase()?a=r:n=r),!i){if(!a){F("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var h=function(e,r,n){var a=document.createElement("canvas");function i(){var r=window.innerWidth,i=window.innerHeight;if(e!==document.body){var o=e.getBoundingClientRect();r=o.right-o.left,i=o.bottom-o.top}a.width=n*r,a.height=n*i,t(a.style,{width:r+"px",height:i+"px"})}return t(a.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(a),e===document.body&&(a.style.position="absolute",t(e.style,{margin:0,padding:0})),window.addEventListener("resize",i,!1),i(),{canvas:a,onDestroy:function(){window.removeEventListener("resize",i),e.removeChild(a)}}}(n||document.body,0,l);if(!h)return null;a=h.canvas,p=h.onDestroy}u.premultipliedAlpha=u.premultipliedAlpha||!1,i=function(e,t){function r(r){try{return e.getContext(r,t)}catch(e){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}(a,u)}return i?{gl:i,canvas:a,container:n,extensions:s,optionalExtensions:c,pixelRatio:l,profile:d,onDone:m,onDestroy:p}:(p(),m("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function N(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}var q=5120,Q=5121,Y=5122,X=5123,$=5124,K=5125,J=5126;function Z(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1}function ee(){var e=N(8,function(){return[]});function t(t){var r=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),n=e[Z(r)>>2];return n.length>0?n.pop():new ArrayBuffer(r)}function r(t){e[Z(t.byteLength)>>2].push(t)}return{alloc:t,free:r,allocType:function(e,r){var n=null;switch(e){case q:n=new Int8Array(t(r),0,r);break;case Q:n=new Uint8Array(t(r),0,r);break;case Y:n=new Int16Array(t(2*r),0,r);break;case X:n=new Uint16Array(t(2*r),0,r);break;case $:n=new Int32Array(t(4*r),0,r);break;case K:n=new Uint32Array(t(4*r),0,r);break;case J:n=new Float32Array(t(4*r),0,r);break;default:return null}return n.length!==r?n.subarray(0,r):n},freeType:function(e){r(e.buffer)}}}var te=ee();te.zero=ee();var re=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(34047));var n=1,a=1;t.webgl_draw_buffers&&(n=e.getParameter(34852),a=e.getParameter(36063));var i=!!t.oes_texture_float;if(i){var o=e.createTexture();e.bindTexture(3553,o),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var f=e.createFramebuffer();if(e.bindFramebuffer(36160,f),e.framebufferTexture2D(36160,36064,3553,o,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))i=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=te.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,u),e.getError()?i=!1:(e.deleteFramebuffer(f),e.deleteTexture(o),i=1===u[0]),te.freeType(u)}}var s=!0;if(!("undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)))){var c=e.createTexture(),l=te.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,c),e.texImage2D(34069,0,6408,3,3,0,6408,5121,l),te.freeType(l),e.bindTexture(34067,null),e.deleteTexture(c),s=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:a,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:i,npotTextureCube:s}};function ne(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var ae=function(e){return Object.keys(e).map(function(t){return e[t]})},ie={shape:function(e){for(var t=[],r=e;r.length;r=r[0])t.push(r.length);return t},flatten:function(e,t,r,n){var a=1;if(t.length)for(var i=0;i<t.length;++i)a*=t[i];else a=0;var o=n||te.allocType(r,a);switch(t.length){case 0:break;case 1:!function(e,t,r){for(var n=0;n<t;++n)r[n]=e[n]}(e,t[0],o);break;case 2:!function(e,t,r,n){for(var a=0,i=0;i<t;++i)for(var o=e[i],f=0;f<r;++f)n[a++]=o[f]}(e,t[0],t[1],o);break;case 3:oe(e,t[0],t[1],t[2],o,0);break;default:!function e(t,r,n,a,i){var o=1;for(var f=n+1;f<r.length;++f)o*=r[f];var u=r[n];if(r.length-n==4){var s=r[n+1],c=r[n+2],l=r[n+3];for(f=0;f<u;++f)oe(t[f],s,c,l,a,i),i+=o}else for(f=0;f<u;++f)e(t[f],r,n+1,a,i),i+=o}(e,t,0,o,0)}return o}};function oe(e,t,r,n,a,i){for(var o=i,f=0;f<t;++f)for(var u=e[f],s=0;s<r;++s)for(var c=u[s],l=0;l<n;++l)a[o++]=c[l]}var fe={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ue={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},se={dynamic:35048,stream:35040,static:35044},ce=ie.flatten,le=ie.shape,de=35044,me=35040,pe=5121,he=5126,be=[];function ve(e){return 0|fe[Object.prototype.toString.call(e)]}function ge(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function ye(e,t,r,n,a,i,o){for(var f=0,u=0;u<r;++u)for(var s=0;s<n;++s)e[f++]=t[a*u+i*s+o]}be[5120]=1,be[5122]=2,be[5124]=4,be[5121]=1,be[5123]=2,be[5125]=4,be[5126]=4;var xe={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},we=0,Ae=1,_e=4,ke=5120,Se=5121,Ee=5122,Oe=5123,Te=5124,je=5125,De=34963,Ce=35040,ze=35044;var Fe=new Float32Array(1),Be=new Uint32Array(Fe.buffer),Ve=5123;function Pe(e){for(var t=te.allocType(Ve,e.length),r=0;r<e.length;++r)if(isNaN(e[r]))t[r]=65535;else if(e[r]===1/0)t[r]=31744;else if(e[r]===-1/0)t[r]=64512;else{Fe[0]=e[r];var n=Be[0],a=n>>>31<<15,i=(n<<1>>>24)-127,o=n>>13&1023;if(i<-24)t[r]=a;else if(i<-14){var f=-14-i;t[r]=a+(o+1024>>f)}else t[r]=i>15?a+31744:a+(i+15<<10)+o}return t}function Le(t){return Array.isArray(t)||e(t)}var Ie=function(e){return!(e&e-1||!e)},Re=34467,Me=3553,We=34067,Ue=34069,Ge=6408,He=6406,Ne=6407,qe=6409,Qe=6410,Ye=32854,Xe=32855,$e=36194,Ke=32819,Je=32820,Ze=33635,et=34042,tt=6402,rt=34041,nt=35904,at=35906,it=36193,ot=33776,ft=33777,ut=33778,st=33779,ct=35986,lt=35987,dt=34798,mt=35840,pt=35841,ht=35842,bt=35843,vt=36196,gt=5121,yt=5123,xt=5125,wt=5126,At=10242,_t=10243,kt=10497,St=33071,Et=33648,Ot=10240,Tt=10241,jt=9728,Dt=9729,Ct=9984,zt=9985,Ft=9986,Bt=9987,Vt=33170,Pt=4352,Lt=4353,It=4354,Rt=34046,Mt=3317,Wt=37440,Ut=37441,Gt=37443,Ht=37444,Nt=33984,qt=[Ct,Ft,zt,Bt],Qt=[0,qe,Qe,Ne,Ge],Yt={};function Xt(e){return"[object "+e+"]"}Yt[qe]=Yt[He]=Yt[tt]=1,Yt[rt]=Yt[Qe]=2,Yt[Ne]=Yt[nt]=3,Yt[Ge]=Yt[at]=4;var $t=Xt("HTMLCanvasElement"),Kt=Xt("OffscreenCanvas"),Jt=Xt("CanvasRenderingContext2D"),Zt=Xt("ImageBitmap"),er=Xt("HTMLImageElement"),tr=Xt("HTMLVideoElement"),rr=Object.keys(fe).concat([$t,Kt,Jt,Zt,er,tr]),nr=[];nr[gt]=1,nr[wt]=4,nr[it]=2,nr[yt]=2,nr[xt]=4;var ar=[];function ir(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function or(e){return!!Array.isArray(e)&&!(0===e.length||!Le(e[0]))}function fr(e){return Object.prototype.toString.call(e)}function ur(e){return fr(e)===$t}function sr(e){return fr(e)===Kt}function cr(e){if(!e)return!1;var t=fr(e);return rr.indexOf(t)>=0||(ir(e)||or(e)||ne(e))}function lr(e){return 0|fe[Object.prototype.toString.call(e)]}function dr(e,t){return te.allocType(e.type===it?wt:e.type,t)}function mr(e,t){e.type===it?(e.data=Pe(t),te.freeType(t)):e.data=t}function pr(e,t,r,n,a,i){var o;if(o=void 0!==ar[e]?ar[e]:Yt[e]*nr[t],i&&(o*=6),a){for(var f=0,u=r;u>=1;)f+=o*u*u,u/=2;return f}return o*r*n}function hr(r,n,a,i,o,f,u){var s={"don't care":Pt,"dont care":Pt,nice:It,fast:Lt},c={repeat:kt,clamp:St,mirror:Et},l={nearest:jt,linear:Dt},d=t({mipmap:Bt,"nearest mipmap nearest":Ct,"linear mipmap nearest":zt,"nearest mipmap linear":Ft,"linear mipmap linear":Bt},l),m={none:0,browser:Ht},p={uint8:gt,rgba4:Ke,rgb565:Ze,"rgb5 a1":Je},h={alpha:He,luminance:qe,"luminance alpha":Qe,rgb:Ne,rgba:Ge,rgba4:Ye,"rgb5 a1":Xe,rgb565:$e},b={};n.ext_srgb&&(h.srgb=nt,h.srgba=at),n.oes_texture_float&&(p.float32=p.float=wt),n.oes_texture_half_float&&(p.float16=p["half float"]=it),n.webgl_depth_texture&&(t(h,{depth:tt,"depth stencil":rt}),t(p,{uint16:yt,uint32:xt,"depth stencil":et})),n.webgl_compressed_texture_s3tc&&t(b,{"rgb s3tc dxt1":ot,"rgba s3tc dxt1":ft,"rgba s3tc dxt3":ut,"rgba s3tc dxt5":st}),n.webgl_compressed_texture_atc&&t(b,{"rgb atc":ct,"rgba atc explicit alpha":lt,"rgba atc interpolated alpha":dt}),n.webgl_compressed_texture_pvrtc&&t(b,{"rgb pvrtc 4bppv1":mt,"rgb pvrtc 2bppv1":pt,"rgba pvrtc 4bppv1":ht,"rgba pvrtc 2bppv1":bt}),n.webgl_compressed_texture_etc1&&(b["rgb etc1"]=vt);var v=Array.prototype.slice.call(r.getParameter(Re));Object.keys(b).forEach(function(e){var t=b[e];v.indexOf(t)>=0&&(h[e]=t)});var g=Object.keys(h);a.textureFormats=g;var y=[];Object.keys(h).forEach(function(e){var t=h[e];y[t]=e});var x=[];Object.keys(p).forEach(function(e){var t=p[e];x[t]=e});var w=[];Object.keys(l).forEach(function(e){var t=l[e];w[t]=e});var A=[];Object.keys(d).forEach(function(e){var t=d[e];A[t]=e});var _=[];Object.keys(c).forEach(function(e){var t=c[e];_[t]=e});var k=g.reduce(function(e,t){var r=h[t];return r===qe||r===He||r===qe||r===Qe||r===tt||r===rt||n.ext_srgb&&(r===nt||r===at)?e[r]=r:r===Xe||t.indexOf("rgba")>=0?e[r]=Ge:e[r]=Ne,e},{});function S(){this.internalformat=Ge,this.format=Ge,this.type=gt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ht,this.width=0,this.height=0,this.channels=0}function E(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function O(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(F.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(F.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(F.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(F.parameter(t.colorSpace,m,"invalid colorSpace"),e.colorSpace=m[t.colorSpace]),"type"in t){var r=t.type;F(n.oes_texture_float||!("float"===r||"float32"===r),"you must enable the OES_texture_float extension in order to use floating point textures."),F(n.oes_texture_half_float||!("half float"===r||"float16"===r),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),F(n.webgl_depth_texture||!("uint16"===r||"uint32"===r||"depth stencil"===r),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),F.parameter(r,p,"invalid texture type"),e.type=p[r]}var i=e.width,o=e.height,f=e.channels,u=!1;"shape"in t?(F(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),i=t.shape[0],o=t.shape[1],3===t.shape.length&&(f=t.shape[2],F(f>0&&f<=4,"invalid number of channels"),u=!0),F(i>=0&&i<=a.maxTextureSize,"invalid width"),F(o>=0&&o<=a.maxTextureSize,"invalid height")):("radius"in t&&(i=o=t.radius,F(i>=0&&i<=a.maxTextureSize,"invalid radius")),"width"in t&&(i=t.width,F(i>=0&&i<=a.maxTextureSize,"invalid width")),"height"in t&&(o=t.height,F(o>=0&&o<=a.maxTextureSize,"invalid height")),"channels"in t&&(f=t.channels,F(f>0&&f<=4,"invalid number of channels"),u=!0)),e.width=0|i,e.height=0|o,e.channels=0|f;var s=!1;if("format"in t){var c=t.format;F(n.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),F.parameter(c,h,"invalid texture format");var l=e.internalformat=h[c];e.format=k[l],c in p&&("type"in t||(e.type=p[c])),c in b&&(e.compressed=!0),s=!0}!u&&s?e.channels=Yt[e.format]:u&&!s?e.channels!==Qt[e.format]&&(e.format=e.internalformat=Qt[e.channels]):s&&u&&F(e.channels===Yt[e.format],"number of channels inconsistent with specified format")}}function T(e){r.pixelStorei(Wt,e.flipY),r.pixelStorei(Ut,e.premultiplyAlpha),r.pixelStorei(Gt,e.colorSpace),r.pixelStorei(Mt,e.unpackAlignment)}function j(){S.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function D(t,r){var n=null;if(cr(r)?n=r:r&&(F.type(r,"object","invalid pixel data type"),O(t,r),"x"in r&&(t.xOffset=0|r.x),"y"in r&&(t.yOffset=0|r.y),cr(r.data)&&(n=r.data)),F(!t.compressed||n instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),r.copy){F(!n,"can not specify copy and data field for the same texture");var i=o.viewportWidth,f=o.viewportHeight;t.width=t.width||i-t.xOffset,t.height=t.height||f-t.yOffset,t.needsCopy=!0,F(t.xOffset>=0&&t.xOffset<i&&t.yOffset>=0&&t.yOffset<f&&t.width>0&&t.width<=i&&t.height>0&&t.height<=f,"copy texture read out of bounds")}else if(n){if(e(n))t.channels=t.channels||4,t.data=n,"type"in r||t.type!==gt||(t.type=lr(n));else if(ir(n))t.channels=t.channels||4,function(e,t){var r=t.length;switch(e.type){case gt:case yt:case xt:case wt:var n=te.allocType(e.type,r);n.set(t),e.data=n;break;case it:e.data=Pe(t);break;default:F.raise("unsupported texture type, must specify a typed array")}}(t,n),t.alignment=1,t.needsFree=!0;else if(ne(n)){var u=n.data;Array.isArray(u)||t.type!==gt||(t.type=lr(u));var s,c,l,d,m,p,h=n.shape,b=n.stride;3===h.length?(l=h[2],p=b[2]):(F(2===h.length,"invalid ndarray pixel data, must be 2 or 3D"),l=1,p=1),s=h[0],c=h[1],d=b[0],m=b[1],t.alignment=1,t.width=s,t.height=c,t.channels=l,t.format=t.internalformat=Qt[l],t.needsFree=!0,function(e,t,r,n,a,i){for(var o=e.width,f=e.height,u=e.channels,s=dr(e,o*f*u),c=0,l=0;l<f;++l)for(var d=0;d<o;++d)for(var m=0;m<u;++m)s[c++]=t[r*d+n*l+a*m+i];mr(e,s)}(t,u,d,m,p,n.offset)}else if(ur(n)||sr(n)||fr(n)===Jt)ur(n)||sr(n)?t.element=n:t.element=n.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return fr(e)===Zt}(n))t.element=n,t.width=n.width,t.height=n.height,t.channels=4;else if(function(e){return fr(e)===er}(n))t.element=n,t.width=n.naturalWidth,t.height=n.naturalHeight,t.channels=4;else if(function(e){return fr(e)===tr}(n))t.element=n,t.width=n.videoWidth,t.height=n.videoHeight,t.channels=4;else if(or(n)){var v=t.width||n[0].length,g=t.height||n.length,y=t.channels;y=Le(n[0][0])?y||n[0][0].length:y||1;for(var x=ie.shape(n),w=1,A=0;A<x.length;++A)w*=x[A];var _=dr(t,w);ie.flatten(n,x,"",_),mr(t,_),t.alignment=1,t.width=v,t.height=g,t.channels=y,t.format=t.internalformat=Qt[y],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===wt?F(a.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===it&&F(a.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function C(e,t,n){var a=e.element,o=e.data,f=e.internalformat,u=e.format,s=e.type,c=e.width,l=e.height;T(e),a?r.texImage2D(t,n,u,u,s,a):e.compressed?r.compressedTexImage2D(t,n,f,c,l,0,o):e.needsCopy?(i(),r.copyTexImage2D(t,n,u,e.xOffset,e.yOffset,c,l,0)):r.texImage2D(t,n,u,c,l,0,u,s,o||null)}function z(e,t,n,a,o){var f=e.element,u=e.data,s=e.internalformat,c=e.format,l=e.type,d=e.width,m=e.height;T(e),f?r.texSubImage2D(t,o,n,a,c,l,f):e.compressed?r.compressedTexSubImage2D(t,o,n,a,s,d,m,u):e.needsCopy?(i(),r.copyTexSubImage2D(t,o,n,a,e.xOffset,e.yOffset,d,m)):r.texSubImage2D(t,o,n,a,d,m,c,l,u)}var B=[];function V(){return B.pop()||new j}function P(e){e.needsFree&&te.freeType(e.data),j.call(e),B.push(e)}function L(e,t,r){var n=e.images[0]=V();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function I(e,t){var r=null;if(cr(t))E(r=e.images[0]=V(),e),D(r,t),e.mipmask=1;else if(O(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,a=0;a<n.length;++a)E(r=e.images[a]=V(),e),r.width>>=a,r.height>>=a,D(r,n[a]),e.mipmask|=1<<a;else E(r=e.images[0]=V(),e),D(r,t),e.mipmask=1;E(e,e.images[0]),!e.compressed||e.internalformat!==ot&&e.internalformat!==ft&&e.internalformat!==ut&&e.internalformat!==st||F(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function R(e,t){for(var r=e.images,n=0;n<r.length;++n){if(!r[n])return;C(r[n],t,n)}}var M=[];function W(){var e=M.pop()||new function(){S.call(this),this.genMipmaps=!1,this.mipmapHint=Pt,this.mipmask=0,this.images=Array(16)};S.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function U(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&P(t[r]),t[r]=null;M.push(e)}function G(){this.minFilter=jt,this.magFilter=jt,this.wrapS=St,this.wrapT=St,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Pt}function H(e,t){if("min"in t){var r=t.min;F.parameter(r,d),e.minFilter=d[r],qt.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var n=t.mag;F.parameter(n,l),e.magFilter=l[n]}var i=e.wrapS,o=e.wrapT;if("wrap"in t){var f=t.wrap;"string"==typeof f?(F.parameter(f,c),i=o=c[f]):Array.isArray(f)&&(F.parameter(f[0],c),F.parameter(f[1],c),i=c[f[0]],o=c[f[1]])}else{if("wrapS"in t){var u=t.wrapS;F.parameter(u,c),i=c[u]}if("wrapT"in t){var m=t.wrapT;F.parameter(m,c),o=c[m]}}if(e.wrapS=i,e.wrapT=o,"anisotropic"in t){var p=t.anisotropic;F("number"==typeof p&&p>=1&&p<=a.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var h=!1;switch(typeof t.mipmap){case"string":F.parameter(t.mipmap,s,"invalid mipmap hint"),e.mipmapHint=s[t.mipmap],e.genMipmaps=!0,h=!0;break;case"boolean":h=e.genMipmaps=t.mipmap;break;case"object":F(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,h=!0;break;default:F.raise("invalid mipmap type")}!h||"min"in t||(e.minFilter=Ct)}}function N(e,t){r.texParameteri(t,Tt,e.minFilter),r.texParameteri(t,Ot,e.magFilter),r.texParameteri(t,At,e.wrapS),r.texParameteri(t,_t,e.wrapT),n.ext_texture_filter_anisotropic&&r.texParameteri(t,Rt,e.anisotropic),e.genMipmaps&&(r.hint(Vt,e.mipmapHint),r.generateMipmap(t))}var q=0,Q={},Y=a.maxTextureUnits,X=Array(Y).map(function(){return null});function $(e){S.call(this),this.mipmask=0,this.internalformat=Ge,this.id=q++,this.refCount=1,this.target=e,this.texture=r.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new G,u.profile&&(this.stats={size:0})}function K(e){r.activeTexture(Nt),r.bindTexture(e.target,e.texture)}function J(){var e=X[0];e?r.bindTexture(e.target,e.texture):r.bindTexture(Me,null)}function Z(e){var t=e.texture;F(t,"must not double destroy texture");var n=e.unit,a=e.target;n>=0&&(r.activeTexture(Nt+n),r.bindTexture(a,null),X[n]=null),r.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete Q[e.id],f.textureCount--}return t($.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<Y;++t){var n=X[t];if(n){if(n.bindCount>0)continue;n.unit=-1}X[t]=this,e=t;break}e>=Y&&F.raise("insufficient number of texture units"),u.profile&&f.maxTextureUnits<e+1&&(f.maxTextureUnits=e+1),this.unit=e,r.activeTexture(Nt+e),r.bindTexture(this.target,this.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Z(this)}}),u.profile&&(f.getTotalTextureSize=function(){var e=0;return Object.keys(Q).forEach(function(t){e+=Q[t].stats.size}),e}),{create2D:function(e,t){var n=new $(Me);function i(e,t){var r=n.texInfo;G.call(r);var o=W();return"number"==typeof e?L(o,0|e,"number"==typeof t?0|t:0|e):e?(F.type(e,"object","invalid arguments to regl.texture"),H(r,e),I(o,e)):L(o,1,1),r.genMipmaps&&(o.mipmask=(o.width<<1)-1),n.mipmask=o.mipmask,E(n,o),F.texture2D(r,o,a),n.internalformat=o.internalformat,i.width=o.width,i.height=o.height,K(n),R(o,Me),N(r,Me),J(),U(o),u.profile&&(n.stats.size=pr(n.internalformat,n.type,o.width,o.height,r.genMipmaps,!1)),i.format=y[n.internalformat],i.type=x[n.type],i.mag=w[r.magFilter],i.min=A[r.minFilter],i.wrapS=_[r.wrapS],i.wrapT=_[r.wrapT],i}return Q[n.id]=n,f.textureCount++,i(e,t),i.subimage=function(e,t,r,a){F(!!e,"must specify image data");var o=0|t,f=0|r,u=0|a,s=V();return E(s,n),s.width=0,s.height=0,D(s,e),s.width=s.width||(n.width>>u)-o,s.height=s.height||(n.height>>u)-f,F(n.type===s.type&&n.format===s.format&&n.internalformat===s.internalformat,"incompatible format for texture.subimage"),F(o>=0&&f>=0&&o+s.width<=n.width&&f+s.height<=n.height,"texture.subimage write out of bounds"),F(n.mipmask&1<<u,"missing mipmap data"),F(s.data||s.element||s.needsCopy,"missing image data"),K(n),z(s,Me,o,f,u),J(),P(s),i},i.resize=function(e,t){var a=0|e,o=0|t||a;if(a===n.width&&o===n.height)return i;i.width=n.width=a,i.height=n.height=o,K(n);for(var f=0;n.mipmask>>f;++f){var s=a>>f,c=o>>f;if(!s||!c)break;r.texImage2D(Me,f,n.format,s,c,0,n.format,n.type,null)}return J(),u.profile&&(n.stats.size=pr(n.internalformat,n.type,a,o,!1,!1)),i},i._reglType="texture2d",i._texture=n,u.profile&&(i.stats=n.stats),i.destroy=function(){n.decRef()},i},createCube:function(e,t,n,i,o,s){var c=new $(We);Q[c.id]=c,f.cubeCount++;var l=new Array(6);function d(e,t,r,n,i,o){var f,s=c.texInfo;for(G.call(s),f=0;f<6;++f)l[f]=W();if("number"!=typeof e&&e)if("object"==typeof e)if(t)I(l[0],e),I(l[1],t),I(l[2],r),I(l[3],n),I(l[4],i),I(l[5],o);else if(H(s,e),O(c,e),"faces"in e){var m=e.faces;for(F(Array.isArray(m)&&6===m.length,"cube faces must be a length 6 array"),f=0;f<6;++f)F("object"==typeof m[f]&&!!m[f],"invalid input for cube map face"),E(l[f],c),I(l[f],m[f])}else for(f=0;f<6;++f)I(l[f],e);else F.raise("invalid arguments to cube map");else{var p=0|e||1;for(f=0;f<6;++f)L(l[f],p,p)}for(E(c,l[0]),a.npotTextureCube||F(Ie(c.width)&&Ie(c.height),"your browser does not support non power or two texture dimensions"),s.genMipmaps?c.mipmask=(l[0].width<<1)-1:c.mipmask=l[0].mipmask,F.textureCube(c,s,l,a),c.internalformat=l[0].internalformat,d.width=l[0].width,d.height=l[0].height,K(c),f=0;f<6;++f)R(l[f],Ue+f);for(N(s,We),J(),u.profile&&(c.stats.size=pr(c.internalformat,c.type,d.width,d.height,s.genMipmaps,!0)),d.format=y[c.internalformat],d.type=x[c.type],d.mag=w[s.magFilter],d.min=A[s.minFilter],d.wrapS=_[s.wrapS],d.wrapT=_[s.wrapT],f=0;f<6;++f)U(l[f]);return d}return d(e,t,n,i,o,s),d.subimage=function(e,t,r,n,a){F(!!t,"must specify image data"),F("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var i=0|r,o=0|n,f=0|a,u=V();return E(u,c),u.width=0,u.height=0,D(u,t),u.width=u.width||(c.width>>f)-i,u.height=u.height||(c.height>>f)-o,F(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),F(i>=0&&o>=0&&i+u.width<=c.width&&o+u.height<=c.height,"texture.subimage write out of bounds"),F(c.mipmask&1<<f,"missing mipmap data"),F(u.data||u.element||u.needsCopy,"missing image data"),K(c),z(u,Ue+e,i,o,f),J(),P(u),d},d.resize=function(e){var t=0|e;if(t!==c.width){d.width=c.width=t,d.height=c.height=t,K(c);for(var n=0;n<6;++n)for(var a=0;c.mipmask>>a;++a)r.texImage2D(Ue+n,a,c.format,t>>a,t>>a,0,c.format,c.type,null);return J(),u.profile&&(c.stats.size=pr(c.internalformat,c.type,d.width,d.height,!1,!0)),d}},d._reglType="textureCube",d._texture=c,u.profile&&(d.stats=c.stats),d.destroy=function(){c.decRef()},d},clear:function(){for(var e=0;e<Y;++e)r.activeTexture(Nt+e),r.bindTexture(Me,null),X[e]=null;ae(Q).forEach(Z),f.cubeCount=0,f.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<Y;++e){var t=X[e];t&&(t.bindCount=0,t.unit=-1,X[e]=null)}ae(Q).forEach(function(e){e.texture=r.createTexture(),r.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===Me)r.texImage2D(Me,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var n=0;n<6;++n)r.texImage2D(Ue+n,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);N(e.texInfo,e.target)})}}}ar[Ye]=2,ar[Xe]=2,ar[$e]=2,ar[rt]=4,ar[ot]=.5,ar[ft]=.5,ar[ut]=1,ar[st]=1,ar[ct]=.5,ar[lt]=1,ar[dt]=1,ar[mt]=.5,ar[pt]=.25,ar[ht]=.5,ar[bt]=.25,ar[vt]=.5;var br=36161,vr=32854,gr=[];function yr(e,t,r){return gr[e]*t*r}gr[vr]=2,gr[32855]=2,gr[36194]=2,gr[33189]=2,gr[36168]=1,gr[34041]=4,gr[35907]=4,gr[34836]=16,gr[34842]=8,gr[34843]=6;var xr=function(e,t,r,n,a){var i={rgba4:vr,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(i.srgba=35907),t.ext_color_buffer_half_float&&(i.rgba16f=34842,i.rgb16f=34843),t.webgl_color_buffer_float&&(i.rgba32f=34836);var o=[];Object.keys(i).forEach(function(e){var t=i[e];o[t]=e});var f=0,u={};function s(e){this.id=f++,this.refCount=1,this.renderbuffer=e,this.format=vr,this.width=0,this.height=0,a.profile&&(this.stats={size:0})}function c(t){var r=t.renderbuffer;F(r,"must not double destroy renderbuffer"),e.bindRenderbuffer(br,null),e.deleteRenderbuffer(r),t.renderbuffer=null,t.refCount=0,delete u[t.id],n.renderbufferCount--}return s.prototype.decRef=function(){--this.refCount<=0&&c(this)},a.profile&&(n.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach(function(t){e+=u[t].stats.size}),e}),{create:function(t,f){var c=new s(e.createRenderbuffer());function l(t,n){var f=0,u=0,s=vr;if("object"==typeof t&&t){var d=t;if("shape"in d){var m=d.shape;F(Array.isArray(m)&&m.length>=2,"invalid renderbuffer shape"),f=0|m[0],u=0|m[1]}else"radius"in d&&(f=u=0|d.radius),"width"in d&&(f=0|d.width),"height"in d&&(u=0|d.height);"format"in d&&(F.parameter(d.format,i,"invalid renderbuffer format"),s=i[d.format])}else"number"==typeof t?(f=0|t,u="number"==typeof n?0|n:f):t?F.raise("invalid arguments to renderbuffer constructor"):f=u=1;if(F(f>0&&u>0&&f<=r.maxRenderbufferSize&&u<=r.maxRenderbufferSize,"invalid renderbuffer size"),f!==c.width||u!==c.height||s!==c.format)return l.width=c.width=f,l.height=c.height=u,c.format=s,e.bindRenderbuffer(br,c.renderbuffer),e.renderbufferStorage(br,s,f,u),F(0===e.getError(),"invalid render buffer format"),a.profile&&(c.stats.size=yr(c.format,c.width,c.height)),l.format=o[c.format],l}return u[c.id]=c,n.renderbufferCount++,l(t,f),l.resize=function(t,n){var i=0|t,o=0|n||i;return i===c.width&&o===c.height?l:(F(i>0&&o>0&&i<=r.maxRenderbufferSize&&o<=r.maxRenderbufferSize,"invalid renderbuffer size"),l.width=c.width=i,l.height=c.height=o,e.bindRenderbuffer(br,c.renderbuffer),e.renderbufferStorage(br,c.format,i,o),F(0===e.getError(),"invalid render buffer format"),a.profile&&(c.stats.size=yr(c.format,c.width,c.height)),l)},l._reglType="renderbuffer",l._renderbuffer=c,a.profile&&(l.stats=c.stats),l.destroy=function(){c.decRef()},l},clear:function(){ae(u).forEach(c)},restore:function(){ae(u).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(br,t.renderbuffer),e.renderbufferStorage(br,t.format,t.width,t.height)}),e.bindRenderbuffer(br,null)}}},wr=36160,Ar=36161,_r=3553,kr=34069,Sr=36064,Er=36096,Or=36128,Tr=33306,jr=36053,Dr=6402,Cr=[6407,6408],zr=[];zr[6408]=4,zr[6407]=3;var Fr=[];Fr[5121]=1,Fr[5126]=4,Fr[36193]=2;var Br=33189,Vr=36168,Pr=34041,Lr=[32854,32855,36194,35907,34842,34843,34836],Ir={};Ir[jr]="complete",Ir[36054]="incomplete attachment",Ir[36057]="incomplete dimensions",Ir[36055]="incomplete, missing attachment",Ir[36061]="unsupported";var Rr=5126,Mr=34962;function Wr(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Rr,this.offset=0,this.stride=0,this.divisor=0}var Ur=35632,Gr=35633,Hr=35718,Nr=35721;function qr(e,t,r,n){var a={},i={};function o(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function f(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function u(r,n,o){var f=r===Ur?a:i,u=f[n];if(!u){var s=t.str(n);u=e.createShader(r),e.shaderSource(u,s),e.compileShader(u),F.shaderError(e,u,s,r,o),f[n]=u}return u}var s={},c=[],l=0;function d(r,a,i){var s,c,l=u(Ur,r.fragId),d=u(Gr,r.vertId),m=r.program=e.createProgram();if(e.attachShader(m,l),e.attachShader(m,d),i)for(let t=0;t<i.length;++t){var p=i[t];e.bindAttribLocation(m,p[0],p[1])}e.linkProgram(m),F.linkError(e,m,t.str(r.fragId),t.str(r.vertId),a);var h=e.getProgramParameter(m,Hr);n.profile&&(r.stats.uniformsCount=h);var b=r.uniforms;for(s=0;s<h;++s)if(c=e.getActiveUniform(m,s))if(c.size>1)for(var v=0;v<c.size;++v){var g=c.name.replace("[0]","["+v+"]");f(b,new o(g,t.id(g),e.getUniformLocation(m,g),c))}else f(b,new o(c.name,t.id(c.name),e.getUniformLocation(m,c.name),c));var y=e.getProgramParameter(m,Nr);n.profile&&(r.stats.attributesCount=y);var x=r.attributes;for(s=0;s<y;++s)(c=e.getActiveAttrib(m,s))&&f(x,new o(c.name,t.id(c.name),e.getAttribLocation(m,c.name),c))}return n.profile&&(r.getMaxUniformsCount=function(){var e=0;return c.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},r.getMaxAttributesCount=function(){var e=0;return c.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var t=e.deleteShader.bind(e);ae(a).forEach(t),a={},ae(i).forEach(t),i={},c.forEach(function(t){e.deleteProgram(t.program)}),c.length=0,s={},r.shaderCount=0},program:function(e,t,a,i){F.command(e>=0,"missing vertex shader",a),F.command(t>=0,"missing fragment shader",a);var o=s[t];o||(o=s[t]={});var f=o[e];if(f&&!i)return f;var u=new function(e,t){this.id=l++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],n.profile&&(this.stats={uniformsCount:0,attributesCount:0})}(t,e);return r.shaderCount++,d(u,a,i),f||(o[e]=u),c.push(u),u},restore:function(){a={},i={};for(var e=0;e<c.length;++e)d(c[e],null,c[e].attributes.map(function(e){return[e.location,e.name]}))},shader:u,frag:-1,vert:-1}}var Qr=6408,Yr=5121,Xr=3333,$r=5126;function Kr(t,r,n,a,i,o,f){function u(u){var s;null===r.next?(F(i.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),s=Yr):(F(null!==r.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),s=r.next.colorAttachments[0].texture._texture.type,o.oes_texture_float?(F(s===Yr||s===$r,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),s===$r&&F(f.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):F(s===Yr,"Reading from a framebuffer is only allowed for the type 'uint8'"));var c=0,l=0,d=a.framebufferWidth,m=a.framebufferHeight,p=null;e(u)?p=u:u&&(F.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,l=0|u.y,F(c>=0&&c<a.framebufferWidth,"invalid x offset for regl.read"),F(l>=0&&l<a.framebufferHeight,"invalid y offset for regl.read"),d=0|(u.width||a.framebufferWidth-c),m=0|(u.height||a.framebufferHeight-l),p=u.data||null),p&&(s===Yr?F(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):s===$r&&F(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),F(d>0&&d+c<=a.framebufferWidth,"invalid width for read pixels"),F(m>0&&m+l<=a.framebufferHeight,"invalid height for read pixels"),n();var h=d*m*4;return p||(s===Yr?p=new Uint8Array(h):s===$r&&(p=p||new Float32Array(h))),F.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),F(p.byteLength>=h,"data buffer for regl.read() too small"),t.pixelStorei(Xr,4),t.readPixels(c,l,d,m,Qr,s,p),p}return function(e){return e&&"framebuffer"in e?function(e){var t;return r.setFBO({framebuffer:e.framebuffer},function(){t=u(e)}),t}(e):u(e)}}function Jr(e){return Array.prototype.slice.call(e)}function Zr(e){return Jr(e).join("")}var en="xyzw".split(""),tn=5121,rn=1,nn=2,an=0,on=1,fn=2,un=3,sn=4,cn="dither",ln="blend.enable",dn="blend.color",mn="blend.equation",pn="blend.func",hn="depth.enable",bn="depth.func",vn="depth.range",gn="depth.mask",yn="colorMask",xn="cull.enable",wn="cull.face",An="frontFace",_n="lineWidth",kn="polygonOffset.enable",Sn="polygonOffset.offset",En="sample.alpha",On="sample.enable",Tn="sample.coverage",jn="stencil.enable",Dn="stencil.mask",Cn="stencil.func",zn="stencil.opFront",Fn="stencil.opBack",Bn="scissor.enable",Vn="scissor.box",Pn="viewport",Ln="profile",In="framebuffer",Rn="vert",Mn="frag",Wn="elements",Un="primitive",Gn="count",Hn="offset",Nn="instances",qn="vao",Qn=In+"Width",Yn=In+"Height",Xn=Pn+"Width",$n=Pn+"Height",Kn="drawingBufferWidth",Jn="drawingBufferHeight",Zn=[pn,mn,Cn,zn,Fn,Tn,Pn,Vn,Sn],ea=34962,ta=34963,ra=3553,na=34067,aa=2884,ia=3042,oa=3024,fa=2960,ua=2929,sa=3089,ca=32823,la=32926,da=32928,ma=5126,pa=35664,ha=35665,ba=35666,va=5124,ga=35667,ya=35668,xa=35669,wa=35670,Aa=35671,_a=35672,ka=35673,Sa=35674,Ea=35675,Oa=35676,Ta=35678,ja=35680,Da=4,Ca=1028,za=1029,Fa=2304,Ba=2305,Va=32775,Pa=32776,La=519,Ia=7680,Ra=0,Ma=1,Wa=32774,Ua=513,Ga=36160,Ha=36064,Na={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},qa=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Qa={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ya={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Xa={frag:35632,vert:35633},$a={cw:Fa,ccw:Ba};function Ka(t){return Array.isArray(t)||e(t)||ne(t)}function Ja(e){return e.sort(function(e,t){return e===Pn?-1:t===Pn?1:e<t?-1:1})}function Za(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function ei(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ti(e){return new Za(!1,!1,!1,e)}function ri(e,t){var r=e.type;if(r===an){var n=e.data.length;return new Za(!0,n>=1,n>=2,t)}if(r===sn){var a=e.data;return new Za(a.thisDep,a.contextDep,a.propDep,t)}return new Za(r===un,r===fn,r===on,t)}var ni=new Za(!1,!1,!1,function(){});function ai(e,r,n,a,i,o,f,u,s,c,l,d,m,p,h){var b=c.Record,v={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(v.min=Va,v.max=Pa);var g=n.angle_instanced_arrays,y=n.webgl_draw_buffers,x={dirty:!0,profile:h.profile},w={},A=[],_={},k={};function S(e){return e.replace(".","_")}function E(e,t,r){var n=S(e);A.push(e),w[n]=x[n]=!!r,_[n]=t}function O(e,t,r){var n=S(e);A.push(e),Array.isArray(r)?(x[n]=r.slice(),w[n]=r.slice()):x[n]=w[n]=r,k[n]=t}E(cn,oa),E(ln,ia),O(dn,"blendColor",[0,0,0,0]),O(mn,"blendEquationSeparate",[Wa,Wa]),O(pn,"blendFuncSeparate",[Ma,Ra,Ma,Ra]),E(hn,ua,!0),O(bn,"depthFunc",Ua),O(vn,"depthRange",[0,1]),O(gn,"depthMask",!0),O(yn,yn,[!0,!0,!0,!0]),E(xn,aa),O(wn,"cullFace",za),O(An,An,Ba),O(_n,_n,1),E(kn,ca),O(Sn,"polygonOffset",[0,0]),E(En,la),E(On,da),O(Tn,"sampleCoverage",[1,!1]),E(jn,fa),O(Dn,"stencilMask",-1),O(Cn,"stencilFunc",[La,0,-1]),O(zn,"stencilOpSeparate",[Ca,Ia,Ia,Ia]),O(Fn,"stencilOpSeparate",[za,Ia,Ia,Ia]),E(Bn,sa),O(Vn,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),O(Pn,Pn,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var T={gl:e,context:m,strings:r,next:w,current:x,draw:d,elements:o,buffer:i,shader:l,attributes:c.state,vao:c,uniforms:s,framebuffer:u,extensions:n,timer:p,isBufferArgs:Ka},j={primTypes:xe,compareFuncs:Qa,blendFuncs:Na,blendEquations:v,stencilOps:Ya,glTypes:ue,orientationType:$a};F.optional(function(){T.isArrayLike=Le}),y&&(j.backBuffer=[za],j.drawBuffer=N(a.maxDrawbuffers,function(e){return 0===e?[0]:N(e,function(e){return Ha+e})}));var D=0;function C(){var e=function(){var e=0,r=[],n=[];function a(){var r=[],n=[];return t(function(){r.push.apply(r,Jr(arguments))},{def:function(){var t="v"+e++;return n.push(t),arguments.length>0&&(r.push(t,"="),r.push.apply(r,Jr(arguments)),r.push(";")),t},toString:function(){return Zr([n.length>0?"var "+n.join(",")+";":"",Zr(r)])}})}function i(){var e=a(),r=a(),n=e.toString,i=r.toString;function o(t,n){r(t,n,"=",e.def(t,n),";")}return t(function(){e.apply(e,Jr(arguments))},{def:e.def,entry:e,exit:r,save:o,set:function(t,r,n){o(t,r),e(t,r,"=",n,";")},toString:function(){return n()+i()}})}var o=a(),f={};return{global:o,link:function(t){for(var a=0;a<n.length;++a)if(n[a]===t)return r[a];var i="g"+e++;return r.push(i),n.push(t),i},block:a,proc:function(e,r){var n=[];function a(){var e="a"+n.length;return n.push(e),e}r=r||0;for(var o=0;o<r;++o)a();var u=i(),s=u.toString;return f[e]=t(u,{arg:a,toString:function(){return Zr(["function(",n.join(),"){",s(),"}"])}})},scope:i,cond:function(){var e=Zr(arguments),r=i(),n=i(),a=r.toString,o=n.toString;return t(r,{then:function(){return r.apply(r,Jr(arguments)),this},else:function(){return n.apply(n,Jr(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),Zr(["if(",e,"){",a(),"}",t])}})},compile:function(){var e=['"use strict";',o,"return {"];Object.keys(f).forEach(function(t){e.push('"',t,'":',f[t].toString(),",")}),e.push("}");var t=Zr(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,r.concat(t)).apply(null,n)}}}(),n=e.link,a=e.global;e.id=D++,e.batchId="0";var i=n(T),o=e.shared={props:"a0"};Object.keys(T).forEach(function(e){o[e]=a.def(i,".",e)}),F.optional(function(){e.CHECK=n(F),e.commandStr=F.guessCommand(),e.command=n(e.commandStr),e.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},j.invalidBlendCombinations=qa});var f=e.next={},u=e.current={};Object.keys(k).forEach(function(e){Array.isArray(x[e])&&(f[e]=a.def(o.next,".",e),u[e]=a.def(o.current,".",e))});var s=e.constants={};Object.keys(j).forEach(function(e){s[e]=a.def(JSON.stringify(j[e]))}),e.invoke=function(t,r){switch(r.type){case an:var a=["this",o.context,o.props,e.batchId];return t.def(n(r.data),".call(",a.slice(0,Math.max(r.data.length+1,4)),")");case on:return t.def(o.props,r.data);case fn:return t.def(o.context,r.data);case un:return t.def("this",r.data);case sn:return r.data.append(e,t),r.data.ref}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var t=r.id(e);if(t in l)return l[t];var a=c.scope[t];return a||(a=c.scope[t]=new b),l[t]=n(a)},e}function z(e,t,f,s,d){var m=e.static,p=e.dynamic;F.optional(function(){var e=[In,Rn,Mn,Wn,Un,Hn,Gn,Nn,Ln,qn].concat(A);function t(t){Object.keys(t).forEach(function(t){F.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',d.commandStr)})}t(m),t(p)});var h=function(e,t){var r=e.static;if("string"==typeof r[Mn]&&"string"==typeof r[Rn]){if(Object.keys(t.dynamic).length>0)return null;var n=t.static,a=Object.keys(n);if(a.length>0&&"number"==typeof n[a[0]]){for(var i=[],o=0;o<a.length;++o)F("number"==typeof n[a[o]],"must specify all vertex attribute locations when using vaos"),i.push([0|n[a[o]],a[o]]);return i}}return null}(e,t),y=function(e,t){var r=e.static,n=e.dynamic;if(In in r){var a=r[In];return a?(a=u.getFramebuffer(a),F.command(a,"invalid framebuffer object"),ti(function(e,t){var r=e.link(a),n=e.shared;t.set(n.framebuffer,".next",r);var i=n.context;return t.set(i,"."+Qn,r+".width"),t.set(i,"."+Yn,r+".height"),r})):ti(function(e,t){var r=e.shared;t.set(r.framebuffer,".next","null");var n=r.context;return t.set(n,"."+Qn,n+"."+Kn),t.set(n,"."+Yn,n+"."+Jn),"null"})}if(In in n){var i=n[In];return ri(i,function(e,t){var r=e.invoke(t,i),n=e.shared,a=n.framebuffer,o=t.def(a,".getFramebuffer(",r,")");F.optional(function(){e.assert(t,"!"+r+"||"+o,"invalid framebuffer object")}),t.set(a,".next",o);var f=n.context;return t.set(f,"."+Qn,o+"?"+o+".width:"+f+"."+Kn),t.set(f,"."+Yn,o+"?"+o+".height:"+f+"."+Jn),o})}return null}(e),x=function(e,t,r){var n=e.static,a=e.dynamic;function i(e){if(e in n){var i=n[e];F.commandType(i,"object","invalid "+e,r.commandStr);var o,f,u=!0,s=0|i.x,c=0|i.y;return"width"in i?(o=0|i.width,F.command(o>=0,"invalid "+e,r.commandStr)):u=!1,"height"in i?(f=0|i.height,F.command(f>=0,"invalid "+e,r.commandStr)):u=!1,new Za(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,function(e,t){var r=e.shared.context,n=o;"width"in i||(n=t.def(r,".",Qn,"-",s));var a=f;return"height"in i||(a=t.def(r,".",Yn,"-",c)),[s,c,n,a]})}if(e in a){var l=a[e],d=ri(l,function(t,r){var n=t.invoke(r,l);F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)});var a=t.shared.context,i=r.def(n,".x|0"),o=r.def(n,".y|0"),f=r.def('"width" in ',n,"?",n,".width|0:","(",a,".",Qn,"-",i,")"),u=r.def('"height" in ',n,"?",n,".height|0:","(",a,".",Yn,"-",o,")");return F.optional(function(){t.assert(r,f+">=0&&"+u+">=0","invalid "+e)}),[i,o,f,u]});return t&&(d.thisDep=d.thisDep||t.thisDep,d.contextDep=d.contextDep||t.contextDep,d.propDep=d.propDep||t.propDep),d}return t?new Za(t.thisDep,t.contextDep,t.propDep,function(e,t){var r=e.shared.context;return[0,0,t.def(r,".",Qn),t.def(r,".",Yn)]}):null}var o=i(Pn);if(o){var f=o;o=new Za(o.thisDep,o.contextDep,o.propDep,function(e,t){var r=f.append(e,t),n=e.shared.context;return t.set(n,"."+Xn,r[2]),t.set(n,"."+$n,r[3]),r})}return{viewport:o,scissor_box:i(Vn)}}(e,y,d),w=function(e,t){var r=e.static,n=e.dynamic,a=function(){if(Wn in r){var e=r[Wn];Ka(e)?e=o.getElements(o.create(e,!0)):e&&(e=o.getElements(e),F.command(e,"invalid elements",t.commandStr));var a=ti(function(t,r){if(e){var n=t.link(e);return t.ELEMENTS=n,n}return t.ELEMENTS=null,null});return a.value=e,a}if(Wn in n){var i=n[Wn];return ri(i,function(e,t){var r=e.shared,n=r.isBufferArgs,a=r.elements,o=e.invoke(t,i),f=t.def("null"),u=t.def(n,"(",o,")"),s=e.cond(u).then(f,"=",a,".createStream(",o,");").else(f,"=",a,".getElements(",o,");");return F.optional(function(){e.assert(s.else,"!"+o+"||"+f,"invalid elements")}),t.entry(s),t.exit(e.cond(u).then(a,".destroyStream(",f,");")),e.ELEMENTS=f,f})}return null}();function i(e,i){if(e in r){var o=0|r[e];return F.command(!i||o>=0,"invalid "+e,t.commandStr),ti(function(e,t){return i&&(e.OFFSET=o),o})}if(e in n){var f=n[e];return ri(f,function(t,r){var n=t.invoke(r,f);return i&&(t.OFFSET=n,F.optional(function(){t.assert(r,n+">=0","invalid "+e)})),n})}return i&&a?ti(function(e,t){return e.OFFSET="0",0}):null}var f=i(Hn,!0);return{elements:a,primitive:function(){if(Un in r){var e=r[Un];return F.commandParameter(e,xe,"invalid primitve",t.commandStr),ti(function(t,r){return xe[e]})}if(Un in n){var i=n[Un];return ri(i,function(e,t){var r=e.constants.primTypes,n=e.invoke(t,i);return F.optional(function(){e.assert(t,n+" in "+r,"invalid primitive, must be one of "+Object.keys(xe))}),t.def(r,"[",n,"]")})}return a?ei(a)?a.value?ti(function(e,t){return t.def(e.ELEMENTS,".primType")}):ti(function(){return Da}):new Za(a.thisDep,a.contextDep,a.propDep,function(e,t){var r=e.ELEMENTS;return t.def(r,"?",r,".primType:",Da)}):null}(),count:function(){if(Gn in r){var e=0|r[Gn];return F.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),ti(function(){return e})}if(Gn in n){var i=n[Gn];return ri(i,function(e,t){var r=e.invoke(t,i);return F.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")}),r})}if(a){if(ei(a)){if(a)return f?new Za(f.thisDep,f.contextDep,f.propDep,function(e,t){var r=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return F.optional(function(){e.assert(t,r+">=0","invalid vertex offset/element buffer too small")}),r}):ti(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var o=ti(function(){return-1});return F.optional(function(){o.MISSING=!0}),o}var u=new Za(a.thisDep||f.thisDep,a.contextDep||f.contextDep,a.propDep||f.propDep,function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")});return F.optional(function(){u.DYNAMIC=!0}),u}return null}(),instances:i(Nn,!1),offset:f}}(e,d),_=function(e,t){var r=e.static,n=e.dynamic,i={};return A.forEach(function(e){var o=S(e);function f(t,a){if(e in r){var f=t(r[e]);i[o]=ti(function(){return f})}else if(e in n){var u=n[e];i[o]=ri(u,function(e,t){return a(e,t,e.invoke(t,u))})}}switch(e){case xn:case ln:case cn:case jn:case hn:case Bn:case kn:case En:case On:case gn:return f(function(r){return F.commandType(r,"boolean",e,t.commandStr),r},function(t,r,n){return F.optional(function(){t.assert(r,"typeof "+n+'==="boolean"',"invalid flag "+e,t.commandStr)}),n});case bn:return f(function(r){return F.commandParameter(r,Qa,"invalid "+e,t.commandStr),Qa[r]},function(t,r,n){var a=t.constants.compareFuncs;return F.optional(function(){t.assert(r,n+" in "+a,"invalid "+e+", must be one of "+Object.keys(Qa))}),r.def(a,"[",n,"]")});case vn:return f(function(e){return F.command(Le(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e},function(e,t,r){return F.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===2&&typeof "+r+'[0]==="number"&&typeof '+r+'[1]==="number"&&'+r+"[0]<="+r+"[1]","depth range must be a 2d array")}),[t.def("+",r,"[0]"),t.def("+",r,"[1]")]});case pn:return f(function(e){F.commandType(e,"object","blend.func",t.commandStr);var r="srcRGB"in e?e.srcRGB:e.src,n="srcAlpha"in e?e.srcAlpha:e.src,a="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return F.commandParameter(r,Na,o+".srcRGB",t.commandStr),F.commandParameter(n,Na,o+".srcAlpha",t.commandStr),F.commandParameter(a,Na,o+".dstRGB",t.commandStr),F.commandParameter(i,Na,o+".dstAlpha",t.commandStr),F.command(-1===qa.indexOf(r+", "+a),"unallowed blending combination (srcRGB, dstRGB) = ("+r+", "+a+")",t.commandStr),[Na[r],Na[a],Na[n],Na[i]]},function(t,r,n){var a=t.constants.blendFuncs;function i(i,o){var f=r.def('"',i,o,'" in ',n,"?",n,".",i,o,":",n,".",i);return F.optional(function(){t.assert(r,f+" in "+a,"invalid "+e+"."+i+o+", must be one of "+Object.keys(Na))}),f}F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid blend func, must be an object")});var o=i("src","RGB"),f=i("dst","RGB");F.optional(function(){var e=t.constants.invalidBlendCombinations;t.assert(r,e+".indexOf("+o+'+", "+'+f+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var u=r.def(a,"[",o,"]"),s=r.def(a,"[",i("src","Alpha"),"]");return[u,r.def(a,"[",f,"]"),s,r.def(a,"[",i("dst","Alpha"),"]")]});case mn:return f(function(r){return"string"==typeof r?(F.commandParameter(r,v,"invalid "+e,t.commandStr),[v[r],v[r]]):"object"==typeof r?(F.commandParameter(r.rgb,v,e+".rgb",t.commandStr),F.commandParameter(r.alpha,v,e+".alpha",t.commandStr),[v[r.rgb],v[r.alpha]]):void F.commandRaise("invalid blend.equation",t.commandStr)},function(t,r,n){var a=t.constants.blendEquations,i=r.def(),o=r.def(),f=t.cond("typeof ",n,'==="string"');return F.optional(function(){function r(e,r,n){t.assert(e,n+" in "+a,"invalid "+r+", must be one of "+Object.keys(v))}r(f.then,e,n),t.assert(f.else,n+"&&typeof "+n+'==="object"',"invalid "+e),r(f.else,e+".rgb",n+".rgb"),r(f.else,e+".alpha",n+".alpha")}),f.then(i,"=",o,"=",a,"[",n,"];"),f.else(i,"=",a,"[",n,".rgb];",o,"=",a,"[",n,".alpha];"),r(f),[i,o]});case dn:return f(function(e){return F.command(Le(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),N(4,function(t){return+e[t]})},function(e,t,r){return F.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","blend.color must be a 4d array")}),N(4,function(e){return t.def("+",r,"[",e,"]")})});case Dn:return f(function(e){return F.commandType(e,"number",o,t.commandStr),0|e},function(e,t,r){return F.optional(function(){e.assert(t,"typeof "+r+'==="number"',"invalid stencil.mask")}),t.def(r,"|0")});case Cn:return f(function(r){F.commandType(r,"object",o,t.commandStr);var n=r.cmp||"keep",a=r.ref||0,i="mask"in r?r.mask:-1;return F.commandParameter(n,Qa,e+".cmp",t.commandStr),F.commandType(a,"number",e+".ref",t.commandStr),F.commandType(i,"number",e+".mask",t.commandStr),[Qa[n],a,i]},function(e,t,r){var n=e.constants.compareFuncs;return F.optional(function(){function a(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}a(r+"&&typeof ",r,'==="object"'),a('!("cmp" in ',r,")||(",r,".cmp in ",n,")")}),[t.def('"cmp" in ',r,"?",n,"[",r,".cmp]",":",Ia),t.def(r,".ref|0"),t.def('"mask" in ',r,"?",r,".mask|0:-1")]});case zn:case Fn:return f(function(r){F.commandType(r,"object",o,t.commandStr);var n=r.fail||"keep",a=r.zfail||"keep",i=r.zpass||"keep";return F.commandParameter(n,Ya,e+".fail",t.commandStr),F.commandParameter(a,Ya,e+".zfail",t.commandStr),F.commandParameter(i,Ya,e+".zpass",t.commandStr),[e===Fn?za:Ca,Ya[n],Ya[a],Ya[i]]},function(t,r,n){var a=t.constants.stencilOps;function i(i){return F.optional(function(){t.assert(r,'!("'+i+'" in '+n+")||("+n+"."+i+" in "+a+")","invalid "+e+"."+i+", must be one of "+Object.keys(Ya))}),r.def('"',i,'" in ',n,"?",a,"[",n,".",i,"]:",Ia)}return F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)}),[e===Fn?za:Ca,i("fail"),i("zfail"),i("zpass")]});case Sn:return f(function(e){F.commandType(e,"object",o,t.commandStr);var r=0|e.factor,n=0|e.units;return F.commandType(r,"number",o+".factor",t.commandStr),F.commandType(n,"number",o+".units",t.commandStr),[r,n]},function(t,r,n){return F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)}),[r.def(n,".factor|0"),r.def(n,".units|0")]});case wn:return f(function(e){var r=0;return"front"===e?r=Ca:"back"===e&&(r=za),F.command(!!r,o,t.commandStr),r},function(e,t,r){return F.optional(function(){e.assert(t,r+'==="front"||'+r+'==="back"',"invalid cull.face")}),t.def(r,'==="front"?',Ca,":",za)});case _n:return f(function(e){return F.command("number"==typeof e&&e>=a.lineWidthDims[0]&&e<=a.lineWidthDims[1],"invalid line width, must be a positive number between "+a.lineWidthDims[0]+" and "+a.lineWidthDims[1],t.commandStr),e},function(e,t,r){return F.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">="+a.lineWidthDims[0]+"&&"+r+"<="+a.lineWidthDims[1],"invalid line width")}),r});case An:return f(function(e){return F.commandParameter(e,$a,o,t.commandStr),$a[e]},function(e,t,r){return F.optional(function(){e.assert(t,r+'==="cw"||'+r+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(r+'==="cw"?'+Fa+":"+Ba)});case yn:return f(function(e){return F.command(Le(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map(function(e){return!!e})},function(e,t,r){return F.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","invalid color.mask")}),N(4,function(e){return"!!"+r+"["+e+"]"})});case Tn:return f(function(e){F.command("object"==typeof e&&e,o,t.commandStr);var r="value"in e?e.value:1,n=!!e.invert;return F.command("number"==typeof r&&r>=0&&r<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[r,n]},function(e,t,r){return F.optional(function(){e.assert(t,r+"&&typeof "+r+'==="object"',"invalid sample.coverage")}),[t.def('"value" in ',r,"?+",r,".value:1"),t.def("!!",r,".invert")]})}}),i}(e,d),k=function(e,t,n){var a=e.static,i=e.dynamic;function o(e){if(e in a){var t=r.id(a[e]);F.optional(function(){l.shader(Xa[e],t,F.guessCommand())});var n=ti(function(){return t});return n.id=t,n}if(e in i){var o=i[e];return ri(o,function(t,r){var n=t.invoke(r,o),a=r.def(t.shared.strings,".id(",n,")");return F.optional(function(){r(t.shared.shader,".shader(",Xa[e],",",a,",",t.command,");")}),a})}return null}var f,u=o(Mn),s=o(Rn),c=null;return ei(u)&&ei(s)?(c=l.program(s.id,u.id,null,n),f=ti(function(e,t){return e.link(c)})):f=new Za(u&&u.thisDep||s&&s.thisDep,u&&u.contextDep||s&&s.contextDep,u&&u.propDep||s&&s.propDep,function(e,t){var r,n=e.shared.shader;r=u?u.append(e,t):t.def(n,".",Mn);var a=n+".program("+(s?s.append(e,t):t.def(n,".",Rn))+","+r;return F.optional(function(){a+=","+e.command}),t.def(a+")")}),{frag:u,vert:s,progVar:f,program:c}}(e,0,h);function E(e){var t=x[e];t&&(_[e]=t)}E(Pn),E(S(Vn));var O=Object.keys(_).length>0,T={framebuffer:y,draw:w,shader:k,state:_,dirty:O,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(T.profile=function(e){var t,r=e.static,n=e.dynamic;if(Ln in r){var a=!!r[Ln];(t=ti(function(e,t){return a})).enable=a}else if(Ln in n){var i=n[Ln];t=ri(i,function(e,t){return e.invoke(t,i)})}return t}(e),T.uniforms=function(e,t){var r=e.static,n=e.dynamic,a={};return Object.keys(r).forEach(function(e){var n,i=r[e];if("number"==typeof i||"boolean"==typeof i)n=ti(function(){return i});else if("function"==typeof i){var o=i._reglType;"texture2d"===o||"textureCube"===o?n=ti(function(e){return e.link(i)}):"framebuffer"===o||"framebufferCube"===o?(F.command(i.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),n=ti(function(e){return e.link(i.color[0])})):F.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else Le(i)?n=ti(function(t){return t.global.def("[",N(i.length,function(r){return F.command("number"==typeof i[r]||"boolean"==typeof i[r],"invalid uniform "+e,t.commandStr),i[r]}),"]")}):F.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);n.value=i,a[e]=n}),Object.keys(n).forEach(function(e){var t=n[e];a[e]=ri(t,function(e,r){return e.invoke(r,t)})}),a}(f,d),T.drawVAO=T.scopeVAO=function(e,t){var r=e.static,n=e.dynamic;if(qn in r){var a=r[qn];return null!==a&&null===c.getVAO(a)&&(a=c.createVAO(a)),ti(function(e){return e.link(c.getVAO(a))})}if(qn in n){var i=n[qn];return ri(i,function(e,t){var r=e.invoke(t,i);return t.def(e.shared.vao+".getVAO("+r+")")})}return null}(e),!T.drawVAO&&k.program&&!h&&n.angle_instanced_arrays){var j=!0,D=k.program.attributes.map(function(e){var r=t.static[e];return j=j&&!!r,r});if(j&&D.length>0){var C=c.getVAO(c.createVAO(D));T.drawVAO=new Za(null,null,null,function(e,t){return e.link(C)}),T.useVAO=!0}}return h?T.useVAO=!0:T.attributes=function(e,t){var n=e.static,a=e.dynamic,o={};return Object.keys(n).forEach(function(e){var a=n[e],f=r.id(e),u=new b;if(Ka(a))u.state=rn,u.buffer=i.getBuffer(i.create(a,ea,!1,!0)),u.type=0;else{var s=i.getBuffer(a);if(s)u.state=rn,u.buffer=s,u.type=0;else if(F.command("object"==typeof a&&a,"invalid data for attribute "+e,t.commandStr),"constant"in a){var c=a.constant;u.buffer="null",u.state=nn,"number"==typeof c?u.x=c:(F.command(Le(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,t.commandStr),en.forEach(function(e,t){t<c.length&&(u[e]=c[t])}))}else{s=Ka(a.buffer)?i.getBuffer(i.create(a.buffer,ea,!1,!0)):i.getBuffer(a.buffer),F.command(!!s,'missing buffer for attribute "'+e+'"',t.commandStr);var l=0|a.offset;F.command(l>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var d=0|a.stride;F.command(d>=0&&d<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var m=0|a.size;F.command(!("size"in a)||m>0&&m<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var p=!!a.normalized,h=0;"type"in a&&(F.commandParameter(a.type,ue,"invalid type for attribute "+e,t.commandStr),h=ue[a.type]);var v=0|a.divisor;"divisor"in a&&(F.command(0===v||g,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),F.command(v>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),F.optional(function(){var r=t.commandStr,n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(a).forEach(function(t){F.command(n.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+n+")",r)})}),u.buffer=s,u.state=rn,u.size=m,u.normalized=p,u.type=h||s.dtype,u.offset=l,u.stride=d,u.divisor=v}}o[e]=ti(function(e,t){var r=e.attribCache;if(f in r)return r[f];var n={isStream:!1};return Object.keys(u).forEach(function(e){n[e]=u[e]}),u.buffer&&(n.buffer=e.link(u.buffer),n.type=n.type||n.buffer+".dtype"),r[f]=n,n})}),Object.keys(a).forEach(function(e){var t=a[e];o[e]=ri(t,function(r,n){var a=r.invoke(n,t),i=r.shared,o=r.constants,f=i.isBufferArgs,u=i.buffer;F.optional(function(){r.assert(n,a+"&&(typeof "+a+'==="object"||typeof '+a+'==="function")&&('+f+"("+a+")||"+u+".getBuffer("+a+")||"+u+".getBuffer("+a+".buffer)||"+f+"("+a+'.buffer)||("constant" in '+a+"&&(typeof "+a+'.constant==="number"||'+i.isArrayLike+"("+a+".constant))))",'invalid dynamic attribute "'+e+'"')});var s={isStream:n.def(!1)},c=new b;c.state=rn,Object.keys(c).forEach(function(e){s[e]=n.def(""+c[e])});var l=s.buffer,d=s.type;function m(e){n(s[e],"=",a,".",e,"|0;")}return n("if(",f,"(",a,")){",s.isStream,"=true;",l,"=",u,".createStream(",ea,",",a,");",d,"=",l,".dtype;","}else{",l,"=",u,".getBuffer(",a,");","if(",l,"){",d,"=",l,".dtype;",'}else if("constant" in ',a,"){",s.state,"=",nn,";","if(typeof "+a+'.constant === "number"){',s[en[0]],"=",a,".constant;",en.slice(1).map(function(e){return s[e]}).join("="),"=0;","}else{",en.map(function(e,t){return s[e]+"="+a+".constant.length>"+t+"?"+a+".constant["+t+"]:0;"}).join(""),"}}else{","if(",f,"(",a,".buffer)){",l,"=",u,".createStream(",ea,",",a,".buffer);","}else{",l,"=",u,".getBuffer(",a,".buffer);","}",d,'="type" in ',a,"?",o.glTypes,"[",a,".type]:",l,".dtype;",s.normalized,"=!!",a,".normalized;"),m("size"),m("offset"),m("stride"),m("divisor"),n("}}"),n.exit("if(",s.isStream,"){",u,".destroyStream(",l,");","}"),s})}),o}(t,d),T.context=function(e){var t=e.static,r=e.dynamic,n={};return Object.keys(t).forEach(function(e){var r=t[e];n[e]=ti(function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)})}),Object.keys(r).forEach(function(e){var t=r[e];n[e]=ri(t,function(e,r){return e.invoke(r,t)})}),n}(s),T}function B(e,t,r){var n=e.shared.context,a=e.scope();Object.keys(r).forEach(function(i){t.save(n,"."+i);var o=r[i];a(n,".",i,"=",o.append(e,t),";")}),t(a)}function V(e,t,r,n){var a,i=e.shared,o=i.gl,f=i.framebuffer;y&&(a=t.def(i.extensions,".webgl_draw_buffers"));var u,s=e.constants,c=s.drawBuffer,l=s.backBuffer;u=r?r.append(e,t):t.def(f,".next"),n||t("if(",u,"!==",f,".cur){"),t("if(",u,"){",o,".bindFramebuffer(",Ga,",",u,".framebuffer);"),y&&t(a,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",Ga,",null);"),y&&t(a,".drawBuffersWEBGL(",l,");"),t("}",f,".cur=",u,";"),n||t("}")}function P(e,t,r){var n=e.shared,a=n.gl,i=e.current,o=e.next,f=n.current,u=n.next,s=e.cond(f,".dirty");A.forEach(function(t){var n,c,l=S(t);if(!(l in r.state))if(l in o){n=o[l],c=i[l];var d=N(x[l].length,function(e){return s.def(n,"[",e,"]")});s(e.cond(d.map(function(e,t){return e+"!=="+c+"["+t+"]"}).join("||")).then(a,".",k[l],"(",d,");",d.map(function(e,t){return c+"["+t+"]="+e}).join(";"),";"))}else{n=s.def(u,".",l);var m=e.cond(n,"!==",f,".",l);s(m),l in _?m(e.cond(n).then(a,".enable(",_[l],");").else(a,".disable(",_[l],");"),f,".",l,"=",n,";"):m(a,".",k[l],"(",n,");",f,".",l,"=",n,";")}}),0===Object.keys(r.state).length&&s(f,".dirty=false;"),t(s)}function L(e,t,r,n){var a=e.shared,i=e.current,o=a.current,f=a.gl;Ja(Object.keys(r)).forEach(function(a){var u=r[a];if(!n||n(u)){var s=u.append(e,t);if(_[a]){var c=_[a];ei(u)?t(f,s?".enable(":".disable(",c,");"):t(e.cond(s).then(f,".enable(",c,");").else(f,".disable(",c,");")),t(o,".",a,"=",s,";")}else if(Le(s)){var l=i[a];t(f,".",k[a],"(",s,");",s.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";")}else t(f,".",k[a],"(",s,");",o,".",a,"=",s,";")}})}function I(e,t){g&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function M(e,t,r,n,a){var i,o,f,u=e.shared,s=e.stats,c=u.current,l=u.timer,d=r.profile;function m(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function h(e){e(i=t.def(),"=",m(),";"),"string"==typeof a?e(s,".count+=",a,";"):e(s,".count++;"),p&&(n?e(o=t.def(),"=",l,".getNumPendingQueries();"):e(l,".beginQuery(",s,");"))}function b(e){e(s,".cpuTime+=",m(),"-",i,";"),p&&(n?e(l,".pushScopeStats(",o,",",l,".getNumPendingQueries(),",s,");"):e(l,".endQuery();"))}function v(e){var r=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",r,";")}if(d){if(ei(d))return void(d.enable?(h(t),b(t.exit),v("true")):v("false"));v(f=d.append(e,t))}else f=t.def(c,".profile");var g=e.block();h(g),t("if(",f,"){",g,"}");var y=e.block();b(y),t.exit("if(",f,"){",y,"}")}function W(e,t,r,n,a){var i=e.shared;n.forEach(function(n){var o,f=n.name,u=r.attributes[f];if(u){if(!a(u))return;o=u.append(e,t)}else{if(!a(ni))return;var s=e.scopeAttrib(f);F.optional(function(){e.assert(t,s+".state","missing attribute "+f)}),o={},Object.keys(new b).forEach(function(e){o[e]=t.def(s,".",e)})}!function(r,n,a){var o=i.gl,f=t.def(r,".location"),u=t.def(i.attributes,"[",f,"]"),s=a.state,c=a.buffer,l=[a.x,a.y,a.z,a.w],d=["buffer","normalized","offset","stride"];function m(){t("if(!",u,".buffer){",o,".enableVertexAttribArray(",f,");}");var r,i=a.type;if(r=a.size?t.def(a.size,"||",n):n,t("if(",u,".type!==",i,"||",u,".size!==",r,"||",d.map(function(e){return u+"."+e+"!=="+a[e]}).join("||"),"){",o,".bindBuffer(",ea,",",c,".buffer);",o,".vertexAttribPointer(",[f,r,i,a.normalized,a.stride,a.offset],");",u,".type=",i,";",u,".size=",r,";",d.map(function(e){return u+"."+e+"="+a[e]+";"}).join(""),"}"),g){var s=a.divisor;t("if(",u,".divisor!==",s,"){",e.instancing,".vertexAttribDivisorANGLE(",[f,s],");",u,".divisor=",s,";}")}}function p(){t("if(",u,".buffer){",o,".disableVertexAttribArray(",f,");",u,".buffer=null;","}if(",en.map(function(e,t){return u+"."+e+"!=="+l[t]}).join("||"),"){",o,".vertexAttrib4f(",f,",",l,");",en.map(function(e,t){return u+"."+e+"="+l[t]+";"}).join(""),"}")}s===rn?m():s===nn?p():(t("if(",s,"===",rn,"){"),m(),t("}else{"),p(),t("}"))}(e.link(n),function(e){switch(e){case pa:case ga:case Aa:return 2;case ha:case ya:case _a:return 3;case ba:case xa:case ka:return 4;default:return 1}}(n.info.type),o)})}function U(e,t,n,a,i){for(var o,f=e.shared,u=f.gl,s=0;s<a.length;++s){var c,l=a[s],d=l.name,m=l.info.type,p=n.uniforms[d],h=e.link(l)+".location";if(p){if(!i(p))continue;if(ei(p)){var b=p.value;if(F.command(null!==b&&void 0!==b,'missing uniform "'+d+'"',e.commandStr),m===Ta||m===ja){F.command("function"==typeof b&&(m===Ta&&("texture2d"===b._reglType||"framebuffer"===b._reglType)||m===ja&&("textureCube"===b._reglType||"framebufferCube"===b._reglType)),"invalid texture for uniform "+d,e.commandStr);var v=e.link(b._texture||b.color[0]._texture);t(u,".uniform1i(",h,",",v+".bind());"),t.exit(v,".unbind();")}else if(m===Sa||m===Ea||m===Oa){F.optional(function(){F.command(Le(b),"invalid matrix for uniform "+d,e.commandStr),F.command(m===Sa&&4===b.length||m===Ea&&9===b.length||m===Oa&&16===b.length,"invalid length for matrix uniform "+d,e.commandStr)});var g=e.global.def("new Float32Array(["+Array.prototype.slice.call(b)+"])"),y=2;m===Ea?y=3:m===Oa&&(y=4),t(u,".uniformMatrix",y,"fv(",h,",false,",g,");")}else{switch(m){case ma:F.commandType(b,"number","uniform "+d,e.commandStr),o="1f";break;case pa:F.command(Le(b)&&2===b.length,"uniform "+d,e.commandStr),o="2f";break;case ha:F.command(Le(b)&&3===b.length,"uniform "+d,e.commandStr),o="3f";break;case ba:F.command(Le(b)&&4===b.length,"uniform "+d,e.commandStr),o="4f";break;case wa:F.commandType(b,"boolean","uniform "+d,e.commandStr),o="1i";break;case va:F.commandType(b,"number","uniform "+d,e.commandStr),o="1i";break;case Aa:case ga:F.command(Le(b)&&2===b.length,"uniform "+d,e.commandStr),o="2i";break;case _a:case ya:F.command(Le(b)&&3===b.length,"uniform "+d,e.commandStr),o="3i";break;case ka:case xa:F.command(Le(b)&&4===b.length,"uniform "+d,e.commandStr),o="4i"}t(u,".uniform",o,"(",h,",",Le(b)?Array.prototype.slice.call(b):b,");")}continue}c=p.append(e,t)}else{if(!i(ni))continue;c=t.def(f.uniforms,"[",r.id(d),"]")}m===Ta?t("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}"):m===ja&&t("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}"),F.optional(function(){function r(r,n){e.assert(t,r,'bad data or missing for uniform "'+d+'".  '+n)}function n(e){r("typeof "+c+'==="'+e+'"',"invalid type, expected "+e)}function a(t,n){r(f.isArrayLike+"("+c+")&&"+c+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function i(t){r("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(t===ra?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(m){case va:n("number");break;case ga:a(2);break;case ya:a(3);break;case xa:a(4);break;case ma:n("number");break;case pa:a(2);break;case ha:a(3);break;case ba:a(4);break;case wa:n("boolean");break;case Aa:a(2);break;case _a:a(3);break;case ka:case Sa:a(4);break;case Ea:a(9);break;case Oa:a(16);break;case Ta:i(ra);break;case ja:i(na)}});var x=1;switch(m){case Ta:case ja:var w=t.def(c,"._texture");t(u,".uniform1i(",h,",",w,".bind());"),t.exit(w,".unbind();");continue;case va:case wa:o="1i";break;case ga:case Aa:o="2i",x=2;break;case ya:case _a:o="3i",x=3;break;case xa:case ka:o="4i",x=4;break;case ma:o="1f";break;case pa:o="2f",x=2;break;case ha:o="3f",x=3;break;case ba:o="4f",x=4;break;case Sa:o="Matrix2fv";break;case Ea:o="Matrix3fv";break;case Oa:o="Matrix4fv"}if(t(u,".uniform",o,"(",h,","),"M"===o.charAt(0)){var A=Math.pow(m-Sa+2,2),_=e.global.def("new Float32Array(",A,")");t("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",N(A,function(e){return _+"["+e+"]="+c+"["+e+"]"}),",",_,")")}else t(x>1?N(x,function(e){return c+"["+e+"]"}):c);t(");")}}function G(e,t,r,n){var a=e.shared,i=a.gl,o=a.draw,f=n.draw;var u=function(){var a,u=f.elements,s=t;return u?((u.contextDep&&n.contextDynamic||u.propDep)&&(s=r),a=u.append(e,s)):a=s.def(o,".",Wn),a&&s("if("+a+")"+i+".bindBuffer("+ta+","+a+".buffer.buffer);"),a}();function s(a){var i=f[a];return i?i.contextDep&&n.contextDynamic||i.propDep?i.append(e,r):i.append(e,t):t.def(o,".",a)}var c,l,d=s(Un),m=s(Hn),p=function(){var a,i=f.count,u=t;return i?((i.contextDep&&n.contextDynamic||i.propDep)&&(u=r),a=i.append(e,u),F.optional(function(){i.MISSING&&e.assert(t,"false","missing vertex count"),i.DYNAMIC&&e.assert(u,a+">=0","missing vertex count")})):(a=u.def(o,".",Gn),F.optional(function(){e.assert(u,a+">=0","missing vertex count")})),a}();if("number"==typeof p){if(0===p)return}else r("if(",p,"){"),r.exit("}");g&&(c=s(Nn),l=e.instancing);var h=u+".type",b=f.elements&&ei(f.elements);function v(){function e(){r(l,".drawElementsInstancedANGLE(",[d,p,h,m+"<<(("+h+"-"+tn+")>>1)",c],");")}function t(){r(l,".drawArraysInstancedANGLE(",[d,m,p,c],");")}u?b?e():(r("if(",u,"){"),e(),r("}else{"),t(),r("}")):t()}function y(){function e(){r(i+".drawElements("+[d,p,h,m+"<<(("+h+"-"+tn+")>>1)"]+");")}function t(){r(i+".drawArrays("+[d,m,p]+");")}u?b?e():(r("if(",u,"){"),e(),r("}else{"),t(),r("}")):t()}g&&("number"!=typeof c||c>=0)?"string"==typeof c?(r("if(",c,">0){"),v(),r("}else if(",c,"<0){"),y(),r("}")):v():y()}function H(e,t,r,n,a){var i=C(),o=i.proc("body",a);return F.optional(function(){i.commandStr=t.commandStr,i.command=i.link(t.commandStr)}),g&&(i.instancing=o.def(i.shared.extensions,".angle_instanced_arrays")),e(i,o,r,n),i.compile().body}function q(e,t,r,n){I(e,t),r.useVAO?r.drawVAO?t(e.shared.vao,".setVAO(",r.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),W(e,t,r,n.attributes,function(){return!0})),U(e,t,r,n.uniforms,function(){return!0}),G(e,t,t,r)}function Q(e,t,r,n){function a(){return!0}e.batchId="a1",I(e,t),W(e,t,r,n.attributes,a),U(e,t,r,n.uniforms,a),G(e,t,t,r)}function Y(e,t,r,n){I(e,t);var a=r.contextDep,i=t.def(),o=t.def();e.shared.props=o,e.batchId=i;var f=e.scope(),u=e.scope();function s(e){return e.contextDep&&a||e.propDep}function c(e){return!s(e)}if(t(f.entry,"for(",i,"=0;",i,"<","a1",";++",i,"){",o,"=","a0","[",i,"];",u,"}",f.exit),r.needsContext&&B(e,u,r.context),r.needsFramebuffer&&V(e,u,r.framebuffer),L(e,u,r.state,s),r.profile&&s(r.profile)&&M(e,u,r,!1,!0),n)r.useVAO?r.drawVAO?s(r.drawVAO)?u(e.shared.vao,".setVAO(",r.drawVAO.append(e,u),");"):f(e.shared.vao,".setVAO(",r.drawVAO.append(e,f),");"):f(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(f(e.shared.vao,".setVAO(null);"),W(e,f,r,n.attributes,c),W(e,u,r,n.attributes,s)),U(e,f,r,n.uniforms,c),U(e,u,r,n.uniforms,s),G(e,f,u,r);else{var l=e.global.def("{}"),d=r.shader.progVar.append(e,u),m=u.def(d,".id"),p=u.def(l,"[",m,"]");u(e.shared.gl,".useProgram(",d,".program);","if(!",p,"){",p,"=",l,"[",m,"]=",e.link(function(t){return H(Q,e,r,t,2)}),"(",d,");}",p,".call(this,a0[",i,"],",i,");")}}function X(e,t,r){var n=t.static[r];if(n&&function(e){if("object"==typeof e&&!Le(e)){for(var t=Object.keys(e),r=0;r<t.length;++r)if(R.isDynamic(e[t[r]]))return!0;return!1}}(n)){var a=e.global,i=Object.keys(n),o=!1,f=!1,u=!1,s=e.global.def("{}");i.forEach(function(t){var r=n[t];if(R.isDynamic(r)){"function"==typeof r&&(r=n[t]=R.unbox(r));var i=ri(r,null);o=o||i.thisDep,u=u||i.propDep,f=f||i.contextDep}else{switch(a(s,".",t,"="),typeof r){case"number":a(r);break;case"string":a('"',r,'"');break;case"object":Array.isArray(r)&&a("[",r.join(),"]");break;default:a(e.link(r))}a(";")}}),t.dynamic[r]=new R.DynamicVariable(sn,{thisDep:o,contextDep:f,propDep:u,ref:s,append:function(e,t){i.forEach(function(r){var a=n[r];if(R.isDynamic(a)){var i=e.invoke(t,a);t(s,".",r,"=",i,";")}})}}),delete t.static[r]}}return{next:w,current:x,procs:function(){var e=C(),t=e.proc("poll"),r=e.proc("refresh"),i=e.block();t(i),r(i);var o,f=e.shared,u=f.gl,s=f.next,c=f.current;i(c,".dirty=false;"),V(e,t),V(e,r,null,!0),g&&(o=e.link(g)),n.oes_vertex_array_object&&r(e.link(n.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var l=0;l<a.maxAttributes;++l){var d=r.def(f.attributes,"[",l,"]"),m=e.cond(d,".buffer");m.then(u,".enableVertexAttribArray(",l,");",u,".bindBuffer(",ea,",",d,".buffer.buffer);",u,".vertexAttribPointer(",l,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(u,".disableVertexAttribArray(",l,");",u,".vertexAttrib4f(",l,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),r(m),g&&r(o,".vertexAttribDivisorANGLE(",l,",",d,".divisor);")}return r(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(_).forEach(function(n){var a=_[n],o=i.def(s,".",n),f=e.block();f("if(",o,"){",u,".enable(",a,")}else{",u,".disable(",a,")}",c,".",n,"=",o,";"),r(f),t("if(",o,"!==",c,".",n,"){",f,"}")}),Object.keys(k).forEach(function(n){var a,o,f=k[n],l=x[n],d=e.block();if(d(u,".",f,"("),Le(l)){var m=l.length;a=e.global.def(s,".",n),o=e.global.def(c,".",n),d(N(m,function(e){return a+"["+e+"]"}),");",N(m,function(e){return o+"["+e+"]="+a+"["+e+"];"}).join("")),t("if(",N(m,function(e){return a+"["+e+"]!=="+o+"["+e+"]"}).join("||"),"){",d,"}")}else a=i.def(s,".",n),o=i.def(c,".",n),d(a,");",c,".",n,"=",a,";"),t("if(",a,"!==",o,"){",d,"}");r(d)}),e.compile()}(),compile:function(e,t,n,a,i){var o=C();o.stats=o.link(i),Object.keys(t.static).forEach(function(e){X(o,t,e)}),Zn.forEach(function(t){X(o,e,t)});var f=z(e,t,n,a,o);return function(e,t){var r=e.proc("draw",1);I(e,r),B(e,r,t.context),V(e,r,t.framebuffer),P(e,r,t),L(e,r,t.state),M(e,r,t,!1,!0);var n=t.shader.progVar.append(e,r);if(r(e.shared.gl,".useProgram(",n,".program);"),t.shader.program)q(e,r,t,t.shader.program);else{r(e.shared.vao,".setVAO(null);");var a=e.global.def("{}"),i=r.def(n,".id"),o=r.def(a,"[",i,"]");r(e.cond(o).then(o,".call(this,a0);").else(o,"=",a,"[",i,"]=",e.link(function(r){return H(q,e,t,r,1)}),"(",n,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}(o,f),function(e,t){var n=e.proc("scope",3);e.batchId="a2";var a=e.shared,i=a.current;function o(r){var i=t.shader[r];i&&n.set(a.shader,"."+r,i.append(e,n))}B(e,n,t.context),t.framebuffer&&t.framebuffer.append(e,n),Ja(Object.keys(t.state)).forEach(function(r){var i=t.state[r].append(e,n);Le(i)?i.forEach(function(t,a){n.set(e.next[r],"["+a+"]",t)}):n.set(a.next,"."+r,i)}),M(e,n,t,!0,!0),[Wn,Hn,Gn,Nn,Un].forEach(function(r){var i=t.draw[r];i&&n.set(a.draw,"."+r,""+i.append(e,n))}),Object.keys(t.uniforms).forEach(function(i){n.set(a.uniforms,"["+r.id(i)+"]",t.uniforms[i].append(e,n))}),Object.keys(t.attributes).forEach(function(r){var a=t.attributes[r].append(e,n),i=e.scopeAttrib(r);Object.keys(new b).forEach(function(e){n.set(i,"."+e,a[e])})}),t.scopeVAO&&n.set(a.vao,".targetVAO",t.scopeVAO.append(e,n)),o(Rn),o(Mn),Object.keys(t.state).length>0&&(n(i,".dirty=true;"),n.exit(i,".dirty=true;")),n("a1(",e.shared.context,",a0,",e.batchId,");")}(o,f),function(e,t){var r=e.proc("batch",2);e.batchId="0",I(e,r);var n=!1,a=!0;Object.keys(t.context).forEach(function(e){n=n||t.context[e].propDep}),n||(B(e,r,t.context),a=!1);var i=t.framebuffer,o=!1;function f(e){return e.contextDep&&n||e.propDep}i?(i.propDep?n=o=!0:i.contextDep&&n&&(o=!0),o||V(e,r,i)):V(e,r,null),t.state.viewport&&t.state.viewport.propDep&&(n=!0),P(e,r,t),L(e,r,t.state,function(e){return!f(e)}),t.profile&&f(t.profile)||M(e,r,t,!1,"a1"),t.contextDep=n,t.needsContext=a,t.needsFramebuffer=o;var u=t.shader.progVar;if(u.contextDep&&n||u.propDep)Y(e,r,t,null);else{var s=u.append(e,r);if(r(e.shared.gl,".useProgram(",s,".program);"),t.shader.program)Y(e,r,t,t.shader.program);else{r(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),l=r.def(s,".id"),d=r.def(c,"[",l,"]");r(e.cond(d).then(d,".call(this,a0,a1);").else(d,"=",c,"[",l,"]=",e.link(function(r){return H(Y,e,t,r,2)}),"(",s,");",d,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}(o,f),o.compile()}}}var ii=34918,oi=34919,fi=35007,ui=function(e,t){if(!t.ext_disjoint_timer_query)return null;var r=[];function n(e){r.push(e)}var a=[];var i=[];function o(e){i.push(e)}var f=[];function u(e,t,r){var n=i.pop()||new function(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null};n.startQueryIndex=e,n.endQueryIndex=t,n.sum=0,n.stats=r,f.push(n)}var s=[],c=[];return{beginQuery:function(e){var n=r.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(fi,n),a.push(n),u(a.length-1,a.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(fi)},pushScopeStats:u,update:function(){var e,r,i=a.length;if(0!==i){c.length=Math.max(c.length,i+1),s.length=Math.max(s.length,i+1),s[0]=0,c[0]=0;var u=0;for(e=0,r=0;r<a.length;++r){var l=a[r];t.ext_disjoint_timer_query.getQueryObjectEXT(l,oi)?(u+=t.ext_disjoint_timer_query.getQueryObjectEXT(l,ii),n(l)):a[e++]=l,s[r+1]=u,c[r+1]=e}for(a.length=e,e=0,r=0;r<f.length;++r){var d=f[r],m=d.startQueryIndex,p=d.endQueryIndex;d.sum+=s[p]-s[m];var h=c[m],b=c[p];b===h?(d.stats.gpuTime+=d.sum/1e6,o(d)):(d.startQueryIndex=h,d.endQueryIndex=b,f[e++]=d)}f.length=e}},getNumPendingQueries:function(){return a.length},clear:function(){r.push.apply(r,a);for(var e=0;e<r.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(r[e]);a.length=0,r.length=0},restore:function(){a.length=0,r.length=0}}},si=16384,ci=256,li=1024,di=34962,mi="webglcontextlost",pi="webglcontextrestored",hi=1,bi=2,vi=3;function gi(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}return function(r){var n=H(r);if(!n)return null;var a=n.gl,i=a.getContextAttributes(),o=a.isContextLost(),f=function(e,t){var r={};function n(t){F.type(t,"string","extension name must be string");var n,a=t.toLowerCase();try{n=r[a]=e.getExtension(a)}catch(e){}return!!n}for(var a=0;a<t.extensions.length;++a){var i=t.extensions[a];if(!n(i))return t.onDestroy(),t.onDone('"'+i+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(n),{extensions:r,restore:function(){Object.keys(r).forEach(function(e){if(r[e]&&!n(e))throw new Error("(regl): error restoring extension "+e)})}}}(a,n);if(!f)return null;var u,s,c=(u={"":0},s=[""],{id:function(e){var t=u[e];return t||(t=u[e]=s.length,s.push(e),t)},str:function(e){return s[e]}}),l={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},d=f.extensions,m=ui(a,d),p=W(),h=a.drawingBufferWidth,b=a.drawingBufferHeight,v={tick:0,time:0,viewportWidth:h,viewportHeight:b,framebufferWidth:h,framebufferHeight:b,drawingBufferWidth:h,drawingBufferHeight:b,pixelRatio:n.pixelRatio},g=re(a,d),y=function(t,r,n,a){var i=0,o={};function f(e){this.id=i++,this.buffer=t.createBuffer(),this.type=e,this.usage=de,this.byteLength=0,this.dimension=1,this.dtype=pe,this.persistentData=null,n.profile&&(this.stats={size:0})}f.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},f.prototype.destroy=function(){l(this)};var u=[];function s(e,r,n){e.byteLength=r.byteLength,t.bufferData(e.type,r,n)}function c(t,r,n,a,i,o){var f,u;if(t.usage=n,Array.isArray(r)){if(t.dtype=a||he,r.length>0)if(Array.isArray(r[0])){f=le(r);for(var c=1,l=1;l<f.length;++l)c*=f[l];t.dimension=c,s(t,u=ce(r,f,t.dtype),n),o?t.persistentData=u:te.freeType(u)}else if("number"==typeof r[0]){t.dimension=i;var d=te.allocType(t.dtype,r.length);ge(d,r),s(t,d,n),o?t.persistentData=d:te.freeType(d)}else e(r[0])?(t.dimension=r[0].length,t.dtype=a||ve(r[0])||he,s(t,u=ce(r,[r.length,r[0].length],t.dtype),n),o?t.persistentData=u:te.freeType(u)):F.raise("invalid buffer data")}else if(e(r))t.dtype=a||ve(r),t.dimension=i,s(t,r,n),o&&(t.persistentData=new Uint8Array(new Uint8Array(r.buffer)));else if(ne(r)){f=r.shape;var m=r.stride,p=r.offset,h=0,b=0,v=0,g=0;1===f.length?(h=f[0],b=1,v=m[0],g=0):2===f.length?(h=f[0],b=f[1],v=m[0],g=m[1]):F.raise("invalid shape"),t.dtype=a||ve(r.data)||he,t.dimension=b;var y=te.allocType(t.dtype,h*b);ye(y,r.data,h,b,v,g,p),s(t,y,n),o?t.persistentData=y:te.freeType(y)}else r instanceof ArrayBuffer?(t.dtype=pe,t.dimension=i,s(t,r,n),o&&(t.persistentData=new Uint8Array(new Uint8Array(r)))):F.raise("invalid buffer data")}function l(e){r.bufferCount--,a(e);var n=e.buffer;F(n,"buffer must not be deleted already"),t.deleteBuffer(n),e.buffer=null,delete o[e.id]}return n.profile&&(r.getTotalBufferSize=function(){var e=0;return Object.keys(o).forEach(function(t){e+=o[t].stats.size}),e}),{create:function(a,i,u,s){r.bufferCount++;var d=new f(i);function m(r){var a=de,i=null,o=0,f=0,u=1;return Array.isArray(r)||e(r)||ne(r)||r instanceof ArrayBuffer?i=r:"number"==typeof r?o=0|r:r&&(F.type(r,"object","buffer arguments must be an object, a number or an array"),"data"in r&&(F(null===i||Array.isArray(i)||e(i)||ne(i),"invalid data for buffer"),i=r.data),"usage"in r&&(F.parameter(r.usage,se,"invalid buffer usage"),a=se[r.usage]),"type"in r&&(F.parameter(r.type,ue,"invalid buffer type"),f=ue[r.type]),"dimension"in r&&(F.type(r.dimension,"number","invalid dimension"),u=0|r.dimension),"length"in r&&(F.nni(o,"buffer length must be a nonnegative integer"),o=0|r.length)),d.bind(),i?c(d,i,a,f,u,s):(o&&t.bufferData(d.type,o,a),d.dtype=f||pe,d.usage=a,d.dimension=u,d.byteLength=o),n.profile&&(d.stats.size=d.byteLength*be[d.dtype]),m}function p(e,r){F(r+e.byteLength<=d.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+r+" to a buffer of size "+d.byteLength),t.bufferSubData(d.type,r,e)}return o[d.id]=d,u||m(a),m._reglType="buffer",m._buffer=d,m.subdata=function(t,r){var n,a=0|(r||0);if(d.bind(),e(t)||t instanceof ArrayBuffer)p(t,a);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var i=te.allocType(d.dtype,t.length);ge(i,t),p(i,a),te.freeType(i)}else if(Array.isArray(t[0])||e(t[0])){n=le(t);var o=ce(t,n,d.dtype);p(o,a),te.freeType(o)}else F.raise("invalid buffer data")}else if(ne(t)){n=t.shape;var f=t.stride,u=0,s=0,c=0,l=0;1===n.length?(u=n[0],s=1,c=f[0],l=0):2===n.length?(u=n[0],s=n[1],c=f[0],l=f[1]):F.raise("invalid shape");var h=Array.isArray(t.data)?d.dtype:ve(t.data),b=te.allocType(h,u*s);ye(b,t.data,u,s,c,l,t.offset),p(b,a),te.freeType(b)}else F.raise("invalid data for buffer subdata");return m},n.profile&&(m.stats=d.stats),m.destroy=function(){l(d)},m},createStream:function(e,t){var r=u.pop();return r||(r=new f(e)),r.bind(),c(r,t,me,0,1,!1),r},destroyStream:function(e){u.push(e)},clear:function(){ae(o).forEach(l),u.forEach(l)},getBuffer:function(e){return e&&e._buffer instanceof f?e._buffer:null},restore:function(){ae(o).forEach(function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:c}}(a,l,n,function(e){return x.destroyBuffer(e)}),x=function(t,r,n,a,i){for(var o=n.maxAttributes,f=new Array(o),u=0;u<o;++u)f[u]=new Wr;var s=0,c={},l={Record:Wr,scope:{},state:f,currentVAO:null,targetVAO:null,restore:d()?function(){d()&&ae(c).forEach(function(e){e.refresh()})}:function(){},createVAO:function(t){var n=new p;function f(t){F(Array.isArray(t),"arguments to vertex array constructor must be an array"),F(t.length<o,"too many attributes"),F(t.length>0,"must specify at least one attribute");for(var a=0;a<n.buffers.length;++a)n.buffers[a].destroy();n.buffers.length=0;var u=n.attributes;u.length=t.length;for(var s=0;s<t.length;++s){var c=t[s],l=u[s]=new Wr;if(Array.isArray(c)||e(c)||ne(c)){var d=i.create(c,Mr,!1,!0);l.buffer=i.getBuffer(d),l.size=0|l.buffer.dimension,l.normalized=!1,l.type=l.buffer.dtype,l.offset=0,l.stride=0,l.divisor=0,l.state=1,n.buffers.push(d)}else i.getBuffer(c)?(l.buffer=i.getBuffer(c),l.size=0|l.buffer.dimension,l.normalized=!1,l.type=l.buffer.dtype,l.offset=0,l.stride=0,l.divisor=0,l.state=1):i.getBuffer(c.buffer)?(l.buffer=i.getBuffer(c.buffer),l.size=0|(+c.size||l.buffer.dimension),l.normalized=!!c.normalized||!1,"type"in c?(F.parameter(c.type,ue,"invalid buffer type"),l.type=ue[c.type]):l.type=l.buffer.dtype,l.offset=0|(c.offset||0),l.stride=0|(c.stride||0),l.divisor=0|(c.divisor||0),l.state=1,F(l.size>=1&&l.size<=4,"size must be between 1 and 4"),F(l.offset>=0,"invalid offset"),F(l.stride>=0&&l.stride<=255,"stride must be between 0 and 255"),F(l.divisor>=0,"divisor must be positive"),F(!l.divisor||!!r.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in c?(F(s>0,"first attribute must not be a constant"),l.x=+c.x||0,l.y=+c.y||0,l.z=+c.z||0,l.w=+c.w||0,l.state=2):F(!1,"invalid attribute spec for location "+s)}return n.refresh(),f}return a.vaoCount+=1,f.destroy=function(){n.destroy()},f._vao=n,f._reglType="vao",f(t)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var r=0;r<f.length;++r){var n=f[r];n.buffer===e&&(t.disableVertexAttribArray(r),n.buffer=null)}},setVAO:d()?function(e){if(e!==l.currentVAO){var t=d();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),l.currentVAO=e}}:function(e){if(e!==l.currentVAO){if(e)e.bindAttrs();else{var r=m();for(let e=0;e<f.length;++e){var n=f[e];n.buffer?(t.enableVertexAttribArray(e),t.vertexAttribPointer(e,n.size,n.type,n.normalized,n.stride,n.offfset),r&&r.vertexAttribDivisorANGLE(e,n.divisor)):(t.disableVertexAttribArray(e),t.vertexAttrib4f(e,n.x,n.y,n.z,n.w))}}l.currentVAO=e}},clear:d()?function(e){ae(c).forEach(e=>{e.destroy()})}:function(){}};function d(){return r.oes_vertex_array_object}function m(){return r.angle_instanced_arrays}function p(){this.id=++s,this.attributes=[];var e=d();this.vao=e?e.createVertexArrayOES():null,c[this.id]=this,this.buffers=[]}return p.prototype.bindAttrs=function(){for(var e=m(),r=this.attributes,n=0;n<r.length;++n){var a=r[n];a.buffer?(t.enableVertexAttribArray(n),t.bindBuffer(Mr,a.buffer.buffer),t.vertexAttribPointer(n,a.size,a.type,a.normalized,a.stride,a.offset),e&&e.vertexAttribDivisorANGLE(n,a.divisor)):(t.disableVertexAttribArray(n),t.vertexAttrib4f(n,a.x,a.y,a.z,a.w))}for(var i=r.length;i<o;++i)t.disableVertexAttribArray(i)},p.prototype.refresh=function(){var e=d();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),l.currentVAO=this)},p.prototype.destroy=function(){if(this.vao){var e=d();this===l.currentVAO&&(l.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}c[this.id]&&(delete c[this.id],a.vaoCount-=1)},l}(a,d,g,l,y),w=function(t,r,n,a){var i={},o=0,f={uint8:Se,uint16:Oe};function u(e){this.id=o++,i[this.id]=this,this.buffer=e,this.primType=_e,this.vertCount=0,this.type=0}r.oes_element_index_uint&&(f.uint32=je),u.prototype.bind=function(){this.buffer.bind()};var s=[];function c(a,i,o,f,u,s,c){var l;if(a.buffer.bind(),i){var d=c;c||e(i)&&(!ne(i)||e(i.data))||(d=r.oes_element_index_uint?je:Oe),n._initBuffer(a.buffer,i,o,d,3)}else t.bufferData(De,s,o),a.buffer.dtype=l||Se,a.buffer.usage=o,a.buffer.dimension=3,a.buffer.byteLength=s;if(l=c,!c){switch(a.buffer.dtype){case Se:case ke:l=Se;break;case Oe:case Ee:l=Oe;break;case je:case Te:l=je;break;default:F.raise("unsupported type for element array")}a.buffer.dtype=l}a.type=l,F(l!==je||!!r.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var m=u;m<0&&(m=a.buffer.byteLength,l===Oe?m>>=1:l===je&&(m>>=2)),a.vertCount=m;var p=f;if(f<0){p=_e;var h=a.buffer.dimension;1===h&&(p=we),2===h&&(p=Ae),3===h&&(p=_e)}a.primType=p}function l(e){a.elementsCount--,F(null!==e.buffer,"must not double destroy elements"),delete i[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,r){var i=n.create(null,De,!0),o=new u(i._buffer);function s(t){if(t)if("number"==typeof t)i(t),o.primType=_e,o.vertCount=0|t,o.type=Se;else{var r=null,n=ze,a=-1,u=-1,l=0,d=0;Array.isArray(t)||e(t)||ne(t)?r=t:(F.type(t,"object","invalid arguments for elements"),"data"in t&&(r=t.data,F(Array.isArray(r)||e(r)||ne(r),"invalid data for element buffer")),"usage"in t&&(F.parameter(t.usage,se,"invalid element buffer usage"),n=se[t.usage]),"primitive"in t&&(F.parameter(t.primitive,xe,"invalid element buffer primitive"),a=xe[t.primitive]),"count"in t&&(F("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(F.parameter(t.type,f,"invalid buffer type"),d=f[t.type]),"length"in t?l=0|t.length:(l=u,d===Oe||d===Ee?l*=2:d!==je&&d!==Te||(l*=4))),c(o,r,n,a,u,l,d)}else i(),o.primType=_e,o.vertCount=0,o.type=Se;return s}return a.elementsCount++,s(t),s._reglType="elements",s._elements=o,s.subdata=function(e,t){return i.subdata(e,t),s},s.destroy=function(){l(o)},s},createStream:function(e){var t=s.pop();return t||(t=new u(n.create(null,De,!0,!1)._buffer)),c(t,e,Ce,-1,-1,0,0),t},destroyStream:function(e){s.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){ae(i).forEach(l)}}}(a,d,y,l),A=qr(a,c,l,n),_=hr(a,d,g,function(){E.procs.poll()},v,l,n),k=xr(a,d,g,l,n),S=function(e,r,n,a,i,o){var f={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],s=["rgba4","rgb565","rgb5 a1"];r.ext_srgb&&s.push("srgba"),r.ext_color_buffer_half_float&&s.push("rgba16f","rgb16f"),r.webgl_color_buffer_float&&s.push("rgba32f");var c=["uint8"];function l(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=0,a=0;t?(n=t.width,a=t.height):r&&(n=r.width,a=r.height),this.width=n,this.height=a}function d(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function m(e,t,r){if(e)if(e.texture){var n=e.texture._texture,a=Math.max(1,n.width),i=Math.max(1,n.height);F(a===t&&i===r,"inconsistent width/height for supplied texture"),n.refCount+=1}else{var o=e.renderbuffer._renderbuffer;F(o.width===t&&o.height===r,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function p(t,r){r&&(r.texture?e.framebufferTexture2D(wr,t,r.target,r.texture._texture.texture,0):e.framebufferRenderbuffer(wr,t,Ar,r.renderbuffer._renderbuffer.renderbuffer))}function h(e){var t=_r,r=null,n=null,a=e;"object"==typeof e&&(a=e.data,"target"in e&&(t=0|e.target)),F.type(a,"function","invalid attachment data");var i=a._reglType;return"texture2d"===i?(r=a,F(t===_r)):"textureCube"===i?(r=a,F(t>=kr&&t<kr+6,"invalid cube map target")):"renderbuffer"===i?(n=a,t=Ar):F.raise("invalid regl object for attachment"),new l(t,r,n)}function b(e,t,r,n,o){if(r){var f=a.create2D({width:e,height:t,format:n,type:o});return f._texture.refCount=0,new l(_r,f,null)}var u=i.create({width:e,height:t,format:n});return u._renderbuffer.refCount=0,new l(Ar,null,u)}function v(e){return e&&(e.texture||e.renderbuffer)}function g(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r),e.width=t,e.height=r)}r.oes_texture_half_float&&c.push("half float","float16"),r.oes_texture_float&&c.push("float","float32");var y=0,x={};function w(){this.id=y++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function A(e){e.colorAttachments.forEach(d),d(e.depthAttachment),d(e.stencilAttachment),d(e.depthStencilAttachment)}function _(t){var r=t.framebuffer;F(r,"must not double destroy framebuffer"),e.deleteFramebuffer(r),t.framebuffer=null,o.framebufferCount--,delete x[t.id]}function k(t){var r;e.bindFramebuffer(wr,t.framebuffer);var a=t.colorAttachments;for(r=0;r<a.length;++r)p(Sr+r,a[r]);for(r=a.length;r<n.maxColorAttachments;++r)e.framebufferTexture2D(wr,Sr+r,_r,null,0);e.framebufferTexture2D(wr,Tr,_r,null,0),e.framebufferTexture2D(wr,Er,_r,null,0),e.framebufferTexture2D(wr,Or,_r,null,0),p(Er,t.depthAttachment),p(Or,t.stencilAttachment),p(Tr,t.depthStencilAttachment);var i=e.checkFramebufferStatus(wr);e.isContextLost()||i===jr||F.raise("framebuffer configuration not supported, status = "+Ir[i]),e.bindFramebuffer(wr,f.next?f.next.framebuffer:null),f.cur=f.next,e.getError()}function S(e,a){var i=new w;function l(e,t){var a;F(f.next!==i,"can not update framebuffer which is currently in use");var o=0,d=0,p=!0,g=!0,y=null,x=!0,w="rgba",_="uint8",S=1,E=null,O=null,T=null,j=!1;if("number"==typeof e)o=0|e,d=0|t||o;else if(e){F.type(e,"object","invalid arguments for framebuffer");var D=e;if("shape"in D){var C=D.shape;F(Array.isArray(C)&&C.length>=2,"invalid shape for framebuffer"),o=C[0],d=C[1]}else"radius"in D&&(o=d=D.radius),"width"in D&&(o=D.width),"height"in D&&(d=D.height);("color"in D||"colors"in D)&&(y=D.color||D.colors,Array.isArray(y)&&F(1===y.length||r.webgl_draw_buffers,"multiple render targets not supported")),y||("colorCount"in D&&(S=0|D.colorCount,F(S>0,"invalid color buffer count")),"colorTexture"in D&&(x=!!D.colorTexture,w="rgba4"),"colorType"in D&&(_=D.colorType,x?(F(r.oes_texture_float||!("float"===_||"float32"===_),"you must enable OES_texture_float in order to use floating point framebuffer objects"),F(r.oes_texture_half_float||!("half float"===_||"float16"===_),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===_||"float16"===_?(F(r.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),w="rgba16f"):"float"!==_&&"float32"!==_||(F(r.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),w="rgba32f"),F.oneOf(_,c,"invalid color type")),"colorFormat"in D&&(w=D.colorFormat,u.indexOf(w)>=0?x=!0:s.indexOf(w)>=0?x=!1:x?F.oneOf(D.colorFormat,u,"invalid color format for texture"):F.oneOf(D.colorFormat,s,"invalid color format for renderbuffer"))),("depthTexture"in D||"depthStencilTexture"in D)&&(j=!(!D.depthTexture&&!D.depthStencilTexture),F(!j||r.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in D&&("boolean"==typeof D.depth?p=D.depth:(E=D.depth,g=!1)),"stencil"in D&&("boolean"==typeof D.stencil?g=D.stencil:(O=D.stencil,p=!1)),"depthStencil"in D&&("boolean"==typeof D.depthStencil?p=g=D.depthStencil:(T=D.depthStencil,p=!1,g=!1))}else o=d=1;var z=null,B=null,V=null,P=null;if(Array.isArray(y))z=y.map(h);else if(y)z=[h(y)];else for(z=new Array(S),a=0;a<S;++a)z[a]=b(o,d,x,w,_);F(r.webgl_draw_buffers||z.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),F(z.length<=n.maxColorAttachments,"too many color attachments, not supported"),o=o||z[0].width,d=d||z[0].height,E?B=h(E):p&&!g&&(B=b(o,d,j,"depth","uint32")),O?V=h(O):g&&!p&&(V=b(o,d,!1,"stencil","uint8")),T?P=h(T):!E&&!O&&g&&p&&(P=b(o,d,j,"depth stencil","depth stencil")),F(!!E+!!O+!!T<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var L=null;for(a=0;a<z.length;++a)if(m(z[a],o,d),F(!z[a]||z[a].texture&&Cr.indexOf(z[a].texture._texture.format)>=0||z[a].renderbuffer&&Lr.indexOf(z[a].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+a+" is invalid"),z[a]&&z[a].texture){var I=zr[z[a].texture._texture.format]*Fr[z[a].texture._texture.type];null===L?L=I:F(L===I,"all color attachments much have the same number of bits per pixel.")}return m(B,o,d),F(!B||B.texture&&B.texture._texture.format===Dr||B.renderbuffer&&B.renderbuffer._renderbuffer.format===Br,"invalid depth attachment for framebuffer object"),m(V,o,d),F(!V||V.renderbuffer&&V.renderbuffer._renderbuffer.format===Vr,"invalid stencil attachment for framebuffer object"),m(P,o,d),F(!P||P.texture&&P.texture._texture.format===Pr||P.renderbuffer&&P.renderbuffer._renderbuffer.format===Pr,"invalid depth-stencil attachment for framebuffer object"),A(i),i.width=o,i.height=d,i.colorAttachments=z,i.depthAttachment=B,i.stencilAttachment=V,i.depthStencilAttachment=P,l.color=z.map(v),l.depth=v(B),l.stencil=v(V),l.depthStencil=v(P),l.width=i.width,l.height=i.height,k(i),l}return o.framebufferCount++,l(e,a),t(l,{resize:function(e,t){F(f.next!==i,"can not resize a framebuffer which is currently in use");var r=Math.max(0|e,1),n=Math.max(0|t||r,1);if(r===i.width&&n===i.height)return l;for(var a=i.colorAttachments,o=0;o<a.length;++o)g(a[o],r,n);return g(i.depthAttachment,r,n),g(i.stencilAttachment,r,n),g(i.depthStencilAttachment,r,n),i.width=l.width=r,i.height=l.height=n,k(i),l},_reglType:"framebuffer",_framebuffer:i,destroy:function(){_(i),A(i)},use:function(e){f.setFBO({framebuffer:l},e)}})}return t(f,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof w)return t}return null},create:S,createCube:function(e){var i=Array(6);function o(e){var n;F(i.indexOf(f.next)<0,"can not update framebuffer which is currently in use");var s,l={color:null},d=0,m=null,p="rgba",h="uint8",b=1;if("number"==typeof e)d=0|e;else if(e){F.type(e,"object","invalid arguments for framebuffer");var v=e;if("shape"in v){var g=v.shape;F(Array.isArray(g)&&g.length>=2,"invalid shape for framebuffer"),F(g[0]===g[1],"cube framebuffer must be square"),d=g[0]}else"radius"in v&&(d=0|v.radius),"width"in v?(d=0|v.width,"height"in v&&F(v.height===d,"must be square")):"height"in v&&(d=0|v.height);("color"in v||"colors"in v)&&(m=v.color||v.colors,Array.isArray(m)&&F(1===m.length||r.webgl_draw_buffers,"multiple render targets not supported")),m||("colorCount"in v&&(b=0|v.colorCount,F(b>0,"invalid color buffer count")),"colorType"in v&&(F.oneOf(v.colorType,c,"invalid color type"),h=v.colorType),"colorFormat"in v&&(p=v.colorFormat,F.oneOf(v.colorFormat,u,"invalid color format for texture"))),"depth"in v&&(l.depth=v.depth),"stencil"in v&&(l.stencil=v.stencil),"depthStencil"in v&&(l.depthStencil=v.depthStencil)}else d=1;if(m)if(Array.isArray(m))for(s=[],n=0;n<m.length;++n)s[n]=m[n];else s=[m];else{s=Array(b);var y={radius:d,format:p,type:h};for(n=0;n<b;++n)s[n]=a.createCube(y)}for(l.color=Array(s.length),n=0;n<s.length;++n){var x=s[n];F("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),d=d||x.width,F(x.width===d&&x.height===d,"invalid cube map shape"),l.color[n]={target:kr,data:s[n]}}for(n=0;n<6;++n){for(var w=0;w<s.length;++w)l.color[w].target=kr+n;n>0&&(l.depth=i[0].depth,l.stencil=i[0].stencil,l.depthStencil=i[0].depthStencil),i[n]?i[n](l):i[n]=S(l)}return t(o,{width:d,height:d,color:s})}return o(e),t(o,{faces:i,resize:function(e){var t,r=0|e;if(F(r>0&&r<=n.maxCubeMapSize,"invalid radius for cube fbo"),r===o.width)return o;var a=o.color;for(t=0;t<a.length;++t)a[t].resize(r);for(t=0;t<6;++t)i[t].resize(r);return o.width=o.height=r,o},_reglType:"framebufferCube",destroy:function(){i.forEach(function(e){e.destroy()})}})},clear:function(){ae(x).forEach(_)},restore:function(){f.cur=null,f.next=null,f.dirty=!0,ae(x).forEach(function(t){t.framebuffer=e.createFramebuffer(),k(t)})}})}(a,d,g,_,k,l),E=ai(a,c,d,g,y,w,0,S,{},x,A,{elements:null,primitive:4,count:-1,offset:0,instances:-1},v,m,n),O=Kr(a,S,E.procs.poll,v,i,d,g),T=E.next,j=a.canvas,D=[],C=[],z=[],B=[n.onDestroy],V=null;function P(){if(0===D.length)return m&&m.update(),void(V=null);V=M.next(P),$();for(var e=D.length-1;e>=0;--e){var t=D[e];t&&t(v,null,0)}a.flush(),m&&m.update()}function L(){!V&&D.length>0&&(V=M.next(P))}function I(){V&&(M.cancel(P),V=null)}function U(e){e.preventDefault(),o=!0,I(),C.forEach(function(e){e()})}function G(e){a.getError(),o=!1,f.restore(),A.restore(),y.restore(),_.restore(),k.restore(),S.restore(),x.restore(),m&&m.restore(),E.procs.refresh(),L(),z.forEach(function(e){e()})}function N(e){function r(e){var t={},r={};return Object.keys(e).forEach(function(n){var a=e[n];R.isDynamic(a)?r[n]=R.unbox(a,n):t[n]=a}),{dynamic:r,static:t}}F(!!e,"invalid args to regl({...})"),F.type(e,"object","invalid args to regl({...})");var n=r(e.context||{}),a=r(e.uniforms||{}),i=r(e.attributes||{}),f=r(function(e){var r=t({},e);function n(e){if(e in r){var t=r[e];delete r[e],Object.keys(t).forEach(function(n){r[e+"."+n]=t[n]})}}return delete r.uniforms,delete r.attributes,delete r.context,delete r.vao,"stencil"in r&&r.stencil.op&&(r.stencil.opBack=r.stencil.opFront=r.stencil.op,delete r.stencil.op),n("blend"),n("depth"),n("cull"),n("stencil"),n("polygonOffset"),n("scissor"),n("sample"),"vao"in e&&(r.vao=e.vao),r}(e)),u={gpuTime:0,cpuTime:0,count:0},s=E.compile(f,i,a,n,u),c=s.draw,l=s.batch,d=s.scope,m=[];return t(function(e,t){var r;if(o&&F.raise("context lost"),"function"==typeof e)return d.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(r=0;r<e;++r)d.call(this,null,t,r);else{if(!Array.isArray(e))return d.call(this,e,t,0);for(r=0;r<e.length;++r)d.call(this,e[r],t,r)}else if("number"==typeof e){if(e>0)return l.call(this,function(e){for(;m.length<e;)m.push(null);return m}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return l.call(this,e,e.length)}},{stats:u})}j&&(j.addEventListener(mi,U,!1),j.addEventListener(pi,G,!1));var q=S.setFBO=N({framebuffer:R.define.call(null,hi,"framebuffer")});function Q(e,t){var r=0;E.procs.poll();var n=t.color;n&&(a.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),r|=si),"depth"in t&&(a.clearDepth(+t.depth),r|=ci),"stencil"in t&&(a.clearStencil(0|t.stencil),r|=li),F(!!r,"called regl.clear with no buffer specified"),a.clear(r)}function Y(e){return F.type(e,"function","regl.frame() callback must be a function"),D.push(e),L(),{cancel:function(){var t=gi(D,e);F(t>=0,"cannot cancel a frame twice"),D[t]=function e(){var t=gi(D,e);D[t]=D[D.length-1],D.length-=1,D.length<=0&&I()}}}}function X(){var e=T.viewport,t=T.scissor_box;e[0]=e[1]=t[0]=t[1]=0,v.viewportWidth=v.framebufferWidth=v.drawingBufferWidth=e[2]=t[2]=a.drawingBufferWidth,v.viewportHeight=v.framebufferHeight=v.drawingBufferHeight=e[3]=t[3]=a.drawingBufferHeight}function $(){v.tick+=1,v.time=J(),X(),E.procs.poll()}function K(){X(),E.procs.refresh(),m&&m.update()}function J(){return(W()-p)/1e3}K();var Z=t(N,{clear:function(e){if(F("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var r=0;r<6;++r)q(t({framebuffer:e.framebuffer.faces[r]},e),Q);else q(e,Q);else Q(0,e)},prop:R.define.bind(null,hi),context:R.define.bind(null,bi),this:R.define.bind(null,vi),draw:N({}),buffer:function(e){return y.create(e,di,!1,!1)},elements:function(e){return w.create(e,!1)},texture:_.create2D,cube:_.createCube,renderbuffer:k.create,framebuffer:S.create,framebufferCube:S.createCube,vao:x.createVAO,attributes:i,frame:Y,on:function(e,t){var r;switch(F.type(t,"function","listener callback must be a function"),e){case"frame":return Y(t);case"lost":r=C;break;case"restore":r=z;break;case"destroy":r=B;break;default:F.raise("invalid event, must be one of frame,lost,restore,destroy")}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t)return r[e]=r[r.length-1],void r.pop()}}},limits:g,hasExtension:function(e){return g.extensions.indexOf(e.toLowerCase())>=0},read:O,destroy:function(){D.length=0,I(),j&&(j.removeEventListener(mi,U),j.removeEventListener(pi,G)),A.clear(),S.clear(),k.clear(),_.clear(),w.clear(),y.clear(),x.clear(),m&&m.clear(),B.forEach(function(e){e()})},_gl:a,_refresh:K,poll:function(){$(),m&&m.update()},now:J,stats:l});return n.onDone(null,Z),Z}});

},{}],323:[function(require,module,exports){
var alea=require("./lib/alea"),xor128=require("./lib/xor128"),xorwow=require("./lib/xorwow"),xorshift7=require("./lib/xorshift7"),xor4096=require("./lib/xor4096"),tychei=require("./lib/tychei"),sr=require("./seedrandom");sr.alea=alea,sr.xor128=xor128,sr.xorwow=xorwow,sr.xorshift7=xorshift7,sr.xor4096=xor4096,sr.tychei=tychei,module.exports=sr;

},{"./lib/alea":324,"./lib/tychei":325,"./lib/xor128":326,"./lib/xor4096":327,"./lib/xorshift7":328,"./lib/xorwow":329,"./seedrandom":330}],324:[function(require,module,exports){
!function(n,t,e){function s(n,t){return t.c=n.c,t.s0=n.s0,t.s1=n.s1,t.s2=n.s2,t}function r(n,t){var e=new function(n){var t,e=this,s=(t=4022871197,function(n){n=n.toString();for(var e=0;e<n.length;e++){var s=.02519603282416938*(t+=n.charCodeAt(e));s-=t=s>>>0,t=(s*=t)>>>0,t+=4294967296*(s-=t)}return 2.3283064365386963e-10*(t>>>0)});e.next=function(){var n=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=n-(e.c=0|n)},e.c=1,e.s0=s(" "),e.s1=s(" "),e.s2=s(" "),e.s0-=s(n),e.s0<0&&(e.s0+=1),e.s1-=s(n),e.s1<0&&(e.s1+=1),e.s2-=s(n),e.s2<0&&(e.s2+=1),s=null}(n),r=t&&t.state,o=e.next;return o.int32=function(){return 4294967296*e.next()|0},o.double=function(){return o()+1.1102230246251565e-16*(2097152*o()|0)},o.quick=o,r&&("object"==typeof r&&s(r,e),o.state=function(){return s(e,{})}),o}t&&t.exports?t.exports=r:e&&e.amd?e(function(){return r}):this.alea=r}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],325:[function(require,module,exports){
!function(t,n,e){function o(t,n){return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n}function r(t,n){var e=new function(t){var n=this,e="";n.next=function(){var t=n.b,e=n.c,o=n.d,r=n.a;return t=t<<25^t>>>7^e,e=e-o|0,o=o<<24^o>>>8^r,r=r-t|0,n.b=t=t<<20^t>>>12^e,n.c=e=e-o|0,n.d=o<<16^e>>>16^r,n.a=r-t|0},n.a=0,n.b=0,n.c=-1640531527,n.d=1367130551,t===Math.floor(t)?(n.a=t/4294967296|0,n.b=0|t):e+=t;for(var o=0;o<e.length+20;o++)n.b^=0|e.charCodeAt(o),n.next()}(t),r=n&&n.state,u=function(){return(e.next()>>>0)/4294967296};return u.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},u.int32=e.next,u.quick=u,r&&("object"==typeof r&&o(r,e),u.state=function(){return o(e,{})}),u}n&&n.exports?n.exports=r:e&&e.amd?e(function(){return r}):this.tychei=r}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],326:[function(require,module,exports){
!function(t,n,e){function o(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n}function r(t,n){var e=new function(t){var n=this,e="";n.x=0,n.y=0,n.z=0,n.w=0,n.next=function(){var t=n.x^n.x<<11;return n.x=n.y,n.y=n.z,n.z=n.w,n.w^=n.w>>>19^t^t>>>8},t===(0|t)?n.x=t:e+=t;for(var o=0;o<e.length+64;o++)n.x^=0|e.charCodeAt(o),n.next()}(t),r=n&&n.state,u=function(){return(e.next()>>>0)/4294967296};return u.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},u.int32=e.next,u.quick=u,r&&("object"==typeof r&&o(r,e),u.state=function(){return o(e,{})}),u}n&&n.exports?n.exports=r:e&&e.amd?e(function(){return r}):this.xor128=r}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],327:[function(require,module,exports){
!function(n,t,e){function r(n,t){return t.i=n.i,t.w=n.w,t.X=n.X.slice(),t}function i(n,t){null==n&&(n=+new Date);var e=new function(n){var t=this;t.next=function(){var n,e,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,e=i[o+34&127],n=i[o=o+1&127],e^=e<<13,n^=n<<17,e^=e>>>15,n^=n>>>12,e=i[o]=e^n,t.i=o,e+(r^r>>>16)|0},function(n,t){var e,r,i,o,u,f=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),i=0,o=-32;o<c;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(u=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(u=u+1640531527|0,i=0==(e=f[127&o]^=r+u)?i+1:0);for(i>=128&&(f[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=f[i+34&127],e=f[i=i+1&127],r^=r<<13,e^=e<<17,r^=r>>>15,e^=e>>>12,f[i]=r^e;n.w=u,n.X=f,n.i=i}(t,n)}(n),i=t&&t.state,o=function(){return(e.next()>>>0)/4294967296};return o.double=function(){do{var n=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},o.int32=e.next,o.quick=o,i&&(i.X&&r(i,e),o.state=function(){return r(e,{})}),o}t&&t.exports?t.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],328:[function(require,module,exports){
!function(n,t,e){function r(n,t){return t.x=n.x.slice(),t.i=n.i,t}function i(n,t){null==n&&(n=+new Date);var e=new function(n){var t=this;t.next=function(){var n,e,r=t.x,i=t.i;return n=r[i],e=(n^=n>>>7)^n<<24,e^=(n=r[i+1&7])^n>>>10,e^=(n=r[i+3&7])^n>>>3,e^=(n=r[i+4&7])^n<<7,n=r[i+7&7],e^=(n^=n<<13)^n<<9,r[i]=e,t.i=i+1&7,e},function(n,t){var e,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,e=0;e<t.length;++e)r[7&e]=r[7&e]<<15^t.charCodeAt(e)+r[e+1&7]<<13;for(;r.length<8;)r.push(0);for(e=0;e<8&&0===r[e];++e);for(8==e?r[7]=-1:r[e],n.x=r,n.i=0,e=256;e>0;--e)n.next()}(t,n)}(n),i=t&&t.state,o=function(){return(e.next()>>>0)/4294967296};return o.double=function(){do{var n=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},o.int32=e.next,o.quick=o,i&&(i.x&&r(i,e),o.state=function(){return r(e,{})}),o}t&&t.exports?t.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],329:[function(require,module,exports){
!function(t,n,e){function o(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n.v=t.v,n.d=t.d,n}function r(t,n){var e=new function(t){var n=this,e="";n.next=function(){var t=n.x^n.x>>>2;return n.x=n.y,n.y=n.z,n.z=n.w,n.w=n.v,(n.d=n.d+362437|0)+(n.v=n.v^n.v<<4^t^t<<1)|0},n.x=0,n.y=0,n.z=0,n.w=0,n.v=0,t===(0|t)?n.x=t:e+=t;for(var o=0;o<e.length+64;o++)n.x^=0|e.charCodeAt(o),o==e.length&&(n.d=n.x<<10^n.x>>>4),n.next()}(t),r=n&&n.state,u=function(){return(e.next()>>>0)/4294967296};return u.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},u.int32=e.next,u.quick=u,r&&("object"==typeof r&&o(r,e),u.state=function(){return o(e,{})}),u}n&&n.exports?n.exports=r:e&&e.amd?e(function(){return r}):this.xorwow=r}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],330:[function(require,module,exports){
!function(n,r){var t,e=this,o=256,i=6,u="random",f=r.pow(o,i),a=r.pow(2,52),c=2*a,s=o-1;function l(l,y,h){var m=[],v=d(function n(r,t){var e,o=[],i=typeof r;if(t&&"object"==i)for(e in r)try{o.push(n(r[e],t-1))}catch(n){}return o.length?o:"string"==i?r:r+"\0"}((y=1==y?{entropy:!0}:y||{}).entropy?[l,g(n)]:null==l?function(){try{var r;return t&&(r=t.randomBytes)?r=r(o):(r=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(r)),g(r)}catch(r){var i=e.navigator,u=i&&i.plugins;return[+new Date,e,u,e.screen,g(n)]}}():l,3),m),j=new function(n){var r,t=n.length,e=this,i=0,u=e.i=e.j=0,f=e.S=[];t||(n=[t++]);for(;i<o;)f[i]=i++;for(i=0;i<o;i++)f[i]=f[u=s&u+n[i%t]+(r=f[i])],f[u]=r;(e.g=function(n){for(var r,t=0,i=e.i,u=e.j,f=e.S;n--;)r=f[i=s&i+1],t=t*o+f[s&(f[i]=f[u=s&u+r])+(f[u]=r)];return e.i=i,e.j=u,t})(o)}(m),S=function(){for(var n=j.g(i),r=f,t=0;n<a;)n=(n+t)*o,r*=o,t=j.g(1);for(;n>=c;)n/=2,r/=2,t>>>=1;return(n+t)/r};return S.int32=function(){return 0|j.g(4)},S.quick=function(){return j.g(4)/4294967296},S.double=S,d(g(j.S),n),(y.pass||h||function(n,t,e,o){return o&&(o.S&&p(o,j),n.state=function(){return p(j,{})}),e?(r[u]=n,t):n})(S,v,"global"in y?y.global:this==r,y.state)}function p(n,r){return r.i=n.i,r.j=n.j,r.S=n.S.slice(),r}function d(n,r){for(var t,e=n+"",o=0;o<e.length;)r[s&o]=s&(t^=19*r[s&o])+e.charCodeAt(o++);return g(r)}function g(n){return String.fromCharCode.apply(0,n)}if(r["seed"+u]=l,d(r.random(),n),"object"==typeof module&&module.exports){module.exports=l;try{t=require("crypto")}catch(n){}}else"function"==typeof define&&define.amd&&define(function(){return l})}([],Math);

},{"crypto":298}],331:[function(require,module,exports){
var EventEmitter=require("events").EventEmitter,inherits=require("util").inherits;function Shader(e){EventEmitter.call(this),e=e||{},this.vertex=e.vertex||"",this.fragment=e.fragment||"",this.version=0,this.setMaxListeners(1e4)}inherits(Shader,EventEmitter),module.exports=Shader;

},{"events":299,"util":336}],332:[function(require,module,exports){
var Shader=require("./lib/Shader");function createShader(e){return new Shader(e=e||{})}module.exports=createShader;

},{"./lib/Shader":331}],333:[function(require,module,exports){
(function (setImmediate,clearImmediate){
var nextTick=require("process/browser.js").nextTick,apply=Function.prototype.apply,slice=Array.prototype.slice,immediateIds={},nextImmediateId=0;function Timeout(e,t){this._id=e,this._clearFn=t}exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)},exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)},exports.clearTimeout=exports.clearInterval=function(e){e.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},exports.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},exports.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},exports._unrefActive=exports.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},exports.setImmediate="function"==typeof setImmediate?setImmediate:function(e){var t=nextImmediateId++,i=!(arguments.length<2)&&slice.call(arguments,1);return immediateIds[t]=!0,nextTick(function(){immediateIds[t]&&(i?e.apply(null,i):e.call(null),exports.clearImmediate(t))}),t},exports.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(e){delete immediateIds[e]};

}).call(this,require("timers").setImmediate,require("timers").clearImmediate)
},{"process/browser.js":321,"timers":333}],334:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};

},{}],335:[function(require,module,exports){
module.exports=function(o){return o&&"object"==typeof o&&"function"==typeof o.copy&&"function"==typeof o.fill&&"function"==typeof o.readUInt8};

},{}],336:[function(require,module,exports){
(function (process,global){
var formatRegExp=/%[sdj%]/g;exports.format=function(e){if(!isString(e)){for(var r=[],t=0;t<arguments.length;t++)r.push(inspect(arguments[t]));return r.join(" ")}t=1;for(var n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e){if("%%"===e)return"%";if(t>=i)return e;switch(e){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(e){return"[Circular]"}default:return e}}),s=n[t];t<i;s=n[++t])isNull(s)||!isObject(s)?o+=" "+s:o+=" "+inspect(s);return o},exports.deprecate=function(e,r){if(isUndefined(global.process))return function(){return exports.deprecate(e,r).apply(this,arguments)};if(!0===process.noDeprecation)return e;var t=!1;return function(){if(!t){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),t=!0}return e.apply(this,arguments)}};var debugEnviron,debugs={};function inspect(e,r){var t={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),isBoolean(r)?t.showHidden=r:r&&exports._extend(t,r),isUndefined(t.showHidden)&&(t.showHidden=!1),isUndefined(t.depth)&&(t.depth=2),isUndefined(t.colors)&&(t.colors=!1),isUndefined(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=stylizeWithColor),formatValue(t,e,t.depth)}function stylizeWithColor(e,r){var t=inspect.styles[r];return t?"["+inspect.colors[t][0]+"m"+e+"["+inspect.colors[t][1]+"m":e}function stylizeNoColor(e,r){return e}function arrayToHash(e){var r={};return e.forEach(function(e,t){r[e]=!0}),r}function formatValue(e,r,t){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(t,e);return isString(n)||(n=formatValue(e,n,t)),n}var i=formatPrimitive(e,r);if(i)return i;var o=Object.keys(r),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),isError(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r);if(0===o.length){if(isFunction(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var c,a="",l=!1,p=["{","}"];(isArray(r)&&(l=!0,p=["[","]"]),isFunction(r))&&(a=" [Function"+(r.name?": "+r.name:"")+"]");return isRegExp(r)&&(a=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(a=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(a=" "+formatError(r)),0!==o.length||l&&0!=r.length?t<0?isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),c=l?formatArray(e,r,t,s,o):o.map(function(n){return formatProperty(e,r,t,s,n,l)}),e.seen.pop(),reduceToSingleString(c,a,p)):p[0]+a+p[1]}function formatPrimitive(e,r){if(isUndefined(r))return e.stylize("undefined","undefined");if(isString(r)){var t="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return isNumber(r)?e.stylize(""+r,"number"):isBoolean(r)?e.stylize(""+r,"boolean"):isNull(r)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,r,t,n,i){for(var o=[],s=0,u=r.length;s<u;++s)hasOwnProperty(r,String(s))?o.push(formatProperty(e,r,t,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(e,r,t,n,i,!0))}),o}function formatProperty(e,r,t,n,i,o){var s,u,c;if((c=Object.getOwnPropertyDescriptor(r,i)||{value:r[i]}).get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),hasOwnProperty(n,i)||(s="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=isNull(t)?formatValue(e,c.value,null):formatValue(e,c.value,t-1)).indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n")):u=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return u;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function reduceToSingleString(e,r,t){return e.reduce(function(e,r){return 0,r.indexOf("\n")>=0&&0,e+r.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?t[0]+(""===r?"":r+"\n ")+" "+e.join(",\n  ")+" "+t[1]:t[0]+r+" "+e.join(", ")+" "+t[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}exports.debuglog=function(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){var r=process.pid;debugs[e]=function(){var t=exports.format.apply(exports,arguments);console.error("%s %d: %s",e,r,t)}}else debugs[e]=function(){};return debugs[e]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var e=new Date,r=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],r].join(" ")}function hasOwnProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(e,r){if(!r||!isObject(r))return e;for(var t=Object.keys(r),n=t.length;n--;)e[t[n]]=r[t[n]];return e};

}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./support/isBuffer":335,"_process":321,"inherits":334}],337:[function(require,module,exports){
var CodeMirror=require("codemirror/lib/codemirror");require("codemirror/mode/clike/clike"),require("codemirror/addon/edit/closebrackets"),require("codemirror/addon/hint/show-hint"),require("codemirror/addon/search/match-highlighter"),require("codemirror/addon/selection/mark-selection"),require("codemirror/addon/comment/comment");var isShowing=!0,EditorClass=function(){console.log("*** Editor class created");var e=document.createElement("div");e.setAttribute("id","editor-container"),e.classList.add("fade");var t=document.createElement("TEXTAREA");(document.body.appendChild(e),e.appendChild(t),this.cm=CodeMirror.fromTextArea(t,{theme:"lucario",value:"hello",mode:{name:"x-shader/x-fragment",globalVars:!0},lineWrapping:!0,styleSelectedText:!0,autoCloseBrackets:!0,showCursorWhenSelecting:!0,highlightSelectionMatches:!0}),this.cm.setOption("extraKeys",{"Ctrl-/":()=>this.cm.execCommand("toggleComment")}),this.cm.refresh(),this.show(),"false"==new URLSearchParams(window.location.search).get("show-code"))&&(console.log("not showing code"),document.getElementsByClassName("CodeMirror-scroll")[0].style.display="none",isShowing=!1)};EditorClass.prototype.clear=function(){this.cm.setValue('\n \n // Type some code on a new line (such as "osc().out()"), and press CTRL+shift+enter')},EditorClass.prototype.setValue=function(e){this.cm.setValue(e)},EditorClass.prototype.getValue=function(){return this.cm.getValue()},EditorClass.prototype.hide=function(){var e=document.getElementsByClassName("CodeMirror-scroll")[0],t=document.getElementById("modal-header");e.style.opacity=0,t.style.opacity=0,this.isShowing=!1},EditorClass.prototype.show=function(){var e=document.getElementsByClassName("CodeMirror-scroll")[0],t=document.getElementById("modal-header");e.style.opacity=1,t.style.opacity=1,this.isShowing=!0},EditorClass.prototype.toggle=function(){this.isShowing?this.hide():this.show()},EditorClass.prototype.getLine=function(){var e=this.cm.getCursor(),t=this.cm.getLine(e.line);return this.flashCode({line:e.line,ch:0},{line:e.line+1,ch:0}),t},EditorClass.prototype.flashCode=function(e,t){var o=this.cm.markText(e,t,{className:"styled-background"});setTimeout(()=>o.clear(),300)},EditorClass.prototype.getCurrentBlock=function(){for(var e=this.cm,t=e.getCursor(),o=t.line,r=t.line;o>0&&""!==e.getLine(o);)o--;for(;r<e.lineCount()&&""!==e.getLine(r);)r++;var i={line:o,ch:0},s={line:r,ch:0},n=e.getRange(i,s);return this.flashCode(i,s),{start:i,end:s,text:n}},module.exports=EditorClass;

},{"codemirror/addon/comment/comment":301,"codemirror/addon/edit/closebrackets":302,"codemirror/addon/hint/show-hint":303,"codemirror/addon/search/match-highlighter":307,"codemirror/addon/selection/mark-selection":310,"codemirror/lib/codemirror":311,"codemirror/mode/clike/clike":312}],338:[function(require,module,exports){
let fadeTimout=1e4,timeout=window.setTimeout(()=>{document.body.classList.add("faded")},fadeTimout),handleActivity=e=>{window.clearTimeout(timeout),document.body.classList.remove("faded"),timeout=window.setTimeout(()=>{document.body.classList.add("faded")},fadeTimout)};document.body.addEventListener("mousemove",handleActivity),document.body.addEventListener("keydown",handleActivity),document.body.addEventListener("touchstart",handleActivity),module.exports=handleActivity;

},{}],339:[function(require,module,exports){
const glslify=require("glslify"),path=require("path");module.exports=require("shader-reload")({vertex:glslify(['\n// boring "pass-through" vertex shader\nprecision mediump float;\n#define GLSLIFY 1\nattribute vec2 position;\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = vec4(position, 0, 1);\n}']),fragment:glslify(["#define GLSLIFY 1\n// Welcome to Shaderbooth!\n//    ______           __        ___            __  __\n//   / __/ /  ___ ____/ /__ ____/ _ )___  ___  / /_/ /\n//  _\\ \\/ _ \\/ _ `/ _  / -_) __/ _  / _ \\/ _ \\/ __/ _ \\\n// /___/_//_/\\_,_/\\_,_/\\__/_/ /____/\\___/\\___/\\__/_//_/\n//\n\n// This is an interactive editor for making face filters with WebGL.\n// The language below is called GLSL, you can edit it to change the effect.\n// Press the arrows in the bottom right to see more examples!\n\nvoid main() {\n\n  vec3 cam = getCam(uv);\n  vec3 prev = getPrevious(uv * 1.05 + pixel * 20.);\n\n  float face = getFace(uv);\n  float eye = getEye(uv);\n  float mouth = getMouth(uv);\n\n  vec3 color = cam;\n\n  // try uncommenting this line:\n  // color = getPrevious(uv + (cam.rg-cam.bb)*0.1);\n\n  if (face > 0.2) {\n    color = cam * blue;\n    // or this one\n    // color = getPrevious(rotate(uv, 0.1) * 1.1);\n  }\n\n  // eye black\n  if (eye > 0.3) {\n    color = black;\n  }\n  if (eye > 0.6) {\n    color = cam;\n  }\n  // lipstick\n  if (mouth > 0.4) {\n    color = cam * red;\n  }\n  if (mouth > 0.6) {\n    color = cam;\n  }\n  if (max(abs(uv.x), abs(uv.y)) > 0.95) {\n    color = cam;\n  }\n  gl_FragColor = vec4(color, 1);\n}\n"])});

},{"glslify":313,"path":320,"shader-reload":332}],340:[function(require,module,exports){
let hull=require("hull.js"),canvas=document.getElementById("paint");function drawShape(e){ctx.beginPath();for(let t=0;t<e.length;t++){const l=e[t][0],r=e[t][1];0==t?ctx.moveTo(l,r):ctx.lineTo(l,r)}ctx.closePath(),ctx.stroke(),ctx.fill()}function paintFace(e){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.lineCap="round";let t=e.silhouette,l=hull(t,1e3);ctx.fillStyle="#008",ctx.strokeStyle="#004",ctx.lineWidth=2,drawShape(l),ctx.lineWidth=0,ctx.strokeStyle="rgba(1, 1, 1, 0)";let r=[...e.leftEyebrowLower,...e.leftEyebrowUpper],a=[...e.rightEyebrowLower,...e.rightEyebrowUpper];ctx.fillStyle="#048",drawShape(hull(r,20)),drawShape(hull(a,20));let h=[...e.leftEyeLower2,...e.leftEyeUpper2],i=[...e.rightEyeLower2,...e.rightEyeUpper2];ctx.fillStyle="#088",drawShape(hull(h,1e3)),drawShape(hull(i,1e3));let p=[...e.leftEyeLower1,...e.leftEyeUpper1],c=[...e.rightEyeLower1,...e.rightEyeUpper1];ctx.fillStyle="#0C8",drawShape(hull(p,1e3)),drawShape(hull(c,1e3));let o=[...e.leftEyeLower0,...e.leftEyeUpper0],n=[...e.rightEyeLower0,...e.rightEyeUpper0];ctx.fillStyle="#0f8",drawShape(hull(o,1e3)),drawShape(hull(n,1e3));let w=[...e.lipsUpperOuter,...e.lipsLowerOuter];ctx.fillStyle="#808",drawShape(hull(w,1e3));let y=[...e.lipsUpperInner,...e.lipsLowerInner];ctx.fillStyle="#F08",drawShape(hull(y,1e3));let x=[...e.noseBottom,...e.noseTip,...e.noseLeftCorner,...e.midwayBetweenEyes,...e.noseRightCorner],s=hull(x,1e3);return ctx.fillStyle="#00F",ctx.strokeStyle="#00C",ctx.lineWidth=2,drawShape(s),ctx}ctx=canvas.getContext("2d"),ctx.translate(canvas.width,0),ctx.scale(-1,1),module.exports={paintFace:paintFace};

},{"hull.js":317}],341:[function(require,module,exports){
(function (Buffer){
let infoButton=document.getElementById("info");infoButton.addEventListener("click",()=>{document.getElementById("info-box").classList.toggle("hidden"),infoButton.classList.toggle("open")});let prefix=Buffer("cHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7Cgp2YXJ5aW5nIHZlYzIgdXY7CnVuaWZvcm0gZmxvYXQgdGltZTsKdW5pZm9ybSB2ZWMyIHJlc29sdXRpb247CnVuaWZvcm0gdmVjMiB2aWRlb1Jlc29sdXRpb247CnVuaWZvcm0gdmVjMiBzY2FsZWRWaWRlb1Jlc29sdXRpb247CnVuaWZvcm0gdmVjMiBmYWNlQ2VudGVyOwp1bmlmb3JtIHNhbXBsZXIyRCBjYW1UZXg7CnVuaWZvcm0gc2FtcGxlcjJEIG1hc2tUZXg7CnVuaWZvcm0gc2FtcGxlcjJEIHByZXZpb3VzVGV4OwovLyBTUEFDRVIKdmVjMiBwaXhlbCA9IDEuMCAvIHJlc29sdXRpb247CgojZGVmaW5lIFBJIDMuMTQxNTkyNjUzOAojZGVmaW5lIFRBVSA2LjI4MzE4NTMwNwoKLy8gU1BBQ0VSCgp2ZWMzIGdldENhbSh2ZWMyIHBvcykgewogIHZlYzIgcmVzUmF0aW8gPSBzY2FsZWRWaWRlb1Jlc29sdXRpb24gLyByZXNvbHV0aW9uOwogIHZlYzIgd2ViY2FtQ29vcmQgPSAocG9zIC8gcmVzUmF0aW8pIC8gMi4wICsgdmVjMigwLjUpOwogIHZlYzIgZmxpcHdjb3JkID0gdmVjMigxLikgLSB3ZWJjYW1Db29yZDsKICByZXR1cm4gdGV4dHVyZTJEKGNhbVRleCwgZmxpcHdjb3JkKS5yZ2I7Cn0KCnZlYzMgZ2V0UHJldmlvdXModmVjMiBwb3MpIHsKICB2ZWMyIGJhY2tDb29yZCA9IChwb3MgLyAyLjApICsgdmVjMigwLjUpOwogIHJldHVybiB0ZXh0dXJlMkQocHJldmlvdXNUZXgsIGJhY2tDb29yZCkucmdiOwp9Ci8vIFNQQUNFUgoKLy8gQWNjZXNzIEZhY2lhbCBGZWF0dXJlIE1hc2tzCgpmbG9hdCBnZXRGYWNlKHZlYzIgcG9zKSB7CiAgdmVjMiByZXNSYXRpbyA9IHNjYWxlZFZpZGVvUmVzb2x1dGlvbiAvIHJlc29sdXRpb247CiAgdmVjMiB3ZWJjYW1Db29yZCA9IChwb3MgLyByZXNSYXRpbykgLyAyLjAgKyB2ZWMyKDAuNSk7CiAgdmVjMiBmbGlwd2NvcmQgPSB2ZWMyKDEuKSAtIHdlYmNhbUNvb3JkOwogIHJldHVybiB0ZXh0dXJlMkQobWFza1RleCwgZmxpcHdjb3JkKS5iOwp9CmZsb2F0IGdldEV5ZSh2ZWMyIHBvcykgewogIHZlYzIgcmVzUmF0aW8gPSBzY2FsZWRWaWRlb1Jlc29sdXRpb24gLyByZXNvbHV0aW9uOwogIHZlYzIgd2ViY2FtQ29vcmQgPSAocG9zIC8gcmVzUmF0aW8pIC8gMi4wICsgdmVjMigwLjUpOwogIHZlYzIgZmxpcHdjb3JkID0gdmVjMigxLikgLSB3ZWJjYW1Db29yZDsKICByZXR1cm4gdGV4dHVyZTJEKG1hc2tUZXgsIGZsaXB3Y29yZCkuZzsKfQpmbG9hdCBnZXRNb3V0aCh2ZWMyIHBvcykgewogIHZlYzIgcmVzUmF0aW8gPSBzY2FsZWRWaWRlb1Jlc29sdXRpb24gLyByZXNvbHV0aW9uOwogIHZlYzIgd2ViY2FtQ29vcmQgPSAocG9zIC8gcmVzUmF0aW8pIC8gMi4wICsgdmVjMigwLjUpOwogIHZlYzIgZmxpcHdjb3JkID0gdmVjMigxLikgLSB3ZWJjYW1Db29yZDsKICByZXR1cm4gdGV4dHVyZTJEKG1hc2tUZXgsIGZsaXB3Y29yZCkucjsKfQoKLy8gU1BBQ0VSCnZlYzIgcm90YXRlKHZlYzIgdiwgZmxvYXQgYSkgewogIGZsb2F0IHMgPSBzaW4oYSk7CiAgZmxvYXQgYyA9IGNvcyhhKTsKICBtYXQyIG0gPSBtYXQyKGMsIC1zLCBzLCBjKTsKICByZXR1cm4gbSAqIHY7Cn0KLy8gU1BBQ0VSCgpmbG9hdCBtYXAoZmxvYXQgdmFsdWUsIGZsb2F0IG1pbjEsIGZsb2F0IG1heDEsIGZsb2F0IG1pbjIsIGZsb2F0IG1heDIpIHsKICByZXR1cm4gbWluMiArICh2YWx1ZSAtIG1pbjEpICogKG1heDIgLSBtaW4yKSAvIChtYXgxIC0gbWluMSk7Cn0KCi8vIFNQQUNFUgovLyBDb2xvciBTaG9ydGhhbmRzCgp2ZWMzIGJsYWNrID0gdmVjMygwLjApOwp2ZWMzIHdoaXRlID0gdmVjMygxLjApOwp2ZWMzIHJlZCA9IHZlYzMoMC44NiwgMC4yMiwgMC4yNyk7CnZlYzMgb3JhbmdlID0gdmVjMygwLjkyLCAwLjQ5LCAwLjA3KTsKdmVjMyB5ZWxsb3cgPSB2ZWMzKDAuOTEsIDAuODksIDAuMjYpOwp2ZWMzIGdyZWVuID0gdmVjMygwLjAsIDAuNzEsIDAuMzEpOwp2ZWMzIGJsdWUgPSB2ZWMzKDAuMDUsIDAuMzUsIDAuNjUpOwp2ZWMzIHB1cnBsZSA9IHZlYzMoMC4zOCwgMC4wOSwgMC42NCk7CnZlYzMgcGluayA9IHZlYzMoLjksIDAuNzU4LCAwLjc5OCk7CnZlYzMgbGltZSA9IHZlYzMoMC4zNjEsIDAuOTY5LCAwLjI4Mik7CnZlYzMgdGVhbCA9IHZlYzMoMC4zOTYsIDAuODc4LCAwLjg3OCk7CnZlYzMgbWFnZW50YSA9IHZlYzMoMS4wLCAwLjE4OSwgMC43NDUpOwp2ZWMzIGJyb3duID0gdmVjMygwLjk2LCAwLjQ3NCwgMC4yMjcpOwovLyBTUEFDRVIKZmxvYXQgcmFuZChmbG9hdCBuKSB7IHJldHVybiBmcmFjdChzaW4obikgKiA0Mzc1OC41NDUzMTIzKTsgfQoKLy8gMUQsIDJELCAzRCBTaW1wbGV4IE5vaXNlCmZsb2F0IG5vaXNlKGZsb2F0IHApIHsKICBmbG9hdCBmbCA9IGZsb29yKHApOwogIGZsb2F0IGZjID0gZnJhY3QocCk7CiAgcmV0dXJuIG1peChyYW5kKGZsKSwgcmFuZChmbCArIDEuMCksIGZjKTsKfQoKLy8gSU5URVJOQUwKdmVjMyBtb2QyODkodmVjMyB4KSB7IHJldHVybiB4IC0gZmxvb3IoeCAqICgxLjAgLyAyODkuMCkpICogMjg5LjA7IH0KLy8gSU5URVJOQUwKdmVjMiBtb2QyODkodmVjMiB4KSB7IHJldHVybiB4IC0gZmxvb3IoeCAqICgxLjAgLyAyODkuMCkpICogMjg5LjA7IH0KLy8gSU5URVJOQUwKdmVjMyBwZXJtdXRlKHZlYzMgeCkgeyByZXR1cm4gbW9kMjg5KCgoeCAqIDM0LjApICsgMS4wKSAqIHgpOyB9CgpmbG9hdCBub2lzZSh2ZWMyIHYpIHsKICBjb25zdCB2ZWM0IEMgPSB2ZWM0KDAuMjExMzI0ODY1NDA1MTg3LCAgLy8gKDMuMC1zcXJ0KDMuMCkpLzYuMAogICAgICAgICAgICAgICAgICAgICAgMC4zNjYwMjU0MDM3ODQ0MzksICAvLyAwLjUqKHNxcnQoMy4wKS0xLjApCiAgICAgICAgICAgICAgICAgICAgICAtMC41NzczNTAyNjkxODk2MjYsIC8vIC0xLjAgKyAyLjAgKiBDLngKICAgICAgICAgICAgICAgICAgICAgIDAuMDI0MzkwMjQzOTAyNDM5KTsgLy8gMS4wIC8gNDEuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGaXJzdCBjb3JuZXIKICB2ZWMyIGkgPSBmbG9vcih2ICsgZG90KHYsIEMueXkpKTsKICB2ZWMyIHgwID0gdiAtIGkgKyBkb3QoaSwgQy54eCk7CgogIC8vIE90aGVyIGNvcm5lcnMKICB2ZWMyIGkxOwogIC8vIGkxLnggPSBzdGVwKCB4MC55LCB4MC54ICk7IC8vIHgwLnggPiB4MC55ID8gMS4wIDogMC4wCiAgLy8gaTEueSA9IDEuMCAtIGkxLng7CiAgaTEgPSAoeDAueCA+IHgwLnkpID8gdmVjMigxLjAsIDAuMCkgOiB2ZWMyKDAuMCwgMS4wKTsKICAvLyB4MCA9IHgwIC0gMC4wICsgMC4wICogQy54eCA7CiAgLy8geDEgPSB4MCAtIGkxICsgMS4wICogQy54eCA7CiAgLy8geDIgPSB4MCAtIDEuMCArIDIuMCAqIEMueHggOwogIHZlYzQgeDEyID0geDAueHl4eSArIEMueHh6ejsKICB4MTIueHkgLT0gaTE7CgogIC8vIFBlcm11dGF0aW9ucwogIGkgPSBtb2QyODkoaSk7IC8vIEF2b2lkIHRydW5jYXRpb24gZWZmZWN0cyBpbiBwZXJtdXRhdGlvbgogIHZlYzMgcCA9CiAgICAgIHBlcm11dGUocGVybXV0ZShpLnkgKyB2ZWMzKDAuMCwgaTEueSwgMS4wKSkgKyBpLnggKyB2ZWMzKDAuMCwgaTEueCwgMS4wKSk7CgogIHZlYzMgbSA9IG1heCgKICAgICAgMC41IC0gdmVjMyhkb3QoeDAsIHgwKSwgZG90KHgxMi54eSwgeDEyLnh5KSwgZG90KHgxMi56dywgeDEyLnp3KSksIDAuMCk7CiAgbSA9IG0gKiBtOwogIG0gPSBtICogbTsKCiAgLy8gR3JhZGllbnRzOiA0MSBwb2ludHMgdW5pZm9ybWx5IG92ZXIgYSBsaW5lLCBtYXBwZWQgb250byBhIGRpYW1vbmQuCiAgLy8gVGhlIHJpbmcgc2l6ZSAxNyoxNyA9IDI4OSBpcyBjbG9zZSB0byBhIG11bHRpcGxlIG9mIDQxICg0MSo3ID0gMjg3KQoKICB2ZWMzIHggPSAyLjAgKiBmcmFjdChwICogQy53d3cpIC0gMS4wOwogIHZlYzMgaCA9IGFicyh4KSAtIDAuNTsKICB2ZWMzIG94ID0gZmxvb3IoeCArIDAuNSk7CiAgdmVjMyBhMCA9IHggLSBveDsKCiAgLy8gTm9ybWFsaXNlIGdyYWRpZW50cyBpbXBsaWNpdGx5IGJ5IHNjYWxpbmcgbQogIC8vIEFwcHJveGltYXRpb24gb2Y6IG0gKj0gaW52ZXJzZXNxcnQoIGEwKmEwICsgaCpoICk7CiAgbSAqPSAxLjc5Mjg0MjkxNDAwMTU5IC0gMC44NTM3MzQ3MjA5NTMxNCAqIChhMCAqIGEwICsgaCAqIGgpOwoKICAvLyBDb21wdXRlIGZpbmFsIG5vaXNlIHZhbHVlIGF0IFAKICB2ZWMzIGc7CiAgZy54ID0gYTAueCAqIHgwLnggKyBoLnggKiB4MC55OwogIGcueXogPSBhMC55eiAqIHgxMi54eiArIGgueXogKiB4MTIueXc7CiAgcmV0dXJuIDEzMC4wICogZG90KG0sIGcpOwp9CgovLyBJTlRFUk5BTAp2ZWMzIG1vZDI4OV8zKHZlYzMgeCkgeyByZXR1cm4geCAtIGZsb29yKHggKiAoMS4wIC8gMjg5LjApKSAqIDI4OS4wOyB9Ci8vIElOVEVSTkFMCnZlYzQgbW9kMjg5XzQodmVjNCB4KSB7IHJldHVybiB4IC0gZmxvb3IoeCAqICgxLjAgLyAyODkuMCkpICogMjg5LjA7IH0KLy8gSU5URVJOQUwKdmVjNCBwZXJtdXRlKHZlYzQgeCkgeyByZXR1cm4gbW9kMjg5XzQoKCh4ICogMzQuMCkgKyAxLjApICogeCk7IH0KLy8gSU5URVJOQUwKdmVjNCB0YXlsb3JJbnZTcXJ0KHZlYzQgcikgeyByZXR1cm4gMS43OTI4NDI5MTQwMDE1OSAtIDAuODUzNzM0NzIwOTUzMTQgKiByOyB9CgpmbG9hdCBub2lzZSh2ZWMzIHYpIHsKICBjb25zdCB2ZWMyIEMgPSB2ZWMyKDEuMCAvIDYuMCwgMS4wIC8gMy4wKTsKICBjb25zdCB2ZWM0IEQgPSB2ZWM0KDAuMCwgMC41LCAxLjAsIDIuMCk7CgogIC8vIEZpcnN0IGNvcm5lcgogIHZlYzMgaSA9IGZsb29yKHYgKyBkb3QodiwgQy55eXkpKTsKICB2ZWMzIHgwID0gdiAtIGkgKyBkb3QoaSwgQy54eHgpOwoKICAvLyBPdGhlciBjb3JuZXJzCiAgdmVjMyBnID0gc3RlcCh4MC55engsIHgwLnh5eik7CiAgdmVjMyBsID0gMS4wIC0gZzsKICB2ZWMzIGkxID0gbWluKGcueHl6LCBsLnp4eSk7CiAgdmVjMyBpMiA9IG1heChnLnh5eiwgbC56eHkpOwoKICAvLyAgIHgwID0geDAgLSAwLjAgKyAwLjAgKiBDLnh4eDsKICAvLyAgIHgxID0geDAgLSBpMSAgKyAxLjAgKiBDLnh4eDsKICAvLyAgIHgyID0geDAgLSBpMiAgKyAyLjAgKiBDLnh4eDsKICAvLyAgIHgzID0geDAgLSAxLjAgKyAzLjAgKiBDLnh4eDsKICB2ZWMzIHgxID0geDAgLSBpMSArIEMueHh4OwogIHZlYzMgeDIgPSB4MCAtIGkyICsgQy55eXk7IC8vIDIuMCpDLnggPSAxLzMgPSBDLnkKICB2ZWMzIHgzID0geDAgLSBELnl5eTsgICAgICAvLyAtMS4wKzMuMCpDLnggPSAtMC41ID0gLUQueQoKICAvLyBQZXJtdXRhdGlvbnMKICBpID0gbW9kMjg5XzMoaSk7CiAgdmVjNCBwID0gcGVybXV0ZShwZXJtdXRlKHBlcm11dGUoaS56ICsgdmVjNCgwLjAsIGkxLnosIGkyLnosIDEuMCkpICsgaS55ICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVjNCgwLjAsIGkxLnksIGkyLnksIDEuMCkpICsKICAgICAgICAgICAgICAgICAgIGkueCArIHZlYzQoMC4wLCBpMS54LCBpMi54LCAxLjApKTsKCiAgLy8gR3JhZGllbnRzOiA3eDcgcG9pbnRzIG92ZXIgYSBzcXVhcmUsIG1hcHBlZCBvbnRvIGFuIG9jdGFoZWRyb24uCiAgLy8gVGhlIHJpbmcgc2l6ZSAxNyoxNyA9IDI4OSBpcyBjbG9zZSB0byBhIG11bHRpcGxlIG9mIDQ5ICg0OSo2ID0gMjk0KQogIGZsb2F0IG5fID0gMC4xNDI4NTcxNDI4NTc7IC8vIDEuMC83LjAKICB2ZWMzIG5zID0gbl8gKiBELnd5eiAtIEQueHp4OwoKICB2ZWM0IGogPSBwIC0gNDkuMCAqIGZsb29yKHAgKiBucy56ICogbnMueik7IC8vICBtb2QocCw3KjcpCgogIHZlYzQgeF8gPSBmbG9vcihqICogbnMueik7CiAgdmVjNCB5XyA9IGZsb29yKGogLSA3LjAgKiB4Xyk7IC8vIG1vZChqLE4pCgogIHZlYzQgeCA9IHhfICogbnMueCArIG5zLnl5eXk7CiAgdmVjNCB5ID0geV8gKiBucy54ICsgbnMueXl5eTsKICB2ZWM0IGggPSAxLjAgLSBhYnMoeCkgLSBhYnMoeSk7CgogIHZlYzQgYjAgPSB2ZWM0KHgueHksIHkueHkpOwogIHZlYzQgYjEgPSB2ZWM0KHguencsIHkuencpOwoKICAvLyB2ZWM0IHMwID0gdmVjNChsZXNzVGhhbihiMCwwLjApKSoyLjAgLSAxLjA7CiAgLy8gdmVjNCBzMSA9IHZlYzQobGVzc1RoYW4oYjEsMC4wKSkqMi4wIC0gMS4wOwogIHZlYzQgczAgPSBmbG9vcihiMCkgKiAyLjAgKyAxLjA7CiAgdmVjNCBzMSA9IGZsb29yKGIxKSAqIDIuMCArIDEuMDsKICB2ZWM0IHNoID0gLXN0ZXAoaCwgdmVjNCgwLjApKTsKCiAgdmVjNCBhMCA9IGIwLnh6eXcgKyBzMC54enl3ICogc2gueHh5eTsKICB2ZWM0IGExID0gYjEueHp5dyArIHMxLnh6eXcgKiBzaC56end3OwoKICB2ZWMzIHAwID0gdmVjMyhhMC54eSwgaC54KTsKICB2ZWMzIHAxID0gdmVjMyhhMC56dywgaC55KTsKICB2ZWMzIHAyID0gdmVjMyhhMS54eSwgaC56KTsKICB2ZWMzIHAzID0gdmVjMyhhMS56dywgaC53KTsKCiAgLy8gTm9ybWFsaXNlIGdyYWRpZW50cwogIHZlYzQgbm9ybSA9CiAgICAgIHRheWxvckludlNxcnQodmVjNChkb3QocDAsIHAwKSwgZG90KHAxLCBwMSksIGRvdChwMiwgcDIpLCBkb3QocDMsIHAzKSkpOwogIHAwICo9IG5vcm0ueDsKICBwMSAqPSBub3JtLnk7CiAgcDIgKj0gbm9ybS56OwogIHAzICo9IG5vcm0udzsKCiAgLy8gTWl4IGZpbmFsIG5vaXNlIHZhbHVlCiAgdmVjNCBtID0KICAgICAgbWF4KDAuNiAtIHZlYzQoZG90KHgwLCB4MCksIGRvdCh4MSwgeDEpLCBkb3QoeDIsIHgyKSwgZG90KHgzLCB4MykpLCAwLjApOwogIG0gPSBtICogbTsKICByZXR1cm4gNDIuMCAqCiAgICAgICAgIGRvdChtICogbSwgdmVjNChkb3QocDAsIHgwKSwgZG90KHAxLCB4MSksIGRvdChwMiwgeDIpLCBkb3QocDMsIHgzKSkpOwp9CgovLyBGcmFjdGFsIEJyb3duaWFuIE5vaXNlCmZsb2F0IGZibihmbG9hdCB4LCBjb25zdCBpbiBpbnQgaXRlcmF0aW9ucykgewogIGZsb2F0IHYgPSAwLjA7CiAgZmxvYXQgYSA9IDAuNTsKICBmbG9hdCBzaGlmdCA9IGZsb2F0KDEwMCk7CiAgZm9yIChpbnQgaSA9IDA7IGkgPCAzMjsgKytpKSB7CiAgICBpZiAoaSA8IGl0ZXJhdGlvbnMpIHsKICAgICAgdiArPSBhICogbm9pc2UoeCk7CiAgICAgIHggPSB4ICogMi4wICsgc2hpZnQ7CiAgICAgIGEgKj0gMC41OwogICAgfQogIH0KICByZXR1cm4gdjsKfQoKZmxvYXQgZmJuKHZlYzIgeCwgY29uc3QgaW4gaW50IGl0ZXJhdGlvbnMpIHsKICBmbG9hdCB2ID0gMC4wOwogIGZsb2F0IGEgPSAwLjU7CiAgdmVjMiBzaGlmdCA9IHZlYzIoMTAwKTsKICAvLyBSb3RhdGUgdG8gcmVkdWNlIGF4aWFsIGJpYXMKICBtYXQyIHJvdCA9IG1hdDIoY29zKDAuNSksIHNpbigwLjUpLCAtc2luKDAuNSksIGNvcygwLjUwKSk7CiAgZm9yIChpbnQgaSA9IDA7IGkgPCAzMjsgKytpKSB7CiAgICBpZiAoaSA8IGl0ZXJhdGlvbnMpIHsKICAgICAgdiArPSBhICogbm9pc2UoeCk7CiAgICAgIHggPSByb3QgKiB4ICogMi4wICsgc2hpZnQ7CiAgICAgIGEgKj0gMC41OwogICAgfQogIH0KICByZXR1cm4gdjsKfQoKZmxvYXQgZmJuKHZlYzMgeCwgY29uc3QgaW4gaW50IGl0ZXJhdGlvbnMpIHsKICBmbG9hdCB2ID0gMC4wOwogIGZsb2F0IGEgPSAwLjU7CiAgdmVjMyBzaGlmdCA9IHZlYzMoMTAwKTsKICBmb3IgKGludCBpID0gMDsgaSA8IDMyOyArK2kpIHsKICAgIGlmIChpIDwgaXRlcmF0aW9ucykgewogICAgICB2ICs9IGEgKiBub2lzZSh4KTsKICAgICAgeCA9IHggKiAyLjAgKyBzaGlmdDsKICAgICAgYSAqPSAwLjU7CiAgICB9CiAgfQogIHJldHVybiB2Owp9Ci8vIFNQQUNFUgovLyBJTlRFUk5BTApmbG9hdCBodWUycmdiKGZsb2F0IGYxLCBmbG9hdCBmMiwgZmxvYXQgaHVlKSB7CiAgLy8gaHR0cDovL3d3dy5jaGlsbGlhbnQuY29tL3JnYjJoc3YuaHRtbAoKICBpZiAoaHVlIDwgMC4wKQogICAgaHVlICs9IDEuMDsKICBlbHNlIGlmIChodWUgPiAxLjApCiAgICBodWUgLT0gMS4wOwogIGZsb2F0IHJlczsKICBpZiAoKDYuMCAqIGh1ZSkgPCAxLjApCiAgICByZXMgPSBmMSArIChmMiAtIGYxKSAqIDYuMCAqIGh1ZTsKICBlbHNlIGlmICgoMi4wICogaHVlKSA8IDEuMCkKICAgIHJlcyA9IGYyOwogIGVsc2UgaWYgKCgzLjAgKiBodWUpIDwgMi4wKQogICAgcmVzID0gZjEgKyAoZjIgLSBmMSkgKiAoKDIuMCAvIDMuMCkgLSBodWUpICogNi4wOwogIGVsc2UKICAgIHJlcyA9IGYxOwogIHJldHVybiByZXM7Cn0KCi8vIENvbG9yIFNwYWNlIENvbnZlcnNpb24KCnZlYzMgaHNsMnJnYih2ZWMzIGhzbCkgewogIHZlYzMgcmdiOwoKICBpZiAoaHNsLnkgPT0gMC4wKSB7CiAgICByZ2IgPSB2ZWMzKGhzbC56KTsgLy8gTHVtaW5hbmNlCiAgfSBlbHNlIHsKICAgIGZsb2F0IGYyOwoKICAgIGlmIChoc2wueiA8IDAuNSkKICAgICAgZjIgPSBoc2wueiAqICgxLjAgKyBoc2wueSk7CiAgICBlbHNlCiAgICAgIGYyID0gaHNsLnogKyBoc2wueSAtIGhzbC55ICogaHNsLno7CgogICAgZmxvYXQgZjEgPSAyLjAgKiBoc2wueiAtIGYyOwoKICAgIHJnYi5yID0gaHVlMnJnYihmMSwgZjIsIGhzbC54ICsgKDEuMCAvIDMuMCkpOwogICAgcmdiLmcgPSBodWUycmdiKGYxLCBmMiwgaHNsLngpOwogICAgcmdiLmIgPSBodWUycmdiKGYxLCBmMiwgaHNsLnggLSAoMS4wIC8gMy4wKSk7CiAgfQogIHJldHVybiByZ2I7Cn0KCnZlYzMgaHNsMnJnYihmbG9hdCBoLCBmbG9hdCBzLCBmbG9hdCBsKSB7IHJldHVybiBoc2wycmdiKHZlYzMoaCwgcywgbCkpOyB9CgovLyBJTlRFUk5BTAp2ZWMzIFJHQnRvSENWKHZlYzMgcmdiKSB7CiAgLy8gQmFzZWQgb24gd29yayBieSBTYW0gSG9jZXZhciBhbmQgRW1pbCBQZXJzc29uCiAgdmVjNCBwID0gKHJnYi5nIDwgcmdiLmIpID8gdmVjNChyZ2IuYmcsIC0xLjAsIDIuMCAvIDMuMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB2ZWM0KHJnYi5nYiwgMC4wLCAtMS4wIC8gMy4wKTsKICB2ZWM0IHEgPSAocmdiLnIgPCBwLngpID8gdmVjNChwLnh5dywgcmdiLnIpIDogdmVjNChyZ2IuciwgcC55engpOwogIGZsb2F0IGMgPSBxLnggLSBtaW4ocS53LCBxLnkpOwogIGZsb2F0IGggPSBhYnMoKHEudyAtIHEueSkgLyAoNi4wICogYyArIDFlLTEwKSArIHEueik7CiAgcmV0dXJuIHZlYzMoaCwgYywgcS54KTsKfQoKdmVjMyByZ2IyaHNsKHZlYzMgcmdiKSB7CiAgdmVjMyBoY3YgPSBSR0J0b0hDVihyZ2IpOwogIGZsb2F0IGwgPSBoY3YueiAtIGhjdi55ICogMC41OwogIGZsb2F0IHMgPSBoY3YueSAvICgxLjAgLSBhYnMobCAqIDIuMCAtIDEuMCkgKyAxZS0xMCk7CiAgcmV0dXJuIHZlYzMoaGN2LngsIHMsIGwpOwp9Cgp2ZWMzIHJnYjJoc2woZmxvYXQgciwgZmxvYXQgZywgZmxvYXQgYikgeyByZXR1cm4gcmdiMmhzbCh2ZWMzKHIsIGcsIGIpKTsgfQoKZmxvYXQgbHVtYSh2ZWMzIGNvbG9yKSB7IHJldHVybiBkb3QoY29sb3IsIHZlYzMoMC4yOTksIDAuNTg3LCAwLjExNCkpOyB9Cg==","base64").toString();var CodeMirror=require("codemirror/lib/codemirror");require("codemirror/mode/clike/clike"),require("codemirror/addon/runmode/runmode"),require("codemirror/addon/runmode/colorize");let reference=document.getElementById("reference");prefix=(prefix=(prefix=(prefix=(prefix=(prefix=(prefix=(prefix=(prefix=(prefix=(prefix=(prefix=(prefix=(prefix=(prefix=(prefix=prefix.replace("precision mediump float;\n","")).replace(/ *\{[^}]*\} */g,"{}")).replace(/ *\{[^}]*\} */g,"{}")).replace(/ *\{[^}]*\} */g,"{}")).replace(/ *\{[^}]*\} */g,"{}")).replace(/ *\{[^}]*\} */g,"{}")).replace(/ *\{[^}]*\} */g,"{}")).replace("{}else{}\n  return rgb;\n}","{}")).replace("{}\n  }\n  return v;\n}","{}")).replace("{}\n  }\n  return v;\n}","{}")).replace("{}\n  }\n  return v;\n}","{}")).replace("{}\n  }\n  return v;\n}","{}")).replace(/\/\/ INTERNAL\n.*\n/g,"")).replace(/\n\n/g,"\n")).replace(/\n\n/g,"\n")).replace(/\/\/ SPACER\n/g,"\n"),CodeMirror.runMode(prefix,"x-shader/x-fragment",reference);

}).call(this,require("buffer").Buffer)
},{"buffer":300,"codemirror/addon/runmode/colorize":304,"codemirror/addon/runmode/runmode":305,"codemirror/lib/codemirror":311,"codemirror/mode/clike/clike":312}],342:[function(require,module,exports){
let model,keypoints,facemesh=require("@tensorflow-models/facemesh"),tf=require("@tensorflow/tfjs-core"),loader=document.getElementById("loading"),video=null;async function loadModel(){model=await facemesh.load({maxFaces:1}),loader.style="display:none"}let dirty=!1;async function predictionLoop(){if(!model||!video)return window.requestAnimationFrame(predictionLoop),null;const e=await model.estimateFaces(video);if(e.length>0)for(let o=0;o<e.length;o++)keypoints=e[o].annotations,dirty=!0;window.requestAnimationFrame(predictionLoop)}function getKeyPoints(){return!!dirty&&(dirty=!1,keypoints)}function setupWebcam(e){const o=e.regl;window.onload=function(){video=document.getElementById("video");let t=document.getElementById("start"),i=document.getElementById("paint"),n=document.getElementById("target");function d(){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(a).catch(e=>{console.log("initial gum failed")}),t.hidden=!0}function a(t){loader.innerText="Loading Model...","srcObject"in video?video.srcObject=t:video.src=window.URL&&window.URL.createObjectURL(t),video.onloadedmetadata=function(){console.log("metadata loaded");const t=o.texture(video),{videoWidth:d,videoHeight:a}=video;var l=d,c=a;video.height=c,video.width=l,i.height=c,i.width=l,n.height=c,n.width=l,predictionLoop(),o.frame(()=>t.subimage(video)),e.done(t,{videoWidth:d,videoHeight:a,getKeyPoints:getKeyPoints})}}d(),t.onclick=function(){console.log("play!"),d()},video.onresize=function(){},video.addEventListener("canplay",function(e){video.play()},!1)}}loadModel(),module.exports={setupWebcam:setupWebcam};

},{"@tensorflow-models/facemesh":6,"@tensorflow/tfjs-core":175}]},{},[1]);
